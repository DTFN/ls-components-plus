"use strict";var j=Object.defineProperty;var s=(u,r)=>j(u,"name",{value:r,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("../../../../../@vueuse_shared@12.0.0_typescript@5.5.4/node_modules/@vueuse/shared/index/index.cjs"),O=require("vue"),I=e.isClient?window:void 0;function M(u){var r;const l=e.toValue(u);return(r=l==null?void 0:l.$el)!=null?r:l}s(M,"unrefElement");function _(...u){let r,l,a,d;if(typeof u[0]=="string"||Array.isArray(u[0])?([l,a,d]=u,r=I):[r,l,a,d]=u,!r)return e.noop;Array.isArray(l)||(l=[l]),Array.isArray(a)||(a=[a]);const p=[],C=s(()=>{p.forEach(o=>o()),p.length=0},"cleanup"),D=s((o,n,f,v)=>(o.addEventListener(n,f,v),()=>o.removeEventListener(n,f,v)),"register"),T=O.watch(()=>[M(r),e.toValue(d)],([o,n])=>{if(C(),!o)return;const f=e.isObject(n)?{...n}:n;p.push(...l.flatMap(v=>a.map(y=>D(o,v,y,f))))},{immediate:!0,flush:"post"}),b=s(()=>{T(),C()},"stop");return e.tryOnScopeDispose(b),b}s(_,"useEventListener");const F="ping";function R(u){return u===!0?{}:u}s(R,"resolveNestedOptions");function V(u,r={}){const{onConnected:l,onDisconnected:a,onError:d,onMessage:p,immediate:C=!0,autoClose:D=!0,protocols:T=[]}=r,b=O.ref(null),o=O.ref("CLOSED"),n=O.ref(),f=e.toRef(u);let v,y,E=!1,S=0,g=[],w;const L=s(()=>{if(g.length&&n.value&&o.value==="OPEN"){for(const t of g)n.value.send(t);g=[]}},"_sendBuffer"),k=s(()=>{clearTimeout(w),w=void 0},"resetHeartbeat"),h=s((t=1e3,i)=>{!e.isClient||!n.value||(E=!0,k(),v==null||v(),n.value.close(t,i),n.value=void 0)},"close"),P=s((t,i=!0)=>!n.value||o.value!=="OPEN"?(i&&g.push(t),!1):(L(),n.value.send(t),!0),"send"),A=s(()=>{if(E||typeof f.value>"u")return;const t=new WebSocket(f.value,T);n.value=t,o.value="CONNECTING",t.onopen=()=>{o.value="OPEN",S=0,l==null||l(t),y==null||y(),L()},t.onclose=i=>{if(o.value="CLOSED",a==null||a(t,i),!E&&r.autoReconnect&&(n.value==null||t===n.value)){const{retries:c=-1,delay:m=1e3,onFailed:W}=R(r.autoReconnect);typeof c=="number"&&(c<0||S<c)?(S+=1,setTimeout(A,m)):typeof c=="function"&&c()?setTimeout(A,m):W==null||W()}},t.onerror=i=>{d==null||d(t,i)},t.onmessage=i=>{if(r.heartbeat){k();const{message:c=F,responseMessage:m=c}=R(r.heartbeat);if(i.data===m)return}b.value=i.data,p==null||p(t,i)}},"_init");if(r.heartbeat){const{message:t=F,interval:i=1e3,pongTimeout:c=1e3}=R(r.heartbeat),{pause:m,resume:W}=e.useIntervalFn(()=>{P(t,!1),w==null&&(w=setTimeout(()=>{h(),E=!1},c))},i,{immediate:!1});v=m,y=W}D&&(e.isClient&&_("beforeunload",()=>h()),e.tryOnScopeDispose(h));const N=s(()=>{!e.isClient&&!e.isWorker||(h(),E=!1,S=0,A())},"open");return C&&N(),O.watch(f,N),{data:b,status:o,close:h,send:P,open:N,ws:n}}s(V,"useWebSocket");exports.isClient=e.isClient;exports.isObject=e.isObject;exports.isWorker=e.isWorker;exports.noop=e.noop;exports.toRef=e.toRef;exports.toValue=e.toValue;exports.tryOnScopeDispose=e.tryOnScopeDispose;exports.useIntervalFn=e.useIntervalFn;exports.defaultWindow=I;exports.unrefElement=M;exports.useEventListener=_;exports.useWebSocket=V;
