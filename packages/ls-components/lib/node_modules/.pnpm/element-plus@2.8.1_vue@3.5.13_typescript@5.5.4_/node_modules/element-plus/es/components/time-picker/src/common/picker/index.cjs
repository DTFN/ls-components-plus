"use strict";var Oe=Object.defineProperty;var l=(A,K)=>Oe(A,"name",{value:K,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue"),Re=require("../../../../../../../../../@vueuse_core@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/core/index/index.cjs"),$e=require("../../../../input/index/index.cjs"),z=require("../../../../icon/index/index.cjs"),ze=require("../../../../tooltip/index/index.cjs"),ie=require("@element-plus/icons-vue"),C=require("../../utils/index.cjs"),Ae=require("../props/index.cjs"),Ke=require("../../../../../_virtual/plugin-vue_export-helper/index.cjs"),Ue=require("../../../../../hooks/use-locale/index/index.cjs"),G=require("../../../../../hooks/use-namespace/index/index.cjs"),je=require("../../../../form/src/hooks/use-form-item/index.cjs"),Le=require("../../../../../hooks/use-empty-values/index/index.cjs"),ce=require("../../../../../utils/error/index.cjs"),h=require("../../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),b=require("../../../../../constants/aria/index.cjs"),He=require("../../../../form/src/hooks/use-form-common-props/index.cjs"),We=require("../../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isEqual/index.cjs"),_e=a.defineComponent({name:"Picker"}),Je=a.defineComponent({..._e,props:Ae.timePickerDefaultProps,emits:["update:modelValue","change","focus","blur","clear","calendar-change","panel-change","visible-change","keydown"],setup(A,{expose:K,emit:c}){const t=A,de=a.useAttrs(),{lang:E}=Ue.useLocale(),v=G.useNamespace("date"),I=G.useNamespace("input"),m=G.useNamespace("range"),{form:Q,formItem:T}=je.useFormItem(),fe=a.inject("ElPopperOptions",{}),{valueOnClear:S}=Le.useEmptyValues(t,null),U=a.ref(),y=a.ref(),u=a.ref(!1),j=a.ref(!1),X=a.ref(null);let L=!1,V=!1;const pe=a.computed(()=>[v.b("editor"),v.bm("editor",t.type),I.e("wrapper"),v.is("disabled",d.value),v.is("active",u.value),m.b("editor"),_?m.bm("editor",_.value):"",de.class]),ve=a.computed(()=>[I.e("icon"),m.e("close-icon"),k.value?"":m.e("close-icon--hidden")]);a.watch(u,e=>{e?a.nextTick(()=>{e&&(X.value=t.modelValue)}):(r.value=null,a.nextTick(()=>{H(t.modelValue)}))});const H=l((e,n)=>{(n||!C.valueEquals(e,X.value))&&(c("change",e),t.validateEvent&&(T==null||T.validate("change").catch(o=>ce.debugWarn(o))))},"emitChange"),g=l(e=>{if(!C.valueEquals(t.modelValue,e)){let n;h.isArray(e)?n=e.map(o=>C.formatter(o,t.valueFormat,E.value)):e&&(n=C.formatter(e,t.valueFormat,E.value)),c("update:modelValue",e&&n,E.value)}},"emitInput"),me=l(e=>{c("keydown",e)},"emitKeydown"),P=a.computed(()=>{if(y.value){const e=O.value?y.value:y.value.$el;return Array.from(e.querySelectorAll("input"))}return[]}),he=l((e,n,o)=>{const s=P.value;s.length&&(!o||o==="min"?(s[0].setSelectionRange(e,n),s[0].focus()):o==="max"&&(s[1].setSelectionRange(e,n),s[1].focus()))},"setSelectionRange"),ye=l(()=>{W(!0,!0),a.nextTick(()=>{V=!1})},"focusOnInputBox"),Z=l((e="",n=!1)=>{n||(V=!0),u.value=n;let o;h.isArray(e)?o=e.map(s=>s.toDate()):o=e&&e.toDate(),r.value=null,g(o)},"onPick"),ge=l(()=>{j.value=!0},"onBeforeShow"),ke=l(()=>{c("visible-change",!0)},"onShow"),Ce=l(e=>{(e==null?void 0:e.key)===b.EVENT_CODE.esc&&W(!0,!0)},"onKeydownPopperContent"),be=l(()=>{j.value=!1,u.value=!1,V=!1,c("visible-change",!1)},"onHide"),Ee=l(()=>{u.value=!0},"handleOpen"),Ie=l(()=>{u.value=!1},"handleClose"),W=l((e=!0,n=!1)=>{V=n;const[o,s]=a.unref(P);let p=o;!e&&O.value&&(p=s),p&&p.focus()},"focus"),w=l(e=>{t.readonly||d.value||u.value||V||(u.value=!0,c("focus",e))},"handleFocusInput");let x;const M=l(e=>{const n=l(async()=>{setTimeout(()=>{var o;x===n&&(!((o=U.value)!=null&&o.isFocusInsideContent()&&!L)&&P.value.filter(s=>s.contains(document.activeElement)).length===0&&(J(),u.value=!1,c("blur",e),t.validateEvent&&(T==null||T.validate("blur").catch(s=>ce.debugWarn(s)))),L=!1)},0)},"handleBlurDefer");x=n,n()},"handleBlurInput"),d=a.computed(()=>t.disabled||(Q==null?void 0:Q.disabled)),q=a.computed(()=>{let e;if(B.value?i.value.getDefaultValue&&(e=i.value.getDefaultValue()):h.isArray(t.modelValue)?e=t.modelValue.map(n=>C.parseDate(n,t.valueFormat,E.value)):e=C.parseDate(t.modelValue,t.valueFormat,E.value),i.value.getRangeAvailableTime){const n=i.value.getRangeAvailableTime(e);We.default(n,e)||(e=n,B.value||g(h.isArray(e)?e.map(o=>o.toDate()):e.toDate()))}return h.isArray(e)&&e.some(n=>!n)&&(e=[]),e}),f=a.computed(()=>{if(!i.value.panelReady)return"";const e=Y(q.value);return h.isArray(r.value)?[r.value[0]||e&&e[0]||"",r.value[1]||e&&e[1]||""]:r.value!==null?r.value:!Pe.value&&B.value||!u.value&&B.value?"":e?ee.value||ae.value||ne.value?e.join(", "):e:""}),Ve=a.computed(()=>t.type.includes("time")),Pe=a.computed(()=>t.type.startsWith("time")),ee=a.computed(()=>t.type==="dates"),ae=a.computed(()=>t.type==="months"),ne=a.computed(()=>t.type==="years"),F=a.computed(()=>t.prefixIcon||(Ve.value?ie.Clock:ie.Calendar)),k=a.ref(!1),le=l(e=>{t.readonly||d.value||(k.value&&(e.stopPropagation(),ye(),i.value.handleClear?i.value.handleClear():g(S.value),H(S.value,!0),k.value=!1,u.value=!1),c("clear"))},"onClearIconClick"),B=a.computed(()=>{const{modelValue:e}=t;return!e||h.isArray(e)&&!e.filter(Boolean).length}),D=l(async e=>{var n;t.readonly||d.value||(((n=e.target)==null?void 0:n.tagName)!=="INPUT"||P.value.includes(document.activeElement))&&(u.value=!0)},"onMouseDownInput"),oe=l(()=>{t.readonly||d.value||!B.value&&t.clearable&&(k.value=!0)},"onMouseEnter"),te=l(()=>{k.value=!1},"onMouseLeave"),N=l(e=>{var n;t.readonly||d.value||(((n=e.touches[0].target)==null?void 0:n.tagName)!=="INPUT"||P.value.includes(document.activeElement))&&(u.value=!0)},"onTouchStartInput"),O=a.computed(()=>t.type.includes("range")),_=He.useFormSize(),we=a.computed(()=>{var e,n;return(n=(e=a.unref(U))==null?void 0:e.popperRef)==null?void 0:n.contentRef}),re=a.computed(()=>{var e;return a.unref(O)?a.unref(y):(e=a.unref(y))==null?void 0:e.$el}),ue=Re.onClickOutside(re,e=>{const n=a.unref(we),o=a.unref(re);n&&(e.target===n||e.composedPath().includes(n))||e.target===o||e.composedPath().includes(o)||(u.value=!1)});a.onBeforeUnmount(()=>{ue==null||ue()});const r=a.ref(null),J=l(()=>{if(r.value){const e=R(f.value);e&&$(e)&&(g(h.isArray(e)?e.map(n=>n.toDate()):e.toDate()),r.value=null)}r.value===""&&(g(S.value),H(S.value),r.value=null)},"handleChange"),R=l(e=>e?i.value.parseUserInput(e):null,"parseUserInputToDayjs"),Y=l(e=>e?i.value.formatToString(e):null,"formatDayjsToString"),$=l(e=>i.value.isValidValue(e),"isValidValue"),se=l(async e=>{if(t.readonly||d.value)return;const{code:n}=e;if(me(e),n===b.EVENT_CODE.esc){u.value===!0&&(u.value=!1,e.preventDefault(),e.stopPropagation());return}if(n===b.EVENT_CODE.down&&(i.value.handleFocusPicker&&(e.preventDefault(),e.stopPropagation()),u.value===!1&&(u.value=!0,await a.nextTick()),i.value.handleFocusPicker)){i.value.handleFocusPicker();return}if(n===b.EVENT_CODE.tab){L=!0;return}if(n===b.EVENT_CODE.enter||n===b.EVENT_CODE.numpadEnter){(r.value===null||r.value===""||$(R(f.value)))&&(J(),u.value=!1),e.stopPropagation();return}if(r.value){e.stopPropagation();return}i.value.handleKeydownInput&&i.value.handleKeydownInput(e)},"handleKeydownInput"),Be=l(e=>{r.value=e,u.value||(u.value=!0)},"onUserInput"),De=l(e=>{const n=e.target;r.value?r.value=[n.value,r.value[1]]:r.value=[n.value,null]},"handleStartInput"),Te=l(e=>{const n=e.target;r.value?r.value=[r.value[0],n.value]:r.value=[null,n.value]},"handleEndInput"),Se=l(()=>{var e;const n=r.value,o=R(n&&n[0]),s=a.unref(q);if(o&&o.isValid()){r.value=[Y(o),((e=f.value)==null?void 0:e[1])||null];const p=[o,s&&(s[1]||null)];$(p)&&(g(p),r.value=null)}},"handleStartChange"),Me=l(()=>{var e;const n=a.unref(r),o=R(n&&n[1]),s=a.unref(q);if(o&&o.isValid()){r.value=[((e=a.unref(f))==null?void 0:e[0])||null,Y(o)];const p=[s&&s[0],o];$(p)&&(g(p),r.value=null)}},"handleEndChange"),i=a.ref({}),qe=l(e=>{i.value[e[0]]=e[1],i.value.panelReady=!0},"onSetPickerOption"),Fe=l(e=>{c("calendar-change",e)},"onCalendarChange"),Ne=l((e,n,o)=>{c("panel-change",e,n,o)},"onPanelChange");return a.provide("EP_PICKER_BASE",{props:t}),K({focus:W,handleFocusInput:w,handleBlurInput:M,handleOpen:Ee,handleClose:Ie,onPick:Z}),(e,n)=>(a.openBlock(),a.createBlock(a.unref(ze.ElTooltip),a.mergeProps({ref_key:"refPopper",ref:U,visible:u.value,effect:"light",pure:"",trigger:"click"},e.$attrs,{role:"dialog",teleported:"",transition:`${a.unref(v).namespace.value}-zoom-in-top`,"popper-class":[`${a.unref(v).namespace.value}-picker__popper`,e.popperClass],"popper-options":a.unref(fe),"fallback-placements":["bottom","top","right","left"],"gpu-acceleration":!1,"stop-popper-mouse-event":!1,"hide-after":0,persistent:"",onBeforeShow:ge,onShow:ke,onHide:be}),{default:a.withCtx(()=>[a.unref(O)?(a.openBlock(),a.createElementBlock("div",{key:1,ref_key:"inputRef",ref:y,class:a.normalizeClass(a.unref(pe)),style:a.normalizeStyle(e.$attrs.style),onClick:w,onMouseenter:oe,onMouseleave:te,onTouchstartPassive:N,onKeydown:se},[a.unref(F)?(a.openBlock(),a.createBlock(a.unref(z.ElIcon),{key:0,class:a.normalizeClass([a.unref(I).e("icon"),a.unref(m).e("icon")]),onMousedown:a.withModifiers(D,["prevent"]),onTouchstartPassive:N},{default:a.withCtx(()=>[(a.openBlock(),a.createBlock(a.resolveDynamicComponent(a.unref(F))))]),_:1},8,["class","onMousedown"])):a.createCommentVNode("v-if",!0),a.createElementVNode("input",{id:e.id&&e.id[0],autocomplete:"off",name:e.name&&e.name[0],placeholder:e.startPlaceholder,value:a.unref(f)&&a.unref(f)[0],disabled:a.unref(d),readonly:!e.editable||e.readonly,class:a.normalizeClass(a.unref(m).b("input")),onMousedown:D,onInput:De,onChange:Se,onFocus:w,onBlur:M},null,42,["id","name","placeholder","value","disabled","readonly"]),a.renderSlot(e.$slots,"range-separator",{},()=>[a.createElementVNode("span",{class:a.normalizeClass(a.unref(m).b("separator"))},a.toDisplayString(e.rangeSeparator),3)]),a.createElementVNode("input",{id:e.id&&e.id[1],autocomplete:"off",name:e.name&&e.name[1],placeholder:e.endPlaceholder,value:a.unref(f)&&a.unref(f)[1],disabled:a.unref(d),readonly:!e.editable||e.readonly,class:a.normalizeClass(a.unref(m).b("input")),onMousedown:D,onFocus:w,onBlur:M,onInput:Te,onChange:Me},null,42,["id","name","placeholder","value","disabled","readonly"]),e.clearIcon?(a.openBlock(),a.createBlock(a.unref(z.ElIcon),{key:1,class:a.normalizeClass(a.unref(ve)),onClick:le},{default:a.withCtx(()=>[(a.openBlock(),a.createBlock(a.resolveDynamicComponent(e.clearIcon)))]),_:1},8,["class"])):a.createCommentVNode("v-if",!0)],38)):(a.openBlock(),a.createBlock(a.unref($e.ElInput),{key:0,id:e.id,ref_key:"inputRef",ref:y,"container-role":"combobox","model-value":a.unref(f),name:e.name,size:a.unref(_),disabled:a.unref(d),placeholder:e.placeholder,class:a.normalizeClass([a.unref(v).b("editor"),a.unref(v).bm("editor",e.type),e.$attrs.class]),style:a.normalizeStyle(e.$attrs.style),readonly:!e.editable||e.readonly||a.unref(ee)||a.unref(ae)||a.unref(ne)||e.type==="week","aria-label":e.ariaLabel,tabindex:e.tabindex,"validate-event":!1,onInput:Be,onFocus:w,onBlur:M,onKeydown:se,onChange:J,onMousedown:D,onMouseenter:oe,onMouseleave:te,onTouchstartPassive:N,onClick:a.withModifiers(()=>{},["stop"])},{prefix:a.withCtx(()=>[a.unref(F)?(a.openBlock(),a.createBlock(a.unref(z.ElIcon),{key:0,class:a.normalizeClass(a.unref(I).e("icon")),onMousedown:a.withModifiers(D,["prevent"]),onTouchstartPassive:N},{default:a.withCtx(()=>[(a.openBlock(),a.createBlock(a.resolveDynamicComponent(a.unref(F))))]),_:1},8,["class","onMousedown"])):a.createCommentVNode("v-if",!0)]),suffix:a.withCtx(()=>[k.value&&e.clearIcon?(a.openBlock(),a.createBlock(a.unref(z.ElIcon),{key:0,class:a.normalizeClass(`${a.unref(I).e("icon")} clear-icon`),onClick:a.withModifiers(le,["stop"])},{default:a.withCtx(()=>[(a.openBlock(),a.createBlock(a.resolveDynamicComponent(e.clearIcon)))]),_:1},8,["class","onClick"])):a.createCommentVNode("v-if",!0)]),_:1},8,["id","model-value","name","size","disabled","placeholder","class","style","readonly","aria-label","tabindex","onKeydown","onClick"]))]),content:a.withCtx(()=>[a.renderSlot(e.$slots,"default",{visible:u.value,actualVisible:j.value,parsedValue:a.unref(q),format:e.format,dateFormat:e.dateFormat,timeFormat:e.timeFormat,unlinkPanels:e.unlinkPanels,type:e.type,defaultValue:e.defaultValue,onPick:Z,onSelectRange:he,onSetPickerOption:qe,onCalendarChange:Fe,onPanelChange:Ne,onKeydown:Ce,onMousedown:a.withModifiers(()=>{},["stop"])})]),_:3},16,["visible","transition","popper-class","popper-options"]))}});var Ye=Ke.default(Je,[["__file","picker.vue"]]);exports.default=Ye;
