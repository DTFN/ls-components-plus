"use strict";var Y=Object.defineProperty;var u=(s,h)=>Y(s,"name",{value:h,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("vue"),Q=require("../menu/index.cjs"),z=require("../store/index.cjs"),W=require("../node/index.cjs"),F=require("../config/index.cjs"),b=require("../utils/index.cjs"),X=require("../types/index.cjs"),Z=require("../../../../_virtual/plugin-vue_export-helper/index.cjs"),D=require("../../../../constants/event/index.cjs"),ee=require("../../../../hooks/use-namespace/index/index.cjs"),I=require("../../../../utils/types/index.cjs"),w=require("../../../../utils/arrays/index.cjs"),ne=require("../../../../utils/dom/scroll/index.cjs"),_=require("../../../../constants/aria/index.cjs"),x=require("../../../../utils/dom/aria/index.cjs"),K=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isEqual/index.cjs"),te=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/flattenDeep/index.cjs"),le=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/cloneDeep/index.cjs"),ae=require("../../../../../../../../@vueuse_shared@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/shared/index/index.cjs"),oe=l.defineComponent({name:"ElCascaderPanel",components:{ElCascaderMenu:Q.default},props:{...F.CommonProps,border:{type:Boolean,default:!0},renderLabel:Function},emits:[D.UPDATE_MODEL_EVENT,D.CHANGE_EVENT,"close","expand-change"],setup(s,{emit:h,slots:O}){let q=!1;const f=ee.useNamespace("cascader"),i=F.useCascaderConfig(s);let r=null;const m=l.ref(!0),v=l.ref([]),y=l.ref(null),g=l.ref([]),C=l.ref(null),N=l.ref([]),H=l.computed(()=>i.value.expandTrigger==="hover"),U=l.computed(()=>s.renderLabel||O.default),G=u(()=>{const{options:e}=s,n=i.value;q=!1,r=new z.default(e,n),g.value=[r.getNodes()],n.lazy&&I.isEmpty(s.options)?(m.value=!1,T(void 0,t=>{t&&(r=new z.default(t,n),g.value=[r.getNodes()]),m.value=!0,k(!1,!0)})):k(!1,!0)},"initStore"),T=u((e,n)=>{const t=i.value;e=e||new W.default({},t,void 0,!0),e.loading=!0;const a=u(o=>{const c=e,p=c.root?null:c;o&&(r==null||r.appendNodes(o,p)),c.loading=!1,c.loaded=!0,c.childrenData=c.childrenData||[],n&&n(o)},"resolve");t.lazyLoad(e,a)},"lazyLoad"),S=u((e,n)=>{var t;const{level:a}=e,o=g.value.slice(0,a);let c;e.isLeaf?c=e.pathNodes[a-2]:(c=e,o.push(e.children)),((t=C.value)==null?void 0:t.uid)!==(c==null?void 0:c.uid)&&(C.value=e,g.value=o,!n&&h("expand-change",(e==null?void 0:e.pathValues)||[]))},"expandNode"),M=u((e,n,t=!0)=>{const{checkStrictly:a,multiple:o}=i.value,c=N.value[0];q=!0,!o&&(c==null||c.doCheck(!1)),e.doCheck(n),$(),t&&!o&&!a&&h("close"),!t&&!o&&!a&&B(e)},"handleCheckChange"),B=u(e=>{e&&(e=e.parent,B(e),e&&S(e))},"expandParentNode"),L=u(e=>r==null?void 0:r.getFlattedNodes(e),"getFlattedNodes"),A=u(e=>{var n;return(n=L(e))==null?void 0:n.filter(t=>t.checked!==!1)},"getCheckedNodes"),j=u(()=>{N.value.forEach(e=>e.doCheck(!1)),$(),g.value=g.value.slice(0,1),C.value=null,h("expand-change",[])},"clearCheckedNodes"),$=u(()=>{var e;const{checkStrictly:n,multiple:t}=i.value,a=N.value,o=A(!n),c=b.sortByOriginalOrder(a,o),p=c.map(d=>d.valueByOption);N.value=c,y.value=t?p:(e=p[0])!=null?e:null},"calculateCheckedValue"),k=u((e=!1,n=!1)=>{const{modelValue:t}=s,{lazy:a,multiple:o,checkStrictly:c}=i.value,p=!c;if(!(!m.value||q||!n&&K.default(t,y.value)))if(a&&!e){const V=w.unique(te.default(w.castArray(t))).map(E=>r==null?void 0:r.getNodeByValue(E)).filter(E=>!!E&&!E.loaded&&!E.loading);V.length?V.forEach(E=>{T(E,()=>k(!1,n))}):k(!0,n)}else{const d=o?w.castArray(t):[t],V=w.unique(d.map(E=>r==null?void 0:r.getNodeByValue(E,p)));J(V,n),y.value=le.default(t)}},"syncCheckedValue"),J=u((e,n=!0)=>{const{checkStrictly:t}=i.value,a=N.value,o=e.filter(d=>!!d&&(t||d.isLeaf)),c=r==null?void 0:r.getSameNode(C.value),p=n&&c||o[0];p?p.pathNodes.forEach(d=>S(d,!0)):C.value=null,a.forEach(d=>d.doCheck(!1)),l.reactive(o).forEach(d=>d.doCheck(!0)),N.value=o,l.nextTick(P)},"syncMenuState"),P=u(()=>{ae.isClient&&v.value.forEach(e=>{const n=e==null?void 0:e.$el;if(n){const t=n.querySelector(`.${f.namespace.value}-scrollbar__wrap`),a=n.querySelector(`.${f.b("node")}.${f.is("active")}`)||n.querySelector(`.${f.b("node")}.in-active-path`);ne.scrollIntoView(t,a)}})},"scrollToExpandingNode"),R=u(e=>{const n=e.target,{code:t}=e;switch(t){case _.EVENT_CODE.up:case _.EVENT_CODE.down:{e.preventDefault();const a=t===_.EVENT_CODE.up?-1:1;x.focusNode(x.getSibling(n,a,`.${f.b("node")}[tabindex="-1"]`));break}case _.EVENT_CODE.left:{e.preventDefault();const a=v.value[b.getMenuIndex(n)-1],o=a==null?void 0:a.$el.querySelector(`.${f.b("node")}[aria-expanded="true"]`);x.focusNode(o);break}case _.EVENT_CODE.right:{e.preventDefault();const a=v.value[b.getMenuIndex(n)+1],o=a==null?void 0:a.$el.querySelector(`.${f.b("node")}[tabindex="-1"]`);x.focusNode(o);break}case _.EVENT_CODE.enter:b.checkNode(n);break}},"handleKeyDown");return l.provide(X.CASCADER_PANEL_INJECTION_KEY,l.reactive({config:i,expandingNode:C,checkedNodes:N,isHoverMenu:H,initialLoaded:m,renderLabelFn:U,lazyLoad:T,expandNode:S,handleCheckChange:M})),l.watch([i,()=>s.options],G,{deep:!0,immediate:!0}),l.watch(()=>s.modelValue,()=>{q=!1,k()},{deep:!0}),l.watch(()=>y.value,e=>{K.default(e,s.modelValue)||(h(D.UPDATE_MODEL_EVENT,e),h(D.CHANGE_EVENT,e))}),l.onBeforeUpdate(()=>v.value=[]),l.onMounted(()=>!I.isEmpty(s.modelValue)&&k()),{ns:f,menuList:v,menus:g,checkedNodes:N,handleKeyDown:R,handleCheckChange:M,getFlattedNodes:L,getCheckedNodes:A,clearCheckedNodes:j,calculateCheckedValue:$,scrollToExpandingNode:P}}});function ce(s,h,O,q,f,i){const r=l.resolveComponent("el-cascader-menu");return l.openBlock(),l.createElementBlock("div",{class:l.normalizeClass([s.ns.b("panel"),s.ns.is("bordered",s.border)]),onKeydown:s.handleKeyDown},[(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(s.menus,(m,v)=>(l.openBlock(),l.createBlock(r,{key:v,ref_for:!0,ref:u(y=>s.menuList[v]=y,"ref"),index:v,nodes:[...m]},null,8,["index","nodes"]))),128))],42,["onKeydown"])}u(ce,"_sfc_render");var se=Z.default(oe,[["render",ce],["__file","index.vue"]]);exports.default=se;
