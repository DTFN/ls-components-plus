"use strict";var B=Object.defineProperty;var p=(f,s)=>B(f,"name",{value:s,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const T=require("vue"),x=require("../../../../../hooks/use-namespace/index/index.cjs"),v=require("../../../../../utils/dom/style/index.cjs"),C=Symbol("dragEvents");function A({props:f,ctx:s,el$:S,dropIndicator$:$,store:g}){const c=x.useNamespace("tree"),r=T.ref({showDropIndicator:!1,draggingNode:null,dropNode:null,allowDrop:!0,dropType:null}),I=p(({event:n,treeNode:t})=>{if(typeof f.allowDrag=="function"&&!f.allowDrag(t.node))return n.preventDefault(),!1;n.dataTransfer.effectAllowed="move";try{n.dataTransfer.setData("text/plain","")}catch{}r.value.draggingNode=t,s.emit("node-drag-start",t.node,n)},"treeNodeDragStart"),P=p(({event:n,treeNode:t})=>{const e=t,o=r.value.dropNode;o&&o.node.id!==e.node.id&&v.removeClass(o.$el,c.is("drop-inner"));const d=r.value.draggingNode;if(!d||!e)return;let l=!0,a=!0,u=!0,h=!0;typeof f.allowDrop=="function"&&(l=f.allowDrop(d.node,e.node,"prev"),h=a=f.allowDrop(d.node,e.node,"inner"),u=f.allowDrop(d.node,e.node,"next")),n.dataTransfer.dropEffect=a||l||u?"move":"none",(l||a||u)&&(o==null?void 0:o.node.id)!==e.node.id&&(o&&s.emit("node-drag-leave",d.node,o.node,n),s.emit("node-drag-enter",d.node,e.node,n)),l||a||u?r.value.dropNode=e:r.value.dropNode=null,e.node.nextSibling===d.node&&(u=!1),e.node.previousSibling===d.node&&(l=!1),e.node.contains(d.node,!1)&&(a=!1),(d.node===e.node||d.node.contains(e.node))&&(l=!1,a=!1,u=!1);const D=e.$el.querySelector(`.${c.be("node","content")}`).getBoundingClientRect(),N=S.value.getBoundingClientRect();let i;const k=l?a?.25:u?.45:1:-1,q=u?a?.75:l?.55:0:1;let y=-9999;const w=n.clientY-D.top;w<D.height*k?i="before":w>D.height*q?i="after":a?i="inner":i="none";const m=e.$el.querySelector(`.${c.be("node","expand-icon")}`).getBoundingClientRect(),b=$.value;i==="before"?y=m.top-N.top:i==="after"&&(y=m.bottom-N.top),b.style.top=`${y}px`,b.style.left=`${m.right-N.left}px`,i==="inner"?v.addClass(e.$el,c.is("drop-inner")):v.removeClass(e.$el,c.is("drop-inner")),r.value.showDropIndicator=i==="before"||i==="after",r.value.allowDrop=r.value.showDropIndicator||h,r.value.dropType=i,s.emit("node-drag-over",d.node,e.node,n)},"treeNodeDragOver"),E=p(n=>{const{draggingNode:t,dropType:e,dropNode:o}=r.value;if(n.preventDefault(),n.dataTransfer&&(n.dataTransfer.dropEffect="move"),t&&o){const d={data:t.node.data};e!=="none"&&t.node.remove(),e==="before"?o.node.parent.insertBefore(d,o.node):e==="after"?o.node.parent.insertAfter(d,o.node):e==="inner"&&o.node.insertChild(d),e!=="none"&&(g.value.registerNode(d),g.value.key&&t.node.eachNode(l=>{var a;(a=g.value.nodesMap[l.data[g.value.key]])==null||a.setChecked(l.checked,!g.value.checkStrictly)})),v.removeClass(o.$el,c.is("drop-inner")),s.emit("node-drag-end",t.node,o.node,e,n),e!=="none"&&s.emit("node-drop",t.node,o.node,e,n)}t&&!o&&s.emit("node-drag-end",t.node,null,e,n),r.value.showDropIndicator=!1,r.value.draggingNode=null,r.value.dropNode=null,r.value.allowDrop=!0},"treeNodeDragEnd");return T.provide(C,{treeNodeDragStart:I,treeNodeDragOver:P,treeNodeDragEnd:E}),{dragState:r}}p(A,"useDragNodeHandler");exports.dragEventsKey=C;exports.useDragNodeHandler=A;
