"use strict";var X=Object.defineProperty;var u=(t,s)=>X(t,"name",{value:s,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue"),Y=require("../../../../../../../../@vueuse_core@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/core/index/index.cjs"),Z=require("../../../icon/index/index.cjs"),ee=require("@element-plus/icons-vue"),te=require("../utils/menu-bar/index.cjs"),ne=require("../menu-collapse-transition/index.cjs"),le=require("../sub-menu/index.cjs"),ue=require("../use-menu-css-var/index.cjs"),T=require("../../../../utils/vue/props/runtime/index.cjs"),oe=require("../../../../utils/typescript/index.cjs"),ie=require("../../../../utils/vue/icon/index.cjs"),M=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),W=require("../../../../hooks/use-namespace/index/index.cjs"),ae=require("../../../../utils/vue/vnode/index.cjs"),se=require("../../../../directives/click-outside/index/index.cjs"),$=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isNil/index.cjs"),L=T.buildProps({mode:{type:String,values:["horizontal","vertical"],default:"vertical"},defaultActive:{type:String,default:""},defaultOpeneds:{type:T.definePropType(Array),default:u(()=>oe.mutable([]),"default")},uniqueOpened:Boolean,router:Boolean,menuTrigger:{type:String,values:["hover","click"],default:"hover"},collapse:Boolean,backgroundColor:String,textColor:String,activeTextColor:String,closeOnClickOutside:Boolean,collapseTransition:{type:Boolean,default:!0},ellipsis:{type:Boolean,default:!0},popperOffset:{type:Number,default:6},ellipsisIcon:{type:ie.iconPropType,default:u(()=>ee.More,"default")},popperEffect:{type:T.definePropType(String),default:"dark"},popperClass:String,showTimeout:{type:Number,default:300},hideTimeout:{type:Number,default:300}}),N=u(t=>Array.isArray(t)&&t.every(s=>M.isString(s)),"checkIndexPath"),V={close:u((t,s)=>M.isString(t)&&N(s),"close"),open:u((t,s)=>M.isString(t)&&N(s),"open"),select:u((t,s,y,S)=>M.isString(t)&&N(s)&&M.isObject(y)&&(S===void 0||S instanceof Promise),"select")};var ce=o.defineComponent({name:"ElMenu",props:L,emits:V,setup(t,{emit:s,slots:y,expose:S}){const O=o.getCurrentInstance(),k=O.appContext.config.globalProperties.$router,f=o.ref(),x=W.useNamespace("menu"),E=W.useNamespace("sub-menu"),v=o.ref(-1),c=o.ref(t.defaultOpeneds&&!t.collapse?t.defaultOpeneds.slice(0):[]),r=o.ref(t.defaultActive),m=o.ref({}),p=o.ref({}),D=o.computed(()=>t.mode==="horizontal"||t.mode==="vertical"&&t.collapse),j=u(()=>{const e=r.value&&m.value[r.value];if(!e||t.mode==="horizontal"||t.collapse)return;e.indexPath.forEach(l=>{const i=p.value[l];i&&I(l,i.indexPath)})},"initMenu"),I=u((e,n)=>{c.value.includes(e)||(t.uniqueOpened&&(c.value=c.value.filter(l=>n.includes(l))),c.value.push(e),s("open",e,n))},"openMenu"),z=u(e=>{const n=c.value.indexOf(e);n!==-1&&c.value.splice(n,1)},"close"),w=u((e,n)=>{z(e),s("close",e,n)},"closeMenu"),F=u(({index:e,indexPath:n})=>{c.value.includes(e)?w(e,n):I(e,n)},"handleSubMenuClick"),G=u(e=>{(t.mode==="horizontal"||t.collapse)&&(c.value=[]);const{index:n,indexPath:l}=e;if(!($.default(n)||$.default(l)))if(t.router&&k){const i=e.route||n,a=k.push(i).then(g=>(g||(r.value=n),g));s("select",n,l,{index:n,indexPath:l,route:i},a)}else r.value=n,s("select",n,l,{index:n,indexPath:l})},"handleMenuItemClick"),H=u(e=>{const n=m.value,l=n[e]||r.value&&n[r.value]||n[t.defaultActive];l?r.value=l.index:r.value=e},"updateActiveIndex"),J=u(e=>{const n=getComputedStyle(e),l=Number.parseInt(n.marginLeft,10),i=Number.parseInt(n.marginRight,10);return e.offsetWidth+l+i||0},"calcMenuItemWidth"),A=u(()=>{var e,n;if(!f.value)return-1;const l=Array.from((n=(e=f.value)==null?void 0:e.childNodes)!=null?n:[]).filter(b=>b.nodeName!=="#comment"&&(b.nodeName!=="#text"||b.nodeValue)),i=64,a=getComputedStyle(f.value),g=Number.parseInt(a.paddingLeft,10),q=Number.parseInt(a.paddingRight,10),d=f.value.clientWidth-g-q;let C=0,h=0;return l.forEach((b,U)=>{C+=J(b),C<=d-i&&(h=U+1)}),h===l.length?-1:h},"calcSliceIndex"),K=u(e=>p.value[e].indexPath,"getIndexPath"),Q=u((e,n=33.34)=>{let l;return()=>{l&&clearTimeout(l),l=setTimeout(()=>{e()},n)}},"debounce");let B=!0;const R=u(()=>{if(v.value===A())return;const e=u(()=>{v.value=-1,o.nextTick(()=>{v.value=A()})},"callback");B?e():Q(e)(),B=!1},"handleResize");o.watch(()=>t.defaultActive,e=>{m.value[e]||(r.value=""),H(e)}),o.watch(()=>t.collapse,e=>{e&&(c.value=[])}),o.watch(m.value,j);let P;o.watchEffect(()=>{t.mode==="horizontal"&&t.ellipsis?P=Y.useResizeObserver(f,R).stop:P==null||P()});const _=o.ref(!1);{const e=u(a=>{p.value[a.index]=a},"addSubMenu"),n=u(a=>{delete p.value[a.index]},"removeSubMenu"),l=u(a=>{m.value[a.index]=a},"addMenuItem"),i=u(a=>{delete m.value[a.index]},"removeMenuItem");o.provide("rootMenu",o.reactive({props:t,openedMenus:c,items:m,subMenus:p,activeIndex:r,isMenuPopup:D,addMenuItem:l,removeMenuItem:i,addSubMenu:e,removeSubMenu:n,openMenu:I,closeMenu:w,handleMenuItemClick:G,handleSubMenuClick:F})),o.provide(`subMenu:${O.uid}`,{addSubMenu:e,removeSubMenu:n,mouseInChild:_,level:0})}return o.onMounted(()=>{t.mode==="horizontal"&&new te.default(O.vnode.el,x.namespace.value)}),S({open:u(n=>{const{indexPath:l}=p.value[n];l.forEach(i=>I(i,l))},"open"),close:z,handleResize:R}),()=>{var e,n;let l=(n=(e=y.default)==null?void 0:e.call(y))!=null?n:[];const i=[];if(t.mode==="horizontal"&&f.value){const d=ae.flattedChildren(l),C=v.value===-1?d:d.slice(0,v.value),h=v.value===-1?[]:d.slice(v.value);h!=null&&h.length&&t.ellipsis&&(l=C,i.push(o.h(le.default,{index:"sub-menu-more",class:E.e("hide-arrow"),popperOffset:t.popperOffset},{title:u(()=>o.h(Z.ElIcon,{class:E.e("icon-more")},{default:u(()=>o.h(t.ellipsisIcon),"default")}),"title"),default:u(()=>h,"default")})))}const a=ue.useMenuCssVar(t,0),g=t.closeOnClickOutside?[[se.default,()=>{c.value.length&&(_.value||(c.value.forEach(d=>s("close",d,K(d))),c.value=[]))}]]:[],q=o.withDirectives(o.h("ul",{key:String(t.collapse),role:"menubar",ref:f,style:a.value,class:{[x.b()]:!0,[x.m(t.mode)]:!0,[x.m("collapse")]:t.collapse}},[...l,...i]),g);return t.collapseTransition&&t.mode==="vertical"?o.h(ne.default,()=>q):q}}});exports.default=ce;exports.menuEmits=V;exports.menuProps=L;
