"use strict";var E=Object.defineProperty;var f=(y,b)=>E(y,"name",{value:b,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),x=require("../../../../../../../../../dayjs@1.11.13/node_modules/dayjs/dayjs.min/index.cjs"),I=require("../../props/basic-month-table/index.cjs"),N=require("../../utils/index.cjs"),j=require("../basic-cell-render/index.cjs"),K=require("../../../../../_virtual/plugin-vue_export-helper/index.cjs"),L=require("../../../../../hooks/use-namespace/index/index.cjs"),P=require("../../../../../hooks/use-locale/index/index.cjs"),h=require("../../../../../utils/arrays/index.cjs"),T=require("../../../../../utils/dom/style/index.cjs"),F=t.defineComponent({__name:"basic-month-table",props:I.basicMonthTableProps,emits:["changerange","pick","select"],setup(y,{expose:b,emit:u}){const e=y,B=L.useNamespace("month-table"),{t:v,lang:D}=P.useLocale(),_=t.ref(),g=t.ref(),O=t.ref(e.date.locale("en").localeData().monthsShort().map(n=>n.toLowerCase())),q=t.ref([[],[],[]]),S=t.ref(),M=t.ref(),C=t.computed(()=>{var n,o;const a=q.value,s=x.default().locale(D.value).startOf("month");for(let r=0;r<3;r++){const c=a[r];for(let l=0;l<4;l++){const d=c[l]||(c[l]={row:r,column:l,type:"normal",inRange:!1,start:!1,end:!1,text:-1,disabled:!1});d.type="normal";const p=r*4+l,i=e.date.startOf("year").month(p),m=e.rangeState.endDate||e.maxDate||e.rangeState.selecting&&e.minDate||null;d.inRange=!!(e.minDate&&i.isSameOrAfter(e.minDate,"month")&&m&&i.isSameOrBefore(m,"month"))||!!(e.minDate&&i.isSameOrBefore(e.minDate,"month")&&m&&i.isSameOrAfter(m,"month")),(n=e.minDate)!=null&&n.isSameOrAfter(m)?(d.start=!!(m&&i.isSame(m,"month")),d.end=e.minDate&&i.isSame(e.minDate,"month")):(d.start=!!(e.minDate&&i.isSame(e.minDate,"month")),d.end=!!(m&&i.isSame(m,"month"))),s.isSame(i)&&(d.type="today"),d.text=p,d.disabled=((o=e.disabledDate)==null?void 0:o.call(e,i.toDate()))||!1}}return a}),V=f(()=>{var n;(n=g.value)==null||n.focus()},"focus"),A=f(n=>{const o={},a=e.date.year(),s=new Date,r=n.text;return o.disabled=e.disabledDate?N.datesInMonth(a,r,D.value).every(e.disabledDate):!1,o.current=h.castArray(e.parsedValue).findIndex(c=>x.default.isDayjs(c)&&c.year()===a&&c.month()===r)>=0,o.today=s.getFullYear()===a&&s.getMonth()===r,n.inRange&&(o["in-range"]=!0,n.start&&(o["start-date"]=!0),n.end&&(o["end-date"]=!0)),o},"getCellStyle"),k=f(n=>{const o=e.date.year(),a=n.text;return h.castArray(e.date).findIndex(s=>s.year()===o&&s.month()===a)>=0},"isSelectedCell"),R=f(n=>{var o;if(!e.rangeState.selecting)return;let a=n.target;if(a.tagName==="SPAN"&&(a=(o=a.parentNode)==null?void 0:o.parentNode),a.tagName==="DIV"&&(a=a.parentNode),a.tagName!=="TD")return;const s=a.parentNode.rowIndex,r=a.cellIndex;C.value[s][r].disabled||(s!==S.value||r!==M.value)&&(S.value=s,M.value=r,u("changerange",{selecting:!0,endDate:e.date.startOf("year").month(s*4+r)}))},"handleMouseMove"),w=f(n=>{var o;const a=(o=n.target)==null?void 0:o.closest("td");if((a==null?void 0:a.tagName)!=="TD"||T.hasClass(a,"disabled"))return;const s=a.cellIndex,c=a.parentNode.rowIndex*4+s,l=e.date.startOf("year").month(c);if(e.selectionMode==="months"){if(n.type==="keydown"){u("pick",h.castArray(e.parsedValue),!1);return}const d=N.getValidDateOfMonth(e.date.year(),c,D.value,e.disabledDate),p=T.hasClass(a,"current")?h.castArray(e.parsedValue).filter(i=>(i==null?void 0:i.month())!==d.month()):h.castArray(e.parsedValue).concat([x.default(d)]);u("pick",p)}else e.selectionMode==="range"?e.rangeState.selecting?(e.minDate&&l>=e.minDate?u("pick",{minDate:e.minDate,maxDate:l}):u("pick",{minDate:l,maxDate:e.minDate}),u("select",!1)):(u("pick",{minDate:l,maxDate:null}),u("select",!0)):u("pick",c)},"handleMonthTableClick");return t.watch(()=>e.date,async()=>{var n,o;(n=_.value)!=null&&n.contains(document.activeElement)&&(await t.nextTick(),(o=g.value)==null||o.focus())}),b({focus:V}),(n,o)=>(t.openBlock(),t.createElementBlock("table",{role:"grid","aria-label":t.unref(v)("el.datepicker.monthTablePrompt"),class:t.normalizeClass(t.unref(B).b()),onClick:w,onMousemove:R},[t.createElementVNode("tbody",{ref_key:"tbodyRef",ref:_},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(t.unref(C),(a,s)=>(t.openBlock(),t.createElementBlock("tr",{key:s},[(t.openBlock(!0),t.createElementBlock(t.Fragment,null,t.renderList(a,(r,c)=>(t.openBlock(),t.createElementBlock("td",{key:c,ref_for:!0,ref:f(l=>k(r)&&(g.value=l),"ref"),class:t.normalizeClass(A(r)),"aria-selected":`${k(r)}`,"aria-label":t.unref(v)(`el.datepicker.month${+r.text+1}`),tabindex:k(r)?0:-1,onKeydown:[t.withKeys(t.withModifiers(w,["prevent","stop"]),["space"]),t.withKeys(t.withModifiers(w,["prevent","stop"]),["enter"])]},[t.createVNode(t.unref(j.default),{cell:{...r,renderText:t.unref(v)("el.datepicker.months."+O.value[r.text])}},null,8,["cell"])],42,["aria-selected","aria-label","tabindex","onKeydown"]))),128))]))),128))],512)],42,["aria-label"]))}});var $=K.default(F,[["__file","basic-month-table.vue"]]);exports.default=$;
