"use strict";var be=Object.defineProperty;var r=(p,n)=>be(p,"name",{value:n,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue"),v=require("../../util/index.cjs"),Ae=require("../expand/index.cjs"),Me=require("../current/index.cjs"),Ke=require("../tree/index.cjs"),Le=require("../../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),Fe=require("../../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isEqual/index.cjs"),Oe=r((p,n)=>{const h=n.sortingColumn;return!h||typeof h.sortable=="string"?p:v.orderBy(p,n.sortProp,n.sortOrder,h.sortMethod,h.sortBy)},"sortData"),M=r(p=>{const n=[];return p.forEach(h=>{h.children&&h.children.length>0?n.push.apply(n,M(h.children)):n.push(h)}),n},"doFlattenColumns");function ke(){var p;const n=a.getCurrentInstance(),{size:h}=a.toRefs((p=n.proxy)==null?void 0:p.$props),i=a.ref(null),f=a.ref([]),O=a.ref([]),k=a.ref(!1),g=a.ref([]),q=a.ref([]),E=a.ref([]),y=a.ref([]),_=a.ref([]),W=a.ref([]),$=a.ref([]),G=a.ref([]),J=[],I=a.ref(0),D=a.ref(0),P=a.ref(0),x=a.ref(!1),u=a.ref([]),X=a.ref(!1),B=a.ref(!1),b=a.ref(null),A=a.ref({}),K=a.ref(null),C=a.ref(null),L=a.ref(null),F=a.ref(null),Y=a.ref(null);a.watch(f,()=>n.state&&N(!1),{deep:!0});const Z=r(()=>{if(!i.value)throw new Error("[ElTable] prop row-key is required")},"assertRowKey"),T=r(e=>{var t;(t=e.children)==null||t.forEach(o=>{o.fixed=e.fixed,T(o)})},"updateChildFixed"),j=r(()=>{g.value.forEach(s=>{T(s)}),y.value=g.value.filter(s=>s.fixed===!0||s.fixed==="left"),_.value=g.value.filter(s=>s.fixed==="right"),y.value.length>0&&g.value[0]&&g.value[0].type==="selection"&&!g.value[0].fixed&&(g.value[0].fixed=!0,y.value.unshift(g.value[0]));const e=g.value.filter(s=>!s.fixed);q.value=[].concat(y.value).concat(e).concat(_.value);const t=M(e),o=M(y.value),l=M(_.value);I.value=t.length,D.value=o.length,P.value=l.length,E.value=[].concat(o).concat(t).concat(l),k.value=y.value.length>0||_.value.length>0},"updateColumns"),N=r((e,t=!1)=>{e&&j(),t?n.state.doLayout():n.state.debouncedUpdateLayout()},"scheduleLayout"),ee=r(e=>u.value.some(t=>Fe.default(t,e)),"isSelected"),te=r(()=>{x.value=!1;const e=u.value;u.value=[],e.length&&n.emit("selection-change",[])},"clearSelection"),le=r(()=>{let e;if(i.value){e=[];const t=v.getKeysMap(u.value,i.value),o=v.getKeysMap(f.value,i.value);for(const l in t)Le.hasOwn(t,l)&&!o[l]&&e.push(t[l].row)}else e=u.value.filter(t=>!f.value.includes(t));if(e.length){const t=u.value.filter(o=>!e.includes(o));u.value=t,n.emit("selection-change",t.slice())}},"cleanSelection"),ne=r(()=>(u.value||[]).slice(),"getSelectionRows"),oe=r((e,t,o=!0)=>{var l,s,c,d;const w={children:(s=(l=n==null?void 0:n.store)==null?void 0:l.states)==null?void 0:s.childrenColumnName.value,checkStrictly:(d=(c=n==null?void 0:n.store)==null?void 0:c.states)==null?void 0:d.checkStrictly.value};if(v.toggleRowStatus(u.value,e,t,w)){const S=(u.value||[]).slice();o&&n.emit("select",S,e),n.emit("selection-change",S)}},"toggleRowSelection"),ae=r(()=>{var e,t;const o=B.value?!x.value:!(x.value||u.value.length);x.value=o;let l=!1,s=0;const c=(t=(e=n==null?void 0:n.store)==null?void 0:e.states)==null?void 0:t.rowKey.value,{childrenColumnName:d}=n.store.states,w={children:d.value,checkStrictly:!1};f.value.forEach((m,S)=>{const R=S+s;v.toggleRowStatus(u.value,m,o,w,b.value,R)&&(l=!0),s+=z(v.getRowIdentity(m,c))}),l&&n.emit("selection-change",u.value?u.value.slice():[]),n.emit("select-all",(u.value||[]).slice())},"_toggleAllSelection"),se=r(()=>{const e=v.getKeysMap(u.value,i.value);f.value.forEach(t=>{const o=v.getRowIdentity(t,i.value),l=e[o];l&&(u.value[l.index]=t)})},"updateSelectionByRowKey"),re=r(()=>{var e;if(((e=f.value)==null?void 0:e.length)===0){x.value=!1;return}const{childrenColumnName:t}=n.store.states,o=i.value?v.getKeysMap(u.value,i.value):void 0;let l=0,s=0;const c=r(m=>o?!!o[v.getRowIdentity(m,i.value)]:u.value.includes(m),"isSelected2"),d=r(m=>{var S;for(const R of m){const _e=b.value&&b.value.call(null,R,l);if(c(R))s++;else if(!b.value||_e)return!1;if(l++,(S=R[t.value])!=null&&S.length&&!d(R[t.value]))return!1}return!0},"checkSelectedStatus"),w=d(f.value||[]);x.value=s===0?!1:w},"updateAllSelected"),z=r(e=>{var t;if(!n||!n.store)return 0;const{treeData:o}=n.store.states;let l=0;const s=(t=o.value[e])==null?void 0:t.children;return s&&(l+=s.length,s.forEach(c=>{l+=z(c)})),l},"getChildrenCount"),ue=r((e,t)=>{Array.isArray(e)||(e=[e]);const o={};return e.forEach(l=>{A.value[l.id]=t,o[l.columnKey||l.id]=t}),o},"updateFilters"),V=r((e,t,o)=>{C.value&&C.value!==e&&(C.value.order=null),C.value=e,L.value=t,F.value=o},"updateSort"),H=r(()=>{let e=a.unref(O);Object.keys(A.value).forEach(t=>{const o=A.value[t];if(!o||o.length===0)return;const l=v.getColumnById({columns:E.value},t);l&&l.filterMethod&&(e=e.filter(s=>o.some(c=>l.filterMethod.call(null,c,s,l))))}),K.value=e},"execFilter"),Q=r(()=>{f.value=Oe(K.value,{sortingColumn:C.value,sortProp:L.value,sortOrder:F.value})},"execSort"),ce=r((e=void 0)=>{e&&e.filter||H(),Q()},"execQuery"),ie=r(e=>{const{tableHeaderRef:t}=n.refs;if(!t)return;const o=Object.assign({},t.filterPanels),l=Object.keys(o);if(l.length)if(typeof e=="string"&&(e=[e]),Array.isArray(e)){const s=e.map(c=>v.getColumnByKey({columns:E.value},c));l.forEach(c=>{const d=s.find(w=>w.id===c);d&&(d.filteredValue=[])}),n.store.commit("filterChange",{column:s,values:[],silent:!0,multi:!0})}else l.forEach(s=>{const c=E.value.find(d=>d.id===s);c&&(c.filteredValue=[])}),A.value={},n.store.commit("filterChange",{column:{},values:[],silent:!0})},"clearFilter"),fe=r(()=>{C.value&&(V(null,null,null),n.store.commit("changeSortCondition",{silent:!0}))},"clearSort"),{setExpandRowKeys:de,toggleRowExpansion:U,updateExpandRows:ve,states:he,isRowExpanded:ge}=Ae.default({data:f,rowKey:i}),{updateTreeExpandKeys:pe,toggleTreeExpansion:me,updateTreeData:ye,loadOrToggle:xe,states:Ce}=Ke.default({data:f,rowKey:i}),{updateCurrentRowData:we,updateCurrentRow:Se,setCurrentRowKey:Ee,states:Re}=Me.default({data:f,rowKey:i});return{assertRowKey:Z,updateColumns:j,scheduleLayout:N,isSelected:ee,clearSelection:te,cleanSelection:le,getSelectionRows:ne,toggleRowSelection:oe,_toggleAllSelection:ae,toggleAllSelection:null,updateSelectionByRowKey:se,updateAllSelected:re,updateFilters:ue,updateCurrentRow:Se,updateSort:V,execFilter:H,execSort:Q,execQuery:ce,clearFilter:ie,clearSort:fe,toggleRowExpansion:U,setExpandRowKeysAdapter:r(e=>{de(e),pe(e)},"setExpandRowKeysAdapter"),setCurrentRowKey:Ee,toggleRowExpansionAdapter:r((e,t)=>{E.value.some(({type:l})=>l==="expand")?U(e,t):me(e,t)},"toggleRowExpansionAdapter"),isRowExpanded:ge,updateExpandRows:ve,updateCurrentRowData:we,loadOrToggle:xe,updateTreeData:ye,states:{tableSize:h,rowKey:i,data:f,_data:O,isComplex:k,_columns:g,originColumns:q,columns:E,fixedColumns:y,rightFixedColumns:_,leafColumns:W,fixedLeafColumns:$,rightFixedLeafColumns:G,updateOrderFns:J,leafColumnsLength:I,fixedLeafColumnsLength:D,rightFixedLeafColumnsLength:P,isAllSelected:x,selection:u,reserveSelection:X,selectOnIndeterminate:B,selectable:b,filters:A,filteredData:K,sortingColumn:C,sortProp:L,sortOrder:F,hoverRow:Y,...he,...Ce,...Re}}}r(ke,"useWatcher");exports.default=ke;
