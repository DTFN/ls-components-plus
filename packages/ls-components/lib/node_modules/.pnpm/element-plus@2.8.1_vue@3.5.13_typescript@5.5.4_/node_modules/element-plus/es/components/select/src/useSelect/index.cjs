"use strict";var st=Object.defineProperty;var a=(t,d)=>st(t,"name",{value:d,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const u=require("vue"),r=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),b=require("../../../../../../../../@vueuse_core@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/core/index/index.cjs"),ct=require("../../../../hooks/use-locale/index/index.cjs"),rt=require("../../../../hooks/use-id/index/index.cjs"),ge=require("../../../../hooks/use-namespace/index/index.cjs"),dt=require("../../../../hooks/use-composition/index/index.cjs"),ft=require("../../../../hooks/use-focus-controller/index/index.cjs"),be=require("../../../form/src/hooks/use-form-item/index.cjs"),vt=require("../../../../hooks/use-empty-values/index/index.cjs"),mt=require("../../../../utils/vue/icon/index.cjs"),ht=require("../../../form/src/hooks/use-form-common-props/index.cjs"),p=require("../../../../utils/types/index.cjs"),gt=require("../../../../utils/error/index.cjs"),x=require("../../../../constants/event/index.cjs"),bt=require("../../../../constants/aria/index.cjs"),xt=require("../../../../utils/dom/scroll/index.cjs"),C=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/castArray/index.cjs"),$=require("../../../../../../../../@vueuse_shared@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/shared/index/index.cjs"),xe=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isEqual/index.cjs"),w=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/get/index.cjs"),Vt=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/debounce/index.cjs"),Ot=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/findLastIndex/index.cjs"),It=11,Et=a((t,d)=>{const{t:y}=ct.useLocale(),Ve=rt.useId(),W=ge.useNamespace("select"),Oe=ge.useNamespace("input"),l=u.reactive({inputValue:"",options:new Map,cachedOptions:new Map,disabledOptions:new Map,optionValues:[],selected:t.multiple?[]:{},selectionWidth:0,calculatorWidth:0,collapseItemWidth:0,selectedLabel:"",hoveringIndex:-1,previousQuery:null,inputHovering:!1,menuVisibleOnFocus:!1,isBeforeHide:!1}),B=u.ref(null),V=u.ref(null),h=u.ref(null),N=u.ref(null),A=u.ref(null),z=u.ref(null),Ie=u.ref(null),Ee=u.ref(null),H=u.ref(null),k=u.ref(null),_=u.ref(null),K=u.ref(null),{isComposing:j,handleCompositionStart:Te,handleCompositionUpdate:pe,handleCompositionEnd:Ce}=dt.useComposition({afterComposition:a(e=>oe(e),"afterComposition")}),{wrapperRef:Q,isFocused:G,handleBlur:we}=ft.useFocusController(A,{afterFocus(){t.automaticDropdown&&!s.value&&(s.value=!0,l.menuVisibleOnFocus=!0)},beforeBlur(e){var n,i;return((n=h.value)==null?void 0:n.isFocusInsideContent(e))||((i=N.value)==null?void 0:i.isFocusInsideContent(e))},afterBlur(){s.value=!1,l.menuVisibleOnFocus=!1}}),s=u.ref(!1),O=u.ref(),{form:J,formItem:I}=be.useFormItem(),{inputId:ye}=be.useFormItemInputId(t,{formItemContext:I}),{valueOnClear:_e,isEmptyValue:Re}=vt.useEmptyValues(t),R=u.computed(()=>t.disabled||(J==null?void 0:J.disabled)),P=u.computed(()=>r.isArray(t.modelValue)?t.modelValue.length>0:!Re(t.modelValue)),qe=u.computed(()=>t.clearable&&!R.value&&l.inputHovering&&P.value),X=u.computed(()=>t.remote&&t.filterable&&!t.remoteShowSuffix?"":t.suffixIcon),Me=u.computed(()=>W.is("reverse",X.value&&s.value)),Y=u.computed(()=>(I==null?void 0:I.validateState)||""),De=u.computed(()=>mt.ValidateComponentsMap[Y.value]),Se=u.computed(()=>t.remote?300:0),Z=u.computed(()=>t.loading?t.loadingText||y("el.select.loading"):t.remote&&!l.inputValue&&l.options.size===0?!1:t.filterable&&l.inputValue&&l.options.size>0&&q.value===0?t.noMatchText||y("el.select.noMatch"):l.options.size===0?t.noDataText||y("el.select.noData"):null),q=u.computed(()=>c.value.filter(e=>e.visible).length),c=u.computed(()=>{const e=Array.from(l.options.values()),n=[];return l.optionValues.forEach(i=>{const o=e.findIndex(v=>v.value===i);o>-1&&n.push(e[o])}),n.length>=e.length?n:e}),Fe=u.computed(()=>Array.from(l.cachedOptions.values())),Le=u.computed(()=>{const e=c.value.filter(n=>!n.created).some(n=>n.currentLabel===l.inputValue);return t.filterable&&t.allowCreate&&l.inputValue!==""&&!e}),ee=a(()=>{t.filterable&&r.isFunction(t.filterMethod)||t.filterable&&t.remote&&r.isFunction(t.remoteMethod)||c.value.forEach(e=>{var n;(n=e.updateOption)==null||n.call(e,l.inputValue)})},"updateOptions"),te=ht.useFormSize(),We=u.computed(()=>["small"].includes(te.value)?"small":"default"),Ne=u.computed({get(){return s.value&&Z.value!==!1},set(e){s.value=e}}),Ae=u.computed(()=>{if(t.multiple&&!p.isUndefined(t.modelValue))return C.default(t.modelValue).length===0&&!l.inputValue;const e=r.isArray(t.modelValue)?t.modelValue[0]:t.modelValue;return t.filterable||p.isUndefined(e)?!l.inputValue:!0}),ze=u.computed(()=>{var e;const n=(e=t.placeholder)!=null?e:y("el.select.placeholder");return t.multiple||!P.value?n:l.selectedLabel}),Pe=u.computed(()=>$.isIOS?null:"mouseenter");u.watch(()=>t.modelValue,(e,n)=>{t.multiple&&t.filterable&&!t.reserveKeyword&&(l.inputValue="",M("")),D(),!xe.default(e,n)&&t.validateEvent&&(I==null||I.validate("change").catch(i=>gt.debugWarn(i)))},{flush:"post",deep:!0}),u.watch(()=>s.value,e=>{e?M(l.inputValue):(l.inputValue="",l.previousQuery=null,l.isBeforeHide=!0),d("visible-change",e)}),u.watch(()=>l.options.entries(),()=>{var e;if(!$.isClient)return;const n=((e=B.value)==null?void 0:e.querySelectorAll("input"))||[];(!t.filterable&&!t.defaultFirstOption&&!p.isUndefined(t.modelValue)||!Array.from(n).includes(document.activeElement))&&D(),t.defaultFirstOption&&(t.filterable||t.remote)&&q.value&&le()},{flush:"post"}),u.watch(()=>l.hoveringIndex,e=>{p.isNumber(e)&&e>-1?O.value=c.value[e]||{}:O.value={},c.value.forEach(n=>{n.hover=O.value===n})}),u.watchEffect(()=>{l.isBeforeHide||ee()});const M=a(e=>{l.previousQuery===e||j.value||(l.previousQuery=e,t.filterable&&r.isFunction(t.filterMethod)?t.filterMethod(e):t.filterable&&t.remote&&r.isFunction(t.remoteMethod)&&t.remoteMethod(e),t.defaultFirstOption&&(t.filterable||t.remote)&&q.value?u.nextTick(le):u.nextTick(Ue))},"handleQueryChange"),le=a(()=>{const e=c.value.filter(o=>o.visible&&!o.disabled&&!o.states.groupDisabled),n=e.find(o=>o.created),i=e[0];l.hoveringIndex=de(c.value,n||i)},"checkDefaultFirstOption"),D=a(()=>{if(t.multiple)l.selectedLabel="";else{const n=r.isArray(t.modelValue)?t.modelValue[0]:t.modelValue,i=ne(n);l.selectedLabel=i.currentLabel,l.selected=i;return}const e=[];p.isUndefined(t.modelValue)||C.default(t.modelValue).forEach(n=>{e.push(ne(n))}),l.selected=e},"setSelected"),ne=a(e=>{let n;const i=r.toRawType(e).toLowerCase()==="object",o=r.toRawType(e).toLowerCase()==="null",v=r.toRawType(e).toLowerCase()==="undefined";for(let m=l.cachedOptions.size-1;m>=0;m--){const f=Fe.value[m];if(i?w.default(f.value,t.valueKey)===w.default(e,t.valueKey):f.value===e){n={value:e,currentLabel:f.currentLabel,get isDisabled(){return f.isDisabled}};break}}if(n)return n;const g=i?e.label:!o&&!v?e:"";return{value:e,currentLabel:g}},"getOption"),Ue=a(()=>{t.multiple?l.hoveringIndex=c.value.findIndex(e=>l.selected.some(n=>T(n)===T(e))):l.hoveringIndex=c.value.findIndex(e=>T(e)===T(l.selected))},"updateHoveringIndex"),$e=a(()=>{l.selectionWidth=V.value.getBoundingClientRect().width},"resetSelectionWidth"),ue=a(()=>{l.calculatorWidth=z.value.getBoundingClientRect().width},"resetCalculatorWidth"),Be=a(()=>{l.collapseItemWidth=_.value.getBoundingClientRect().width},"resetCollapseItemWidth"),U=a(()=>{var e,n;(n=(e=h.value)==null?void 0:e.updatePopper)==null||n.call(e)},"updateTooltip"),ie=a(()=>{var e,n;(n=(e=N.value)==null?void 0:e.updatePopper)==null||n.call(e)},"updateTagTooltip"),ae=a(()=>{l.inputValue.length>0&&!s.value&&(s.value=!0),M(l.inputValue)},"onInputChange"),oe=a(e=>{if(l.inputValue=e.target.value,t.remote)se();else return ae()},"onInput"),se=Vt.default(()=>{ae()},Se.value),E=a(e=>{xe.default(t.modelValue,e)||d(x.CHANGE_EVENT,e)},"emitChange"),He=a(e=>Ot.default(e,n=>!l.disabledOptions.has(n)),"getLastNotDisabledIndex"),ke=a(e=>{if(t.multiple&&e.code!==bt.EVENT_CODE.delete&&e.target.value.length<=0){const n=C.default(t.modelValue).slice(),i=He(n);if(i<0)return;const o=n[i];n.splice(i,1),d(x.UPDATE_MODEL_EVENT,n),E(n),d("remove-tag",o)}},"deletePrevTag"),Ke=a((e,n)=>{const i=l.selected.indexOf(n);if(i>-1&&!R.value){const o=C.default(t.modelValue).slice();o.splice(i,1),d(x.UPDATE_MODEL_EVENT,o),E(o),d("remove-tag",n.value)}e.stopPropagation(),F()},"deleteTag"),ce=a(e=>{e.stopPropagation();const n=t.multiple?[]:_e.value;if(t.multiple)for(const i of l.selected)i.isDisabled&&n.push(i.value);d(x.UPDATE_MODEL_EVENT,n),E(n),l.hoveringIndex=-1,s.value=!1,d("clear"),F()},"deleteSelected"),re=a(e=>{var n;if(t.multiple){const i=C.default((n=t.modelValue)!=null?n:[]).slice(),o=de(i,e.value);o>-1?i.splice(o,1):(t.multipleLimit<=0||i.length<t.multipleLimit)&&i.push(e.value),d(x.UPDATE_MODEL_EVENT,i),E(i),e.created&&M(""),t.filterable&&!t.reserveKeyword&&(l.inputValue="")}else d(x.UPDATE_MODEL_EVENT,e.value),E(e.value),s.value=!1;F(),!s.value&&u.nextTick(()=>{S(e)})},"handleOptionSelect"),de=a((e=[],n)=>{if(!r.isObject(n))return e.indexOf(n);const i=t.valueKey;let o=-1;return e.some((v,g)=>u.toRaw(w.default(v,i))===w.default(n,i)?(o=g,!0):!1),o},"getValueIndex"),S=a(e=>{var n,i,o,v,g;const L=r.isArray(e)?e[0]:e;let m=null;if(L!=null&&L.value){const f=c.value.filter(he=>he.value===L.value);f.length>0&&(m=f[0].$el)}if(h.value&&m){const f=(v=(o=(i=(n=h.value)==null?void 0:n.popperRef)==null?void 0:i.contentRef)==null?void 0:o.querySelector)==null?void 0:v.call(o,`.${W.be("dropdown","wrap")}`);f&&xt.scrollIntoView(f,m)}(g=K.value)==null||g.handleScroll()},"scrollToOption"),je=a(e=>{l.options.set(e.value,e),l.cachedOptions.set(e.value,e),e.disabled&&l.disabledOptions.set(e.value,e)},"onOptionCreate"),Qe=a((e,n)=>{l.options.get(e)===n&&l.options.delete(e)},"onOptionDestroy"),Ge=u.computed(()=>{var e,n;return(n=(e=h.value)==null?void 0:e.popperRef)==null?void 0:n.contentRef}),Je=a(()=>{l.isBeforeHide=!1,u.nextTick(()=>S(l.selected))},"handleMenuEnter"),F=a(()=>{var e;(e=A.value)==null||e.focus()},"focus"),Xe=a(()=>{fe()},"blur"),Ye=a(e=>{ce(e)},"handleClearClick"),fe=a(e=>{if(s.value=!1,G.value){const n=new FocusEvent("focus",e);u.nextTick(()=>we(n))}},"handleClickOutside"),Ze=a(()=>{l.inputValue.length>0?l.inputValue="":s.value=!1},"handleEsc"),ve=a(()=>{R.value||($.isIOS&&(l.inputHovering=!0),l.menuVisibleOnFocus?l.menuVisibleOnFocus=!1:s.value=!s.value)},"toggleMenu"),et=a(()=>{s.value?c.value[l.hoveringIndex]&&re(c.value[l.hoveringIndex]):ve()},"selectOption"),T=a(e=>r.isObject(e.value)?w.default(e.value,t.valueKey):e.value,"getValueKey"),tt=u.computed(()=>c.value.filter(e=>e.visible).every(e=>e.disabled)),lt=u.computed(()=>t.multiple?t.collapseTags?l.selected.slice(0,t.maxCollapseTags):l.selected:[]),nt=u.computed(()=>t.multiple?t.collapseTags?l.selected.slice(t.maxCollapseTags):[]:[]),me=a(e=>{if(!s.value){s.value=!0;return}if(!(l.options.size===0||l.filteredOptionsCount===0||j.value)&&!tt.value){e==="next"?(l.hoveringIndex++,l.hoveringIndex===l.options.size&&(l.hoveringIndex=0)):e==="prev"&&(l.hoveringIndex--,l.hoveringIndex<0&&(l.hoveringIndex=l.options.size-1));const n=c.value[l.hoveringIndex];(n.disabled===!0||n.states.groupDisabled===!0||!n.visible)&&me(e),u.nextTick(()=>S(O.value))}},"navigateOptions"),ut=a(()=>{if(!V.value)return 0;const e=window.getComputedStyle(V.value);return Number.parseFloat(e.gap||"6px")},"getGapWidth"),it=u.computed(()=>{const e=ut();return{maxWidth:`${_.value&&t.maxCollapseTags===1?l.selectionWidth-l.collapseItemWidth-e:l.selectionWidth}px`}}),at=u.computed(()=>({maxWidth:`${l.selectionWidth}px`})),ot=u.computed(()=>({width:`${Math.max(l.calculatorWidth,It)}px`}));return b.useResizeObserver(V,$e),b.useResizeObserver(z,ue),b.useResizeObserver(H,U),b.useResizeObserver(Q,U),b.useResizeObserver(k,ie),b.useResizeObserver(_,Be),u.onMounted(()=>{D()}),{inputId:ye,contentId:Ve,nsSelect:W,nsInput:Oe,states:l,isFocused:G,expanded:s,optionsArray:c,hoverOption:O,selectSize:te,filteredOptionsCount:q,resetCalculatorWidth:ue,updateTooltip:U,updateTagTooltip:ie,debouncedOnInputChange:se,onInput:oe,deletePrevTag:ke,deleteTag:Ke,deleteSelected:ce,handleOptionSelect:re,scrollToOption:S,hasModelValue:P,shouldShowPlaceholder:Ae,currentPlaceholder:ze,mouseEnterEventName:Pe,showClose:qe,iconComponent:X,iconReverse:Me,validateState:Y,validateIcon:De,showNewOption:Le,updateOptions:ee,collapseTagSize:We,setSelected:D,selectDisabled:R,emptyText:Z,handleCompositionStart:Te,handleCompositionUpdate:pe,handleCompositionEnd:Ce,onOptionCreate:je,onOptionDestroy:Qe,handleMenuEnter:Je,focus:F,blur:Xe,handleClearClick:Ye,handleClickOutside:fe,handleEsc:Ze,toggleMenu:ve,selectOption:et,getValueKey:T,navigateOptions:me,dropdownMenuVisible:Ne,showTagList:lt,collapseTagList:nt,tagStyle:it,collapseTagStyle:at,inputStyle:ot,popperRef:Ge,inputRef:A,tooltipRef:h,tagTooltipRef:N,calculatorRef:z,prefixRef:Ie,suffixRef:Ee,selectRef:B,wrapperRef:Q,selectionRef:V,scrollbarRef:K,menuRef:H,tagMenuRef:k,collapseItemRef:_}},"useSelect");exports.useSelect=Et;
