"use strict";var D=Object.defineProperty;var a=(h,b)=>D(h,"name",{value:b,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=require("vue"),k=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),$=require("../upload-dragger2/index.cjs"),w=require("../upload-content/index.cjs"),z=require("../upload/index.cjs"),A=require("../../../../_virtual/plugin-vue_export-helper/index.cjs"),H=require("../../../../hooks/use-namespace/index/index.cjs"),L=require("../../../form/src/hooks/use-form-common-props/index.cjs"),N=require("../../../../utils/objects/index.cjs"),S=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/cloneDeep/index.cjs"),T=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isEqual/index.cjs"),V=t.defineComponent({name:"ElUploadContent",inheritAttrs:!1}),I=t.defineComponent({...V,props:w.uploadContentProps,setup(h,{expose:b}){const s=h,u=H.useNamespace("upload"),c=L.useFormDisabled(),d=t.shallowRef({}),m=t.shallowRef(),_=a(e=>{if(e.length===0)return;const{autoUpload:n,limit:o,fileList:r,multiple:l,onStart:f,onExceed:g}=s;if(o&&r.length+e.length>o){g(e,r);return}l||(e=e.slice(0,1));for(const v of e){const p=v;p.uid=z.genFileId(),f(p),n&&E(p)}},"uploadFiles"),E=a(async e=>{if(m.value.value="",!s.beforeUpload)return P(e);let n,o={};try{const l=s.data,f=s.beforeUpload(e);o=k.isPlainObject(s.data)?S.default(s.data):s.data,n=await f,k.isPlainObject(s.data)&&T.default(l,o)&&(o=S.default(s.data))}catch{n=!1}if(n===!1){s.onRemove(e);return}let r=e;n instanceof Blob&&(n instanceof File?r=n:r=new File([n],e.name,{type:e.type})),P(Object.assign(r,{uid:e.uid}),o)},"upload$1"),U=a(async(e,n)=>k.isFunction(e)?e(n):e,"resolveData"),P=a(async(e,n)=>{const{headers:o,data:r,method:l,withCredentials:f,name:g,action:v,onProgress:p,onSuccess:M,onError:O,httpRequest:K}=s;try{n=await U(n??r,e)}catch{s.onRemove(e);return}const{uid:y}=e,q={headers:o||{},withCredentials:f,file:e,data:n,method:l,filename:g,action:v,onProgress:a(i=>{p(i,e)},"onProgress"),onSuccess:a(i=>{M(i,e),delete d.value[y]},"onSuccess"),onError:a(i=>{O(i,e),delete d.value[y]},"onError")},C=K(q);d.value[y]=C,C instanceof Promise&&C.then(q.onSuccess,q.onError)},"doUpload"),B=a(e=>{const n=e.target.files;n&&_(Array.from(n))},"handleChange"),R=a(()=>{c.value||(m.value.value="",m.value.click())},"handleClick"),j=a(()=>{R()},"handleKeydown");return b({abort:a(e=>{N.entriesOf(d.value).filter(e?([o])=>String(e.uid)===o:()=>!0).forEach(([o,r])=>{r instanceof XMLHttpRequest&&r.abort(),delete d.value[o]})},"abort"),upload:E}),(e,n)=>(t.openBlock(),t.createElementBlock("div",{class:t.normalizeClass([t.unref(u).b(),t.unref(u).m(e.listType),t.unref(u).is("drag",e.drag),t.unref(u).is("disabled",t.unref(c))]),tabindex:t.unref(c)?"-1":"0",onClick:R,onKeydown:t.withKeys(t.withModifiers(j,["self"]),["enter","space"])},[e.drag?(t.openBlock(),t.createBlock($.default,{key:0,disabled:t.unref(c),onFile:_},{default:t.withCtx(()=>[t.renderSlot(e.$slots,"default")]),_:3},8,["disabled"])):t.renderSlot(e.$slots,"default",{key:1}),t.createElementVNode("input",{ref_key:"inputRef",ref:m,class:t.normalizeClass(t.unref(u).e("input")),name:e.name,disabled:t.unref(c),multiple:e.multiple,accept:e.accept,type:"file",onChange:B,onClick:t.withModifiers(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var X=A.default(I,[["__file","upload-content.vue"]]);exports.default=X;
