"use strict";var E=Object.defineProperty;var f=(b,D)=>E(b,"name",{value:D,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),y=require("../../../../../../../../../dayjs@1.11.13/node_modules/dayjs/dayjs.min/index.cjs"),I=require("../../props/basic-year-table/index.cjs"),N=require("../../utils/index.cjs"),K=require("../basic-cell-render/index.cjs"),$=require("../../../../../_virtual/plugin-vue_export-helper/index.cjs"),j=require("../../../../time-picker/src/utils/index.cjs"),L=require("../../../../../hooks/use-namespace/index/index.cjs"),P=require("../../../../../hooks/use-locale/index/index.cjs"),m=require("../../../../../utils/arrays/index.cjs"),O=require("../../../../../utils/dom/style/index.cjs"),z=e.defineComponent({__name:"basic-year-table",props:I.basicYearTableProps,emits:["changerange","pick","select"],setup(b,{expose:D,emit:u}){const a=b,B=f((r,t)=>{const n=y.default(String(r)).locale(t).startOf("year"),o=n.endOf("year").dayOfYear();return j.rangeArr(o).map(i=>n.add(i,"day").toDate())},"datesInYear"),q=L.useNamespace("year-table"),{t:M,lang:p}=P.useLocale(),_=e.ref(),g=e.ref(),k=e.computed(()=>Math.floor(a.date.year()/10)*10),T=e.ref([[],[],[]]),S=e.ref(),h=e.ref(),C=e.computed(()=>{var r;const t=T.value,n=y.default().locale(p.value).startOf("year");for(let s=0;s<3;s++){const o=t[s];for(let i=0;i<4&&!(s*4+i>=10);i++){let l=o[i];l||(l={row:s,column:i,type:"normal",inRange:!1,start:!1,end:!1,text:-1,disabled:!1}),l.type="normal";const v=s*4+i+k.value,c=y.default().year(v),d=a.rangeState.endDate||a.maxDate||a.rangeState.selecting&&a.minDate||null;l.inRange=!!(a.minDate&&c.isSameOrAfter(a.minDate,"year")&&d&&c.isSameOrBefore(d,"year"))||!!(a.minDate&&c.isSameOrBefore(a.minDate,"year")&&d&&c.isSameOrAfter(d,"year")),(r=a.minDate)!=null&&r.isSameOrAfter(d)?(l.start=!!(d&&c.isSame(d,"year")),l.end=!!(a.minDate&&c.isSame(a.minDate,"year"))):(l.start=!!(a.minDate&&c.isSame(a.minDate,"year")),l.end=!!(d&&c.isSame(d,"year"))),n.isSame(c)&&(l.type="today"),l.text=v;const V=c.toDate();l.disabled=a.disabledDate&&a.disabledDate(V)||!1,o[i]=l}}return t}),Y=f(()=>{var r;(r=g.value)==null||r.focus()},"focus"),A=f(r=>{const t={},n=y.default().locale(p.value),s=r.text;return t.disabled=a.disabledDate?B(s,p.value).every(a.disabledDate):!1,t.today=n.year()===s,t.current=m.castArray(a.parsedValue).findIndex(o=>o.year()===s)>=0,r.inRange&&(t["in-range"]=!0,r.start&&(t["start-date"]=!0),r.end&&(t["end-date"]=!0)),t},"getCellKls"),x=f(r=>{const t=r.text;return m.castArray(a.date).findIndex(n=>n.year()===t)>=0},"isSelectedCell"),w=f(r=>{var t;const n=(t=r.target)==null?void 0:t.closest("td");if(!n||!n.textContent||O.hasClass(n,"disabled"))return;const s=n.cellIndex,i=n.parentNode.rowIndex*4+s+k.value,l=y.default().year(i);if(a.selectionMode==="range")a.rangeState.selecting?(a.minDate&&l>=a.minDate?u("pick",{minDate:a.minDate,maxDate:l}):u("pick",{minDate:l,maxDate:a.minDate}),u("select",!1)):(u("pick",{minDate:l,maxDate:null}),u("select",!0));else if(a.selectionMode==="years"){if(r.type==="keydown"){u("pick",m.castArray(a.parsedValue),!1);return}const v=N.getValidDateOfYear(l.startOf("year"),p.value,a.disabledDate),c=O.hasClass(n,"current")?m.castArray(a.parsedValue).filter(d=>(d==null?void 0:d.year())!==i):m.castArray(a.parsedValue).concat([v]);u("pick",c)}else u("pick",i)},"handleYearTableClick"),R=f(r=>{var t;if(!a.rangeState.selecting)return;const n=(t=r.target)==null?void 0:t.closest("td");if(!n)return;const s=n.parentNode.rowIndex,o=n.cellIndex;C.value[s][o].disabled||(s!==S.value||o!==h.value)&&(S.value=s,h.value=o,u("changerange",{selecting:!0,endDate:y.default().year(k.value).add(s*4+o,"year")}))},"handleMouseMove");return e.watch(()=>a.date,async()=>{var r,t;(r=_.value)!=null&&r.contains(document.activeElement)&&(await e.nextTick(),(t=g.value)==null||t.focus())}),D({focus:Y}),(r,t)=>(e.openBlock(),e.createElementBlock("table",{role:"grid","aria-label":e.unref(M)("el.datepicker.yearTablePrompt"),class:e.normalizeClass(e.unref(q).b()),onClick:w,onMousemove:R},[e.createElementVNode("tbody",{ref_key:"tbodyRef",ref:_},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(C),(n,s)=>(e.openBlock(),e.createElementBlock("tr",{key:s},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n,(o,i)=>(e.openBlock(),e.createElementBlock("td",{key:`${s}_${i}`,ref_for:!0,ref:f(l=>x(o)&&(g.value=l),"ref"),class:e.normalizeClass(["available",A(o)]),"aria-selected":x(o),"aria-label":String(o.text),tabindex:x(o)?0:-1,onKeydown:[e.withKeys(e.withModifiers(w,["prevent","stop"]),["space"]),e.withKeys(e.withModifiers(w,["prevent","stop"]),["enter"])]},[e.createVNode(e.unref(K.default),{cell:o},null,8,["cell"])],42,["aria-selected","aria-label","tabindex","onKeydown"]))),128))]))),128))],512)],42,["aria-label"]))}});var F=$.default(z,[["__file","basic-year-table.vue"]]);exports.default=F;
