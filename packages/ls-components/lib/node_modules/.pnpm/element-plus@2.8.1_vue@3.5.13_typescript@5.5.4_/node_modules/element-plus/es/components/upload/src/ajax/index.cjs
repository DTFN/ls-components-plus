"use strict";var c=Object.defineProperty;var o=(t,e)=>c(t,"name",{value:e,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const f=require("../../../../utils/error/index.cjs"),p=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),h=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isNil/index.cjs"),m="ElUpload",i=class i extends Error{constructor(e,s,n,d){super(e),this.name="UploadAjaxError",this.status=s,this.method=n,this.url=d}};o(i,"UploadAjaxError");let u=i;function l(t,e,s){let n;return s.response?n=`${s.response.error||s.response}`:s.responseText?n=`${s.responseText}`:n=`fail to ${e.method} ${t} ${s.status}`,new u(n,s.status,e.method,t)}o(l,"getError");function E(t){const e=t.responseText||t.response;if(!e)return e;try{return JSON.parse(e)}catch{return e}}o(E,"getBody");const g=o(t=>{typeof XMLHttpRequest>"u"&&f.throwError(m,"XMLHttpRequest is undefined");const e=new XMLHttpRequest,s=t.action;e.upload&&e.upload.addEventListener("progress",a=>{const r=a;r.percent=a.total>0?a.loaded/a.total*100:0,t.onProgress(r)});const n=new FormData;if(t.data)for(const[a,r]of Object.entries(t.data))p.isArray(r)&&r.length?n.append(a,...r):n.append(a,r);n.append(t.filename,t.file,t.file.name),e.addEventListener("error",()=>{t.onError(l(s,t,e))}),e.addEventListener("load",()=>{if(e.status<200||e.status>=300)return t.onError(l(s,t,e));t.onSuccess(E(e))}),e.open(t.method,s,!0),t.withCredentials&&"withCredentials"in e&&(e.withCredentials=!0);const d=t.headers||{};if(d instanceof Headers)d.forEach((a,r)=>e.setRequestHeader(r,a));else for(const[a,r]of Object.entries(d))h.default(r)||e.setRequestHeader(a,String(r));return e.send(n),e},"ajaxUpload");exports.UploadAjaxError=u;exports.ajaxUpload=g;
