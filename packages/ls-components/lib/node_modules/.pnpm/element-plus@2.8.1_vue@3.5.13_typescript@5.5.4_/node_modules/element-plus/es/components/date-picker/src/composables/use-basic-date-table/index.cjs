"use strict";var Y=Object.defineProperty;var o=(a,f)=>Y(a,"name",{value:f,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const n=require("vue"),W=require("../../../../../../../../../dayjs@1.11.13/node_modules/dayjs/dayjs.min/index.cjs"),Z=require("../../utils/index.cjs"),q=require("../../../../../hooks/use-locale/index/index.cjs"),x=require("../../../../../utils/arrays/index.cjs"),p=require("../../../../../hooks/use-namespace/index/index.cjs"),ee=require("../../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/flatten/index.cjs"),N=o((a="")=>["normal","today"].includes(a),"isNormalDay"),te=o((a,f)=>{const{lang:b}=q.useLocale(),D=n.ref(),k=n.ref(),g=n.ref(),w=n.ref(),C=n.ref([[],[],[],[],[],[]]);let M=!1;const h=a.date.$locale().weekStart||7,u=a.date.locale("en").localeData().weekdaysShort().map(e=>e.toLowerCase()),d=n.computed(()=>h>3?7-h:-h),O=n.computed(()=>{const e=a.date.startOf("month");return e.subtract(e.day()||7,"day")}),I=n.computed(()=>u.concat(u).slice(h,h+7)),S=n.computed(()=>ee.default(n.unref(v)).some(e=>e.isCurrent)),L=n.computed(()=>{const e=a.date.startOf("month"),t=e.day()||7,s=e.daysInMonth(),r=e.subtract(1,"month").daysInMonth();return{startOfMonthDay:t,dateCountOfMonth:s,dateCountOfLastMonth:r}}),_=n.computed(()=>a.selectionMode==="dates"?x.castArray(a.parsedValue):[]),E=o((e,{count:t,rowIndex:s,columnIndex:r})=>{const{startOfMonthDay:c,dateCountOfMonth:l,dateCountOfLastMonth:m}=n.unref(L),y=n.unref(d);if(s>=0&&s<=1){const i=c+y<0?7+c+y:c+y;if(r+s*7>=i)return e.text=t,!0;e.text=m-(i-r%7)+1+s*7,e.type="prev-month"}else return t<=l?e.text=t:(e.text=t-l,e.type="next-month"),!0;return!1},"setDateText"),j=o((e,{columnIndex:t,rowIndex:s},r)=>{const{disabledDate:c,cellClassName:l}=a,m=n.unref(_),y=E(e,{count:r,rowIndex:s,columnIndex:t}),i=e.dayjs.toDate();return e.selected=m.find(X=>X.isSame(e.dayjs,"day")),e.isSelected=!!e.selected,e.isCurrent=R(e),e.disabled=c==null?void 0:c(i),e.customClass=l==null?void 0:l(i),y},"setCellMetadata"),K=o(e=>{if(a.selectionMode==="week"){const[t,s]=a.showWeekNumber?[1,7]:[0,6],r=P(e[t+1]);e[t].inRange=r,e[t].start=r,e[s].inRange=r,e[s].end=r}},"setRowMetadata"),v=n.computed(()=>{const{minDate:e,maxDate:t,rangeState:s,showWeekNumber:r}=a,c=n.unref(d),l=n.unref(C),m="day";let y=1;if(r)for(let i=0;i<6;i++)l[i][0]||(l[i][0]={type:"week",text:n.unref(O).add(i*7+1,m).week()});return Z.buildPickerTable({row:6,column:7},l,{startDate:e,columnIndexOffset:r?1:0,nextEndDate:s.endDate||t||s.selecting&&e||null,now:W.default().locale(n.unref(b)).startOf(m),unit:m,relativeDateGetter:o(i=>n.unref(O).add(i-c,m),"relativeDateGetter"),setCellMetadata:o((...i)=>{j(...i,y)&&(y+=1)},"setCellMetadata"),setRowMetadata:K}),l});n.watch(()=>a.date,async()=>{var e;(e=n.unref(D))!=null&&e.contains(document.activeElement)&&(await n.nextTick(),await T())});const T=o(async()=>{var e;return(e=n.unref(k))==null?void 0:e.focus()},"focus"),R=o(e=>a.selectionMode==="date"&&N(e.type)&&B(e,a.parsedValue),"isCurrent"),B=o((e,t)=>t?W.default(t).locale(n.unref(b)).isSame(a.date.date(Number(e.text)),"day"):!1,"cellMatchesDate"),V=o((e,t)=>{const s=e*7+(t-(a.showWeekNumber?1:0))-n.unref(d);return n.unref(O).add(s,"day")},"getDateOfCell"),$=o(e=>{var t;if(!a.rangeState.selecting)return;let s=e.target;if(s.tagName==="SPAN"&&(s=(t=s.parentNode)==null?void 0:t.parentNode),s.tagName==="DIV"&&(s=s.parentNode),s.tagName!=="TD")return;const r=s.parentNode.rowIndex-1,c=s.cellIndex;n.unref(v)[r][c].disabled||(r!==n.unref(g)||c!==n.unref(w))&&(g.value=r,w.value=c,f("changerange",{selecting:!0,endDate:V(r,c)}))},"handleMouseMove"),F=o(e=>!n.unref(S)&&(e==null?void 0:e.text)===1&&e.type==="normal"||e.isCurrent,"isSelectedCell"),U=o(e=>{M||n.unref(S)||a.selectionMode!=="date"||A(e,!0)},"handleFocus"),G=o(e=>{e.target.closest("td")&&(M=!0)},"handleMouseDown"),z=o(e=>{e.target.closest("td")&&(M=!1)},"handleMouseUp"),H=o(e=>{!a.rangeState.selecting||!a.minDate?(f("pick",{minDate:e,maxDate:null}),f("select",!0)):(e>=a.minDate?f("pick",{minDate:a.minDate,maxDate:e}):f("pick",{minDate:e,maxDate:a.minDate}),f("select",!1))},"handleRangePick"),J=o(e=>{const t=e.week(),s=`${e.year()}w${t}`;f("pick",{year:e.year(),week:t,value:s,date:e.startOf("week")})},"handleWeekPick"),Q=o((e,t)=>{const s=t?x.castArray(a.parsedValue).filter(r=>(r==null?void 0:r.valueOf())!==e.valueOf()):x.castArray(a.parsedValue).concat([e]);f("pick",s)},"handleDatesPick"),A=o((e,t=!1)=>{const s=e.target.closest("td");if(!s)return;const r=s.parentNode.rowIndex-1,c=s.cellIndex,l=n.unref(v)[r][c];if(l.disabled||l.type==="week")return;const m=V(r,c);switch(a.selectionMode){case"range":{H(m);break}case"date":{f("pick",m,t);break}case"week":{J(m);break}case"dates":{Q(m,!!l.selected);break}}},"handlePickDate"),P=o(e=>{if(a.selectionMode!=="week")return!1;let t=a.date.startOf("day");if(e.type==="prev-month"&&(t=t.subtract(1,"month")),e.type==="next-month"&&(t=t.add(1,"month")),t=t.date(Number.parseInt(e.text,10)),a.parsedValue&&!Array.isArray(a.parsedValue)){const s=(a.parsedValue.day()-h+7)%7-1;return a.parsedValue.subtract(s,"day").isSame(t,"day")}return!1},"isWeekActive");return{WEEKS:I,rows:v,tbodyRef:D,currentCellRef:k,focus:T,isCurrent:R,isWeekActive:P,isSelectedCell:F,handlePickDate:A,handleMouseUp:z,handleMouseDown:G,handleMouseMove:$,handleFocus:U}},"useBasicDateTable"),ae=o((a,{isCurrent:f,isWeekActive:b})=>{const D=p.useNamespace("date-table"),{t:k}=q.useLocale(),g=n.computed(()=>[D.b(),{"is-week-mode":a.selectionMode==="week"}]),w=n.computed(()=>k("el.datepicker.dateTablePrompt")),C=n.computed(()=>k("el.datepicker.week"));return{tableKls:g,tableLabel:w,weekLabel:C,getCellClasses:o(u=>{const d=[];return N(u.type)&&!u.disabled?(d.push("available"),u.type==="today"&&d.push("today")):d.push(u.type),f(u)&&d.push("current"),u.inRange&&(N(u.type)||a.selectionMode==="week")&&(d.push("in-range"),u.start&&d.push("start-date"),u.end&&d.push("end-date")),u.disabled&&d.push("disabled"),u.selected&&d.push("selected"),u.customClass&&d.push(u.customClass),d.join(" ")},"getCellClasses"),getRowKls:o(u=>[D.e("row"),{current:b(u)}],"getRowKls"),t:k}},"useBasicDateTableDOM");exports.useBasicDateTable=te;exports.useBasicDateTableDOM=ae;
