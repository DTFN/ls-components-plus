"use strict";var X=Object.defineProperty;var a=(y,I)=>X(y,"name",{value:I,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),Y=require("../../../input/index/index.cjs"),K=require("../../../icon/index/index.cjs"),w=require("@element-plus/icons-vue"),O=require("../input-number/index.cjs"),Z=require("../../../../_virtual/plugin-vue_export-helper/index.cjs"),ee=require("../../../../hooks/use-locale/index/index.cjs"),ne=require("../../../../hooks/use-namespace/index/index.cjs"),re=require("../../../form/src/hooks/use-form-item/index.cjs"),m=require("../../../../utils/types/index.cjs"),g=require("../../../../utils/error/index.cjs"),$=require("../../../form/src/hooks/use-form-common-props/index.cjs"),p=require("../../../../constants/event/index.cjs"),te=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),z=require("../../../../directives/repeat-click/index/index.cjs"),B=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/isNil/index.cjs"),ue=e.defineComponent({name:"ElInputNumber"}),le=e.defineComponent({...ue,props:O.inputNumberProps,emits:O.inputNumberEmits,setup(y,{expose:I,emit:c}){const u=y,{t:T}=ee.useLocale(),f=ne.useNamespace("input-number"),v=e.ref(),l=e.reactive({currentValue:u.modelValue,userInput:null}),{formItem:b}=re.useFormItem(),q=e.computed(()=>m.isNumber(u.modelValue)&&u.modelValue<=u.min),M=e.computed(()=>m.isNumber(u.modelValue)&&u.modelValue>=u.max),L=e.computed(()=>{const n=U(u.step);return m.isUndefined(u.precision)?Math.max(U(u.modelValue),n):(n>u.precision&&g.debugWarn("InputNumber","precision should not be less than the decimal places of step"),u.precision)}),_=e.computed(()=>u.controls&&u.controlsPosition==="right"),S=$.useFormSize(),N=$.useFormDisabled(),k=e.computed(()=>{if(l.userInput!==null)return l.userInput;let n=l.currentValue;if(B.default(n))return"";if(m.isNumber(n)){if(Number.isNaN(n))return"";m.isUndefined(u.precision)||(n=n.toFixed(u.precision))}return n}),P=a((n,r)=>{if(m.isUndefined(r)&&(r=L.value),r===0)return Math.round(n);let t=String(n);const o=t.indexOf(".");if(o===-1||!t.replace(".","").split("")[o+r])return n;const h=t.length;return t.charAt(h-1)==="5"&&(t=`${t.slice(0,Math.max(0,h-1))}6`),Number.parseFloat(Number(t).toFixed(r))},"toPrecision"),U=a(n=>{if(B.default(n))return 0;const r=n.toString(),t=r.indexOf(".");let o=0;return t!==-1&&(o=r.length-t-1),o},"getPrecision"),x=a((n,r=1)=>m.isNumber(n)?P(n+u.step*r):l.currentValue,"ensurePrecision"),C=a(()=>{if(u.readonly||N.value||M.value)return;const n=Number(k.value)||0,r=x(n);V(r),c(p.INPUT_EVENT,l.currentValue),A()},"increase"),D=a(()=>{if(u.readonly||N.value||q.value)return;const n=Number(k.value)||0,r=x(n,-1);V(r),c(p.INPUT_EVENT,l.currentValue),A()},"decrease"),F=a((n,r)=>{const{max:t,min:o,step:i,precision:d,stepStrictly:h,valueOnClear:E}=u;t<o&&g.throwError("InputNumber","min should not be greater than max.");let s=Number(n);if(B.default(n)||Number.isNaN(s))return null;if(n===""){if(E===null)return null;s=te.isString(E)?{min:o,max:t}[E]:E}return h&&(s=P(Math.round(s/i)*i,d)),m.isUndefined(d)||(s=P(s,d)),(s>t||s<o)&&(s=s>t?t:o,r&&c(p.UPDATE_MODEL_EVENT,s)),s},"verifyValue"),V=a((n,r=!0)=>{var t;const o=l.currentValue,i=F(n);if(!r){c(p.UPDATE_MODEL_EVENT,i);return}o===i&&n||(l.userInput=null,c(p.UPDATE_MODEL_EVENT,i),o!==i&&c(p.CHANGE_EVENT,i,o),u.validateEvent&&((t=b==null?void 0:b.validate)==null||t.call(b,"change").catch(d=>g.debugWarn(d))),l.currentValue=i)},"setCurrentValue"),W=a(n=>{l.userInput=n;const r=n===""?null:Number(n);c(p.INPUT_EVENT,r),V(r,!1)},"handleInput"),R=a(n=>{const r=n!==""?Number(n):"";(m.isNumber(r)&&!Number.isNaN(r)||n==="")&&V(r),A(),l.userInput=null},"handleInputChange"),H=a(()=>{var n,r;(r=(n=v.value)==null?void 0:n.focus)==null||r.call(n)},"focus"),j=a(()=>{var n,r;(r=(n=v.value)==null?void 0:n.blur)==null||r.call(n)},"blur"),G=a(n=>{c("focus",n)},"handleFocus"),J=a(n=>{var r;l.userInput=null,c("blur",n),u.validateEvent&&((r=b==null?void 0:b.validate)==null||r.call(b,"blur").catch(t=>g.debugWarn(t)))},"handleBlur"),A=a(()=>{l.currentValue!==u.modelValue&&(l.currentValue=u.modelValue)},"setCurrentValueToModelValue"),Q=a(n=>{document.activeElement===n.target&&n.preventDefault()},"handleWheel");return e.watch(()=>u.modelValue,(n,r)=>{const t=F(n,!0);l.userInput===null&&t!==r&&(l.currentValue=t)},{immediate:!0}),e.onMounted(()=>{var n;const{min:r,max:t,modelValue:o}=u,i=(n=v.value)==null?void 0:n.input;if(i.setAttribute("role","spinbutton"),Number.isFinite(t)?i.setAttribute("aria-valuemax",String(t)):i.removeAttribute("aria-valuemax"),Number.isFinite(r)?i.setAttribute("aria-valuemin",String(r)):i.removeAttribute("aria-valuemin"),i.setAttribute("aria-valuenow",l.currentValue||l.currentValue===0?String(l.currentValue):""),i.setAttribute("aria-disabled",String(N.value)),!m.isNumber(o)&&o!=null){let d=Number(o);Number.isNaN(d)&&(d=null),c(p.UPDATE_MODEL_EVENT,d)}i.addEventListener("wheel",Q,{passive:!1})}),e.onUpdated(()=>{var n,r;const t=(n=v.value)==null?void 0:n.input;t==null||t.setAttribute("aria-valuenow",`${(r=l.currentValue)!=null?r:""}`)}),I({focus:H,blur:j}),(n,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([e.unref(f).b(),e.unref(f).m(e.unref(S)),e.unref(f).is("disabled",e.unref(N)),e.unref(f).is("without-controls",!n.controls),e.unref(f).is("controls-right",e.unref(_))]),onDragstart:e.withModifiers(()=>{},["prevent"])},[n.controls?e.withDirectives((e.openBlock(),e.createElementBlock("span",{key:0,role:"button","aria-label":e.unref(T)("el.inputNumber.decrease"),class:e.normalizeClass([e.unref(f).e("decrease"),e.unref(f).is("disabled",e.unref(q))]),onKeydown:e.withKeys(D,["enter"])},[e.renderSlot(n.$slots,"decrease-icon",{},()=>[e.createVNode(e.unref(K.ElIcon),null,{default:e.withCtx(()=>[e.unref(_)?(e.openBlock(),e.createBlock(e.unref(w.ArrowDown),{key:0})):(e.openBlock(),e.createBlock(e.unref(w.Minus),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[e.unref(z.vRepeatClick),D]]):e.createCommentVNode("v-if",!0),n.controls?e.withDirectives((e.openBlock(),e.createElementBlock("span",{key:1,role:"button","aria-label":e.unref(T)("el.inputNumber.increase"),class:e.normalizeClass([e.unref(f).e("increase"),e.unref(f).is("disabled",e.unref(M))]),onKeydown:e.withKeys(C,["enter"])},[e.renderSlot(n.$slots,"increase-icon",{},()=>[e.createVNode(e.unref(K.ElIcon),null,{default:e.withCtx(()=>[e.unref(_)?(e.openBlock(),e.createBlock(e.unref(w.ArrowUp),{key:0})):(e.openBlock(),e.createBlock(e.unref(w.Plus),{key:1}))]),_:1})])],42,["aria-label","onKeydown"])),[[e.unref(z.vRepeatClick),C]]):e.createCommentVNode("v-if",!0),e.createVNode(e.unref(Y.ElInput),{id:n.id,ref_key:"input",ref:v,type:"number",step:n.step,"model-value":e.unref(k),placeholder:n.placeholder,readonly:n.readonly,disabled:e.unref(N),size:e.unref(S),max:n.max,min:n.min,name:n.name,"aria-label":n.ariaLabel,"validate-event":!1,onKeydown:[e.withKeys(e.withModifiers(C,["prevent"]),["up"]),e.withKeys(e.withModifiers(D,["prevent"]),["down"])],onBlur:J,onFocus:G,onInput:W,onChange:R},null,8,["id","step","model-value","placeholder","readonly","disabled","size","max","min","name","aria-label","onKeydown"])],42,["onDragstart"]))}});var ie=Z.default(le,[["__file","input-number.vue"]]);exports.default=ie;
