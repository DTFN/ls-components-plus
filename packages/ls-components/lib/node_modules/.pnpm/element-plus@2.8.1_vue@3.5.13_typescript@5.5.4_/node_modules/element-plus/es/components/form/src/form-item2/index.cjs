"use strict";var le=Object.defineProperty;var u=(g,b)=>le(g,"name",{value:b,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),ne=require("../../../../../../../../async-validator@4.2.5/node_modules/async-validator/dist-web/index/index.cjs"),se=require("../form-item/index.cjs"),ie=require("../form-label-wrap/index.cjs"),F=require("../constants/index.cjs"),ue=require("../../../../_virtual/plugin-vue_export-helper/index.cjs"),ae=require("../hooks/use-form-common-props/index.cjs"),de=require("../../../../hooks/use-namespace/index/index.cjs"),ce=require("../../../../hooks/use-id/index/index.cjs"),k=require("../../../../utils/dom/style/index.cjs"),fe=require("../../../../utils/types/index.cjs"),B=require("../../../../../../../../@vue_shared@3.5.13/node_modules/@vue/shared/dist/shared.esm-bundler/index.cjs"),z=require("../../../../utils/objects/index.cjs"),ve=require("../../../../../../../../@vueuse_shared@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/shared/index/index.cjs"),E=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/castArray/index.cjs"),A=require("../../../../../../../../lodash-es@4.17.21/node_modules/lodash-es/clone/index.cjs"),me=e.defineComponent({name:"ElFormItem"}),pe=e.defineComponent({...me,props:se.formItemProps,setup(g,{expose:b}){const o=g,P=e.useSlots(),r=e.inject(F.formContextKey,void 0),D=e.inject(F.formItemContextKey,void 0),y=ae.useFormSize(void 0,{formItem:!1}),i=de.useNamespace("form-item"),q=ce.useId().value,d=e.ref([]),c=e.ref(""),L=ve.debouncedRef(c,100),f=e.ref(""),$=e.ref();let R,p=!1;const h=e.computed(()=>o.labelPosition||(r==null?void 0:r.labelPosition)),M=e.computed(()=>{if(h.value==="top")return{};const t=k.addUnit(o.labelWidth||(r==null?void 0:r.labelWidth)||"");return t?{width:t}:{}}),T=e.computed(()=>{if(h.value==="top"||r!=null&&r.inline)return{};if(!o.label&&!o.labelWidth&&H)return{};const t=k.addUnit(o.labelWidth||(r==null?void 0:r.labelWidth)||"");return!o.label&&!P.label?{marginLeft:t}:{}}),K=e.computed(()=>[i.b(),i.m(y.value),i.is("error",c.value==="error"),i.is("validating",c.value==="validating"),i.is("success",c.value==="success"),i.is("required",X.value||o.required),i.is("no-asterisk",r==null?void 0:r.hideRequiredAsterisk),(r==null?void 0:r.requireAsteriskPosition)==="right"?"asterisk-right":"asterisk-left",{[i.m("feedback")]:r==null?void 0:r.statusIcon,[i.m(`label-${h.value}`)]:h.value}]),U=e.computed(()=>fe.isBoolean(o.inlineMessage)?o.inlineMessage:(r==null?void 0:r.inlineMessage)||!1),G=e.computed(()=>[i.e("error"),{[i.em("error","inline")]:U.value}]),O=e.computed(()=>o.prop?B.isString(o.prop)?o.prop:o.prop.join("."):""),S=e.computed(()=>!!(o.label||P.label)),_=e.computed(()=>o.for||(d.value.length===1?d.value[0]:void 0)),C=e.computed(()=>!_.value&&S.value),H=!!D,I=e.computed(()=>{const t=r==null?void 0:r.model;if(!(!t||!o.prop))return z.getProp(t,o.prop).value}),V=e.computed(()=>{const{required:t}=o,l=[];o.rules&&l.push(...E.default(o.rules));const s=r==null?void 0:r.rules;if(s&&o.prop){const n=z.getProp(s,o.prop).value;n&&l.push(...E.default(n))}if(t!==void 0){const n=l.map((a,m)=>[a,m]).filter(([a])=>Object.keys(a).includes("required"));if(n.length>0)for(const[a,m]of n)a.required!==t&&(l[m]={...a,required:t});else l.push({required:t})}return l}),J=e.computed(()=>V.value.length>0),Q=u(t=>V.value.filter(s=>!s.trigger||!t?!0:Array.isArray(s.trigger)?s.trigger.includes(t):s.trigger===t).map(({trigger:s,...n})=>n),"getFilteredRule"),X=e.computed(()=>V.value.some(t=>t.required)),Y=e.computed(()=>{var t;return L.value==="error"&&o.showMessage&&((t=r==null?void 0:r.showMessage)!=null?t:!0)}),N=e.computed(()=>`${o.label||""}${(r==null?void 0:r.labelSuffix)||""}`),v=u(t=>{c.value=t},"setValidationState"),Z=u(t=>{var l,s;const{errors:n,fields:a}=t;(!n||!a)&&console.error(t),v("error"),f.value=n?(s=(l=n==null?void 0:n[0])==null?void 0:l.message)!=null?s:`${o.prop} is required`:"",r==null||r.emit("validate",o.prop,!1,f.value)},"onValidationFailed"),ee=u(()=>{v("success"),r==null||r.emit("validate",o.prop,!0,"")},"onValidationSucceeded"),te=u(async t=>{const l=O.value;return new ne.default({[l]:t}).validate({[l]:I.value},{firstFields:!0}).then(()=>(ee(),!0)).catch(n=>(Z(n),Promise.reject(n)))},"doValidate"),W=u(async(t,l)=>{if(p||!o.prop)return!1;const s=B.isFunction(l);if(!J.value)return l==null||l(!1),!1;const n=Q(t);return n.length===0?(l==null||l(!0),!0):(v("validating"),te(n).then(()=>(l==null||l(!0),!0)).catch(a=>{const{fields:m}=a;return l==null||l(!1,m),s?!1:Promise.reject(m)}))},"validate"),x=u(()=>{v(""),f.value="",p=!1},"clearValidate"),j=u(async()=>{const t=r==null?void 0:r.model;if(!t||!o.prop)return;const l=z.getProp(t,o.prop);p=!0,l.value=A.default(R),await e.nextTick(),x(),p=!1},"resetField"),re=u(t=>{d.value.includes(t)||d.value.push(t)},"addInputId"),oe=u(t=>{d.value=d.value.filter(l=>l!==t)},"removeInputId");e.watch(()=>o.error,t=>{f.value=t||"",v(t?"error":"")},{immediate:!0}),e.watch(()=>o.validateStatus,t=>v(t||""));const w=e.reactive({...e.toRefs(o),$el:$,size:y,validateState:c,labelId:q,inputIds:d,isGroup:C,hasLabel:S,fieldValue:I,addInputId:re,removeInputId:oe,resetField:j,clearValidate:x,validate:W});return e.provide(F.formItemContextKey,w),e.onMounted(()=>{o.prop&&(r==null||r.addField(w),R=A.default(I.value))}),e.onBeforeUnmount(()=>{r==null||r.removeField(w)}),b({size:y,validateMessage:f,validateState:c,validate:W,clearValidate:x,resetField:j}),(t,l)=>{var s;return e.openBlock(),e.createElementBlock("div",{ref_key:"formItemRef",ref:$,class:e.normalizeClass(e.unref(K)),role:e.unref(C)?"group":void 0,"aria-labelledby":e.unref(C)?e.unref(q):void 0},[e.createVNode(e.unref(ie.default),{"is-auto-width":e.unref(M).width==="auto","update-all":((s=e.unref(r))==null?void 0:s.labelWidth)==="auto"},{default:e.withCtx(()=>[e.unref(S)?(e.openBlock(),e.createBlock(e.resolveDynamicComponent(e.unref(_)?"label":"div"),{key:0,id:e.unref(q),for:e.unref(_),class:e.normalizeClass(e.unref(i).e("label")),style:e.normalizeStyle(e.unref(M))},{default:e.withCtx(()=>[e.renderSlot(t.$slots,"label",{label:e.unref(N)},()=>[e.createTextVNode(e.toDisplayString(e.unref(N)),1)])]),_:3},8,["id","for","class","style"])):e.createCommentVNode("v-if",!0)]),_:3},8,["is-auto-width","update-all"]),e.createElementVNode("div",{class:e.normalizeClass(e.unref(i).e("content")),style:e.normalizeStyle(e.unref(T))},[e.renderSlot(t.$slots,"default"),e.createVNode(e.TransitionGroup,{name:`${e.unref(i).namespace.value}-zoom-in-top`},{default:e.withCtx(()=>[e.unref(Y)?e.renderSlot(t.$slots,"error",{key:0,error:f.value},()=>[e.createElementVNode("div",{class:e.normalizeClass(e.unref(G))},e.toDisplayString(f.value),3)]):e.createCommentVNode("v-if",!0)]),_:3},8,["name"])],6)],10,["role","aria-labelledby"])}}});var he=ue.default(pe,[["__file","form-item.vue"]]);exports.default=he;
