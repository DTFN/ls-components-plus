"use strict";var G=Object.defineProperty;var n=(i,o)=>G(i,"name",{value:o,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),x=require("../../../../../../../../../@vueuse_core@9.13.0_vue@3.5.13_typescript@5.5.4_/node_modules/@vueuse/core/index/index.cjs"),I=require("../../../../form/src/hooks/use-form-common-props/index.cjs");function J(i,o,u,l){const C=r.ref(!1),B=r.ref(null),p=r.ref(!1),_=n(e=>{p.value=e},"setDragVisible"),d=r.ref({width:null,height:null,headerHeight:null}),z=r.ref(!1),F={display:"inline-block",verticalAlign:"middle"},w=r.ref(),L=r.ref(0),y=r.ref(0),g=r.ref(0),v=r.ref(0),R=r.ref(0);r.watchEffect(()=>{o.setHeight(i.height)}),r.watchEffect(()=>{o.setMaxHeight(i.maxHeight)}),r.watch(()=>[i.currentRowKey,u.states.rowKey],([e,t])=>{!r.unref(t)||!r.unref(e)||u.setCurrentRowKey(`${e}`)},{immediate:!0}),r.watch(()=>i.data,e=>{l.store.commit("setData",e)},{immediate:!0,deep:!0}),r.watchEffect(()=>{i.expandRowKeys&&u.setExpandRowKeysAdapter(i.expandRowKeys)});const V=n(()=>{l.store.commit("setHoverRow",null),l.hoverState&&(l.hoverState=null)},"handleMouseLeave"),Y=n((e,t)=>{const{pixelX:s,pixelY:a}=t;Math.abs(s)>=Math.abs(a)&&(l.refs.bodyWrapper.scrollLeft+=t.pixelX/5)},"handleHeaderFooterMousewheel"),N=r.computed(()=>i.height||i.maxHeight||u.states.fixedColumns.value.length>0||u.states.rightFixedColumns.value.length>0),q=r.computed(()=>({width:o.bodyWidth.value?`${o.bodyWidth.value}px`:""})),W=n(()=>{N.value&&o.updateElsHeight(),o.updateColumnsWidth(),requestAnimationFrame(E)},"doLayout");r.onMounted(async()=>{await r.nextTick(),u.updateColumns(),P(),requestAnimationFrame(W);const e=l.vnode.el,t=l.refs.headerWrapper;i.flexible&&e&&e.parentElement&&(e.parentElement.style.minWidth="0"),d.value={width:w.value=e.offsetWidth,height:e.offsetHeight,headerHeight:i.showHeader&&t?t.offsetHeight:null},u.states.columns.value.forEach(s=>{s.filteredValue&&s.filteredValue.length&&l.store.commit("filterChange",{column:s,values:s.filteredValue,silent:!0})}),l.$ready=!0});const A=n((e,t)=>{if(!e)return;const s=Array.from(e.classList).filter(a=>!a.startsWith("is-scrolling-"));s.push(o.scrollX.value?t:"is-scrolling-none"),e.className=s.join(" ")},"setScrollClassByEl"),m=n(e=>{const{tableWrapper:t}=l.refs;A(t,e)},"setScrollClass"),K=n(e=>{const{tableWrapper:t}=l.refs;return!!(t&&t.classList.contains(e))},"hasScrollClass"),E=n(function(){if(!l.refs.scrollBarRef)return;if(!o.scrollX.value){const H="is-scrolling-none";K(H)||m(H);return}const e=l.refs.scrollBarRef.wrapRef;if(!e)return;const{scrollLeft:t,offsetWidth:s,scrollWidth:a}=e,{headerWrapper:c,footerWrapper:h}=l.refs;c&&(c.scrollLeft=t),h&&(h.scrollLeft=t);const b=a-s-1;t>=b?m("is-scrolling-right"):m(t===0?"is-scrolling-left":"is-scrolling-middle")},"syncPosition"),P=n(()=>{l.refs.scrollBarRef&&(l.refs.scrollBarRef.wrapRef&&x.useEventListener(l.refs.scrollBarRef.wrapRef,"scroll",E,{passive:!0}),i.fit?x.useResizeObserver(l.vnode.el,S):x.useEventListener(window,"resize",S),x.useResizeObserver(l.refs.bodyWrapper,()=>{var e,t;S(),(t=(e=l.refs)==null?void 0:e.scrollBarRef)==null||t.update()}))},"bindEvents"),S=n(()=>{var e,t,s,a;const c=l.vnode.el;if(!l.$ready||!c)return;let h=!1;const{width:b,height:H,headerHeight:U}=d.value,M=w.value=c.offsetWidth;b!==M&&(h=!0);const $=c.offsetHeight;(i.height||N.value)&&H!==$&&(h=!0);const f=i.tableLayout==="fixed"?l.refs.headerWrapper:(e=l.refs.tableHeaderRef)==null?void 0:e.$el;i.showHeader&&(f==null?void 0:f.offsetHeight)!==U&&(h=!0),L.value=((t=l.refs.tableWrapper)==null?void 0:t.scrollHeight)||0,g.value=(f==null?void 0:f.scrollHeight)||0,v.value=((s=l.refs.footerWrapper)==null?void 0:s.offsetHeight)||0,R.value=((a=l.refs.appendWrapper)==null?void 0:a.offsetHeight)||0,y.value=L.value-g.value-v.value-R.value,h&&(d.value={width:M,height:$,headerHeight:i.showHeader&&(f==null?void 0:f.offsetHeight)||0},W())},"resizeListener"),T=I.useFormSize(),X=r.computed(()=>{const{bodyWidth:e,scrollY:t,gutterWidth:s}=o;return e.value?`${e.value-(t.value?s:0)}px`:""}),D=r.computed(()=>i.maxHeight?"fixed":i.tableLayout),k=r.computed(()=>{if(i.data&&i.data.length)return null;let e="100%";i.height&&y.value&&(e=`${y.value}px`);const t=w.value;return{width:t?`${t}px`:"",height:e}}),O=r.computed(()=>i.height?{height:Number.isNaN(Number(i.height))?i.height:`${i.height}px`}:i.maxHeight?{maxHeight:Number.isNaN(Number(i.maxHeight))?i.maxHeight:`${i.maxHeight}px`}:{}),j=r.computed(()=>i.height?{height:"100%"}:i.maxHeight?Number.isNaN(Number(i.maxHeight))?{maxHeight:`calc(${i.maxHeight} - ${g.value+v.value}px)`}:{maxHeight:`${i.maxHeight-g.value-v.value}px`}:{});return{isHidden:C,renderExpanded:B,setDragVisible:_,isGroup:z,handleMouseLeave:V,handleHeaderFooterMousewheel:Y,tableSize:T,emptyBlockStyle:k,handleFixedMousewheel:n((e,t)=>{const s=l.refs.bodyWrapper;if(Math.abs(t.spinY)>0){const a=s.scrollTop;t.pixelY<0&&a!==0&&e.preventDefault(),t.pixelY>0&&s.scrollHeight-s.clientHeight>a&&e.preventDefault(),s.scrollTop+=Math.ceil(t.pixelY/5)}else s.scrollLeft+=Math.ceil(t.pixelX/5)},"handleFixedMousewheel"),resizeProxyVisible:p,bodyWidth:X,resizeState:d,doLayout:W,tableBodyStyles:q,tableLayout:D,scrollbarViewStyle:F,tableInnerStyle:O,scrollbarStyle:j}}n(J,"useStyle");exports.default=J;
