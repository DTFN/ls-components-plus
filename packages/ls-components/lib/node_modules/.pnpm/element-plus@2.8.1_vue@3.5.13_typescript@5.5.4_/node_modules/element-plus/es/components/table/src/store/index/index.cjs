"use strict";var C=Object.defineProperty;var f=(e,r)=>C(e,"name",{value:r,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("vue"),m=require("../watcher/index.cjs"),S=require("../../../../../hooks/use-namespace/index/index.cjs");function p(e,r){return e.map(s=>{var d;return s.id===r.id?r:((d=s.children)!=null&&d.length&&(s.children=p(s.children,r)),s)})}f(p,"replaceColumn");function h(e){e.forEach(r=>{var s,d;r.no=(s=r.getColumnIndex)==null?void 0:s.call(r),(d=r.children)!=null&&d.length&&h(r.children)}),e.sort((r,s)=>r.no-s.no)}f(h,"sortColumn");function y(){const e=a.getCurrentInstance(),r=m.default();return{ns:S.useNamespace("table"),...r,mutations:{setData(o,t){const n=a.unref(o._data)!==t;o.data.value=t,o._data.value=t,e.store.execQuery(),e.store.updateCurrentRowData(),e.store.updateExpandRows(),e.store.updateTreeData(e.store.states.defaultExpandAll.value),a.unref(o.reserveSelection)?(e.store.assertRowKey(),e.store.updateSelectionByRowKey()):n?e.store.clearSelection():e.store.cleanSelection(),e.store.updateAllSelected(),e.$ready&&e.store.scheduleLayout()},insertColumn(o,t,n,c){const u=a.unref(o._columns);let l=[];n?(n&&!n.children&&(n.children=[]),n.children.push(t),l=p(u,n)):(u.push(t),l=u),h(l),o._columns.value=l,o.updateOrderFns.push(c),t.type==="selection"&&(o.selectable.value=t.selectable,o.reserveSelection.value=t.reserveSelection),e.$ready&&(e.store.updateColumns(),e.store.scheduleLayout())},updateColumnOrder(o,t){var n;((n=t.getColumnIndex)==null?void 0:n.call(t))!==t.no&&(h(o._columns.value),e.$ready&&e.store.updateColumns())},removeColumn(o,t,n,c){const u=a.unref(o._columns)||[];if(n)n.children.splice(n.children.findIndex(i=>i.id===t.id),1),a.nextTick(()=>{var i;((i=n.children)==null?void 0:i.length)===0&&delete n.children}),o._columns.value=p(u,n);else{const i=u.indexOf(t);i>-1&&(u.splice(i,1),o._columns.value=u)}const l=o.updateOrderFns.indexOf(c);l>-1&&o.updateOrderFns.splice(l,1),e.$ready&&(e.store.updateColumns(),e.store.scheduleLayout())},sort(o,t){const{prop:n,order:c,init:u}=t;if(n){const l=a.unref(o.columns).find(i=>i.property===n);l&&(l.order=c,e.store.updateSort(l,n,c),e.store.commit("changeSortCondition",{init:u}))}},changeSortCondition(o,t){const{sortingColumn:n,sortProp:c,sortOrder:u}=o,l=a.unref(n),i=a.unref(c),v=a.unref(u);v===null&&(o.sortingColumn.value=null,o.sortProp.value=null);const g={filter:!0};e.store.execQuery(g),(!t||!(t.silent||t.init))&&e.emit("sort-change",{column:l,prop:i,order:v}),e.store.updateTableScrollY()},filterChange(o,t){const{column:n,values:c,silent:u}=t,l=e.store.updateFilters(n,c);e.store.execQuery(),u||e.emit("filter-change",l),e.store.updateTableScrollY()},toggleAllSelection(){e.store.toggleAllSelection()},rowSelectedChanged(o,t){e.store.toggleRowSelection(t),e.store.updateAllSelected()},setHoverRow(o,t){o.hoverRow.value=t},setCurrentRow(o,t){e.store.updateCurrentRow(t)}},commit:f(function(o,...t){const n=e.store.mutations;if(n[o])n[o].apply(e,[e.store.states].concat(t));else throw new Error(`Action not found: ${o}`)},"commit"),updateTableScrollY:f(function(){a.nextTick(()=>e.layout.updateScrollY.apply(e.layout))},"updateTableScrollY")}}f(y,"useStore");exports.default=y;
