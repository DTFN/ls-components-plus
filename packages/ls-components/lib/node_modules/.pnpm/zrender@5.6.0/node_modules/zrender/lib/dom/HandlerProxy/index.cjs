"use strict";var z=Object.defineProperty;var i=(t,o)=>z(t,"name",{value:o,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const H=require("../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),u=require("../../core/event/index.cjs"),s=require("../../core/util/index.cjs"),v=require("../../core/Eventful/index.cjs"),m=require("../../core/env/index.cjs");var C=300,h=m.default.domSupported,p=function(){var t=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],o=["touchstart","touchend","touchmove"],e={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},r=s.map(t,function(n){var a=n.replace("mouse","pointer");return e.hasOwnProperty(a)?a:n});return{mouse:t,touch:o,pointer:r}}(),T={mouse:["mousemove","mouseup"],pointer:["pointermove","pointerup"]},E=!1;function g(t){var o=t.pointerType;return o==="pen"||o==="touch"}i(g,"isPointerFromTouch");function S(t){t.touching=!0,t.touchTimer!=null&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout(function(){t.touching=!1,t.touchTimer=null},700)}i(S,"setTouchTimer");function d(t){t&&(t.zrByTouch=!0)}i(d,"markTouch");function b(t,o){return u.normalizeEvent(t.dom,new O(t,o),!0)}i(b,"normalizeGlobalEvent");function y(t,o){for(var e=o,r=!1;e&&e.nodeType!==9&&!(r=e.domBelongToZr||e!==o&&e===t.painterRoot);)e=e.parentNode;return r}i(y,"isLocalEl");var O=function(){function t(o,e){this.stopPropagation=s.noop,this.stopImmediatePropagation=s.noop,this.preventDefault=s.noop,this.type=e.type,this.target=this.currentTarget=o.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY}return i(t,"FakeGlobalEvent"),t}(),l={mousedown:i(function(t){t=u.normalizeEvent(this.dom,t),this.__mayPointerCapture=[t.zrX,t.zrY],this.trigger("mousedown",t)},"mousedown"),mousemove:i(function(t){t=u.normalizeEvent(this.dom,t);var o=this.__mayPointerCapture;o&&(t.zrX!==o[0]||t.zrY!==o[1])&&this.__togglePointerCapture(!0),this.trigger("mousemove",t)},"mousemove"),mouseup:i(function(t){t=u.normalizeEvent(this.dom,t),this.__togglePointerCapture(!1),this.trigger("mouseup",t)},"mouseup"),mouseout:i(function(t){t=u.normalizeEvent(this.dom,t);var o=t.toElement||t.relatedTarget;y(this,o)||(this.__pointerCapturing&&(t.zrEventControl="no_globalout"),this.trigger("mouseout",t))},"mouseout"),wheel:i(function(t){E=!0,t=u.normalizeEvent(this.dom,t),this.trigger("mousewheel",t)},"wheel"),mousewheel:i(function(t){E||(t=u.normalizeEvent(this.dom,t),this.trigger("mousewheel",t))},"mousewheel"),touchstart:i(function(t){t=u.normalizeEvent(this.dom,t),d(t),this.__lastTouchMoment=new Date,this.handler.processGesture(t,"start"),l.mousemove.call(this,t),l.mousedown.call(this,t)},"touchstart"),touchmove:i(function(t){t=u.normalizeEvent(this.dom,t),d(t),this.handler.processGesture(t,"change"),l.mousemove.call(this,t)},"touchmove"),touchend:i(function(t){t=u.normalizeEvent(this.dom,t),d(t),this.handler.processGesture(t,"end"),l.mouseup.call(this,t),+new Date-+this.__lastTouchMoment<C&&l.click.call(this,t)},"touchend"),pointerdown:i(function(t){l.mousedown.call(this,t)},"pointerdown"),pointermove:i(function(t){g(t)||l.mousemove.call(this,t)},"pointermove"),pointerup:i(function(t){l.mouseup.call(this,t)},"pointerup"),pointerout:i(function(t){g(t)||l.mouseout.call(this,t)},"pointerout")};s.each(["click","dblclick","contextmenu"],function(t){l[t]=function(o){o=u.normalizeEvent(this.dom,o),this.trigger(t,o)}});var _={pointermove:i(function(t){g(t)||_.mousemove.call(this,t)},"pointermove"),pointerup:i(function(t){_.mouseup.call(this,t)},"pointerup"),mousemove:i(function(t){this.trigger("mousemove",t)},"mousemove"),mouseup:i(function(t){var o=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",t),o&&(t.zrEventControl="only_globalout",this.trigger("mouseout",t))},"mouseup")};function D(t,o){var e=o.domHandlers;m.default.pointerEventsSupported?s.each(p.pointer,function(r){c(o,r,function(n){e[r].call(t,n)})}):(m.default.touchEventsSupported&&s.each(p.touch,function(r){c(o,r,function(n){e[r].call(t,n),S(o)})}),s.each(p.mouse,function(r){c(o,r,function(n){n=u.getNativeEvent(n),o.touching||e[r].call(t,n)})}))}i(D,"mountLocalDOMEventListeners");function L(t,o){m.default.pointerEventsSupported?s.each(T.pointer,e):m.default.touchEventsSupported||s.each(T.mouse,e);function e(r){function n(a){a=u.getNativeEvent(a),y(t,a.target)||(a=b(t,a),o.domHandlers[r].call(t,a))}i(n,"nativeEventListener"),c(o,r,n,{capture:!0})}i(e,"mount")}i(L,"mountGlobalDOMEventListeners");function c(t,o,e,r){t.mounted[o]=e,t.listenerOpts[o]=r,u.addEventListener(t.domTarget,o,e,r)}i(c,"mountSingleDOMEventListener");function f(t){var o=t.mounted;for(var e in o)o.hasOwnProperty(e)&&u.removeEventListener(t.domTarget,e,o[e],t.listenerOpts[e]);t.mounted={}}i(f,"unmountDOMEventListeners");var w=function(){function t(o,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=o,this.domHandlers=e}return i(t,"DOMHandlerScope"),t}(),P=function(t){H.__extends(o,t);function o(e,r){var n=t.call(this)||this;return n.__pointerCapturing=!1,n.dom=e,n.painterRoot=r,n._localHandlerScope=new w(e,l),h&&(n._globalHandlerScope=new w(document,_)),D(n,n._localHandlerScope),n}return i(o,"HandlerDomProxy"),o.prototype.dispose=function(){f(this._localHandlerScope),h&&f(this._globalHandlerScope)},o.prototype.setCursor=function(e){this.dom.style&&(this.dom.style.cursor=e||"default")},o.prototype.__togglePointerCapture=function(e){if(this.__mayPointerCapture=null,h&&+this.__pointerCapturing^+e){this.__pointerCapturing=e;var r=this._globalHandlerScope;e?L(this,r):f(r)}},o}(v.default);exports.default=P;
