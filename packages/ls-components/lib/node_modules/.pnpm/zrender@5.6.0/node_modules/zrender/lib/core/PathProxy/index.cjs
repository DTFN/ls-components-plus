"use strict";var mt=Object.defineProperty;var et=(v,t)=>mt(v,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const ct=require("../vector/index.cjs"),Lt=require("../BoundingRect/index.cjs"),dt=require("../../config/index.cjs"),$=require("../bbox/index.cjs"),G=require("../curve/index.cjs");var h={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},X=[],Z=[],M=[],x=[],S=[],C=[],st=Math.min,vt=Math.max,V=Math.cos,Y=Math.sin,k=Math.abs,ft=Math.PI,w=ft*2,ot=typeof Float32Array<"u",tt=[];function ht(v){var t=Math.round(v/ft*1e8)/1e8;return t%2*ft}et(ht,"modPI2");function lt(v,t){var r=ht(v[0]);r<0&&(r+=w);var a=r-v[0],i=v[1];i+=a,!t&&i-r>=w?i=r+w:t&&r-i>=w?i=r-w:!t&&r>i?i=r+(w-ht(r-i)):t&&r<i&&(i=r-(w-ht(i-r))),v[0]=r,v[1]=i}et(lt,"normalizeArcAngles");var Dt=function(){function v(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}return et(v,"PathProxy"),v.prototype.increaseVersion=function(){this._version++},v.prototype.getVersion=function(){return this._version},v.prototype.setScale=function(t,r,a){a=a||0,a>0&&(this._ux=k(a/dt.devicePixelRatio/t)||0,this._uy=k(a/dt.devicePixelRatio/r)||0)},v.prototype.setDPR=function(t){this.dpr=t},v.prototype.setContext=function(t){this._ctx=t},v.prototype.getContext=function(){return this._ctx},v.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},v.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},v.prototype.moveTo=function(t,r){return this._drawPendingPt(),this.addData(h.M,t,r),this._ctx&&this._ctx.moveTo(t,r),this._x0=t,this._y0=r,this._xi=t,this._yi=r,this},v.prototype.lineTo=function(t,r){var a=k(t-this._xi),i=k(r-this._yi),n=a>this._ux||i>this._uy;if(this.addData(h.L,t,r),this._ctx&&n&&this._ctx.lineTo(t,r),n)this._xi=t,this._yi=r,this._pendingPtDist=0;else{var e=a*a+i*i;e>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=r,this._pendingPtDist=e)}return this},v.prototype.bezierCurveTo=function(t,r,a,i,n,e){return this._drawPendingPt(),this.addData(h.C,t,r,a,i,n,e),this._ctx&&this._ctx.bezierCurveTo(t,r,a,i,n,e),this._xi=n,this._yi=e,this},v.prototype.quadraticCurveTo=function(t,r,a,i){return this._drawPendingPt(),this.addData(h.Q,t,r,a,i),this._ctx&&this._ctx.quadraticCurveTo(t,r,a,i),this._xi=a,this._yi=i,this},v.prototype.arc=function(t,r,a,i,n,e){this._drawPendingPt(),tt[0]=i,tt[1]=n,lt(tt,e),i=tt[0],n=tt[1];var c=n-i;return this.addData(h.A,t,r,a,a,i,c,0,e?0:1),this._ctx&&this._ctx.arc(t,r,a,i,n,e),this._xi=V(n)*a+t,this._yi=Y(n)*a+r,this},v.prototype.arcTo=function(t,r,a,i,n){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(t,r,a,i,n),this},v.prototype.rect=function(t,r,a,i){return this._drawPendingPt(),this._ctx&&this._ctx.rect(t,r,a,i),this.addData(h.R,t,r,a,i),this},v.prototype.closePath=function(){this._drawPendingPt(),this.addData(h.Z);var t=this._ctx,r=this._x0,a=this._y0;return t&&t.closePath(),this._xi=r,this._yi=a,this},v.prototype.fill=function(t){t&&t.fill(),this.toStatic()},v.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},v.prototype.len=function(){return this._len},v.prototype.setData=function(t){var r=t.length;!(this.data&&this.data.length===r)&&ot&&(this.data=new Float32Array(r));for(var a=0;a<r;a++)this.data[a]=t[a];this._len=r},v.prototype.appendPath=function(t){t instanceof Array||(t=[t]);for(var r=t.length,a=0,i=this._len,n=0;n<r;n++)a+=t[n].len();ot&&this.data instanceof Float32Array&&(this.data=new Float32Array(i+a));for(var n=0;n<r;n++)for(var e=t[n].data,c=0;c<e.length;c++)this.data[i++]=e[c];this._len=i},v.prototype.addData=function(t,r,a,i,n,e,c,b,d){if(this._saveData){var u=this.data;this._len+arguments.length>u.length&&(this._expandData(),u=this.data);for(var p=0;p<arguments.length;p++)u[this._len++]=arguments[p]}},v.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},v.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],r=0;r<this._len;r++)t[r]=this.data[r];this.data=t}},v.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,ot&&this._len>11&&(this.data=new Float32Array(t)))}},v.prototype.getBoundingRect=function(){M[0]=M[1]=S[0]=S[1]=Number.MAX_VALUE,x[0]=x[1]=C[0]=C[1]=-Number.MAX_VALUE;var t=this.data,r=0,a=0,i=0,n=0,e;for(e=0;e<this._len;){var c=t[e++],b=e===1;switch(b&&(r=t[e],a=t[e+1],i=r,n=a),c){case h.M:r=i=t[e++],a=n=t[e++],S[0]=i,S[1]=n,C[0]=i,C[1]=n;break;case h.L:$.fromLine(r,a,t[e],t[e+1],S,C),r=t[e++],a=t[e++];break;case h.C:$.fromCubic(r,a,t[e++],t[e++],t[e++],t[e++],t[e],t[e+1],S,C),r=t[e++],a=t[e++];break;case h.Q:$.fromQuadratic(r,a,t[e++],t[e++],t[e],t[e+1],S,C),r=t[e++],a=t[e++];break;case h.A:var d=t[e++],u=t[e++],p=t[e++],s=t[e++],m=t[e++],L=t[e++]+m;e+=1;var D=!t[e++];b&&(i=V(m)*p+d,n=Y(m)*s+u),$.fromArc(d,u,p,s,m,L,D,S,C),r=V(L)*p+d,a=Y(L)*s+u;break;case h.R:i=r=t[e++],n=a=t[e++];var f=t[e++],y=t[e++];$.fromLine(i,n,i+f,n+y,S,C);break;case h.Z:r=i,a=n;break}ct.min(M,M,S),ct.max(x,x,C)}return e===0&&(M[0]=M[1]=x[0]=x[1]=0),new Lt.default(M[0],M[1],x[0]-M[0],x[1]-M[1])},v.prototype._calculateLength=function(){var t=this.data,r=this._len,a=this._ux,i=this._uy,n=0,e=0,c=0,b=0;this._pathSegLen||(this._pathSegLen=[]);for(var d=this._pathSegLen,u=0,p=0,s=0;s<r;){var m=t[s++],L=s===1;L&&(n=t[s],e=t[s+1],c=n,b=e);var D=-1;switch(m){case h.M:n=c=t[s++],e=b=t[s++];break;case h.L:{var f=t[s++],y=t[s++],l=f-n,T=y-e;(k(l)>a||k(T)>i||s===r-1)&&(D=Math.sqrt(l*l+T*T),n=f,e=y);break}case h.C:{var E=t[s++],O=t[s++],f=t[s++],y=t[s++],o=t[s++],H=t[s++];D=G.cubicLength(n,e,E,O,f,y,o,H,10),n=o,e=H;break}case h.Q:{var E=t[s++],O=t[s++],f=t[s++],y=t[s++];D=G.quadraticLength(n,e,E,O,f,y,10),n=f,e=y;break}case h.A:var I=t[s++],U=t[s++],z=t[s++],_=t[s++],P=t[s++],J=t[s++],q=J+P;s+=1,L&&(c=V(P)*z+I,b=Y(P)*_+U),D=vt(z,_)*st(w,Math.abs(J)),n=V(q)*z+I,e=Y(q)*_+U;break;case h.R:{c=n=t[s++],b=e=t[s++];var Q=t[s++],R=t[s++];D=Q*2+R*2;break}case h.Z:{var l=c-n,T=b-e;D=Math.sqrt(l*l+T*T),n=c,e=b;break}}D>=0&&(d[p++]=D,u+=D)}return this._pathLen=u,u},v.prototype.rebuildPath=function(t,r){var a=this.data,i=this._ux,n=this._uy,e=this._len,c,b,d,u,p,s,m=r<1,L,D,f=0,y=0,l,T=0,E,O;if(!(m&&(this._pathSegLen||this._calculateLength(),L=this._pathSegLen,D=this._pathLen,l=r*D,!l)))t:for(var o=0;o<e;){var H=a[o++],I=o===1;switch(I&&(d=a[o],u=a[o+1],c=d,b=u),H!==h.L&&T>0&&(t.lineTo(E,O),T=0),H){case h.M:c=d=a[o++],b=u=a[o++],t.moveTo(d,u);break;case h.L:{p=a[o++],s=a[o++];var U=k(p-d),z=k(s-u);if(U>i||z>n){if(m){var _=L[y++];if(f+_>l){var P=(l-f)/_;t.lineTo(d*(1-P)+p*P,u*(1-P)+s*P);break t}f+=_}t.lineTo(p,s),d=p,u=s,T=0}else{var J=U*U+z*z;J>T&&(E=p,O=s,T=J)}break}case h.C:{var q=a[o++],Q=a[o++],R=a[o++],A=a[o++],it=a[o++],nt=a[o++];if(m){var _=L[y++];if(f+_>l){var P=(l-f)/_;G.cubicSubdivide(d,q,R,it,P,X),G.cubicSubdivide(u,Q,A,nt,P,Z),t.bezierCurveTo(X[1],Z[1],X[2],Z[2],X[3],Z[3]);break t}f+=_}t.bezierCurveTo(q,Q,R,A,it,nt),d=it,u=nt;break}case h.Q:{var q=a[o++],Q=a[o++],R=a[o++],A=a[o++];if(m){var _=L[y++];if(f+_>l){var P=(l-f)/_;G.quadraticSubdivide(d,q,R,P,X),G.quadraticSubdivide(u,Q,A,P,Z),t.quadraticCurveTo(X[1],Z[1],X[2],Z[2]);break t}f+=_}t.quadraticCurveTo(q,Q,R,A),d=R,u=A;break}case h.A:var at=a[o++],rt=a[o++],F=a[o++],N=a[o++],j=a[o++],ut=a[o++],Pt=a[o++],_t=!a[o++],bt=F>N?F:N,yt=k(F-N)>.001,K=j+ut,pt=!1;if(m){var _=L[y++];f+_>l&&(K=j+ut*(l-f)/_,pt=!0),f+=_}if(yt&&t.ellipse?t.ellipse(at,rt,F,N,Pt,j,K,_t):t.arc(at,rt,bt,j,K,_t),pt)break t;I&&(c=V(j)*F+at,b=Y(j)*N+rt),d=V(K)*F+at,u=Y(K)*N+rt;break;case h.R:c=d=a[o],b=u=a[o+1],p=a[o++],s=a[o++];var B=a[o++],W=a[o++];if(m){var _=L[y++];if(f+_>l){var g=l-f;t.moveTo(p,s),t.lineTo(p+st(g,B),s),g-=B,g>0&&t.lineTo(p+B,s+st(g,W)),g-=W,g>0&&t.lineTo(p+vt(B-g,0),s+W),g-=B,g>0&&t.lineTo(p,s+vt(W-g,0));break t}f+=_}t.rect(p,s,B,W);break;case h.Z:if(m){var _=L[y++];if(f+_>l){var P=(l-f)/_;t.lineTo(d*(1-P)+c*P,u*(1-P)+b*P);break t}f+=_}t.closePath(),d=c,u=b}}},v.prototype.clone=function(){var t=new v,r=this.data;return t.data=r.slice?r.slice():Array.prototype.slice.call(r),t._len=this._len,t},v.CMD=h,v.initDefaultProps=function(){var t=v.prototype;t._saveData=!0,t._ux=0,t._uy=0,t._pendingPtDist=0,t._version=0}(),v}();exports.default=Dt;exports.normalizeArcAngles=lt;
