"use strict";var c=Object.defineProperty;var h=(a,r)=>c(a,"name",{value:r,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const p=require("../../graphic/Displayable/index.cjs"),x=require("../../core/PathProxy/index.cjs"),C=require("../../graphic/helper/image/index.cjs"),H=require("../helper/index.cjs"),q=require("../../graphic/Path/index.cjs"),rr=require("../../graphic/Image/index.cjs"),ar=require("../../graphic/TSpan/index.cjs"),ir=require("../../core/util/index.cjs"),V=require("../dashStyle/index.cjs"),Z=require("../../graphic/constants/index.cjs"),er=require("../../core/platform/index.cjs");var nr=new x.default(!0);function S(a){var r=a.stroke;return!(r==null||r==="none"||!(a.lineWidth>0))}h(S,"styleHasStroke");function Y(a){return typeof a=="string"&&a!=="none"}h(Y,"isValidStrokeFillStyle");function P(a){var r=a.fill;return r!=null&&r!=="none"}h(P,"styleHasFill");function y(a,r){if(r.fillOpacity!=null&&r.fillOpacity!==1){var i=a.globalAlpha;a.globalAlpha=r.fillOpacity*r.opacity,a.fill(),a.globalAlpha=i}else a.fill()}h(y,"doFillPath");function U(a,r){if(r.strokeOpacity!=null&&r.strokeOpacity!==1){var i=a.globalAlpha;a.globalAlpha=r.strokeOpacity*r.opacity,a.stroke(),a.globalAlpha=i}else a.stroke()}h(U,"doStrokePath");function R(a,r,i){var n=C.createOrUpdateImage(r.image,r.__image,i);if(C.isImageReady(n)){var f=a.createPattern(n,r.repeat||"repeat");if(typeof DOMMatrix=="function"&&f&&f.setTransform){var e=new DOMMatrix;e.translateSelf(r.x||0,r.y||0),e.rotateSelf(0,0,(r.rotation||0)*ir.RADIAN_TO_DEGREE),e.scaleSelf(r.scaleX||1,r.scaleY||1),f.setTransform(e)}return f}}h(R,"createCanvasPattern");function fr(a,r,i,n){var f,e=S(i),o=P(i),u=i.strokePercent,t=u<1,l=!r.path;(!r.silent||t)&&l&&r.createPathProxy();var s=r.path||nr,v=r.__dirty;if(!n){var g=i.fill,T=i.stroke,E=o&&!!g.colorStops,k=e&&!!T.colorStops,F=o&&!!g.image,L=e&&!!T.image,B=void 0,O=void 0,_=void 0,m=void 0,A=void 0;(E||k)&&(A=r.getBoundingRect()),E&&(B=v?H.getCanvasGradient(a,g,A):r.__canvasFillGradient,r.__canvasFillGradient=B),k&&(O=v?H.getCanvasGradient(a,T,A):r.__canvasStrokeGradient,r.__canvasStrokeGradient=O),F&&(_=v||!r.__canvasFillPattern?R(a,g,r):r.__canvasFillPattern,r.__canvasFillPattern=_),L&&(m=v||!r.__canvasStrokePattern?R(a,T,r):r.__canvasStrokePattern,r.__canvasStrokePattern=_),E?a.fillStyle=B:F&&(_?a.fillStyle=_:o=!1),k?a.strokeStyle=O:L&&(m?a.strokeStyle=m:e=!1)}var I=r.getGlobalScale();s.setScale(I[0],I[1],r.segmentIgnoreThreshold);var D,M;a.setLineDash&&i.lineDash&&(f=V.getLineDash(r),D=f[0],M=f[1]);var W=!0;(l||v&Z.SHAPE_CHANGED_BIT)&&(s.setDPR(a.dpr),t?s.setContext(null):(s.setContext(a),W=!1),s.reset(),r.buildPath(s,r.shape,n),s.toStatic(),r.pathUpdated()),W&&s.rebuildPath(a,t?u:1),D&&(a.setLineDash(D),a.lineDashOffset=M),n||(i.strokeFirst?(e&&U(a,i),o&&y(a,i)):(o&&y(a,i),e&&U(a,i))),D&&a.setLineDash([])}h(fr,"brushPath");function tr(a,r,i){var n=r.__image=C.createOrUpdateImage(i.image,r.__image,r,r.onload);if(!(!n||!C.isImageReady(n))){var f=i.x||0,e=i.y||0,o=r.getWidth(),u=r.getHeight(),t=n.width/n.height;if(o==null&&u!=null?o=u*t:u==null&&o!=null?u=o/t:o==null&&u==null&&(o=n.width,u=n.height),i.sWidth&&i.sHeight){var l=i.sx||0,s=i.sy||0;a.drawImage(n,l,s,i.sWidth,i.sHeight,f,e,o,u)}else if(i.sx&&i.sy){var l=i.sx,s=i.sy,v=o-l,g=u-s;a.drawImage(n,l,s,v,g,f,e,o,u)}else a.drawImage(n,f,e,o,u)}}h(tr,"brushImage");function or(a,r,i){var n,f=i.text;if(f!=null&&(f+=""),f){a.font=i.font||er.DEFAULT_FONT,a.textAlign=i.textAlign,a.textBaseline=i.textBaseline;var e=void 0,o=void 0;a.setLineDash&&i.lineDash&&(n=V.getLineDash(r),e=n[0],o=n[1]),e&&(a.setLineDash(e),a.lineDashOffset=o),i.strokeFirst?(S(i)&&a.strokeText(f,i.x,i.y),P(i)&&a.fillText(f,i.x,i.y)):(P(i)&&a.fillText(f,i.x,i.y),S(i)&&a.strokeText(f,i.x,i.y)),e&&a.setLineDash([])}}h(or,"brushText");var N=["shadowBlur","shadowOffsetX","shadowOffsetY"],X=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function z(a,r,i,n,f){var e=!1;if(!n&&(i=i||{},r===i))return!1;if(n||r.opacity!==i.opacity){d(a,f),e=!0;var o=Math.max(Math.min(r.opacity,1),0);a.globalAlpha=isNaN(o)?p.DEFAULT_COMMON_STYLE.opacity:o}(n||r.blend!==i.blend)&&(e||(d(a,f),e=!0),a.globalCompositeOperation=r.blend||p.DEFAULT_COMMON_STYLE.blend);for(var u=0;u<N.length;u++){var t=N[u];(n||r[t]!==i[t])&&(e||(d(a,f),e=!0),a[t]=a.dpr*(r[t]||0))}return(n||r.shadowColor!==i.shadowColor)&&(e||(d(a,f),e=!0),a.shadowColor=r.shadowColor||p.DEFAULT_COMMON_STYLE.shadowColor),e}h(z,"bindCommonProps");function G(a,r,i,n,f){var e=b(r,f.inHover),o=n?null:i&&b(i,f.inHover)||{};if(e===o)return!1;var u=z(a,e,o,n,f);if((n||e.fill!==o.fill)&&(u||(d(a,f),u=!0),Y(e.fill)&&(a.fillStyle=e.fill)),(n||e.stroke!==o.stroke)&&(u||(d(a,f),u=!0),Y(e.stroke)&&(a.strokeStyle=e.stroke)),(n||e.opacity!==o.opacity)&&(u||(d(a,f),u=!0),a.globalAlpha=e.opacity==null?1:e.opacity),r.hasStroke()){var t=e.lineWidth,l=t/(e.strokeNoScale&&r.getLineScale?r.getLineScale():1);a.lineWidth!==l&&(u||(d(a,f),u=!0),a.lineWidth=l)}for(var s=0;s<X.length;s++){var v=X[s],g=v[0];(n||e[g]!==o[g])&&(u||(d(a,f),u=!0),a[g]=e[g]||v[1])}return u}h(G,"bindPathAndTextCommonStyle");function ur(a,r,i,n,f){return z(a,b(r,f.inHover),i&&b(i,f.inHover),n,f)}h(ur,"bindImageStyle");function Q(a,r){var i=r.transform,n=a.dpr||1;i?a.setTransform(n*i[0],n*i[1],n*i[2],n*i[3],n*i[4],n*i[5]):a.setTransform(n,0,0,n,0,0)}h(Q,"setContextTransform");function sr(a,r,i){for(var n=!1,f=0;f<a.length;f++){var e=a[f];n=n||e.isZeroArea(),Q(r,e),r.beginPath(),e.buildPath(r,e.shape),r.clip()}i.allClipped=n}h(sr,"updateClipStatus");function hr(a,r){return a&&r?a[0]!==r[0]||a[1]!==r[1]||a[2]!==r[2]||a[3]!==r[3]||a[4]!==r[4]||a[5]!==r[5]:!(!a&&!r)}h(hr,"isTransformChanged");var $=1,j=2,J=3,K=4;function lr(a){var r=P(a),i=S(a);return!(a.lineDash||!(+r^+i)||r&&typeof a.fill!="string"||i&&typeof a.stroke!="string"||a.strokePercent<1||a.strokeOpacity<1||a.fillOpacity<1)}h(lr,"canPathBatch");function d(a,r){r.batchFill&&a.fill(),r.batchStroke&&a.stroke(),r.batchFill="",r.batchStroke=""}h(d,"flushPathDrawn");function b(a,r){return r&&a.__hoverStyle||a.style}h(b,"getStyle");function vr(a,r){w(a,r,{inHover:!1,viewWidth:0,viewHeight:0},!0)}h(vr,"brushSingle");function w(a,r,i,n){var f=r.transform;if(!r.shouldBePainted(i.viewWidth,i.viewHeight,!1,!1)){r.__dirty&=~Z.REDRAW_BIT,r.__isRendered=!1;return}var e=r.__clipPaths,o=i.prevElClipPaths,u=!1,t=!1;if((!o||H.isClipPathChanged(e,o))&&(o&&o.length&&(d(a,i),a.restore(),t=u=!0,i.prevElClipPaths=null,i.allClipped=!1,i.prevEl=null),e&&e.length&&(d(a,i),a.save(),sr(e,a,i),u=!0),i.prevElClipPaths=e),i.allClipped){r.__isRendered=!1;return}r.beforeBrush&&r.beforeBrush(),r.innerBeforeBrush();var l=i.prevEl;l||(t=u=!0);var s=r instanceof q.default&&r.autoBatch&&lr(r.style);u||hr(f,l.transform)?(d(a,i),Q(a,r)):s||d(a,i);var v=b(r,i.inHover);r instanceof q.default?(i.lastDrawType!==$&&(t=!0,i.lastDrawType=$),G(a,r,l,t,i),(!s||!i.batchFill&&!i.batchStroke)&&a.beginPath(),fr(a,r,v,s),s&&(i.batchFill=v.fill||"",i.batchStroke=v.stroke||"")):r instanceof ar.default?(i.lastDrawType!==J&&(t=!0,i.lastDrawType=J),G(a,r,l,t,i),or(a,r,v)):r instanceof rr.default?(i.lastDrawType!==j&&(t=!0,i.lastDrawType=j),ur(a,r,l,t,i),tr(a,r,v)):r.getTemporalDisplayables&&(i.lastDrawType!==K&&(t=!0,i.lastDrawType=K),dr(a,r,i)),s&&n&&d(a,i),r.innerAfterBrush(),r.afterBrush&&r.afterBrush(),i.prevEl=r,r.__dirty=0,r.__isRendered=!0}h(w,"brush");function dr(a,r,i){var n=r.getDisplayables(),f=r.getTemporalDisplayables();a.save();var e={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:i.viewWidth,viewHeight:i.viewHeight,inHover:i.inHover},o,u;for(o=r.getCursor(),u=n.length;o<u;o++){var t=n[o];t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush(),w(a,t,e,o===u-1),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),e.prevEl=t}for(var l=0,s=f.length;l<s;l++){var t=f[l];t.beforeBrush&&t.beforeBrush(),t.innerBeforeBrush(),w(a,t,e,l===s-1),t.innerAfterBrush(),t.afterBrush&&t.afterBrush(),e.prevEl=t}r.clearTemporalDisplayables(),r.notClear=!0,a.restore()}h(dr,"brushIncremental");exports.brush=w;exports.brushSingle=vr;exports.createCanvasPattern=R;
