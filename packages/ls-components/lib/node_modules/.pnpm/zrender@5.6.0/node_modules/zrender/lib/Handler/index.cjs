"use strict";var B=Object.defineProperty;var f=(s,e)=>B(s,"name",{value:e,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const m=require("../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),w=require("../core/util/index.cjs"),X=require("../core/vector/index.cjs"),Y=require("../mixin/Draggable/index.cjs"),T=require("../core/Eventful/index.cjs"),q=require("../core/event/index.cjs"),O=require("../core/GestureMgr/index.cjs"),E=require("../core/BoundingRect/index.cjs");var b="silent";function R(s,e,t){return{type:s,event:t,target:e.target,topTarget:e.topTarget,cancelBubble:!1,offsetX:t.zrX,offsetY:t.zrY,gestureEvent:t.gestureEvent,pinchX:t.pinchX,pinchY:t.pinchY,pinchScale:t.pinchScale,wheelDelta:t.zrDelta,zrByTouch:t.zrByTouch,which:t.which,stop:D}}f(R,"makeEventPacket");function D(){q.stop(this.event)}f(D,"stopEvent");var L=function(s){m.__extends(e,s);function e(){var t=s!==null&&s.apply(this,arguments)||this;return t.handler=null,t}return f(e,"EmptyProxy"),e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e}(T.default),p=function(){function s(e,t){this.x=e,this.y=t}return f(s,"HoveredResult"),s}(),S=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],_=new E.default(0,0,0,0),z=function(s){m.__extends(e,s);function e(t,r,a,n,i){var o=s.call(this)||this;return o._hovered=new p(0,0),o.storage=t,o.painter=r,o.painterRoot=n,o._pointerSize=i,a=a||new L,o.proxy=null,o.setHandlerProxy(a),o._draggingMgr=new Y.default(o),o}return f(e,"Handler"),e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(w.each(S,function(r){t.on&&t.on(r,this[r],this)},this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(t){var r=t.zrX,a=t.zrY,n=H(this,r,a),i=this._hovered,o=i.target;o&&!o.__zr&&(i=this.findHover(i.x,i.y),o=i.target);var u=this._hovered=n?new p(r,a):this.findHover(r,a),h=u.target,l=this.proxy;l.setCursor&&l.setCursor(h?h.cursor:"default"),o&&h!==o&&this.dispatchToElement(i,"mouseout",t),this.dispatchToElement(u,"mousemove",t),h&&h!==o&&this.dispatchToElement(u,"mouseover",t)},e.prototype.mouseout=function(t){var r=t.zrEventControl;r!=="only_globalout"&&this.dispatchToElement(this._hovered,"mouseout",t),r!=="no_globalout"&&this.trigger("globalout",{type:"globalout",event:t})},e.prototype.resize=function(){this._hovered=new p(0,0)},e.prototype.dispatch=function(t,r){var a=this[t];a&&a.call(this,r)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(t){var r=this.proxy;r.setCursor&&r.setCursor(t)},e.prototype.dispatchToElement=function(t,r,a){t=t||{};var n=t.target;if(!(n&&n.silent)){for(var i="on"+r,o=R(r,t,a);n&&(n[i]&&(o.cancelBubble=!!n[i].call(n,o)),n.trigger(r,o),n=n.__hostTarget?n.__hostTarget:n.parent,!o.cancelBubble););o.cancelBubble||(this.trigger(r,o),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer(function(u){typeof u[i]=="function"&&u[i].call(u,o),u.trigger&&u.trigger(r,o)}))}},e.prototype.findHover=function(t,r,a){var n=this.storage.getDisplayList(),i=new p(t,r);if(y(n,i,t,r,a),this._pointerSize&&!i.target){for(var o=[],u=this._pointerSize,h=u/2,l=new E.default(t-h,r-h,u,u),d=n.length-1;d>=0;d--){var c=n[d];c!==a&&!c.ignore&&!c.ignoreCoarsePointer&&(!c.parent||!c.parent.ignoreCoarsePointer)&&(_.copy(c.getBoundingRect()),c.transform&&_.applyTransform(c.transform),_.intersect(l)&&o.push(c))}if(o.length)for(var P=4,M=Math.PI/12,C=Math.PI*2,g=0;g<h;g+=P)for(var v=0;v<C;v+=M){var x=t+g*Math.cos(v),k=r+g*Math.sin(v);if(y(o,i,x,k,a),i.target)return i}}return i},e.prototype.processGesture=function(t,r){this._gestureMgr||(this._gestureMgr=new O.GestureMgr);var a=this._gestureMgr;r==="start"&&a.clear();var n=a.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);if(r==="end"&&a.clear(),n){var i=n.type;t.gestureEvent=i;var o=new p;o.target=n.target,this.dispatchToElement(o,i,n.event)}},e}(T.default);w.each(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],function(s){z.prototype[s]=function(e){var t=e.zrX,r=e.zrY,a=H(this,t,r),n,i;if((s!=="mouseup"||!a)&&(n=this.findHover(t,r),i=n.target),s==="mousedown")this._downEl=i,this._downPoint=[e.zrX,e.zrY],this._upEl=i;else if(s==="mouseup")this._upEl=i;else if(s==="click"){if(this._downEl!==this._upEl||!this._downPoint||X.dist(this._downPoint,[e.zrX,e.zrY])>4)return;this._downPoint=null}this.dispatchToElement(n,s,e)}});function G(s,e,t){if(s[s.rectHover?"rectContain":"contain"](e,t)){for(var r=s,a=void 0,n=!1;r;){if(r.ignoreClip&&(n=!0),!n){var i=r.getClipPath();if(i&&!i.contain(e,t))return!1}r.silent&&(a=!0);var o=r.__hostTarget;r=o||r.parent}return a?b:!0}return!1}f(G,"isHover");function y(s,e,t,r,a){for(var n=s.length-1;n>=0;n--){var i=s[n],o=void 0;if(i!==a&&!i.ignore&&(o=G(i,t,r))&&(!e.topTarget&&(e.topTarget=i),o!==b)){e.target=i;break}}}f(y,"setHoverTarget");function H(s,e,t){var r=s.painter;return e<0||e>r.getWidth()||t<0||t>r.getHeight()}f(H,"isOutsideBoundary");exports.default=z;
