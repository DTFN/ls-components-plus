"use strict";var U=Object.defineProperty;var _=(e,t)=>U(e,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const L=require("../core/Transformable/index.cjs"),I=require("../animation/Animator/index.cjs"),Y=require("../core/BoundingRect/index.cjs"),X=require("../core/Eventful/index.cjs"),G=require("../contain/text/index.cjs"),p=require("../core/util/index.cjs"),M=require("../config/index.cjs"),Z=require("../tool/color/index.cjs"),w=require("../graphic/constants/index.cjs");var E="__zr_normal__",N=L.TRANSFORMABLE_PROPS.concat(["ignore"]),J=p.reduce(L.TRANSFORMABLE_PROPS,function(e,t){return e[t]=!0,e},{ignore:!1}),P={},Q=new Y.default(0,0,0,0),H=function(){function e(t){this.id=p.guid(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return _(e,"Element"),e.prototype._init=function(t){this.attr(t)},e.prototype.drift=function(t,i,r){switch(this.draggable){case"horizontal":i=0;break;case"vertical":t=0;break}var n=this.transform;n||(n=this.transform=[1,0,0,1,0,0]),n[4]+=t,n[5]+=i,this.decomposeTransform(),this.markRedraw()},e.prototype.beforeUpdate=function(){},e.prototype.afterUpdate=function(){},e.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},e.prototype.updateInnerText=function(t){var i=this._textContent;if(i&&(!i.ignore||t)){this.textConfig||(this.textConfig={});var r=this.textConfig,n=r.local,o=i.innerTransformable,s=void 0,f=void 0,h=!1;o.parent=n?this:null;var d=!1;if(o.copyTransform(i),r.position!=null){var a=Q;r.layoutRect?a.copy(r.layoutRect):a.copy(this.getBoundingRect()),n||a.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(P,r,a):G.calculateTextPosition(P,r,a),o.x=P.x,o.y=P.y,s=P.align,f=P.verticalAlign;var v=r.origin;if(v&&r.rotation!=null){var l=void 0,S=void 0;v==="center"?(l=a.width*.5,S=a.height*.5):(l=G.parsePercent(v[0],a.width),S=G.parsePercent(v[1],a.height)),d=!0,o.originX=-o.x+l+(n?0:a.x),o.originY=-o.y+S+(n?0:a.y)}}r.rotation!=null&&(o.rotation=r.rotation);var c=r.offset;c&&(o.x+=c[0],o.y+=c[1],d||(o.originX=-c[0],o.originY=-c[1]));var g=r.inside==null?typeof r.position=="string"&&r.position.indexOf("inside")>=0:r.inside,m=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),u=void 0,T=void 0,C=void 0;g&&this.canBeInsideText()?(u=r.insideFill,T=r.insideStroke,(u==null||u==="auto")&&(u=this.getInsideTextFill()),(T==null||T==="auto")&&(T=this.getInsideTextStroke(u),C=!0)):(u=r.outsideFill,T=r.outsideStroke,(u==null||u==="auto")&&(u=this.getOutsideFill()),(T==null||T==="auto")&&(T=this.getOutsideStroke(u),C=!0)),u=u||"#000",(u!==m.fill||T!==m.stroke||C!==m.autoStroke||s!==m.align||f!==m.verticalAlign)&&(h=!0,m.fill=u,m.stroke=T,m.autoStroke=C,m.align=s,m.verticalAlign=f,i.setDefaultTextStyle(m)),i.__dirty|=w.REDRAW_BIT,h&&i.dirtyStyle(!0)}},e.prototype.canBeInsideText=function(){return!0},e.prototype.getInsideTextFill=function(){return"#fff"},e.prototype.getInsideTextStroke=function(t){return"#000"},e.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?M.LIGHT_LABEL_COLOR:M.DARK_LABEL_COLOR},e.prototype.getOutsideStroke=function(t){var i=this.__zr&&this.__zr.getBackgroundColor(),r=typeof i=="string"&&Z.parse(i);r||(r=[255,255,255,1]);for(var n=r[3],o=this.__zr.isDarkMode(),s=0;s<3;s++)r[s]=r[s]*n+(o?0:255)*(1-n);return r[3]=1,Z.stringify(r,"rgba")},e.prototype.traverse=function(t,i){},e.prototype.attrKV=function(t,i){t==="textConfig"?this.setTextConfig(i):t==="textContent"?this.setTextContent(i):t==="clipPath"?this.setClipPath(i):t==="extra"?(this.extra=this.extra||{},p.extend(this.extra,i)):this[t]=i},e.prototype.hide=function(){this.ignore=!0,this.markRedraw()},e.prototype.show=function(){this.ignore=!1,this.markRedraw()},e.prototype.attr=function(t,i){if(typeof t=="string")this.attrKV(t,i);else if(p.isObject(t))for(var r=t,n=p.keys(r),o=0;o<n.length;o++){var s=n[o];this.attrKV(s,t[s])}return this.markRedraw(),this},e.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var i=this._normalState,r=0;r<this.animators.length;r++){var n=this.animators[r],o=n.__fromStateTransition;if(!(n.getLoop()||o&&o!==E)){var s=n.targetName,f=s?i[s]:i;n.saveTo(f)}}},e.prototype._innerSaveToNormal=function(t){var i=this._normalState;i||(i=this._normalState={}),t.textConfig&&!i.textConfig&&(i.textConfig=this.textConfig),this._savePrimaryToNormal(t,i,N)},e.prototype._savePrimaryToNormal=function(t,i,r){for(var n=0;n<r.length;n++){var o=r[n];t[o]!=null&&!(o in i)&&(i[o]=this[o])}},e.prototype.hasState=function(){return this.currentStates.length>0},e.prototype.getState=function(t){return this.states[t]},e.prototype.ensureState=function(t){var i=this.states;return i[t]||(i[t]={}),i[t]},e.prototype.clearStates=function(t){this.useState(E,!1,t)},e.prototype.useState=function(t,i,r,n){var o=t===E,s=this.hasState();if(!(!s&&o)){var f=this.currentStates,h=this.stateTransition;if(!(p.indexOf(f,t)>=0&&(i||f.length===1))){var d;if(this.stateProxy&&!o&&(d=this.stateProxy(t)),d||(d=this.states&&this.states[t]),!d&&!o){p.logError("State "+t+" not exists.");return}o||this.saveCurrentToNormalState(d);var a=!!(d&&d.hoverLayer||n);a&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,d,this._normalState,i,!r&&!this.__inHover&&h&&h.duration>0,h);var v=this._textContent,l=this._textGuide;return v&&v.useState(t,i,r,a),l&&l.useState(t,i,r,a),o?(this.currentStates=[],this._normalState={}):i?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!a&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~w.REDRAW_BIT),d}}},e.prototype.useStates=function(t,i,r){if(!t.length)this.clearStates();else{var n=[],o=this.currentStates,s=t.length,f=s===o.length;if(f){for(var h=0;h<s;h++)if(t[h]!==o[h]){f=!1;break}}if(f)return;for(var h=0;h<s;h++){var d=t[h],a=void 0;this.stateProxy&&(a=this.stateProxy(d,t)),a||(a=this.states[d]),a&&n.push(a)}var v=n[s-1],l=!!(v&&v.hoverLayer||r);l&&this._toggleHoverLayerFlag(!0);var S=this._mergeStates(n),c=this.stateTransition;this.saveCurrentToNormalState(S),this._applyStateObj(t.join(","),S,this._normalState,!1,!i&&!this.__inHover&&c&&c.duration>0,c);var g=this._textContent,m=this._textGuide;g&&g.useStates(t,i,l),m&&m.useStates(t,i,l),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!l&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~w.REDRAW_BIT)}},e.prototype.isSilent=function(){for(var t=this.silent,i=this.parent;!t&&i;){if(i.silent){t=!0;break}i=i.parent}return t},e.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var i=this.animators[t];i.targetName&&i.changeTarget(this[i.targetName])}},e.prototype.removeState=function(t){var i=p.indexOf(this.currentStates,t);if(i>=0){var r=this.currentStates.slice();r.splice(i,1),this.useStates(r)}},e.prototype.replaceState=function(t,i,r){var n=this.currentStates.slice(),o=p.indexOf(n,t),s=p.indexOf(n,i)>=0;o>=0?s?n.splice(o,1):n[o]=i:r&&!s&&n.push(i),this.useStates(n)},e.prototype.toggleState=function(t,i){i?this.useState(t,!0):this.removeState(t)},e.prototype._mergeStates=function(t){for(var i={},r,n=0;n<t.length;n++){var o=t[n];p.extend(i,o),o.textConfig&&(r=r||{},p.extend(r,o.textConfig))}return r&&(i.textConfig=r),i},e.prototype._applyStateObj=function(t,i,r,n,o,s){var f=!(i&&n);i&&i.textConfig?(this.textConfig=p.extend({},n?this.textConfig:r.textConfig),p.extend(this.textConfig,i.textConfig)):f&&r.textConfig&&(this.textConfig=r.textConfig);for(var h={},d=!1,a=0;a<N.length;a++){var v=N[a],l=o&&J[v];i&&i[v]!=null?l?(d=!0,h[v]=i[v]):this[v]=i[v]:f&&r[v]!=null&&(l?(d=!0,h[v]=r[v]):this[v]=r[v])}if(!o)for(var a=0;a<this.animators.length;a++){var S=this.animators[a],c=S.targetName;S.getLoop()||S.__changeFinalValue(c?(i||r)[c]:i||r)}d&&this._transitionState(t,h,s)},e.prototype._attachComponent=function(t){if(t.__zr&&!t.__hostTarget){if(process.env.NODE_ENV!=="production")throw new Error("Text element has been added to zrender.");return}if(t===this){if(process.env.NODE_ENV!=="production")throw new Error("Recursive component attachment.");return}var i=this.__zr;i&&t.addSelfToZr(i),t.__zr=i,t.__hostTarget=this},e.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},e.prototype.getClipPath=function(){return this._clipPath},e.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},e.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},e.prototype.getTextContent=function(){return this._textContent},e.prototype.setTextContent=function(t){var i=this._textContent;if(i!==t){if(i&&i!==t&&this.removeTextContent(),process.env.NODE_ENV!=="production"&&t.__zr&&!t.__hostTarget)throw new Error("Text element has been added to zrender.");t.innerTransformable=new L.default,this._attachComponent(t),this._textContent=t,this.markRedraw()}},e.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),p.extend(this.textConfig,t),this.markRedraw()},e.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},e.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.innerTransformable=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},e.prototype.getTextGuideLine=function(){return this._textGuide},e.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},e.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},e.prototype.markRedraw=function(){this.__dirty|=w.REDRAW_BIT;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},e.prototype.dirty=function(){this.markRedraw()},e.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var i=this._textContent,r=this._textGuide;i&&(i.__inHover=t),r&&(r.__inHover=t)},e.prototype.addSelfToZr=function(t){if(this.__zr!==t){this.__zr=t;var i=this.animators;if(i)for(var r=0;r<i.length;r++)t.animation.addAnimator(i[r]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)}},e.prototype.removeSelfFromZr=function(t){if(this.__zr){this.__zr=null;var i=this.animators;if(i)for(var r=0;r<i.length;r++)t.animation.removeAnimator(i[r]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)}},e.prototype.animate=function(t,i,r){var n=t?this[t]:this;if(process.env.NODE_ENV!=="production"&&!n){p.logError('Property "'+t+'" is not existed in element '+this.id);return}var o=new I.default(n,i,r);return t&&(o.targetName=t),this.addAnimator(o,t),o},e.prototype.addAnimator=function(t,i){var r=this.__zr,n=this;t.during(function(){n.updateDuringAnimation(i)}).done(function(){var o=n.animators,s=p.indexOf(o,t);s>=0&&o.splice(s,1)}),this.animators.push(t),r&&r.animation.addAnimator(t),r&&r.wakeUp()},e.prototype.updateDuringAnimation=function(t){this.markRedraw()},e.prototype.stopAnimation=function(t,i){for(var r=this.animators,n=r.length,o=[],s=0;s<n;s++){var f=r[s];!t||t===f.scope?f.stop(i):o.push(f)}return this.animators=o,this},e.prototype.animateTo=function(t,i,r){z(this,t,i,r)},e.prototype.animateFrom=function(t,i,r){z(this,t,i,r,!0)},e.prototype._transitionState=function(t,i,r,n){for(var o=z(this,i,r,n),s=0;s<o.length;s++)o[s].__fromStateTransition=t},e.prototype.getBoundingRect=function(){return null},e.prototype.getPaintRect=function(){return null},e.initDefaultProps=function(){var t=e.prototype;t.type="element",t.name="",t.ignore=t.silent=t.isGroup=t.draggable=t.dragging=t.ignoreClip=t.__inHover=!1,t.__dirty=w.REDRAW_BIT;var i={};function r(o,s,f){i[o+s+f]||(console.warn("DEPRECATED: '"+o+"' has been deprecated. use '"+s+"', '"+f+"' instead"),i[o+s+f]=!0)}_(r,"logDeprecatedError");function n(o,s,f,h){Object.defineProperty(t,o,{get:_(function(){if(process.env.NODE_ENV!=="production"&&r(o,f,h),!this[s]){var a=this[s]=[];d(this,a)}return this[s]},"get"),set:_(function(a){process.env.NODE_ENV!=="production"&&r(o,f,h),this[f]=a[0],this[h]=a[1],this[s]=a,d(this,a)},"set")});function d(a,v){Object.defineProperty(v,0,{get:_(function(){return a[f]},"get"),set:_(function(l){a[f]=l},"set")}),Object.defineProperty(v,1,{get:_(function(){return a[h]},"get"),set:_(function(l){a[h]=l},"set")})}_(d,"enhanceArray")}_(n,"createLegacyProperty"),Object.defineProperty&&(n("position","_legacyPos","x","y"),n("scale","_legacyScale","scaleX","scaleY"),n("origin","_legacyOrigin","originX","originY"))}(),e}();p.mixin(H,X.default);p.mixin(H,L.default);function z(e,t,i,r,n){i=i||{};var o=[];q(e,"",e,t,i,r,o,n);var s=o.length,f=!1,h=i.done,d=i.aborted,a=_(function(){f=!0,s--,s<=0&&(f?h&&h():d&&d())},"doneCb"),v=_(function(){s--,s<=0&&(f?h&&h():d&&d())},"abortedCb");s||h&&h(),o.length>0&&i.during&&o[0].during(function(c,g){i.during(g)});for(var l=0;l<o.length;l++){var S=o[l];a&&S.done(a),v&&S.aborted(v),i.force&&S.duration(i.duration),S.start(i.easing)}return o}_(z,"animateTo");function B(e,t,i){for(var r=0;r<i;r++)e[r]=t[r]}_(B,"copyArrShallow");function $(e){return p.isArrayLike(e[0])}_($,"is2DArray");function b(e,t,i){if(p.isArrayLike(t[i]))if(p.isArrayLike(e[i])||(e[i]=[]),p.isTypedArray(t[i])){var r=t[i].length;e[i].length!==r&&(e[i]=new t[i].constructor(r),B(e[i],t[i],r))}else{var n=t[i],o=e[i],s=n.length;if($(n))for(var f=n[0].length,h=0;h<s;h++)o[h]?B(o[h],n[h],f):o[h]=Array.prototype.slice.call(n[h]);else B(o,n,s);o.length=n.length}else e[i]=t[i]}_(b,"copyValue");function j(e,t){return e===t||p.isArrayLike(e)&&p.isArrayLike(t)&&k(e,t)}_(j,"isValueSame");function k(e,t){var i=e.length;if(i!==t.length)return!1;for(var r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}_(k,"is1DArraySame");function q(e,t,i,r,n,o,s,f){for(var h=p.keys(r),d=n.duration,a=n.delay,v=n.additive,l=n.setToFinal,S=!p.isObject(o),c=e.animators,g=[],m=0;m<h.length;m++){var u=h[m],T=r[u];if(T!=null&&i[u]!=null&&(S||o[u]))if(p.isObject(T)&&!p.isArrayLike(T)&&!p.isGradientObject(T)){if(t){f||(i[u]=T,e.updateDuringAnimation(t));continue}q(e,u,i[u],T,n,o&&o[u],s,f)}else g.push(u);else f||(i[u]=T,e.updateDuringAnimation(t),g.push(u))}var C=g.length;if(!v&&C)for(var x=0;x<c.length;x++){var R=c[x];if(R.targetName===t){var W=R.stopTracks(g);if(W){var V=p.indexOf(c,R);c.splice(V,1)}}}if(n.force||(g=p.filter(g,function(F){return!j(r[F],i[F])}),C=g.length),C>0||n.force&&!s.length){var A=void 0,D=void 0,y=void 0;if(f){D={},l&&(A={});for(var x=0;x<C;x++){var u=g[x];D[u]=i[u],l?A[u]=r[u]:i[u]=r[u]}}else if(l){y={};for(var x=0;x<C;x++){var u=g[x];y[u]=I.cloneValue(i[u]),b(i,r,u)}}var R=new I.default(i,!1,!1,v?p.filter(c,function(O){return O.targetName===t}):null);R.targetName=t,n.scope&&(R.scope=n.scope),l&&A&&R.whenWithKeys(0,A,g),y&&R.whenWithKeys(0,y,g),R.whenWithKeys(d??500,f?D:r,g).delay(a||0),e.addAnimator(R,t),s.push(R)}}_(q,"animateToShallow");exports.PRESERVED_NORMAL_STATE=E;exports.default=H;
