"use strict";var x=Object.defineProperty;var l=(a,r)=>x(a,"name",{value:r,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("../matrix/index.cjs"),S=require("../vector/index.cjs");var g=s.identity,M=5e-5;function f(a){return a>M||a<-M}l(f,"isNotAroundZero");var c=[],h=[],v=s.create(),p=Math.abs,R=function(){function a(){}return l(a,"Transformable"),a.prototype.getLocalTransform=function(r){return a.getLocalTransform(this,r)},a.prototype.setPosition=function(r){this.x=r[0],this.y=r[1]},a.prototype.setScale=function(r){this.scaleX=r[0],this.scaleY=r[1]},a.prototype.setSkew=function(r){this.skewX=r[0],this.skewY=r[1]},a.prototype.setOrigin=function(r){this.originX=r[0],this.originY=r[1]},a.prototype.needLocalTransform=function(){return f(this.rotation)||f(this.x)||f(this.y)||f(this.scaleX-1)||f(this.scaleY-1)||f(this.skewX)||f(this.skewY)},a.prototype.updateTransform=function(){var r=this.parent&&this.parent.transform,t=this.needLocalTransform(),o=this.transform;if(!(t||r)){o&&(g(o),this.invTransform=null);return}o=o||s.create(),t?this.getLocalTransform(o):g(o),r&&(t?s.mul(o,r,o):s.copy(o,r)),this.transform=o,this._resolveGlobalScaleRatio(o)},a.prototype._resolveGlobalScaleRatio=function(r){var t=this.globalScaleRatio;if(t!=null&&t!==1){this.getGlobalScale(c);var o=c[0]<0?-1:1,n=c[1]<0?-1:1,i=((c[0]-o)*t+o)/c[0]||0,e=((c[1]-n)*t+n)/c[1]||0;r[0]*=i,r[1]*=i,r[2]*=e,r[3]*=e}this.invTransform=this.invTransform||s.create(),s.invert(this.invTransform,r)},a.prototype.getComputedTransform=function(){for(var r=this,t=[];r;)t.push(r),r=r.parent;for(;r=t.pop();)r.updateTransform();return this.transform},a.prototype.setLocalTransform=function(r){if(r){var t=r[0]*r[0]+r[1]*r[1],o=r[2]*r[2]+r[3]*r[3],n=Math.atan2(r[1],r[0]),i=Math.PI/2+n-Math.atan2(r[3],r[2]);o=Math.sqrt(o)*Math.cos(i),t=Math.sqrt(t),this.skewX=i,this.skewY=0,this.rotation=-n,this.x=+r[4],this.y=+r[5],this.scaleX=t,this.scaleY=o,this.originX=0,this.originY=0}},a.prototype.decomposeTransform=function(){if(this.transform){var r=this.parent,t=this.transform;r&&r.transform&&(r.invTransform=r.invTransform||s.create(),s.mul(h,r.invTransform,t),t=h);var o=this.originX,n=this.originY;(o||n)&&(v[4]=o,v[5]=n,s.mul(h,t,v),h[4]-=o,h[5]-=n,t=h),this.setLocalTransform(t)}},a.prototype.getGlobalScale=function(r){var t=this.transform;return r=r||[],t?(r[0]=Math.sqrt(t[0]*t[0]+t[1]*t[1]),r[1]=Math.sqrt(t[2]*t[2]+t[3]*t[3]),t[0]<0&&(r[0]=-r[0]),t[3]<0&&(r[1]=-r[1]),r):(r[0]=1,r[1]=1,r)},a.prototype.transformCoordToLocal=function(r,t){var o=[r,t],n=this.invTransform;return n&&S.applyTransform(o,o,n),o},a.prototype.transformCoordToGlobal=function(r,t){var o=[r,t],n=this.transform;return n&&S.applyTransform(o,o,n),o},a.prototype.getLineScale=function(){var r=this.transform;return r&&p(r[0]-1)>1e-10&&p(r[3]-1)>1e-10?Math.sqrt(p(r[0]*r[3]-r[2]*r[1])):1},a.prototype.copyTransform=function(r){d(this,r)},a.getLocalTransform=function(r,t){t=t||[];var o=r.originX||0,n=r.originY||0,i=r.scaleX,e=r.scaleY,T=r.anchorX,y=r.anchorY,m=r.rotation||0,b=r.x,L=r.y,X=r.skewX?Math.tan(r.skewX):0,Y=r.skewY?Math.tan(-r.skewY):0;if(o||n||T||y){var w=o+T,k=n+y;t[4]=-w*i-X*k*e,t[5]=-k*e-Y*w*i}else t[4]=t[5]=0;return t[0]=i,t[3]=e,t[1]=Y*i,t[2]=X*e,m&&s.rotate(t,t,m),t[4]+=o+b,t[5]+=n+L,t},a.initDefaultProps=function(){var r=a.prototype;r.scaleX=r.scaleY=r.globalScaleRatio=1,r.x=r.y=r.originX=r.originY=r.skewX=r.skewY=r.rotation=r.anchorX=r.anchorY=0}(),a}(),u=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function d(a,r){for(var t=0;t<u.length;t++){var o=u[t];a[o]=r[o]}}l(d,"copyTransform");exports.TRANSFORMABLE_PROPS=u;exports.copyTransform=d;exports.default=R;
