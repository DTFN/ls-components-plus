"use strict";var z=Object.defineProperty;var n=(i,t)=>z(i,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const g=require("../core/util/index.cjs"),A=require("../core/timsort/index.cjs"),D=require("../graphic/constants/index.cjs");var h=!1;function d(){h||(h=!0,console.warn("z / z2 / zlevel of displayable is invalid, which may cause unexpected errors"))}n(d,"logInvalidZError");function L(i,t){return i.zlevel===t.zlevel?i.z===t.z?i.z2-t.z2:i.z-t.z:i.zlevel-t.zlevel}n(L,"shapeCompareFunc");var c=function(){function i(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=L}return n(i,"Storage"),i.prototype.traverse=function(t,e){for(var s=0;s<this._roots.length;s++)this._roots[s].traverse(t,e)},i.prototype.getDisplayList=function(t,e){e=e||!1;var s=this._displayList;return(t||!s.length)&&this.updateDisplayList(e),s},i.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,s=this._displayList,o=0,a=e.length;o<a;o++)this._updateAndAddDisplayable(e[o],null,t);s.length=this._displayListLen,A.default(s,L)},i.prototype._updateAndAddDisplayable=function(t,e,s){if(!(t.ignore&&!s)){t.beforeUpdate(),t.update(),t.afterUpdate();var o=t.getClipPath();if(t.ignoreClip)e=null;else if(o){e?e=e.slice():e=[];for(var a=o,f=t;a;)a.parent=f,a.updateTransform(),e.push(a),f=a,a=a.getClipPath()}if(t.childrenRef){for(var u=t.childrenRef(),l=0;l<u.length;l++){var _=u[l];t.__dirty&&(_.__dirty|=D.REDRAW_BIT),this._updateAndAddDisplayable(_,e,s)}t.__dirty=0}else{var r=t;e&&e.length?r.__clipPaths=e:r.__clipPaths&&r.__clipPaths.length>0&&(r.__clipPaths=[]),isNaN(r.z)&&(d(),r.z=0),isNaN(r.z2)&&(d(),r.z2=0),isNaN(r.zlevel)&&(d(),r.zlevel=0),this._displayList[this._displayListLen++]=r}var p=t.getDecalElement&&t.getDecalElement();p&&this._updateAndAddDisplayable(p,e,s);var y=t.getTextGuideLine();y&&this._updateAndAddDisplayable(y,e,s);var v=t.getTextContent();v&&this._updateAndAddDisplayable(v,e,s)}},i.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},i.prototype.delRoot=function(t){if(t instanceof Array){for(var e=0,s=t.length;e<s;e++)this.delRoot(t[e]);return}var o=g.indexOf(this._roots,t);o>=0&&this._roots.splice(o,1)},i.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},i.prototype.getRoots=function(){return this._roots},i.prototype.dispose=function(){this._displayList=null,this._roots=null},i}();exports.default=c;
