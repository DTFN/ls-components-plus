"use strict";var ar=Object.defineProperty;var c=(v,r)=>ar(v,"name",{value:r,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const m=require("../../core/curve/index.cjs"),x=require("../../graphic/Path/index.cjs"),F=require("../../core/util/index.cjs"),er=require("../../core/vector/index.cjs"),lr=require("../path/index.cjs"),tr=require("../../core/Transformable/index.cjs"),B=require("../dividePath/index.cjs"),S=require("../convertPath/index.cjs");function fr(v,r){var a=v.length,n=r.length;if(a===n)return[v,r];for(var t=[],i=[],f=a<n?v:r,e=Math.min(a,n),d=Math.abs(n-a)/6,l=(e-2)/6,u=Math.ceil(d/l)+1,o=[f[0],f[1]],g=d,s=2;s<e;){var D=f[s-2],T=f[s-1],q=f[s++],_=f[s++],C=f[s++],M=f[s++],Z=f[s++],p=f[s++];if(g<=0){o.push(q,_,C,M,Z,p);continue}for(var h=Math.min(g,u-1)+1,R=1;R<=h;R++){var y=R/h;m.cubicSubdivide(D,q,C,Z,y,t),m.cubicSubdivide(T,_,M,p,y,i),D=t[3],T=i[3],o.push(t[1],i[1],t[2],i[2],D,T),q=t[5],_=i[5],C=t[6],M=i[6]}g-=h-1}return f===v?[o,r]:[v,o]}c(fr,"alignSubpath");function z(v,r){for(var a=v.length,n=v[a-2],t=v[a-1],i=[],f=0;f<r.length;)i[f++]=n,i[f++]=t;return i}c(z,"createSubpath");function b(v,r){for(var a,n,t,i=[],f=[],e=0;e<Math.max(v.length,r.length);e++){var d=v[e],l=r[e],u=void 0,o=void 0;d?l?(a=fr(d,l),u=a[0],o=a[1],n=u,t=o):(o=z(t||d,d),u=d):(u=z(n||l,l),o=l),i.push(u),f.push(o)}return[i,f]}c(b,"alignBezierCurves");function L(v){for(var r=0,a=0,n=0,t=v.length,i=0,f=t-2;i<t;f=i,i+=2){var e=v[f],d=v[f+1],l=v[i],u=v[i+1],o=e*u-l*d;r+=o,a+=(e+l)*o,n+=(d+u)*o}return r===0?[v[0]||0,v[1]||0]:[a/r/3,n/r/3,r]}c(L,"centroid");function or(v,r,a,n){for(var t=(v.length-2)/6,i=1/0,f=0,e=v.length,d=e-2,l=0;l<t;l++){for(var u=l*6,o=0,g=0;g<e;g+=2){var s=g===0?u:(u+g-2)%d+2,D=v[s]-a[0],T=v[s+1]-a[1],q=r[g]-n[0],_=r[g+1]-n[1],C=q-D,M=_-T;o+=C*C+M*M}o<i&&(i=o,f=l)}return f}c(or,"findBestRingOffset");function ir(v){for(var r=[],a=v.length,n=0;n<a;n+=2)r[n]=v[a-n-2],r[n+1]=v[a-n-1];return r}c(ir,"reverse");function dr(v,r,a,n){for(var t=[],i,f=0;f<v.length;f++){var e=v[f],d=r[f],l=L(e),u=L(d);i==null&&(i=l[2]<0!=u[2]<0);var o=[],g=[],s=0,D=1/0,T=[],q=e.length;i&&(e=ir(e));for(var _=or(e,d,l,u)*6,C=q-2,M=0;M<C;M+=2){var Z=(_+M)%C+2;o[M+2]=e[Z]-l[0],o[M+3]=e[Z+1]-l[1]}o[0]=e[_]-l[0],o[1]=e[_+1]-l[1];for(var p=n/a,h=-n/2;h<=n/2;h+=p){for(var R=Math.sin(h),y=Math.cos(h),I=0,M=0;M<e.length;M+=2){var P=o[M],Y=o[M+1],E=d[M]-u[0],U=d[M+1]-u[1],G=E*y-U*R,J=E*R+U*y;T[M]=G,T[M+1]=J;var V=G-P,A=J-Y;I+=V*V+A*A}if(I<D){D=I,s=h;for(var H=0;H<T.length;H++)g[H]=T[H]}}t.push({from:o,to:g,fromCp:l,toCp:u,rotation:-s})}return t}c(dr,"findBestMorphingRotation");function $(v){return v.__isCombineMorphing}c($,"isCombineMorphing");var rr="__mOriginal_";function N(v,r,a){var n=rr+r,t=v[n]||v[r];v[n]||(v[n]=v[r]);var i=a.replace,f=a.after,e=a.before;v[r]=function(){var d=arguments,l;return e&&e.apply(this,d),i?l=i.apply(this,d):l=t.apply(this,d),f&&f.apply(this,d),l}}c(N,"saveAndModifyMethod");function K(v,r){var a=rr+r;v[a]&&(v[r]=v[a],v[a]=null)}c(K,"restoreMethod");function k(v,r){for(var a=0;a<v.length;a++)for(var n=v[a],t=0;t<n.length;){var i=n[t],f=n[t+1];n[t++]=r[0]*i+r[2]*f+r[4],n[t++]=r[1]*i+r[3]*f+r[5]}}c(k,"applyTransformOnBeziers");function vr(v,r){var a=v.getUpdatedPathProxy(),n=r.getUpdatedPathProxy(),t=b(S.pathToBezierCurves(a),S.pathToBezierCurves(n)),i=t[0],f=t[1],e=v.getComputedTransform(),d=r.getComputedTransform();function l(){this.transform=null}c(l,"updateIdentityTransform"),e&&k(i,e),d&&k(f,d),N(r,"updateTransform",{replace:l}),r.transform=null;var u=dr(i,f,10,Math.PI),o=[];N(r,"buildPath",{replace:c(function(g){for(var s=r.__morphT,D=1-s,T=[],q=0;q<u.length;q++){var _=u[q],C=_.from,M=_.to,Z=_.rotation*s,p=_.fromCp,h=_.toCp,R=Math.sin(Z),y=Math.cos(Z);er.lerp(T,p,h,s);for(var I=0;I<C.length;I+=2){var P=C[I],Y=C[I+1],E=M[I],U=M[I+1],G=P*D+E*s,J=Y*D+U*s;o[I]=G*y-J*R+T[0],o[I+1]=G*R+J*y+T[1]}var V=o[0],A=o[1];g.moveTo(V,A);for(var I=2;I<C.length;){var E=o[I++],U=o[I++],H=o[I++],w=o[I++],Q=o[I++],W=o[I++];V===E&&A===U&&H===Q&&w===W?g.lineTo(Q,W):g.bezierCurveTo(E,U,H,w,Q,W),V=Q,A=W}}},"replace")})}c(vr,"prepareMorphPath");function j(v,r,a){if(!v||!r)return r;var n=a.done,t=a.during;vr(v,r),r.__morphT=0;function i(){K(r,"buildPath"),K(r,"updateTransform"),r.__morphT=-1,r.createPathProxy(),r.dirtyShape()}return c(i,"restoreToPath"),r.animateTo({__morphT:1},F.defaults({during:c(function(f){r.dirtyShape(),t&&t(f)},"during"),done:c(function(){i(),n&&n()},"done")},a)),r}c(j,"morphPath");function ur(v,r,a,n,t,i){var f=16;v=t===a?0:Math.round(32767*(v-a)/(t-a)),r=i===n?0:Math.round(32767*(r-n)/(i-n));for(var e=0,d,l=(1<<f)/2;l>0;l/=2){var u=0,o=0;(v&l)>0&&(u=1),(r&l)>0&&(o=1),e+=l*l*(3*u^o),o===0&&(u===1&&(v=l-1-v,r=l-1-r),d=v,v=r,r=d)}return e}c(ur,"hilbert");function X(v){var r=1/0,a=1/0,n=-1/0,t=-1/0,i=F.map(v,function(e){var d=e.getBoundingRect(),l=e.getComputedTransform(),u=d.x+d.width/2+(l?l[4]:0),o=d.y+d.height/2+(l?l[5]:0);return r=Math.min(u,r),a=Math.min(o,a),n=Math.max(u,n),t=Math.max(o,t),[u,o]}),f=F.map(i,function(e,d){return{cp:e,z:ur(e[0],e[1],r,a,n,t),path:v[d]}});return f.sort(function(e,d){return e.z-d.z}).map(function(e){return e.path})}c(X,"sortPaths");function nr(v){return B.split(v.path,v.count)}c(nr,"defaultDividePath");function O(){return{fromIndividuals:[],toIndividuals:[],count:0}}c(O,"createEmptyReturn");function cr(v,r,a){var n=[];function t(p){for(var h=0;h<p.length;h++){var R=p[h];$(R)?t(R.childrenRef()):R instanceof x.default&&n.push(R)}}c(t,"addFromPath"),t(v);var i=n.length;if(!i)return O();var f=a.dividePath||nr,e=f({path:r,count:i});if(e.length!==i)return console.error("Invalid morphing: unmatched splitted path"),O();n=X(n),e=X(e);for(var d=a.done,l=a.during,u=a.individualDelay,o=new tr.default,g=0;g<i;g++){var s=n[g],D=e[g];D.parent=r,D.copyTransform(o),u||vr(s,D)}r.__isCombineMorphing=!0,r.childrenRef=function(){return e};function T(p){for(var h=0;h<e.length;h++)e[h].addSelfToZr(p)}c(T,"addToSubPathListToZr"),N(r,"addSelfToZr",{after:c(function(p){T(p)},"after")}),N(r,"removeSelfFromZr",{after:c(function(p){for(var h=0;h<e.length;h++)e[h].removeSelfFromZr(p)},"after")});function q(){r.__isCombineMorphing=!1,r.__morphT=-1,r.childrenRef=null,K(r,"addSelfToZr"),K(r,"removeSelfFromZr")}c(q,"restoreToPath");var _=e.length;if(u)for(var C=_,M=c(function(){C--,C===0&&(q(),d&&d())},"eachDone"),g=0;g<_;g++){var Z=u?F.defaults({delay:(a.delay||0)+u(g,_,n[g],e[g]),done:M},a):a;j(n[g],e[g],Z)}else r.__morphT=0,r.animateTo({__morphT:1},F.defaults({during:c(function(p){for(var h=0;h<_;h++){var R=e[h];R.__morphT=r.__morphT,R.dirtyShape()}l&&l(p)},"during"),done:c(function(){q();for(var p=0;p<v.length;p++)K(v[p],"updateTransform");d&&d()},"done")},a));return r.__zr&&T(r.__zr),{fromIndividuals:n,toIndividuals:e,count:_}}c(cr,"combineMorph");function gr(v,r,a){var n=r.length,t=[],i=a.dividePath||nr;function f(s){for(var D=0;D<s.length;D++){var T=s[D];$(T)?f(T.childrenRef()):T instanceof x.default&&t.push(T)}}if(c(f,"addFromPath"),$(v)){f(v.childrenRef());var e=t.length;if(e<n)for(var d=0,l=e;l<n;l++)t.push(lr.clonePath(t[d++%e]));t.length=n}else{t=i({path:v,count:n});for(var u=v.getComputedTransform(),l=0;l<t.length;l++)t[l].setLocalTransform(u);if(t.length!==n)return console.error("Invalid morphing: unmatched splitted path"),O()}t=X(t),r=X(r);for(var o=a.individualDelay,l=0;l<n;l++){var g=o?F.defaults({delay:(a.delay||0)+o(l,n,t[l],r[l])},a):a;j(t[l],r[l],g)}return{fromIndividuals:t,toIndividuals:r,count:r.length}}c(gr,"separateMorph");exports.defaultDividePath=B.split;exports.alignBezierCurves=b;exports.centroid=L;exports.combineMorph=cr;exports.isCombineMorphing=$;exports.morphPath=j;exports.separateMorph=gr;
