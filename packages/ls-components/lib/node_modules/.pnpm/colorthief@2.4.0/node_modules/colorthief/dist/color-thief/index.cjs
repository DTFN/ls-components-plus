"use strict";var T=Object.defineProperty;var l=(f,u)=>T(f,"name",{value:u,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});if(!q)var q={map:l(function(f,u){var d={};return u?f.map(function(g,b){return d.index=b,u.call(d,g)}):f.slice()},"map"),naturalOrder:l(function(f,u){return f<u?-1:f>u?1:0},"naturalOrder"),sum:l(function(f,u){var d={};return f.reduce(u?function(g,b,m){return d.index=m,g+u.call(d,b)}:function(g,b){return g+b},0)},"sum"),max:l(function(f,u){return Math.max.apply(null,u?q.map(f,u):f)},"max")};var L=function(){var f=5,u=8-f,d=1e3;function g(r,t,n){return(r<<2*f)+(t<<f)+n}l(g,"e");function b(r){var t=[],n=!1;function s(){t.sort(r),n=!0}return l(s,"o"),{push:l(function(e){t.push(e),n=!1},"push"),peek:l(function(e){return n||s(),e===void 0&&(e=t.length-1),t[e]},"peek"),pop:l(function(){return n||s(),t.pop()},"pop"),size:l(function(){return t.length},"size"),map:l(function(e){return t.map(e)},"map"),debug:l(function(){return n||s(),t},"debug")}}l(b,"u");function m(r,t,n,s,e,o,h){var a=this;a.r1=r,a.r2=t,a.g1=n,a.g2=s,a.b1=e,a.b2=o,a.histo=h}l(m,"a");function M(){this.vboxes=new b(function(r,t){return q.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}l(M,"i");function I(r,t){if(t.count()){var n=t.r2-t.r1+1,s=t.g2-t.g1+1,e=q.max([n,s,t.b2-t.b1+1]);if(t.count()==1)return[t.copy()];var o,h,a,c,v=0,p=[],w=[];if(e==n)for(o=t.r1;o<=t.r2;o++){for(c=0,h=t.g1;h<=t.g2;h++)for(a=t.b1;a<=t.b2;a++)c+=r[g(o,h,a)]||0;p[o]=v+=c}else if(e==s)for(o=t.g1;o<=t.g2;o++){for(c=0,h=t.r1;h<=t.r2;h++)for(a=t.b1;a<=t.b2;a++)c+=r[g(h,o,a)]||0;p[o]=v+=c}else for(o=t.b1;o<=t.b2;o++){for(c=0,h=t.r1;h<=t.r2;h++)for(a=t.g1;a<=t.g2;a++)c+=r[g(h,a,o)]||0;p[o]=v+=c}return p.forEach(function(x,y){w[y]=v-x}),function(x){var y,E,_,O,C,k=x+"1",z=x+"2",D=0;for(o=t[k];o<=t[z];o++)if(p[o]>v/2){for(_=t.copy(),O=t.copy(),C=(y=o-t[k])<=(E=t[z]-o)?Math.min(t[z]-1,~~(o+E/2)):Math.max(t[k],~~(o-1-y/2));!p[C];)C++;for(D=w[C];!D&&p[C-1];)D=w[--C];return _[z]=C,O[k]=_[z]+1,[_,O]}}(e==n?"r":e==s?"g":"b")}}return l(I,"c"),m.prototype={volume:l(function(r){var t=this;return t._volume&&!r||(t._volume=(t.r2-t.r1+1)*(t.g2-t.g1+1)*(t.b2-t.b1+1)),t._volume},"volume"),count:l(function(r){var t=this,n=t.histo;if(!t._count_set||r){var s,e,o,h=0;for(s=t.r1;s<=t.r2;s++)for(e=t.g1;e<=t.g2;e++)for(o=t.b1;o<=t.b2;o++)h+=n[g(s,e,o)]||0;t._count=h,t._count_set=!0}return t._count},"count"),copy:l(function(){var r=this;return new m(r.r1,r.r2,r.g1,r.g2,r.b1,r.b2,r.histo)},"copy"),avg:l(function(r){var t=this,n=t.histo;if(!t._avg||r){var s,e,o,h,a=0,c=1<<8-f,v=0,p=0,w=0;for(e=t.r1;e<=t.r2;e++)for(o=t.g1;o<=t.g2;o++)for(h=t.b1;h<=t.b2;h++)a+=s=n[g(e,o,h)]||0,v+=s*(e+.5)*c,p+=s*(o+.5)*c,w+=s*(h+.5)*c;t._avg=a?[~~(v/a),~~(p/a),~~(w/a)]:[~~(c*(t.r1+t.r2+1)/2),~~(c*(t.g1+t.g2+1)/2),~~(c*(t.b1+t.b2+1)/2)]}return t._avg},"avg"),contains:l(function(r){var t=this,n=r[0]>>u;return gval=r[1]>>u,bval=r[2]>>u,n>=t.r1&&n<=t.r2&&gval>=t.g1&&gval<=t.g2&&bval>=t.b1&&bval<=t.b2},"contains")},M.prototype={push:l(function(r){this.vboxes.push({vbox:r,color:r.avg()})},"push"),palette:l(function(){return this.vboxes.map(function(r){return r.color})},"palette"),size:l(function(){return this.vboxes.size()},"size"),map:l(function(r){for(var t=this.vboxes,n=0;n<t.size();n++)if(t.peek(n).vbox.contains(r))return t.peek(n).color;return this.nearest(r)},"map"),nearest:l(function(r){for(var t,n,s,e=this.vboxes,o=0;o<e.size();o++)((n=Math.sqrt(Math.pow(r[0]-e.peek(o).color[0],2)+Math.pow(r[1]-e.peek(o).color[1],2)+Math.pow(r[2]-e.peek(o).color[2],2)))<t||t===void 0)&&(t=n,s=e.peek(o).color);return s},"nearest"),forcebw:l(function(){var r=this.vboxes;r.sort(function(e,o){return q.naturalOrder(q.sum(e.color),q.sum(o.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var n=r.length-1,s=r[n].color;s[0]>251&&s[1]>251&&s[2]>251&&(r[n].color=[255,255,255])},"forcebw")},{quantize:l(function(r,t){if(!r.length||t<2||t>256)return!1;var n=function(c){var v,p=new Array(1<<3*f);return c.forEach(function(w){v=g(w[0]>>u,w[1]>>u,w[2]>>u),p[v]=(p[v]||0)+1}),p}(r);n.forEach(function(){});var s=function(c,v){var p,w,x,y=1e6,E=0,_=1e6,O=0,C=1e6,k=0;return c.forEach(function(z){(p=z[0]>>u)<y?y=p:p>E&&(E=p),(w=z[1]>>u)<_?_=w:w>O&&(O=w),(x=z[2]>>u)<C?C=x:x>k&&(k=x)}),new m(y,E,_,O,C,k,v)}(r,n),e=new b(function(c,v){return q.naturalOrder(c.count(),v.count())});function o(c,v){for(var p,w=c.size(),x=0;x<d;){if(w>=v||x++>d)return;if((p=c.pop()).count()){var y=I(n,p),E=y[0],_=y[1];if(!E)return;c.push(E),_&&(c.push(_),w++)}else c.push(p),x++}}l(o,"g"),e.push(s),o(e,.75*t);for(var h=new b(function(c,v){return q.naturalOrder(c.count()*c.volume(),v.count()*v.volume())});e.size();)h.push(e.pop());o(h,t);for(var a=new M;h.size();)a.push(h.pop());return a},"quantize")}}().quantize,A=l(function(f){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=f.naturalWidth,this.height=this.canvas.height=f.naturalHeight,this.context.drawImage(f,0,0,this.width,this.height)},"n");A.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var P=l(function(){},"o");P.prototype.getColor=function(f,u){return u===void 0&&(u=10),this.getPalette(f,5,u)[0]},P.prototype.getPalette=function(f,u,d){var g=function(I){var r=I.colorCount,t=I.quality;if(r!==void 0&&Number.isInteger(r)){if(r===1)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(t===void 0||!Number.isInteger(t)||t<1)&&(t=10),{colorCount:r,quality:t}}({colorCount:u,quality:d}),b=new A(f),m=function(I,r,t){for(var n,s,e,o,h,a=I,c=[],v=0;v<r;v+=t)s=a[0+(n=4*v)],e=a[n+1],o=a[n+2],((h=a[n+3])===void 0||h>=125)&&(s>250&&e>250&&o>250||c.push([s,e,o]));return c}(b.getImageData().data,b.width*b.height,g.quality),M=L(m,g.colorCount);return M?M.palette():null},P.prototype.getColorFromUrl=function(f,u,d){var g=this,b=document.createElement("img");b.addEventListener("load",function(){var m=g.getPalette(b,5,d);u(m[0],f)}),b.src=f},P.prototype.getImageData=function(f,u){var d=new XMLHttpRequest;d.open("GET",f,!0),d.responseType="arraybuffer",d.onload=function(){if(this.status==200){var g=new Uint8Array(this.response);i=g.length;for(var b=new Array(i),m=0;m<g.length;m++)b[m]=String.fromCharCode(g[m]);var M=b.join(""),I=window.btoa(M);u("data:image/png;base64,"+I)}},d.send()},P.prototype.getColorAsync=function(f,u,d){var g=this;this.getImageData(f,function(b){var m=document.createElement("img");m.addEventListener("load",function(){var M=g.getPalette(m,5,d);u(M[0],this)}),m.src=b})};exports.default=P;
