"use strict";var E=Object.defineProperty;var l=(o,t)=>E(o,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const b=require("../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),n=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),k=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/env/index.cjs"),m=require("../../util/model/index.cjs"),v=require("../Component/index.cjs"),A=require("../mixin/palette/index.cjs"),R=require("../mixin/dataFormat/index.cjs"),h=require("../../util/layout/index.cjs"),w=require("../../core/task/index.cjs"),N=require("../../util/clazz/index.cjs"),x=require("../../data/helper/sourceManager/index.cjs"),C=require("../../component/tooltip/seriesFormatTooltip/index.cjs");var c=m.makeInner();function g(o,t){return o.getName(t)||o.getId(t)}l(g,"getSelectionKey");var P="__universalTransitionEnabled",y=function(o){b.__extends(t,o);function t(){var e=o!==null&&o.apply(this,arguments)||this;return e._selectedDataIndicesMap={},e}return l(t,"SeriesModel"),t.prototype.init=function(e,a,r){this.seriesIndex=this.componentIndex,this.dataTask=w.createTask({count:L,reset:O}),this.dataTask.context={model:this},this.mergeDefaultAndTheme(e,r);var i=c(this).sourceManager=new x.SourceManager(this);i.prepareSource();var s=this.getInitialData(e,r);I(s,this),this.dataTask.context.data=s,process.env.NODE_ENV!=="production"&&n.assert(s,"getInitialData returned invalid data."),c(this).dataBeforeProcessed=s,_(this),this._initSelectedMapFromData(s)},t.prototype.mergeDefaultAndTheme=function(e,a){var r=h.fetchLayoutMode(this),i=r?h.getLayoutParams(e):{},s=this.subType;v.default.hasClass(s)&&(s+="Series"),n.merge(e,a.getTheme().get(this.subType)),n.merge(e,this.getDefaultOption()),m.defaultEmphasis(e,"label",["show"]),this.fillDataTextStyle(e.data),r&&h.mergeLayoutParam(e,i,r)},t.prototype.mergeOption=function(e,a){e=n.merge(this.option,e,!0),this.fillDataTextStyle(e.data);var r=h.fetchLayoutMode(this);r&&h.mergeLayoutParam(this.option,e,r);var i=c(this).sourceManager;i.dirty(),i.prepareSource();var s=this.getInitialData(e,a);I(s,this),this.dataTask.dirty(),this.dataTask.context.data=s,c(this).dataBeforeProcessed=s,_(this),this._initSelectedMapFromData(s)},t.prototype.fillDataTextStyle=function(e){if(e&&!n.isTypedArray(e))for(var a=["show"],r=0;r<e.length;r++)e[r]&&e[r].label&&m.defaultEmphasis(e[r],"label",a)},t.prototype.getInitialData=function(e,a){},t.prototype.appendData=function(e){var a=this.getRawData();a.appendData(e.data)},t.prototype.getData=function(e){var a=M(this);if(a){var r=a.context.data;return e==null||!r.getLinkedData?r:r.getLinkedData(e)}else return c(this).data},t.prototype.getAllData=function(){var e=this.getData();return e&&e.getLinkedDataAll?e.getLinkedDataAll():[{data:e}]},t.prototype.setData=function(e){var a=M(this);if(a){var r=a.context;r.outputData=e,a!==this.dataTask&&(r.data=e)}c(this).data=e},t.prototype.getEncode=function(){var e=this.get("encode",!0);if(e)return n.createHashMap(e)},t.prototype.getSourceManager=function(){return c(this).sourceManager},t.prototype.getSource=function(){return this.getSourceManager().getSource()},t.prototype.getRawData=function(){return c(this).dataBeforeProcessed},t.prototype.getColorBy=function(){var e=this.get("colorBy");return e||"series"},t.prototype.isColorBySeries=function(){return this.getColorBy()==="series"},t.prototype.getBaseAxis=function(){var e=this.coordinateSystem;return e&&e.getBaseAxis&&e.getBaseAxis()},t.prototype.formatTooltip=function(e,a,r){return C.defaultSeriesFormatTooltip({series:this,dataIndex:e,multipleSeries:a})},t.prototype.isAnimationEnabled=function(){var e=this.ecModel;if(k.default.node&&!(e&&e.ssr))return!1;var a=this.getShallow("animation");return a&&this.getData().count()>this.getShallow("animationThreshold")&&(a=!1),!!a},t.prototype.restoreData=function(){this.dataTask.dirty()},t.prototype.getColorFromPalette=function(e,a,r){var i=this.ecModel,s=A.PaletteMixin.prototype.getColorFromPalette.call(this,e,a,r);return s||(s=i.getColorFromPalette(e,a,r)),s},t.prototype.coordDimToDataDim=function(e){return this.getRawData().mapDimensionsAll(e)},t.prototype.getProgressive=function(){return this.get("progressive")},t.prototype.getProgressiveThreshold=function(){return this.get("progressiveThreshold")},t.prototype.select=function(e,a){this._innerSelect(this.getData(a),e)},t.prototype.unselect=function(e,a){var r=this.option.selectedMap;if(r){var i=this.option.selectedMode,s=this.getData(a);if(i==="series"||r==="all"){this.option.selectedMap={},this._selectedDataIndicesMap={};return}for(var u=0;u<e.length;u++){var p=e[u],f=g(s,p);r[f]=!1,this._selectedDataIndicesMap[f]=-1}}},t.prototype.toggleSelect=function(e,a){for(var r=[],i=0;i<e.length;i++)r[0]=e[i],this.isSelected(e[i],a)?this.unselect(r,a):this.select(r,a)},t.prototype.getSelectedDataIndices=function(){if(this.option.selectedMap==="all")return[].slice.call(this.getData().getIndices());for(var e=this._selectedDataIndicesMap,a=n.keys(e),r=[],i=0;i<a.length;i++){var s=e[a[i]];s>=0&&r.push(s)}return r},t.prototype.isSelected=function(e,a){var r=this.option.selectedMap;if(!r)return!1;var i=this.getData(a);return(r==="all"||r[g(i,e)])&&!i.getItemModel(e).get(["select","disabled"])},t.prototype.isUniversalTransitionEnabled=function(){if(this[P])return!0;var e=this.option.universalTransition;return e?e===!0?!0:e&&e.enabled:!1},t.prototype._innerSelect=function(e,a){var r,i,s=this.option,u=s.selectedMode,p=a.length;if(!(!u||!p)){if(u==="series")s.selectedMap="all";else if(u==="multiple"){n.isObject(s.selectedMap)||(s.selectedMap={});for(var f=s.selectedMap,D=0;D<p;D++){var S=a[D],d=g(e,S);f[d]=!0,this._selectedDataIndicesMap[d]=e.getRawIndex(S)}}else if(u==="single"||u===!0){var T=a[p-1],d=g(e,T);s.selectedMap=(r={},r[d]=!0,r),this._selectedDataIndicesMap=(i={},i[d]=e.getRawIndex(T),i)}}},t.prototype._initSelectedMapFromData=function(e){if(!this.option.selectedMap){var a=[];e.hasItemOption&&e.each(function(r){var i=e.getRawDataItem(r);i&&i.selected&&a.push(r)}),a.length>0&&this._innerSelect(e,a)}},t.registerClass=function(e){return v.default.registerClass(e)},t.protoInitialize=function(){var e=t.prototype;e.type="series.__base__",e.seriesIndex=0,e.ignoreStyleOnData=!1,e.hasSymbolVisual=!1,e.defaultSymbol="circle",e.visualStyleAccessPath="itemStyle",e.visualDrawType="fill"}(),t}(v.default);n.mixin(y,R.DataFormatMixin);n.mixin(y,A.PaletteMixin);N.mountExtend(y,v.default);function _(o){var t=o.name;m.isNameSpecified(o)||(o.name=B(o)||t)}l(_,"autoSeriesName");function B(o){var t=o.getRawData(),e=t.mapDimensionsAll("seriesName"),a=[];return n.each(e,function(r){var i=t.getDimensionInfo(r);i.displayName&&a.push(i.displayName)}),a.join(" ")}l(B,"getSeriesAutoName");function L(o){return o.model.getRawData().count()}l(L,"dataTaskCount");function O(o){var t=o.model;return t.setData(t.getRawData().cloneShallow()),q}l(O,"dataTaskReset");function q(o,t){t.outputData&&o.end>t.outputData.count()&&t.model.getRawData().cloneShallow(t.outputData)}l(q,"dataTaskProgress");function I(o,t){n.each(n.concatArray(o.CHANGABLE_METHODS,o.DOWNSAMPLE_METHODS),function(e){o.wrapMethod(e,n.curry(F,t))})}l(I,"wrapData");function F(o,t){var e=M(o);return e&&e.setOutputEnd((t||this).count()),t}l(F,"onDataChange");function M(o){var t=(o.ecModel||{}).scheduler,e=t&&t.getPipeline(o.uid);if(e){var a=e.currentTask;if(a){var r=a.agentStubMap;r&&(a=r.get(o.uid))}return a}}l(M,"getCurrentTask");exports.SERIES_UNIVERSAL_TRANSITION_PROP=P;exports.default=y;
