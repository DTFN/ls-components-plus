"use strict";var A=Object.defineProperty;var _=(s,e)=>A(s,"name",{value:e,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const w=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),h=require("../../../util/number/index.cjs"),I=require("../../helper/sliderMove/index.cjs"),P=require("../../../coord/axisHelper/index.cjs"),R=require("../../../coord/scaleRawExtentInfo/index.cjs"),E=require("../helper/index.cjs"),q=require("../../../util/model/index.cjs");var m=w.each,N=h.asc,V=function(){function s(e,t,r,a){this._dimName=e,this._axisIndex=t,this.ecModel=a,this._dataZoomModel=r}return _(s,"AxisProxy"),s.prototype.hostedBy=function(e){return this._dataZoomModel===e},s.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},s.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},s.prototype.getTargetSeriesModels=function(){var e=[];return this.ecModel.eachSeries(function(t){if(E.isCoordSupported(t)){var r=E.getAxisMainType(this._dimName),a=t.getReferringComponents(r,q.SINGLE_REFERRING).models[0];a&&this._axisIndex===a.componentIndex&&e.push(t)}},this),e},s.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},s.prototype.getMinMaxSpan=function(){return w.clone(this._minMaxSpan)},s.prototype.calculateDataWindow=function(e){var t=this._dataExtent,r=this.getAxisModel(),a=r.axis.scale,o=this._dataZoomModel.getRangePropMode(),n=[0,100],v=[],c=[],d;m(["start","end"],function(x,i){var u=e[x],l=e[x+"Value"];o[i]==="percent"?(u==null&&(u=n[i]),l=a.parse(h.linearMap(u,n,t))):(d=!0,l=l==null?t[i]:a.parse(l),u=h.linearMap(l,t,n)),c[i]=l==null||isNaN(l)?t[i]:l,v[i]=u==null||isNaN(u)?n[i]:u}),N(c),N(v);var f=this._minMaxSpan;d?S(c,v,t,n,!1):S(v,c,n,t,!0);function S(x,i,u,l,g){var M=g?"Span":"ValueSpan";I.default(0,x,u,"all",f["min"+M],f["max"+M]);for(var p=0;p<2;p++)i[p]=h.linearMap(x[p],u,l,!0),g&&(i[p]=a.parse(i[p]))}return _(S,"restrictSet"),{valueWindow:c,percentWindow:v}},s.prototype.reset=function(e){if(e===this._dataZoomModel){var t=this.getTargetSeriesModels();this._dataExtent=b(this,this._dimName,t),this._updateMinMaxSpan();var r=this.calculateDataWindow(e.settledOption);this._valueWindow=r.valueWindow,this._percentWindow=r.percentWindow,this._setAxisModel()}},s.prototype.filterData=function(e,t){if(e!==this._dataZoomModel)return;var r=this._dimName,a=this.getTargetSeriesModels(),o=e.get("filterMode"),n=this._valueWindow;if(o==="none")return;m(a,function(c){var d=c.getData(),f=d.mapDimensionsAll(r);if(f.length){if(o==="weakFilter"){var S=d.getStore(),x=w.map(f,function(i){return d.getDimensionIndex(i)},d);d.filterSelf(function(i){for(var u,l,g,M=0;M<f.length;M++){var p=S.get(x[M],i),y=!isNaN(p),W=p<n[0],D=p>n[1];if(y&&!W&&!D)return!0;y&&(g=!0),W&&(u=!0),D&&(l=!0)}return g&&u&&l})}else m(f,function(i){if(o==="empty")c.setData(d=d.map(i,function(l){return v(l)?l:NaN}));else{var u={};u[i]=n,d.selectRange(u)}});m(f,function(i){d.setApproximateExtent(n,i)})}});function v(c){return c>=n[0]&&c<=n[1]}_(v,"isInWindow")},s.prototype._updateMinMaxSpan=function(){var e=this._minMaxSpan={},t=this._dataZoomModel,r=this._dataExtent;m(["min","max"],function(a){var o=t.get(a+"Span"),n=t.get(a+"ValueSpan");n!=null&&(n=this.getAxisModel().axis.scale.parse(n)),n!=null?o=h.linearMap(r[0]+n,r,[0,100],!0):o!=null&&(n=h.linearMap(o,[0,100],r,!0)-r[0]),e[a+"Span"]=o,e[a+"ValueSpan"]=n},this)},s.prototype._setAxisModel=function(){var e=this.getAxisModel(),t=this._percentWindow,r=this._valueWindow;if(t){var a=h.getPixelPrecision(r,[0,500]);a=Math.min(a,20);var o=e.axis.scale.rawExtentInfo;t[0]!==0&&o.setDeterminedMinMax("min",+r[0].toFixed(a)),t[1]!==100&&o.setDeterminedMinMax("max",+r[1].toFixed(a)),o.freeze()}},s}();function b(s,e,t){var r=[1/0,-1/0];m(t,function(n){P.unionAxisExtentFromData(r,n.getData(),e)});var a=s.getAxisModel(),o=R.ensureScaleRawExtentInfo(a.axis.scale,a,r).calculate();return[o.min,o.max]}_(b,"calculateDataExtent");exports.default=V;
