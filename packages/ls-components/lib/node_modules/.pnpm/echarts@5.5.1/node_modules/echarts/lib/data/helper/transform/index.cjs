"use strict";var b=Object.defineProperty;var l=(r,t)=>b(r,"name",{value:t,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const v=require("../../../util/types/index.cjs"),S=require("../../../util/model/index.cjs"),o=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),N=require("../dataProvider/index.cjs"),A=require("../dataValueHelper/index.cjs"),c=require("../../../util/log/index.cjs"),I=require("../../Source/index.cjs");var V=function(){function r(){}return l(r,"ExternalSource"),r.prototype.getRawData=function(){throw new Error("not supported")},r.prototype.getRawDataItem=function(t){throw new Error("not supported")},r.prototype.cloneRawData=function(){},r.prototype.getDimensionInfo=function(t){},r.prototype.cloneAllDimensionInfo=function(){},r.prototype.count=function(){},r.prototype.retrieveValue=function(t,e){},r.prototype.retrieveValueFromItem=function(t,e){},r.prototype.convertValue=function(t,e){return A.parseDataValue(t,e)},r}();function M(r,t){var e=new V,s=r.data,n=e.sourceFormat=r.sourceFormat,a=r.startIndex,u="";r.seriesLayoutBy!==v.SERIES_LAYOUT_BY_COLUMN&&(process.env.NODE_ENV!=="production"&&(u='`seriesLayoutBy` of upstream dataset can only be "column" in data transform.'),c.throwError(u));var f=[],E={},h=r.dimensionsDefine;if(h)o.each(h,function(p,d){var m=p.name,R={index:d,name:m,displayName:p.displayName};if(f.push(R),m!=null){var g="";o.hasOwn(E,m)&&(process.env.NODE_ENV!=="production"&&(g='dimension name "'+m+'" duplicated.'),c.throwError(g)),E[m]=R}});else for(var i=0;i<r.dimensionsDetectedCount;i++)f.push({index:i});var w=N.getRawSourceItemGetter(n,v.SERIES_LAYOUT_BY_COLUMN);t.__isBuiltIn&&(e.getRawDataItem=function(p){return w(s,a,f,p)},e.getRawData=o.bind(x,null,r)),e.cloneRawData=o.bind(C,null,r);var _=N.getRawSourceDataCounter(n,v.SERIES_LAYOUT_BY_COLUMN);e.count=o.bind(_,null,s,a,f);var D=N.getRawSourceValueGetter(n);e.retrieveValue=function(p,d){var m=w(s,a,f,p);return O(m,d)};var O=e.retrieveValueFromItem=function(p,d){if(p!=null){var m=f[d];if(m)return D(p,d,m.name)}};return e.getDimensionInfo=o.bind(F,null,f,E),e.cloneAllDimensionInfo=o.bind(U,null,f),e}l(M,"createExternalSource");function x(r){var t=r.sourceFormat;if(!y(t)){var e="";process.env.NODE_ENV!=="production"&&(e="`getRawData` is not supported in source format "+t),c.throwError(e)}return r.data}l(x,"getRawData");function C(r){var t=r.sourceFormat,e=r.data;if(!y(t)){var s="";process.env.NODE_ENV!=="production"&&(s="`cloneRawData` is not supported in source format "+t),c.throwError(s)}if(t===v.SOURCE_FORMAT_ARRAY_ROWS){for(var n=[],a=0,u=e.length;a<u;a++)n.push(e[a].slice());return n}else if(t===v.SOURCE_FORMAT_OBJECT_ROWS){for(var n=[],a=0,u=e.length;a<u;a++)n.push(o.extend({},e[a]));return n}}l(C,"cloneRawData");function F(r,t,e){if(e!=null){if(o.isNumber(e)||!isNaN(e)&&!o.hasOwn(t,e))return r[e];if(o.hasOwn(t,e))return t[e]}}l(F,"getDimensionInfo");function U(r){return o.clone(r)}l(U,"cloneAllDimensionInfo");var T=o.createHashMap();function B(r){r=o.clone(r);var t=r.type,e="";t||(process.env.NODE_ENV!=="production"&&(e="Must have a `type` when `registerTransform`."),c.throwError(e));var s=t.split(":");s.length!==2&&(process.env.NODE_ENV!=="production"&&(e='Name must include namespace like "ns:regression".'),c.throwError(e));var n=!1;s[0]==="echarts"&&(t=s[1],n=!0),r.__isBuiltIn=n,T.set(t,r)}l(B,"registerExternalTransform");function L(r,t,e){var s=S.normalizeToArray(r),n=s.length,a="";n||(process.env.NODE_ENV!=="production"&&(a="If `transform` declared, it should at least contain one transform."),c.throwError(a));for(var u=0,f=n;u<f;u++){var E=s[u];t=Y(E,t,e,n===1?null:u),u!==f-1&&(t.length=Math.max(t.length,1))}return t}l(L,"applyDataTransform");function Y(r,t,e,s){var n="";t.length||(process.env.NODE_ENV!=="production"&&(n="Must have at least one upstream dataset."),c.throwError(n)),o.isObject(r)||(process.env.NODE_ENV!=="production"&&(n="transform declaration must be an object rather than "+typeof r+"."),c.throwError(n));var a=r.type,u=T.get(a);u||(process.env.NODE_ENV!=="production"&&(n='Can not find transform on type "'+a+'".'),c.throwError(n));var f=o.map(t,function(i){return M(i,u)}),E=S.normalizeToArray(u.transform({upstream:f[0],upstreamList:f,config:o.clone(r.config)}));if(process.env.NODE_ENV!=="production"&&r.print){var h=o.map(E,function(i){var w=s!=null?" === pipe index: "+s:"";return["=== dataset index: "+e.datasetIndex+w+" ===","- transform result data:",c.makePrintable(i.data),"- transform result dimensions:",c.makePrintable(i.dimensions)].join(`
`)}).join(`
`);c.log(h)}return o.map(E,function(i,w){var _="";o.isObject(i)||(process.env.NODE_ENV!=="production"&&(_="A transform should not return some empty results."),c.throwError(_)),i.data||(process.env.NODE_ENV!=="production"&&(_="Transform result data should be not be null or undefined"),c.throwError(_));var D=I.detectSourceFormat(i.data);y(D)||(process.env.NODE_ENV!=="production"&&(_="Transform result data should be array rows or object rows."),c.throwError(_));var O,p=t[0];if(p&&w===0&&!i.dimensions){var d=p.startIndex;d&&(i.data=p.data.slice(0,d).concat(i.data)),O={seriesLayoutBy:v.SERIES_LAYOUT_BY_COLUMN,sourceHeader:d,dimensions:p.metaRawOption.dimensions}}else O={seriesLayoutBy:v.SERIES_LAYOUT_BY_COLUMN,sourceHeader:0,dimensions:i.dimensions};return I.createSource(i.data,O,null)})}l(Y,"applySingleDataTransform");function y(r){return r===v.SOURCE_FORMAT_ARRAY_ROWS||r===v.SOURCE_FORMAT_OBJECT_ROWS}l(y,"isSupportedSourceFormat");exports.ExternalSource=V;exports.applyDataTransform=L;exports.registerExternalTransform=B;
