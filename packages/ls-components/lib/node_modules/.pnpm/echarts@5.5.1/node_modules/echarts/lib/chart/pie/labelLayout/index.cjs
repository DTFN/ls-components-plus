"use strict";var ue=Object.defineProperty;var N=(a,t)=>ue(a,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const W=require("../../../util/number/index.cjs");require("../../../util/graphic/index.cjs");const H=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),se=require("../../../label/labelGuideHelper/index.cjs"),be=require("../../../label/labelLayoutHelper/index.cjs"),ve=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/Point/index.cjs");var de=Math.PI/180;function ge(a,t,d,v,o,S,h,T,m,M){if(a.length<2)return;function A(n){for(var l=n.rB,c=l*l,u=0;u<n.list.length;u++){var g=n.list[u],x=Math.abs(g.label.y-d),b=v+g.len,p=b*b,D=Math.sqrt((1-Math.abs(x*x/c))*p),i=t+(D+g.len2)*o,f=i-g.label.x,B=g.targetTextWidth-f*o;oe(g,B,!0),g.label.x=i}}N(A,"recalculateXOnSemiToAlignOnEllipseCurve");function C(n){for(var l={list:[],maxY:0},c={list:[],maxY:0},u=0;u<n.length;u++)if(n[u].labelAlignTo==="none"){var g=n[u],x=g.label.y>d?c:l,b=Math.abs(g.label.y-d);if(b>=x.maxY){var p=g.label.x-t-g.len2*o,D=v+g.len,i=Math.abs(p)<D?Math.sqrt(b*b/(1-p*p/D/D)):D;x.rB=i,x.maxY=b}x.list.push(g)}A(l),A(c)}N(C,"recalculateX");for(var s=a.length,r=0;r<s;r++)if(a[r].position==="outer"&&a[r].labelAlignTo==="labelLine"){var e=a[r].label.x-M;a[r].linePoints[1][0]+=e,a[r].label.x=M}be.shiftLayoutOnY(a,m,m+h)&&C(a)}N(ge,"adjustSingleSide");function pe(a,t,d,v,o,S,h,T){for(var m=[],M=[],A=Number.MAX_VALUE,C=-Number.MAX_VALUE,s=0;s<a.length;s++){var r=a[s].label;ee(a[s])||(r.x<t?(A=Math.min(A,r.x),m.push(a[s])):(C=Math.max(C,r.x),M.push(a[s])))}for(var s=0;s<a.length;s++){var e=a[s];if(!ee(e)&&e.linePoints){if(e.labelStyleWidth!=null)continue;var r=e.label,n=e.linePoints,l=void 0;e.labelAlignTo==="edge"?r.x<t?l=n[2][0]-e.labelDistance-h-e.edgeDistance:l=h+o-e.edgeDistance-n[2][0]-e.labelDistance:e.labelAlignTo==="labelLine"?r.x<t?l=A-h-e.bleedMargin:l=h+o-C-e.bleedMargin:r.x<t?l=r.x-h-e.bleedMargin:l=h+o-r.x-e.bleedMargin,e.targetTextWidth=l,oe(e,l)}}ge(M,t,d,v,1,o,S,h,T,C),ge(m,t,d,v,-1,o,S,h,T,A);for(var s=0;s<a.length;s++){var e=a[s];if(!ee(e)&&e.linePoints){var r=e.label,n=e.linePoints,c=e.labelAlignTo==="edge",u=r.style.padding,g=u?u[1]+u[3]:0,x=r.style.backgroundColor?0:g,b=e.rect.width+x,p=n[1][0]-n[2][0];c?r.x<t?n[2][0]=h+e.edgeDistance+b+e.labelDistance:n[2][0]=h+o-e.edgeDistance-b-e.labelDistance:(r.x<t?n[2][0]=r.x+e.labelDistance:n[2][0]=r.x-e.labelDistance,n[1][0]=n[2][0]+p),n[1][1]=n[2][1]=r.y}}}N(pe,"avoidOverlap");function oe(a,t,d){if(d===void 0&&(d=!1),a.labelStyleWidth==null){var v=a.label,o=v.style,S=a.rect,h=o.backgroundColor,T=o.padding,m=T?T[1]+T[3]:0,M=o.overflow,A=S.width+(h?0:m);if(t<A||d){var C=S.height;if(M&&M.match("break")){v.setStyle("backgroundColor",null),v.setStyle("width",t-m);var s=v.getBoundingRect();v.setStyle("width",Math.ceil(s.width)),v.setStyle("backgroundColor",h)}else{var r=t-m,e=t<A?r:d?r>a.unconstrainedWidth?null:r:null;v.setStyle("width",e)}var n=v.getBoundingRect();S.width=n.width;var l=(v.style.margin||0)+2.1;S.height=n.height+l,S.y-=(S.height-C)/2}}}N(oe,"constrainTextWidth");function ee(a){return a.position==="center"}N(ee,"isPositionCenter");function Me(a){var t=a.getData(),d=[],v,o,S=!1,h=(a.get("minShowLabelAngle")||0)*de,T=t.getLayout("viewRect"),m=t.getLayout("r"),M=T.width,A=T.x,C=T.y,s=T.height;function r(p){p.ignore=!0}N(r,"setNotShow");function e(p){if(!p.ignore)return!0;for(var D in p.states)if(p.states[D].ignore===!1)return!0;return!1}N(e,"isLabelShown"),t.each(function(p){var D=t.getItemGraphicEl(p),i=D.shape,f=D.getTextContent(),B=D.getTextGuideLine(),z=t.getItemModel(p),O=z.getModel("label"),q=O.get("position")||z.get(["emphasis","label","position"]),F=O.get("distanceToLabelLine"),J=O.get("alignTo"),K=W.parsePercent(O.get("edgeDistance"),M),fe=O.get("bleedMargin"),j=z.getModel("labelLine"),k=j.get("length");k=W.parsePercent(k,M);var R=j.get("length2");if(R=W.parsePercent(R,M),Math.abs(i.endAngle-i.startAngle)<h){H.each(f.states,r),f.ignore=!0,B&&(H.each(B.states,r),B.ignore=!0);return}if(e(f)){var U=(i.startAngle+i.endAngle)/2,P=Math.cos(U),w=Math.sin(U),I,V,re,y;v=i.cx,o=i.cy;var L=q==="inside"||q==="inner";if(q==="center")I=i.cx,V=i.cy,y="center";else{var Q=(L?(i.r+i.r0)/2*P:i.r*P)+v,Z=(L?(i.r+i.r0)/2*w:i.r*w)+o;if(I=Q+P*3,V=Z+w*3,!L){var ae=Q+P*(k+m-i.r),ne=Z+w*(k+m-i.r),te=ae+(P<0?-1:1)*R,le=ne;J==="edge"?I=P<0?A+K:A+M-K:I=te+(P<0?-F:F),V=le,re=[[Q,Z],[ae,ne],[te,le]]}y=L?"center":J==="edge"?P>0?"right":"left":P>0?"left":"right"}var X=Math.PI,Y=0,E=O.get("rotate");if(H.isNumber(E))Y=E*(X/180);else if(q==="center")Y=0;else if(E==="radial"||E===!0){var he=P<0?-U+X:-U;Y=he}else if(E==="tangential"&&q!=="outside"&&q!=="outer"){var _=Math.atan2(P,w);_<0&&(_=X*2+_);var ce=w>0;ce&&(_=X+_),Y=_-X}if(S=!!Y,f.x=I,f.y=V,f.rotation=Y,f.setStyle({verticalAlign:"middle"}),L){f.setStyle({align:y});var $=f.states.select;$&&($.x+=f.x,$.y+=f.y)}else{var G=f.getBoundingRect().clone();G.applyTransform(f.getComputedTransform());var ie=(f.style.margin||0)+2.1;G.y-=ie/2,G.height+=ie,d.push({label:f,labelLine:B,position:q,len:k,len2:R,minTurnAngle:j.get("minTurnAngle"),maxSurfaceAngle:j.get("maxSurfaceAngle"),surfaceNormal:new ve.default(P,w),linePoints:re,textAlign:y,labelDistance:F,labelAlignTo:J,edgeDistance:K,bleedMargin:fe,rect:G,unconstrainedWidth:G.width,labelStyleWidth:f.style.width})}D.setTextConfig({inside:L})}}),!S&&a.get("avoidLabelOverlap")&&pe(d,v,o,m,M,s,A,C);for(var n=0;n<d.length;n++){var l=d[n],c=l.label,u=l.labelLine,g=isNaN(c.x)||isNaN(c.y);if(c){c.setStyle({align:l.textAlign}),g&&(H.each(c.states,r),c.ignore=!0);var x=c.states.select;x&&(x.x+=c.x,x.y+=c.y)}if(u){var b=l.linePoints;g||!b?(H.each(u.states,r),u.ignore=!0):(se.limitTurnAngle(b,l.minTurnAngle),se.limitSurfaceAngle(b,l.surfaceNormal,l.maxSurfaceAngle),u.setShape({points:b}),c.__hostTarget.textGuideLineConfig={anchor:new ve.default(b[0][0],b[0][1])})}}}N(Me,"pieLabelLayout");exports.default=Me;
