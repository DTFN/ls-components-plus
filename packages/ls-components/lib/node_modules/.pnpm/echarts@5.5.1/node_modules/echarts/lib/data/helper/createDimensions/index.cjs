"use strict";var W=Object.defineProperty;var g=(n,a)=>W(n,"name",{value:a,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Z=require("../../../util/types/index.cjs"),k=require("../../SeriesDimensionDefine/index.cjs"),t=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),z=require("../../Source/index.cjs"),G=require("../../DataStore/index.cjs"),F=require("../../../util/model/index.cjs"),K=require("../sourceHelper/index.cjs"),b=require("../SeriesDataSchema/index.cjs");function J(n,a){z.isSourceInstance(n)||(n=z.createSourceFromSeriesDataOption(n)),a=a||{};var v=a.coordDimensions||[],l=a.dimensionsDefine||n.dimensionsDefine||[],d=t.createHashMap(),s=[],u=X(n,v,l,a.dimensionsCount),A=a.canOmitUnusedDimensions&&b.shouldOmitUnusedDimensions(u),j=l===n.dimensionsDefine,x=j?b.ensureSourceDimNameMap(n):b.createDimNameMap(l),T=a.encodeDefine;!T&&a.encodeDefaulter&&(T=a.encodeDefaulter(n,u));for(var N=t.createHashMap(T),q=new G.CtorInt32Array(u),p=0;p<q.length;p++)q[p]=-1;function S(i){var r=q[i];if(r<0){var o=l[i],c=t.isObject(o)?o:{name:o},e=new k.default,D=c.name;D!=null&&x.get(D)!=null&&(e.name=e.displayName=D),c.type!=null&&(e.type=c.type),c.displayName!=null&&(e.displayName=c.displayName);var f=s.length;return q[i]=f,e.storeDimIndex=i,s.push(e),e}return s[r]}if(g(S,"getResultItem"),!A)for(var p=0;p<u;p++)S(p);N.each(function(i,r){var o=F.normalizeToArray(i).slice();if(o.length===1&&!t.isString(o[0])&&o[0]<0){N.set(r,!1);return}var c=N.set(r,[]);t.each(o,function(e,D){var f=t.isString(e)?x.get(e):e;f!=null&&f<u&&(c[D]=f,E(S(f),r,D))})});var M=0;t.each(v,function(i){var r,o,c,e;if(t.isString(i))r=i,e={};else{e=i,r=e.name;var D=e.ordinalMeta;e.ordinalMeta=null,e=t.extend({},e),e.ordinalMeta=D,o=e.dimsDef,c=e.otherDims,e.name=e.coordDim=e.coordDimIndex=e.dimsDef=e.otherDims=null}var f=N.get(r);if(f!==!1){if(f=F.normalizeToArray(f),!f.length)for(var _=0;_<(o&&o.length||1);_++){for(;M<u&&S(M).coordDim!=null;)M++;M<u&&f.push(M++)}t.each(f,function(V,L){var m=S(V);if(j&&e.type!=null&&(m.type=e.type),E(t.defaults(m,e),r,L),m.name==null&&o){var C=o[L];!t.isObject(C)&&(C={name:C}),m.name=m.displayName=C.name,m.defaultTooltip=C.defaultTooltip}c&&t.defaults(m.otherDims,c)})}});function E(i,r,o){Z.VISUAL_DIMENSIONS.get(r)!=null?i.otherDims[r]=o:(i.coordDim=r,i.coordDimIndex=o,d.set(r,!0))}g(E,"applyDim");var U=a.generateCoord,y=a.generateCoordCount,w=y!=null;y=U?y||1:0;var B=U||"value";function H(i){i.name==null&&(i.name=i.coordDim)}if(g(H,"ifNoNameFillWithCoordName"),A)t.each(s,function(i){H(i)}),s.sort(function(i,r){return i.storeDimIndex-r.storeDimIndex});else for(var O=0;O<u;O++){var h=S(O),P=h.coordDim;P==null&&(h.coordDim=Y(B,d,w),h.coordDimIndex=0,(!U||y<=0)&&(h.isExtraCoord=!0),y--),H(h),h.type==null&&(K.guessOrdinal(n,O)===K.BE_ORDINAL.Must||h.isExtraCoord&&(h.otherDims.itemName!=null||h.otherDims.seriesName!=null))&&(h.type="ordinal")}return Q(s),new b.SeriesDataSchema({source:n,dimensions:s,fullDimensionCount:u,dimensionOmitted:A})}g(J,"prepareSeriesDataSchema");function Q(n){for(var a=t.createHashMap(),v=0;v<n.length;v++){var l=n[v],d=l.name,s=a.get(d)||0;s>0&&(l.name=d+(s-1)),s++,a.set(d,s)}}g(Q,"removeDuplication");function X(n,a,v,l){var d=Math.max(n.dimensionsDetectedCount||1,a.length,v.length,l||0);return t.each(a,function(s){var u;t.isObject(s)&&(u=s.dimsDef)&&(d=Math.max(d,u.length))}),d}g(X,"getDimCount");function Y(n,a,v){if(v||a.hasKey(n)){for(var l=0;a.hasKey(n+l);)l++;n+=l}return a.set(n,!0),n}g(Y,"genCoordDimName");exports.default=J;
