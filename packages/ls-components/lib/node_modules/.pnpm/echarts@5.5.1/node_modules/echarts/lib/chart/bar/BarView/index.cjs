"use strict";var de=Object.defineProperty;var l=(i,r)=>de(i,"name",{value:r,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const ae=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),le=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Path/index.cjs"),ge=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),O=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),ve=require("../../../util/graphic/index.cjs"),T=require("../../../util/innerStore/index.cjs"),U=require("../../../util/states/index.cjs"),k=require("../../../label/labelStyle/index.cjs"),fe=require("../../../util/throttle/index.cjs"),me=require("../../helper/createClipPathFromCoordSys/index.cjs"),Y=require("../../../util/shape/sausage/index.cjs"),_e=require("../../../view/Chart/index.cjs"),ie=require("../../../coord/CoordinateSystem/index.cjs"),Z=require("../../helper/labelHelper/index.cjs"),F=require("../../../util/log/index.cjs"),ne=require("../../../label/sectorLabel/index.cjs"),b=require("../../../animation/basicTransition/index.cjs"),be=require("../../helper/sectorHelper/index.cjs"),se=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Rect/index.cjs"),oe=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Sector/index.cjs");var R=Math.max,W=Math.min;function ye(i,r){var e=i.getArea&&i.getArea();if(ie.isCoordinateSystemType(i,"cartesian2d")){var t=i.getBaseAxis();if(t.type!=="category"||!t.onBand){var a=r.getLayout("bandWidth");t.isHorizontal()?(e.x-=a,e.width+=a*2):(e.y-=a,e.height+=a*2)}}return e}l(ye,"getClipArea");var Ae=function(i){ae.__extends(r,i);function r(){var e=i.call(this)||this;return e.type=r.type,e._isFirstFrame=!0,e}return l(r,"BarView"),r.prototype.render=function(e,t,a,n){this._model=e,this._removeOnRenderedListener(a),this._updateDrawMode(e);var o=e.get("coordinateSystem");o==="cartesian2d"||o==="polar"?(this._progressiveEls=null,this._isLargeDraw?this._renderLarge(e,t,a):this._renderNormal(e,t,a,n)):process.env.NODE_ENV!=="production"&&F.warn("Only cartesian2d and polar supported for bar.")},r.prototype.incrementalPrepareRender=function(e){this._clear(),this._updateDrawMode(e),this._updateLargeClip(e)},r.prototype.incrementalRender=function(e,t){this._progressiveEls=[],this._incrementalRenderLarge(e,t)},r.prototype.eachRendered=function(e){ve.traverseElements(this._progressiveEls||this.group,e)},r.prototype._updateDrawMode=function(e){var t=e.pipelineContext.large;(this._isLargeDraw==null||t!==this._isLargeDraw)&&(this._isLargeDraw=t,this._clear())},r.prototype._renderNormal=function(e,t,a,n){var o=this.group,s=e.getData(),p=this._data,h=e.coordinateSystem,u=h.getBaseAxis(),c;h.type==="cartesian2d"?c=u.isHorizontal():h.type==="polar"&&(c=u.dim==="angle");var _=e.isAnimationEnabled()?e:null,g=xe(e,h);g&&this._enableRealtimeSort(g,s,a);var S=e.get("clip",!0)||g,C=ye(h,s);o.removeClipPath();var w=e.get("roundCap",!0),D=e.get("showBackground",!0),x=e.getModel("backgroundStyle"),P=x.get("borderRadius")||0,L=[],B=this._backgroundEls,G=n&&n.isInitSort,M=n&&n.type==="changeAxisOrder";function X(d){var y=I[h.type](s,d),v=Ie(h,c,y);return v.useStyle(x.getItemStyle()),h.type==="cartesian2d"?v.setShape("r",P):v.setShape("cornerRadius",P),L[d]=v,v}l(X,"createBackground"),s.diff(p).add(function(d){var y=s.getItemModel(d),v=I[h.type](s,d,y);if(D&&X(d),!(!s.hasValue(d)||!Q[h.type](v))){var A=!1;S&&(A=j[h.type](C,v));var f=H[h.type](e,s,d,v,c,_,u.model,!1,w);g&&(f.forceLabelAnimation=!0),$(f,s,d,y,v,e,c,h.type==="polar"),G?f.attr({shape:v}):g?J(g,_,f,v,d,c,!1,!1):b.initProps(f,{shape:v},e,d),s.setItemGraphicEl(d,f),o.add(f),f.ignore=A}}).update(function(d,y){var v=s.getItemModel(d),A=I[h.type](s,d,v);if(D){var f=void 0;B.length===0?f=X(y):(f=B[y],f.useStyle(x.getItemStyle()),h.type==="cartesian2d"?f.setShape("r",P):f.setShape("cornerRadius",P),L[d]=f);var pe=I[h.type](s,d),ce=ue(c,pe,h);b.updateProps(f,{shape:ce},_,d)}var m=p.getItemGraphicEl(y);if(!s.hasValue(d)||!Q[h.type](A)){o.remove(m);return}var E=!1;if(S&&(E=j[h.type](C,A),E&&o.remove(m)),m?b.saveOldStyle(m):m=H[h.type](e,s,d,A,c,_,u.model,!!m,w),g&&(m.forceLabelAnimation=!0),M){var z=m.getTextContent();if(z){var q=k.labelInner(z);q.prevValue!=null&&(q.prevValue=q.value)}}else $(m,s,d,v,A,e,c,h.type==="polar");G?m.attr({shape:A}):g?J(g,_,m,A,d,c,!0,M):b.updateProps(m,{shape:A},e,d,null),s.setItemGraphicEl(d,m),m.ignore=E,o.add(m)}).remove(function(d){var y=p.getItemGraphicEl(d);y&&b.removeElementWithFadeOut(y,e,d)}).execute();var V=this._backgroundGroup||(this._backgroundGroup=new ge.default);V.removeAll();for(var N=0;N<L.length;++N)V.add(L[N]);o.add(V),this._backgroundEls=L,this._data=s},r.prototype._renderLarge=function(e,t,a){this._clear(),te(e,this.group),this._updateLargeClip(e)},r.prototype._incrementalRenderLarge=function(e,t){this._removeBackground(),te(t,this.group,this._progressiveEls,!0)},r.prototype._updateLargeClip=function(e){var t=e.get("clip",!0)&&me.createClipPath(e.coordinateSystem,!1,e),a=this.group;t?a.setClipPath(t):a.removeClipPath()},r.prototype._enableRealtimeSort=function(e,t,a){var n=this;if(t.count()){var o=e.baseAxis;if(this._isFirstFrame)this._dispatchInitSort(t,e,a),this._isFirstFrame=!1;else{var s=l(function(p){var h=t.getItemGraphicEl(p),u=h&&h.shape;return u&&Math.abs(o.isHorizontal()?u.height:u.width)||0},"orderMapping_1");this._onRendered=function(){n._updateSortWithinSameData(t,s,o,a)},a.getZr().on("rendered",this._onRendered)}}},r.prototype._dataSort=function(e,t,a){var n=[];return e.each(e.mapDimension(t.dim),function(o,s){var p=a(s);p=p??NaN,n.push({dataIndex:s,mappedValue:p,ordinalNumber:o})}),n.sort(function(o,s){return s.mappedValue-o.mappedValue}),{ordinalNumbers:O.map(n,function(o){return o.ordinalNumber})}},r.prototype._isOrderChangedWithinSameData=function(e,t,a){for(var n=a.scale,o=e.mapDimension(a.dim),s=Number.MAX_VALUE,p=0,h=n.getOrdinalMeta().categories.length;p<h;++p){var u=e.rawIndexOf(o,n.getRawOrdinalNumber(p)),c=u<0?Number.MIN_VALUE:t(e.indexOfRawIndex(u));if(c>s)return!0;s=c}return!1},r.prototype._isOrderDifferentInView=function(e,t){for(var a=t.scale,n=a.getExtent(),o=Math.max(0,n[0]),s=Math.min(n[1],a.getOrdinalMeta().categories.length-1);o<=s;++o)if(e.ordinalNumbers[o]!==a.getRawOrdinalNumber(o))return!0},r.prototype._updateSortWithinSameData=function(e,t,a,n){if(this._isOrderChangedWithinSameData(e,t,a)){var o=this._dataSort(e,a,t);this._isOrderDifferentInView(o,a)&&(this._removeOnRenderedListener(n),n.dispatchAction({type:"changeAxisOrder",componentType:a.dim+"Axis",axisId:a.index,sortInfo:o}))}},r.prototype._dispatchInitSort=function(e,t,a){var n=t.baseAxis,o=this._dataSort(e,n,function(s){return e.get(e.mapDimension(t.otherAxis.dim),s)});a.dispatchAction({type:"changeAxisOrder",componentType:n.dim+"Axis",isInitSort:!0,axisId:n.index,sortInfo:o})},r.prototype.remove=function(e,t){this._clear(this._model),this._removeOnRenderedListener(t)},r.prototype.dispose=function(e,t){this._removeOnRenderedListener(t)},r.prototype._removeOnRenderedListener=function(e){this._onRendered&&(e.getZr().off("rendered",this._onRendered),this._onRendered=null)},r.prototype._clear=function(e){var t=this.group,a=this._data;e&&e.isAnimationEnabled()&&a&&!this._isLargeDraw?(this._removeBackground(),this._backgroundEls=[],a.eachItemGraphicEl(function(n){b.removeElementWithFadeOut(n,e,T.getECData(n).dataIndex)})):t.removeAll(),this._data=null,this._isFirstFrame=!0},r.prototype._removeBackground=function(){this.group.remove(this._backgroundGroup),this._backgroundGroup=null},r.type="bar",r}(_e.default),j={cartesian2d:l(function(i,r){var e=r.width<0?-1:1,t=r.height<0?-1:1;e<0&&(r.x+=r.width,r.width=-r.width),t<0&&(r.y+=r.height,r.height=-r.height);var a=i.x+i.width,n=i.y+i.height,o=R(r.x,i.x),s=W(r.x+r.width,a),p=R(r.y,i.y),h=W(r.y+r.height,n),u=s<o,c=h<p;return r.x=u&&o>a?s:o,r.y=c&&p>n?h:p,r.width=u?0:s-o,r.height=c?0:h-p,e<0&&(r.x+=r.width,r.width=-r.width),t<0&&(r.y+=r.height,r.height=-r.height),u||c},"cartesian2d"),polar:l(function(i,r){var e=r.r0<=r.r?1:-1;if(e<0){var t=r.r;r.r=r.r0,r.r0=t}var a=W(r.r,i.r),n=R(r.r0,i.r0);r.r=a,r.r0=n;var o=a-n<0;if(e<0){var t=r.r;r.r=r.r0,r.r0=t}return o},"polar")},H={cartesian2d:l(function(i,r,e,t,a,n,o,s,p){var h=new se.default({shape:O.extend({},t),z2:1});if(h.__dataIndex=e,h.name="item",n){var u=h.shape,c=a?"height":"width";u[c]=0}return h},"cartesian2d"),polar:l(function(i,r,e,t,a,n,o,s,p){var h=!a&&p?Y.default:oe.default,u=new h({shape:t,z2:1});u.name="item";var c=he(a);if(u.calculateTextPosition=ne.createSectorCalculateTextPosition(c,{isRoundCap:h===Y.default}),n){var _=u.shape,g=a?"r":"endAngle",S={};_[g]=a?t.r0:t.startAngle,S[g]=t[g],(s?b.updateProps:b.initProps)(u,{shape:S},n)}return u},"polar")};function xe(i,r){var e=i.get("realtimeSort",!0),t=r.getBaseAxis();if(process.env.NODE_ENV!=="production"&&e&&(t.type!=="category"&&F.warn("`realtimeSort` will not work because this bar series is not based on a category axis."),r.type!=="cartesian2d"&&F.warn("`realtimeSort` will not work because this bar series is not on cartesian2d.")),e&&t.type==="category"&&r.type==="cartesian2d")return{baseAxis:t,otherAxis:r.getOtherAxis(t)}}l(xe,"shouldRealtimeSort");function J(i,r,e,t,a,n,o,s){var p,h;n?(h={x:t.x,width:t.width},p={y:t.y,height:t.height}):(h={y:t.y,height:t.height},p={x:t.x,width:t.width}),s||(o?b.updateProps:b.initProps)(e,{shape:p},r,a,null);var u=r?i.baseAxis.model:null;(o?b.updateProps:b.initProps)(e,{shape:h},u,a)}l(J,"updateRealtimeAnimation");function K(i,r){for(var e=0;e<r.length;e++)if(!isFinite(i[r[e]]))return!0;return!1}l(K,"checkPropertiesNotValid");var Se=["x","y","width","height"],we=["cx","cy","r","startAngle","endAngle"],Q={cartesian2d:l(function(i){return!K(i,Se)},"cartesian2d"),polar:l(function(i){return!K(i,we)},"polar")},I={cartesian2d:l(function(i,r,e){var t=i.getItemLayout(r),a=e?Ce(e,t):0,n=t.width>0?1:-1,o=t.height>0?1:-1;return{x:t.x+n*a/2,y:t.y+o*a/2,width:t.width-n*a,height:t.height-o*a}},"cartesian2d"),polar:l(function(i,r,e){var t=i.getItemLayout(r);return{cx:t.cx,cy:t.cy,r0:t.r0,r:t.r,startAngle:t.startAngle,endAngle:t.endAngle,clockwise:t.clockwise}},"polar")};function De(i){return i.startAngle!=null&&i.endAngle!=null&&i.startAngle===i.endAngle}l(De,"isZeroOnPolar");function he(i){return function(r){var e=r?"Arc":"Angle";return function(t){switch(t){case"start":case"insideStart":case"end":case"insideEnd":return t+e;default:return t}}}(i)}l(he,"createPolarPositionMapping");function $(i,r,e,t,a,n,o,s){var p=r.getItemVisual(e,"style");if(s){if(!n.get("roundCap")){var u=i.shape,c=be.getSectorCornerRadius(t.getModel("itemStyle"),u,!0);O.extend(u,c),i.setShape(u)}}else{var h=t.get(["itemStyle","borderRadius"])||0;i.setShape("r",h)}i.useStyle(p);var _=t.getShallow("cursor");_&&i.attr("cursor",_);var g=s?o?a.r>=a.r0?"endArc":"startArc":a.endAngle>=a.startAngle?"endAngle":"startAngle":o?a.height>=0?"bottom":"top":a.width>=0?"right":"left",S=k.getLabelStatesModels(t);k.setLabelStyle(i,S,{labelFetcher:n,labelDataIndex:e,defaultText:Z.getDefaultLabel(n.getData(),e),inheritColor:p.fill,defaultOpacity:p.opacity,defaultOutsidePosition:g});var C=i.getTextContent();if(s&&C){var w=t.get(["label","position"]);i.textConfig.inside=w==="middle"?!0:null,ne.setSectorTextRotation(i,w==="outside"?g:w,he(o),t.get(["label","rotate"]))}k.setLabelValueAnimation(C,S,n.getRawValue(e),function(x){return Z.getDefaultInterpolatedLabel(r,x)});var D=t.getModel(["emphasis"]);U.toggleHoverEmphasis(i,D.get("focus"),D.get("blurScope"),D.get("disabled")),U.setStatesStylesFromModel(i,t),De(a)&&(i.style.fill="none",i.style.stroke="none",O.each(i.states,function(x){x.style&&(x.style.fill=x.style.stroke="none")}))}l($,"updateStyle");function Ce(i,r){var e=i.get(["itemStyle","borderColor"]);if(!e||e==="none")return 0;var t=i.get(["itemStyle","borderWidth"])||0,a=isNaN(r.width)?Number.MAX_VALUE:Math.abs(r.width),n=isNaN(r.height)?Number.MAX_VALUE:Math.abs(r.height);return Math.min(t,a,n)}l(Ce,"getLineWidth");var Le=function(){function i(){}return l(i,"LagePathShape"),i}(),ee=function(i){ae.__extends(r,i);function r(e){var t=i.call(this,e)||this;return t.type="largeBar",t}return l(r,"LargePath"),r.prototype.getDefaultShape=function(){return new Le},r.prototype.buildPath=function(e,t){for(var a=t.points,n=this.baseDimIdx,o=1-this.baseDimIdx,s=[],p=[],h=this.barWidth,u=0;u<a.length;u+=3)p[n]=h,p[o]=a[u+2],s[n]=a[u+n],s[o]=a[u+o],e.rect(s[0],s[1],p[0],p[1])},r}(le.default);function te(i,r,e,t){var a=i.getData(),n=a.getLayout("valueAxisHorizontal")?1:0,o=a.getLayout("largeDataIndices"),s=a.getLayout("size"),p=i.getModel("backgroundStyle"),h=a.getLayout("largeBackgroundPoints");if(h){var u=new ee({shape:{points:h},incremental:!!t,silent:!0,z2:0});u.baseDimIdx=n,u.largeDataIndices=o,u.barWidth=s,u.useStyle(p.getItemStyle()),r.add(u),e&&e.push(u)}var c=new ee({shape:{points:a.getLayout("largePoints")},incremental:!!t,ignoreCoarsePointer:!0,z2:1});c.baseDimIdx=n,c.largeDataIndices=o,c.barWidth=s,r.add(c),c.useStyle(a.getVisual("style")),T.getECData(c).seriesIndex=i.seriesIndex,i.get("silent")||(c.on("mousedown",re),c.on("mousemove",re)),e&&e.push(c)}l(te,"createLarge");var re=fe.throttle(function(i){var r=this,e=Pe(r,i.offsetX,i.offsetY);T.getECData(r).dataIndex=e>=0?e:null},30,!1);function Pe(i,r,e){for(var t=i.baseDimIdx,a=1-t,n=i.shape.points,o=i.largeDataIndices,s=[],p=[],h=i.barWidth,u=0,c=n.length/3;u<c;u++){var _=u*3;if(p[t]=h,p[a]=n[_+2],s[t]=n[_+t],s[a]=n[_+a],p[a]<0&&(s[a]+=p[a],p[a]=-p[a]),r>=s[0]&&r<=s[0]+p[0]&&e>=s[1]&&e<=s[1]+p[1])return o[u]}return-1}l(Pe,"largePathFindDataIndex");function ue(i,r,e){if(ie.isCoordinateSystemType(e,"cartesian2d")){var t=r,a=e.getArea();return{x:i?t.x:a.x,y:i?a.y:t.y,width:i?t.width:a.width,height:i?a.height:t.height}}else{var a=e.getArea(),n=r;return{cx:a.cx,cy:a.cy,r0:i?a.r0:n.r0,r:i?a.r:n.r,startAngle:i?n.startAngle:0,endAngle:i?n.endAngle:Math.PI*2}}}l(ue,"createBackgroundShape");function Ie(i,r,e){var t=i.type==="polar"?oe.default:se.default;return new t({shape:ue(r,e,i),silent:!0,z2:0})}l(Ie,"createBackgroundEl");exports.default=Ae;
