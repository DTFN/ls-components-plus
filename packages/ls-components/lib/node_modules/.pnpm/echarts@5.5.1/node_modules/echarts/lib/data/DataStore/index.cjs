"use strict";var T=Object.defineProperty;var m=(u,t)=>T(u,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const d=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),G=require("../helper/dataValueHelper/index.cjs"),B=require("../Source/index.cjs");var x="undefined",P=typeof Uint32Array===x?Array:Uint32Array,b=typeof Uint16Array===x?Array:Uint16Array,z=typeof Int32Array===x?Array:Int32Array,F=typeof Float64Array===x?Array:Float64Array,q={float:F,int:z,ordinal:Array,number:Array,time:F},U;function k(u){return u>65535?P:b}m(k,"getIndicesCtor");function S(){return[1/0,-1/0]}m(S,"getInitialExtent");function H(u){var t=u.constructor;return t===Array?u.slice():new t(u)}m(H,"cloneChunk");function O(u,t,r,e,a){var n=q[r||"float"];if(a){var i=u[t],s=i&&i.length;if(s!==e){for(var o=new n(e),v=0;v<s;v++)o[v]=i[v];u[t]=o}}else u[t]=new n(e)}m(O,"prepareStore");var L=function(){function u(){this._chunks=[],this._rawExtent=[],this._extent=[],this._count=0,this._rawCount=0,this._calcDimNameToIdx=d.createHashMap()}return m(u,"DataStore"),u.prototype.initData=function(t,r,e){process.env.NODE_ENV!=="production"&&d.assert(d.isFunction(t.getItem)&&d.isFunction(t.count),"Invalid data provider."),this._provider=t,this._chunks=[],this._indices=null,this.getRawIndex=this._getRawIdxIdentity;var a=t.getSource(),n=this.defaultDimValueGetter=U[a.sourceFormat];this._dimValueGetter=e||n,this._rawExtent=[];var i=B.shouldRetrieveDataByName(a);this._dimensions=d.map(r,function(s){return process.env.NODE_ENV!=="production"&&i&&d.assert(s.property!=null),{type:s.type,property:s.property}}),this._initDataFromProvider(0,t.count())},u.prototype.getProvider=function(){return this._provider},u.prototype.getSource=function(){return this._provider.getSource()},u.prototype.ensureCalculationDimension=function(t,r){var e=this._calcDimNameToIdx,a=this._dimensions,n=e.get(t);if(n!=null){if(a[n].type===r)return n}else n=a.length;return a[n]={type:r},e.set(t,n),this._chunks[n]=new q[r||"float"](this._rawCount),this._rawExtent[n]=S(),n},u.prototype.collectOrdinalMeta=function(t,r){var e=this._chunks[t],a=this._dimensions[t],n=this._rawExtent,i=a.ordinalOffset||0,s=e.length;i===0&&(n[t]=S());for(var o=n[t],v=i;v<s;v++){var h=e[v]=r.parseAndCollect(e[v]);isNaN(h)||(o[0]=Math.min(h,o[0]),o[1]=Math.max(h,o[1]))}a.ordinalMeta=r,a.ordinalOffset=s,a.type="ordinal"},u.prototype.getOrdinalMeta=function(t){var r=this._dimensions[t],e=r.ordinalMeta;return e},u.prototype.getDimensionProperty=function(t){var r=this._dimensions[t];return r&&r.property},u.prototype.appendData=function(t){process.env.NODE_ENV!=="production"&&d.assert(!this._indices,"appendData can only be called on raw data.");var r=this._provider,e=this.count();r.appendData(t);var a=r.count();return r.persistent||(a+=e),e<a&&this._initDataFromProvider(e,a,!0),[e,a]},u.prototype.appendValues=function(t,r){for(var e=this._chunks,a=this._dimensions,n=a.length,i=this._rawExtent,s=this.count(),o=s+Math.max(t.length,r||0),v=0;v<n;v++){var h=a[v];O(e,v,h.type,o,!0)}for(var y=[],_=s;_<o;_++)for(var f=_-s,c=0;c<n;c++){var h=a[c],w=U.arrayRows.call(this,t[f]||y,h.property,f,c);e[c][_]=w;var l=i[c];w<l[0]&&(l[0]=w),w>l[1]&&(l[1]=w)}return this._rawCount=this._count=o,{start:s,end:o}},u.prototype._initDataFromProvider=function(t,r,e){for(var a=this._provider,n=this._chunks,i=this._dimensions,s=i.length,o=this._rawExtent,v=d.map(i,function(g){return g.property}),h=0;h<s;h++){var y=i[h];o[h]||(o[h]=S()),O(n,h,y.type,r,e)}if(a.fillStorage)a.fillStorage(t,r,n,o);else for(var _=[],f=t;f<r;f++){_=a.getItem(f,_);for(var c=0;c<s;c++){var w=n[c],l=this._dimValueGetter(_,v[c],f,c);w[f]=l;var p=o[c];l<p[0]&&(p[0]=l),l>p[1]&&(p[1]=l)}}!a.persistent&&a.clean&&a.clean(),this._rawCount=this._count=r,this._extent=[]},u.prototype.count=function(){return this._count},u.prototype.get=function(t,r){if(!(r>=0&&r<this._count))return NaN;var e=this._chunks[t];return e?e[this.getRawIndex(r)]:NaN},u.prototype.getValues=function(t,r){var e=[],a=[];if(r==null){r=t,t=[];for(var n=0;n<this._dimensions.length;n++)a.push(n)}else a=t;for(var n=0,i=a.length;n<i;n++)e.push(this.get(a[n],r));return e},u.prototype.getByRawIndex=function(t,r){if(!(r>=0&&r<this._rawCount))return NaN;var e=this._chunks[t];return e?e[r]:NaN},u.prototype.getSum=function(t){var r=this._chunks[t],e=0;if(r)for(var a=0,n=this.count();a<n;a++){var i=this.get(t,a);isNaN(i)||(e+=i)}return e},u.prototype.getMedian=function(t){var r=[];this.each([t],function(n){isNaN(n)||r.push(n)});var e=r.sort(function(n,i){return n-i}),a=this.count();return a===0?0:a%2===1?e[(a-1)/2]:(e[a/2]+e[a/2-1])/2},u.prototype.indexOfRawIndex=function(t){if(t>=this._rawCount||t<0)return-1;if(!this._indices)return t;var r=this._indices,e=r[t];if(e!=null&&e<this._count&&e===t)return t;for(var a=0,n=this._count-1;a<=n;){var i=(a+n)/2|0;if(r[i]<t)a=i+1;else if(r[i]>t)n=i-1;else return i}return-1},u.prototype.indicesOfNearest=function(t,r,e){var a=this._chunks,n=a[t],i=[];if(!n)return i;e==null&&(e=1/0);for(var s=1/0,o=-1,v=0,h=0,y=this.count();h<y;h++){var _=this.getRawIndex(h),f=r-n[_],c=Math.abs(f);c<=e&&((c<s||c===s&&f>=0&&o<0)&&(s=c,o=f,v=0),f===o&&(i[v++]=h))}return i.length=v,i},u.prototype.getIndices=function(){var t,r=this._indices;if(r){var e=r.constructor,a=this._count;if(e===Array){t=new e(a);for(var n=0;n<a;n++)t[n]=r[n]}else t=new e(r.buffer,0,a)}else{var e=k(this._rawCount);t=new e(this.count());for(var n=0;n<t.length;n++)t[n]=n}return t},u.prototype.filter=function(t,r){if(!this._count)return this;for(var e=this.clone(),a=e.count(),n=k(e._rawCount),i=new n(a),s=[],o=t.length,v=0,h=t[0],y=e._chunks,_=0;_<a;_++){var f=void 0,c=e.getRawIndex(_);if(o===0)f=r(_);else if(o===1){var w=y[h][c];f=r(w,_)}else{for(var l=0;l<o;l++)s[l]=y[t[l]][c];s[l]=_,f=r.apply(null,s)}f&&(i[v++]=c)}return v<a&&(e._indices=i),e._count=v,e._extent=[],e._updateGetRawIdx(),e},u.prototype.selectRange=function(t){var r=this.clone(),e=r._count;if(!e)return this;var a=d.keys(t),n=a.length;if(!n)return this;var i=r.count(),s=k(r._rawCount),o=new s(i),v=0,h=a[0],y=t[h][0],_=t[h][1],f=r._chunks,c=!1;if(!r._indices){var w=0;if(n===1){for(var l=f[a[0]],p=0;p<e;p++){var g=l[p];(g>=y&&g<=_||isNaN(g))&&(o[v++]=w),w++}c=!0}else if(n===2){for(var l=f[a[0]],D=f[a[1]],I=t[a[1]][0],A=t[a[1]][1],p=0;p<e;p++){var g=l[p],N=D[p];(g>=y&&g<=_||isNaN(g))&&(N>=I&&N<=A||isNaN(N))&&(o[v++]=w),w++}c=!0}}if(!c)if(n===1)for(var p=0;p<i;p++){var C=r.getRawIndex(p),g=f[a[0]][C];(g>=y&&g<=_||isNaN(g))&&(o[v++]=C)}else for(var p=0;p<i;p++){for(var E=!0,C=r.getRawIndex(p),M=0;M<n;M++){var R=a[M],g=f[R][C];(g<t[R][0]||g>t[R][1])&&(E=!1)}E&&(o[v++]=r.getRawIndex(p))}return v<i&&(r._indices=o),r._count=v,r._extent=[],r._updateGetRawIdx(),r},u.prototype.map=function(t,r){var e=this.clone(t);return this._updateDims(e,t,r),e},u.prototype.modify=function(t,r){this._updateDims(this,t,r)},u.prototype._updateDims=function(t,r,e){for(var a=t._chunks,n=[],i=r.length,s=t.count(),o=[],v=t._rawExtent,h=0;h<r.length;h++)v[r[h]]=S();for(var y=0;y<s;y++){for(var _=t.getRawIndex(y),f=0;f<i;f++)o[f]=a[r[f]][_];o[i]=y;var c=e&&e.apply(null,o);if(c!=null){typeof c!="object"&&(n[0]=c,c=n);for(var h=0;h<c.length;h++){var w=r[h],l=c[h],p=v[w],g=a[w];g&&(g[_]=l),l<p[0]&&(p[0]=l),l>p[1]&&(p[1]=l)}}}},u.prototype.lttbDownSample=function(t,r){var e=this.clone([t],!0),a=e._chunks,n=a[t],i=this.count(),s=0,o=Math.floor(1/r),v=this.getRawIndex(0),h,y,_,f=new(k(this._rawCount))(Math.min((Math.ceil(i/o)+2)*2,i));f[s++]=v;for(var c=1;c<i-1;c+=o){for(var w=Math.min(c+o,i-1),l=Math.min(c+o*2,i),p=(l+w)/2,g=0,D=w;D<l;D++){var I=this.getRawIndex(D),A=n[I];isNaN(A)||(g+=A)}g/=l-w;var N=c,C=Math.min(c+o,i),E=c-1,M=n[v];h=-1,_=N;for(var R=-1,V=0,D=N;D<C;D++){var I=this.getRawIndex(D),A=n[I];if(isNaN(A)){V++,R<0&&(R=I);continue}y=Math.abs((E-p)*(A-M)-(E-D)*(g-M)),y>h&&(h=y,_=I)}V>0&&V<C-N&&(f[s++]=Math.min(R,_),_=Math.max(R,_)),f[s++]=_,v=_}return f[s++]=this.getRawIndex(i-1),e._count=s,e._indices=f,e.getRawIndex=this._getRawIdx,e},u.prototype.downSample=function(t,r,e,a){for(var n=this.clone([t],!0),i=n._chunks,s=[],o=Math.floor(1/r),v=i[t],h=this.count(),y=n._rawExtent[t]=S(),_=new(k(this._rawCount))(Math.ceil(h/o)),f=0,c=0;c<h;c+=o){o>h-c&&(o=h-c,s.length=o);for(var w=0;w<o;w++){var l=this.getRawIndex(c+w);s[w]=v[l]}var p=e(s),g=this.getRawIndex(Math.min(c+a(s,p)||0,h-1));v[g]=p,p<y[0]&&(y[0]=p),p>y[1]&&(y[1]=p),_[f++]=g}return n._count=f,n._indices=_,n._updateGetRawIdx(),n},u.prototype.each=function(t,r){if(this._count)for(var e=t.length,a=this._chunks,n=0,i=this.count();n<i;n++){var s=this.getRawIndex(n);switch(e){case 0:r(n);break;case 1:r(a[t[0]][s],n);break;case 2:r(a[t[0]][s],a[t[1]][s],n);break;default:for(var o=0,v=[];o<e;o++)v[o]=a[t[o]][s];v[o]=n,r.apply(null,v)}}},u.prototype.getDataExtent=function(t){var r=this._chunks[t],e=S();if(!r)return e;var a=this.count(),n=!this._indices,i;if(n)return this._rawExtent[t].slice();if(i=this._extent[t],i)return i.slice();i=e;for(var s=i[0],o=i[1],v=0;v<a;v++){var h=this.getRawIndex(v),y=r[h];y<s&&(s=y),y>o&&(o=y)}return i=[s,o],this._extent[t]=i,i},u.prototype.getRawDataItem=function(t){var r=this.getRawIndex(t);if(this._provider.persistent)return this._provider.getItem(r);for(var e=[],a=this._chunks,n=0;n<a.length;n++)e.push(a[n][r]);return e},u.prototype.clone=function(t,r){var e=new u,a=this._chunks,n=t&&d.reduce(t,function(s,o){return s[o]=!0,s},{});if(n)for(var i=0;i<a.length;i++)e._chunks[i]=n[i]?H(a[i]):a[i];else e._chunks=a;return this._copyCommonProps(e),r||(e._indices=this._cloneIndices()),e._updateGetRawIdx(),e},u.prototype._copyCommonProps=function(t){t._count=this._count,t._rawCount=this._rawCount,t._provider=this._provider,t._dimensions=this._dimensions,t._extent=d.clone(this._extent),t._rawExtent=d.clone(this._rawExtent)},u.prototype._cloneIndices=function(){if(this._indices){var t=this._indices.constructor,r=void 0;if(t===Array){var e=this._indices.length;r=new t(e);for(var a=0;a<e;a++)r[a]=this._indices[a]}else r=new t(this._indices);return r}return null},u.prototype._getRawIdxIdentity=function(t){return t},u.prototype._getRawIdx=function(t){return t<this._count&&t>=0?this._indices[t]:-1},u.prototype._updateGetRawIdx=function(){this.getRawIndex=this._indices?this._getRawIdx:this._getRawIdxIdentity},u.internalField=function(){function t(r,e,a,n){return G.parseDataValue(r[n],this._dimensions[n])}m(t,"getDimValueSimply"),U={arrayRows:t,objectRows:m(function(r,e,a,n){return G.parseDataValue(r[e],this._dimensions[n])},"objectRows"),keyedColumns:t,original:m(function(r,e,a,n){var i=r&&(r.value==null?r:r.value);return G.parseDataValue(i instanceof Array?i[n]:i,this._dimensions[n])},"original"),typedArray:m(function(r,e,a,n){return r[n]},"typedArray")}}(),u}();exports.CtorFloat64Array=F;exports.CtorInt32Array=z;exports.CtorUint16Array=b;exports.CtorUint32Array=P;exports.default=L;
