"use strict";var X=Object.defineProperty;var x=(a,r)=>X(a,"name",{value:r,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const Z=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),k=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),I=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/tool/color/index.cjs"),$=require("../../../util/graphic/index.cjs"),K=require("../../../util/states/index.cjs"),V=require("../../../label/labelStyle/index.cjs"),J=require("../../helper/listComponent/index.cjs"),B=require("../../../util/layout/index.cjs"),Q=require("../../../view/Component/index.cjs"),Y=require("../../../util/symbol/index.cjs"),M=require("../../../util/decal/index.cjs"),z=require("../../../util/innerStore/index.cjs"),U=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Text/index.cjs"),tt=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Rect/index.cjs"),et=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs");var D=k.curry,F=k.each,E=et.default,it=function(a){Z.__extends(r,a);function r(){var t=a!==null&&a.apply(this,arguments)||this;return t.type=r.type,t.newlineDisabled=!1,t}return x(r,"LegendView"),r.prototype.init=function(){this.group.add(this._contentGroup=new E),this.group.add(this._selectorGroup=new E),this._isFirstRender=!0},r.prototype.getContentGroup=function(){return this._contentGroup},r.prototype.getSelectorGroup=function(){return this._selectorGroup},r.prototype.render=function(t,e,c){var u=this._isFirstRender;if(this._isFirstRender=!1,this.resetInner(),!!t.get("show",!0)){var v=t.get("align"),d=t.get("orient");(!v||v==="auto")&&(v=t.get("left")==="right"&&d==="vertical"?"right":"left");var f=t.get("selector",!0),i=t.get("selectorPosition",!0);f&&(!i||i==="auto")&&(i=d==="horizontal"?"end":"start"),this.renderInner(v,t,e,c,f,d,i);var o=t.getBoxLayoutParams(),h={width:c.getWidth(),height:c.getHeight()},s=t.get("padding"),l=B.getLayoutRect(o,h,s),g=this.layoutInner(t,v,l,u,f,i),n=B.getLayoutRect(k.defaults({width:g.width,height:g.height},o),h,s);this.group.x=n.x-g.x,this.group.y=n.y-g.y,this.group.markRedraw(),this.group.add(this._backgroundEl=J.makeBackground(g,t))}},r.prototype.resetInner=function(){this.getContentGroup().removeAll(),this._backgroundEl&&this.group.remove(this._backgroundEl),this.getSelectorGroup().removeAll()},r.prototype.renderInner=function(t,e,c,u,v,d,f){var i=this.getContentGroup(),o=k.createHashMap(),h=e.get("selectedMode"),s=[];c.eachRawSeries(function(l){!l.get("legendHoverLink")&&s.push(l.id)}),F(e.getData(),function(l,g){var n=l.get("name");if(!this.newlineDisabled&&(n===""||n===`
`)){var y=new E;y.newline=!0,i.add(y);return}var p=c.getSeriesByName(n)[0];if(!o.get(n)){if(p){var b=p.getData(),m=b.getVisual("legendLineStyle")||{},R=b.getVisual("legendIcon"),S=b.getVisual("style"),W=this._createItem(p,n,g,l,e,t,m,S,R,h,u);W.on("click",D(j,n,null,u,s)).on("mouseover",D(O,p.name,null,u,s)).on("mouseout",D(P,p.name,null,u,s)),c.ssr&&W.eachChild(function(C){var w=z.getECData(C);w.seriesIndex=p.seriesIndex,w.dataIndex=g,w.ssrType="legend"}),o.set(n,!0)}else c.eachRawSeries(function(C){if(!o.get(n)&&C.legendVisualProvider){var w=C.legendVisualProvider;if(!w.containName(n))return;var T=w.indexOfName(n),_=w.getItemVisual(T,"style"),A=w.getItemVisual(T,"legendIcon"),L=I.parse(_.fill);L&&L[3]===0&&(L[3]=.2,_=k.extend(k.extend({},_),{fill:I.stringify(L,"rgba")}));var G=this._createItem(C,n,g,l,e,t,{},_,A,h,u);G.on("click",D(j,null,n,u,s)).on("mouseover",D(O,null,n,u,s)).on("mouseout",D(P,null,n,u,s)),c.ssr&&G.eachChild(function(H){var q=z.getECData(H);q.seriesIndex=C.seriesIndex,q.dataIndex=g,q.ssrType="legend"}),o.set(n,!0)}},this);process.env.NODE_ENV!=="production"&&(o.get(n)||console.warn(n+" series not exists. Legend data should be same with series name or data name."))}},this),v&&this._createSelector(v,e,u,d,f)},r.prototype._createSelector=function(t,e,c,u,v){var d=this.getSelectorGroup();F(t,x(function(i){var o=i.type,h=new U.default({style:{x:0,y:0,align:"center",verticalAlign:"middle"},onclick:x(function(){c.dispatchAction({type:o==="all"?"legendAllSelect":"legendInverseSelect"})},"onclick")});d.add(h);var s=e.getModel("selectorLabel"),l=e.getModel(["emphasis","selectorLabel"]);V.setLabelStyle(h,{normal:s,emphasis:l},{defaultText:i.title}),K.enableHoverEmphasis(h)},"createSelectorButton"))},r.prototype._createItem=function(t,e,c,u,v,d,f,i,o,h,s){var l=t.visualDrawType,g=v.get("itemWidth"),n=v.get("itemHeight"),y=v.isSelected(e),p=u.get("symbolRotate"),b=u.get("symbolKeepAspect"),m=u.get("icon");o=m||o||"roundRect";var R=rt(o,u,f,i,l,y,s),S=new E,W=u.getModel("textStyle");if(k.isFunction(t.getLegendIcon)&&(!m||m==="inherit"))S.add(t.getLegendIcon({itemWidth:g,itemHeight:n,icon:o,iconRotate:p,itemStyle:R.itemStyle,lineStyle:R.lineStyle,symbolKeepAspect:b}));else{var C=m==="inherit"&&t.getData().getVisual("symbol")?p==="inherit"?t.getData().getVisual("symbolRotate"):p:0;S.add(nt({itemWidth:g,itemHeight:n,icon:o,iconRotate:C,itemStyle:R.itemStyle,lineStyle:R.lineStyle,symbolKeepAspect:b}))}var w=d==="left"?g+5:-5,T=d,_=v.get("formatter"),A=e;k.isString(_)&&_?A=_.replace("{name}",e??""):k.isFunction(_)&&(A=_(e));var L=y?W.getTextColor():u.get("inactiveColor");S.add(new U.default({style:V.createTextStyle(W,{text:A,x:w,y:n/2,fill:L,align:T,verticalAlign:"middle"},{inheritColor:L})}));var G=new tt.default({shape:S.getBoundingRect(),style:{fill:"transparent"}}),H=u.getModel("tooltip");return H.get("show")&&$.setTooltipConfig({el:G,componentModel:v,itemName:e,itemTooltipOption:H.option}),S.add(G),S.eachChild(function(q){q.silent=!0}),G.silent=!h,this.getContentGroup().add(S),K.enableHoverEmphasis(S),S.__legendDataIndex=c,S},r.prototype.layoutInner=function(t,e,c,u,v,d){var f=this.getContentGroup(),i=this.getSelectorGroup();B.box(t.get("orient"),f,t.get("itemGap"),c.width,c.height);var o=f.getBoundingRect(),h=[-o.x,-o.y];if(i.markRedraw(),f.markRedraw(),v){B.box("horizontal",i,t.get("selectorItemGap",!0));var s=i.getBoundingRect(),l=[-s.x,-s.y],g=t.get("selectorButtonGap",!0),n=t.getOrient().index,y=n===0?"width":"height",p=n===0?"height":"width",b=n===0?"y":"x";d==="end"?l[n]+=o[y]+g:h[n]+=s[y]+g,l[1-n]+=o[p]/2-s[p]/2,i.x=l[0],i.y=l[1],f.x=h[0],f.y=h[1];var m={x:0,y:0};return m[y]=o[y]+g+s[y],m[p]=Math.max(o[p],s[p]),m[b]=Math.min(0,s[b]+l[1-n]),m}else return f.x=h[0],f.y=h[1],this.group.getBoundingRect()},r.prototype.remove=function(){this.getContentGroup().removeAll(),this._isFirstRender=!0},r.type="legend.plain",r}(Q.default);function rt(a,r,t,e,c,u,v){function d(y,p){y.lineWidth==="auto"&&(y.lineWidth=p.lineWidth>0?2:0),F(y,function(b,m){y[m]==="inherit"&&(y[m]=p[m])})}x(d,"handleCommonProps");var f=r.getModel("itemStyle"),i=f.getItemStyle(),o=a.lastIndexOf("empty",0)===0?"fill":"stroke",h=f.getShallow("decal");i.decal=!h||h==="inherit"?e.decal:M.createOrUpdatePatternFromDecal(h,v),i.fill==="inherit"&&(i.fill=e[c]),i.stroke==="inherit"&&(i.stroke=e[o]),i.opacity==="inherit"&&(i.opacity=(c==="fill"?e:t).opacity),d(i,e);var s=r.getModel("lineStyle"),l=s.getLineStyle();if(d(l,t),i.fill==="auto"&&(i.fill=e.fill),i.stroke==="auto"&&(i.stroke=e.fill),l.stroke==="auto"&&(l.stroke=e.fill),!u){var g=r.get("inactiveBorderWidth"),n=i[o];i.lineWidth=g==="auto"?e.lineWidth>0&&n?2:0:i.lineWidth,i.fill=r.get("inactiveColor"),i.stroke=r.get("inactiveBorderColor"),l.stroke=s.get("inactiveColor"),l.lineWidth=s.get("inactiveWidth")}return{itemStyle:i,lineStyle:l}}x(rt,"getLegendStyle");function nt(a){var r=a.icon||"roundRect",t=Y.createSymbol(r,0,0,a.itemWidth,a.itemHeight,a.itemStyle.fill,a.symbolKeepAspect);return t.setStyle(a.itemStyle),t.rotation=(a.iconRotate||0)*Math.PI/180,t.setOrigin([a.itemWidth/2,a.itemHeight/2]),r.indexOf("empty")>-1&&(t.style.stroke=t.style.fill,t.style.fill="#fff",t.style.lineWidth=2),t}x(nt,"getDefaultLegendIcon");function j(a,r,t,e){P(a,r,t,e),t.dispatchAction({type:"legendToggleSelect",name:a??r}),O(a,r,t,e)}x(j,"dispatchSelectAction");function N(a){for(var r=a.getZr().storage.getDisplayList(),t,e=0,c=r.length;e<c&&!(t=r[e].states.emphasis);)e++;return t&&t.hoverLayer}x(N,"isUseHoverLayer");function O(a,r,t,e){N(t)||t.dispatchAction({type:"highlight",seriesName:a,name:r,excludeSeriesId:e})}x(O,"dispatchHighlightAction");function P(a,r,t,e){N(t)||t.dispatchAction({type:"downplay",seriesName:a,name:r,excludeSeriesId:e})}x(P,"dispatchDownplayAction");exports.default=it;
