"use strict";var O=Object.defineProperty;var h=(i,t)=>O(i,"name",{value:t,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const a=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs");function N(i){return new g(i)}h(N,"createTask");var g=function(){function i(t){t=t||{},this._reset=t.reset,this._plan=t.plan,this._count=t.count,this._onDirty=t.onDirty,this._dirty=!0}return h(i,"Task"),i.prototype.perform=function(t){var s=this._upstream,e=t&&t.skip;if(this._dirty&&s){var r=this.context;r.data=r.outputData=s.context.outputData}this.__pipeline&&(this.__pipeline.currentTask=this);var u;this._plan&&!e&&(u=this._plan(this.context));var l=d(this._modBy),y=this._modDataCount||0,n=d(t&&t.modBy),o=t&&t.modDataCount||0;(l!==n||y!==o)&&(u="reset");function d(E){return!(E>=1)&&(E=1),E}h(d,"normalizeModBy");var p;(this._dirty||u==="reset")&&(this._dirty=!1,p=this._doReset(e)),this._modBy=n,this._modDataCount=o;var m=t&&t.step;if(s?(process.env.NODE_ENV!=="production"&&a.assert(s._outputDueEnd!=null),this._dueEnd=s._outputDueEnd):(process.env.NODE_ENV!=="production"&&a.assert(!this._progress||this._count),this._dueEnd=this._count?this._count(this.context):1/0),this._progress){var f=this._dueIndex,_=Math.min(m!=null?this._dueIndex+m:1/0,this._dueEnd);if(!e&&(p||f<_)){var c=this._progress;if(a.isArray(c))for(var v=0;v<c.length;v++)this._doProgress(c[v],f,_,n,o);else this._doProgress(c,f,_,n,o)}this._dueIndex=_;var D=this._settedOutputEnd!=null?this._settedOutputEnd:_;process.env.NODE_ENV!=="production"&&a.assert(D>=this._outputDueEnd),this._outputDueEnd=D}else this._dueIndex=this._outputDueEnd=this._settedOutputEnd!=null?this._settedOutputEnd:this._dueEnd;return this.unfinished()},i.prototype.dirty=function(){this._dirty=!0,this._onDirty&&this._onDirty(this.context)},i.prototype._doProgress=function(t,s,e,r,u){x.reset(s,e,r,u),this._callingProgress=t,this._callingProgress({start:s,end:e,count:e-s,next:x.next},this.context)},i.prototype._doReset=function(t){this._dueIndex=this._outputDueEnd=this._dueEnd=0,this._settedOutputEnd=null;var s,e;!t&&this._reset&&(s=this._reset(this.context),s&&s.progress&&(e=s.forceFirstProgress,s=s.progress),a.isArray(s)&&!s.length&&(s=null)),this._progress=s,this._modBy=this._modDataCount=null;var r=this._downstream;return r&&r.dirty(),e},i.prototype.unfinished=function(){return this._progress&&this._dueIndex<this._dueEnd},i.prototype.pipe=function(t){process.env.NODE_ENV!=="production"&&a.assert(t&&!t._disposed&&t!==this),(this._downstream!==t||this._dirty)&&(this._downstream=t,t._upstream=this,t.dirty())},i.prototype.dispose=function(){this._disposed||(this._upstream&&(this._upstream._downstream=null),this._downstream&&(this._downstream._upstream=null),this._dirty=!1,this._disposed=!0)},i.prototype.getUpstream=function(){return this._upstream},i.prototype.getDownstream=function(){return this._downstream},i.prototype.setOutputEnd=function(t){this._outputDueEnd=this._settedOutputEnd=t},i}(),x=function(){var i,t,s,e,r,u={reset:h(function(n,o,d,p){t=n,i=o,s=d,e=p,r=Math.ceil(e/s),u.next=s>1&&e>0?y:l},"reset")};return u;function l(){return t<i?t++:null}function y(){var n=t%r*s+Math.ceil(t/r),o=t>=i?null:n<e?n:t;return t++,o}}();exports.Task=g;exports.createTask=N;
