"use strict";var X=Object.defineProperty;var E=(m,n)=>X(m,"name",{value:n,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const U=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),u=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),C=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/event/index.cjs"),B=require("../../../util/graphic/index.cjs"),V=require("../../../util/throttle/index.cjs"),j=require("../DataZoomView/index.cjs"),f=require("../../../util/number/index.cjs"),O=require("../../../util/layout/index.cjs"),$=require("../../helper/sliderMove/index.cjs"),k=require("../helper/index.cjs"),J=require("../../../util/states/index.cjs"),G=require("../../../util/symbol/index.cjs"),K=require("../../../util/log/index.cjs"),Q=require("../../../label/labelStyle/index.cjs"),F=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),tt=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Text/index.cjs"),P=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Rect/index.cjs"),et=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/Point/index.cjs"),at=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Polygon/index.cjs"),rt=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Polyline/index.cjs");var R=P.default,H=7,it=1,q=30,st=7,L="horizontal",N="vertical",ot=5,nt=["line","bar","candlestick","scatter"],lt={easing:"cubicOut",duration:100,delay:0},ht=function(m){U.__extends(n,m);function n(){var t=m!==null&&m.apply(this,arguments)||this;return t.type=n.type,t._displayables={},t}return E(n,"SliderZoomView"),n.prototype.init=function(t,e){this.api=e,this._onBrush=u.bind(this._onBrush,this),this._onBrushEnd=u.bind(this._onBrushEnd,this)},n.prototype.render=function(t,e,r,s){if(m.prototype.render.apply(this,arguments),V.createOrUpdate(this,"_dispatchZoomAction",t.get("throttle"),"fixRate"),this._orient=t.getOrient(),t.get("show")===!1){this.group.removeAll();return}if(t.noTarget()){this._clear(),this.group.removeAll();return}(!s||s.type!=="dataZoom"||s.from!==this.uid)&&this._buildView(),this._updateView()},n.prototype.dispose=function(){this._clear(),m.prototype.dispose.apply(this,arguments)},n.prototype._clear=function(){V.clear(this,"_dispatchZoomAction");var t=this.api.getZr();t.off("mousemove",this._onBrush),t.off("mouseup",this._onBrushEnd)},n.prototype._buildView=function(){var t=this.group;t.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var e=this._displayables.sliderGroup=new F.default;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),t.add(e),this._positionGroup()},n.prototype._resetLocation=function(){var t=this.dataZoomModel,e=this.api,r=t.get("brushSelect"),s=r?st:0,a=this._findCoordRect(),i={width:e.getWidth(),height:e.getHeight()},o=this._orient===L?{right:i.width-a.x-a.width,top:i.height-q-H-s,width:a.width,height:q}:{right:H,top:a.y,width:q,height:a.height},l=O.getLayoutParams(t.option);u.each(["right","top","width","height"],function(d){l[d]==="ph"&&(l[d]=o[d])});var h=O.getLayoutRect(l,i);this._location={x:h.x,y:h.y},this._size=[h.width,h.height],this._orient===N&&this._size.reverse()},n.prototype._positionGroup=function(){var t=this.group,e=this._location,r=this._orient,s=this.dataZoomModel.getFirstTargetAxisModel(),a=s&&s.get("inverse"),i=this._displayables.sliderGroup,o=(this._dataShadowInfo||{}).otherAxisInverse;i.attr(r===L&&!a?{scaleY:o?1:-1,scaleX:1}:r===L&&a?{scaleY:o?1:-1,scaleX:-1}:r===N&&!a?{scaleY:o?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:o?-1:1,scaleX:-1,rotation:Math.PI/2});var l=t.getBoundingRect([i]);t.x=e.x-l.x,t.y=e.y-l.y,t.markRedraw()},n.prototype._getViewExtent=function(){return[0,this._size[0]]},n.prototype._renderBackground=function(){var t=this.dataZoomModel,e=this._size,r=this._displayables.sliderGroup,s=t.get("brushSelect");r.add(new R({silent:!0,shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:t.get("backgroundColor")},z2:-40}));var a=new R({shape:{x:0,y:0,width:e[0],height:e[1]},style:{fill:"transparent"},z2:0,onclick:u.bind(this._onClickPanel,this)}),i=this.api.getZr();s?(a.on("mousedown",this._onBrushStart,this),a.cursor="crosshair",i.on("mousemove",this._onBrush),i.on("mouseup",this._onBrushEnd)):(i.off("mousemove",this._onBrush),i.off("mouseup",this._onBrushEnd)),r.add(a)},n.prototype._renderDataShadow=function(){var t=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!t)return;var e=this._size,r=this._shadowSize||[],s=t.series,a=s.getRawData(),i=s.getShadowDim&&s.getShadowDim(),o=i&&a.getDimensionInfo(i)?s.getShadowDim():t.otherDim;if(o==null)return;var l=this._shadowPolygonPts,h=this._shadowPolylinePts;if(a!==this._shadowData||o!==this._shadowDim||e[0]!==r[0]||e[1]!==r[1]){var d=a.getDataExtent(o),g=(d[1]-d[0])*.3;d=[d[0]-g,d[1]+g];var v=[0,e[1]],c=[0,e[0]],p=[[e[0],0],[0,0]],_=[],M=c[1]/(a.count()-1),y=0,D=Math.round(a.count()/e[0]),w;a.each([o],function(S,I){if(D>0&&I%D){y+=M;return}var x=S==null||isNaN(S)||S==="",z=x?0:f.linearMap(S,d,v,!0);x&&!w&&I?(p.push([p[p.length-1][0],0]),_.push([_[_.length-1][0],0])):!x&&w&&(p.push([y,0]),_.push([y,0])),p.push([y,z]),_.push([y,z]),y+=M,w=x}),l=this._shadowPolygonPts=p,h=this._shadowPolylinePts=_}this._shadowData=a,this._shadowDim=o,this._shadowSize=[e[0],e[1]];var b=this.dataZoomModel;function T(S){var I=b.getModel(S?"selectedDataBackground":"dataBackground"),x=new F.default,z=new at.default({shape:{points:l},segmentIgnoreThreshold:1,style:I.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),Y=new rt.default({shape:{points:h},segmentIgnoreThreshold:1,style:I.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return x.add(z),x.add(Y),x}E(T,"createDataShadowGroup");for(var A=0;A<3;A++){var Z=T(A===1);this._displayables.sliderGroup.add(Z),this._displayables.dataShadowSegs.push(Z)}},n.prototype._prepareDataShadowInfo=function(){var t=this.dataZoomModel,e=t.get("showDataShadow");if(e!==!1){var r,s=this.ecModel;return t.eachTargetAxis(function(a,i){var o=t.getAxisProxy(a,i).getTargetSeriesModels();u.each(o,function(l){if(!r&&!(e!==!0&&u.indexOf(nt,l.get("type"))<0)){var h=s.getComponent(k.getAxisMainType(a),i).axis,d=dt(a),g,v=l.coordinateSystem;d!=null&&v.getOtherAxis&&(g=v.getOtherAxis(h).inverse),d=l.getData().mapDimension(d),r={thisAxis:h,series:l,thisDim:a,otherDim:d,otherAxisInverse:g}}},this)},this),r}},n.prototype._renderHandle=function(){var t=this.group,e=this._displayables,r=e.handles=[null,null],s=e.handleLabels=[null,null],a=this._displayables.sliderGroup,i=this._size,o=this.dataZoomModel,l=this.api,h=o.get("borderRadius")||0,d=o.get("brushSelect"),g=e.filler=new R({silent:d,style:{fill:o.get("fillerColor")},textConfig:{position:"inside"}});a.add(g),a.add(new R({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:i[0],height:i[1],r:h},style:{stroke:o.get("dataBackgroundColor")||o.get("borderColor"),lineWidth:it,fill:"rgba(0,0,0,0)"}})),u.each([0,1],function(D){var w=o.get("handleIcon");!G.symbolBuildProxies[w]&&w.indexOf("path://")<0&&w.indexOf("image://")<0&&(w="path://"+w,process.env.NODE_ENV!=="production"&&K.deprecateLog("handleIcon now needs 'path://' prefix when using a path string"));var b=G.createSymbol(w,-1,0,2,2,null,!0);b.attr({cursor:W(this._orient),draggable:!0,drift:u.bind(this._onDragMove,this,D),ondragend:u.bind(this._onDragEnd,this),onmouseover:u.bind(this._showDataInfo,this,!0),onmouseout:u.bind(this._showDataInfo,this,!1),z2:5});var T=b.getBoundingRect(),A=o.get("handleSize");this._handleHeight=f.parsePercent(A,this._size[1]),this._handleWidth=T.width/T.height*this._handleHeight,b.setStyle(o.getModel("handleStyle").getItemStyle()),b.style.strokeNoScale=!0,b.rectHover=!0,b.ensureState("emphasis").style=o.getModel(["emphasis","handleStyle"]).getItemStyle(),J.enableHoverEmphasis(b);var Z=o.get("handleColor");Z!=null&&(b.style.fill=Z),a.add(r[D]=b);var S=o.getModel("textStyle");t.add(s[D]=new tt.default({silent:!0,invisible:!0,style:Q.createTextStyle(S,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:S.getTextColor(),font:S.getFont()}),z2:10}))},this);var v=g;if(d){var c=f.parsePercent(o.get("moveHandleSize"),i[1]),p=e.moveHandle=new P.default({style:o.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:i[1]-.5,height:c}}),_=c*.8,M=e.moveHandleIcon=G.createSymbol(o.get("moveHandleIcon"),-_/2,-_/2,_,_,"#fff",!0);M.silent=!0,M.y=i[1]+c/2-.5,p.ensureState("emphasis").style=o.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var y=Math.min(i[1]/2,Math.max(c,10));v=e.moveZone=new P.default({invisible:!0,shape:{y:i[1]-y,height:c+y}}),v.on("mouseover",function(){l.enterEmphasis(p)}).on("mouseout",function(){l.leaveEmphasis(p)}),a.add(p),a.add(M),a.add(v)}v.attr({draggable:!0,cursor:W(this._orient),drift:u.bind(this._onDragMove,this,"all"),ondragstart:u.bind(this._showDataInfo,this,!0),ondragend:u.bind(this._onDragEnd,this),onmouseover:u.bind(this._showDataInfo,this,!0),onmouseout:u.bind(this._showDataInfo,this,!1)})},n.prototype._resetInterval=function(){var t=this._range=this.dataZoomModel.getPercentRange(),e=this._getViewExtent();this._handleEnds=[f.linearMap(t[0],[0,100],e,!0),f.linearMap(t[1],[0,100],e,!0)]},n.prototype._updateInterval=function(t,e){var r=this.dataZoomModel,s=this._handleEnds,a=this._getViewExtent(),i=r.findRepresentativeAxisProxy().getMinMaxSpan(),o=[0,100];$.default(e,s,a,r.get("zoomLock")?"all":t,i.minSpan!=null?f.linearMap(i.minSpan,o,a,!0):null,i.maxSpan!=null?f.linearMap(i.maxSpan,o,a,!0):null);var l=this._range,h=this._range=f.asc([f.linearMap(s[0],a,o,!0),f.linearMap(s[1],a,o,!0)]);return!l||l[0]!==h[0]||l[1]!==h[1]},n.prototype._updateView=function(t){var e=this._displayables,r=this._handleEnds,s=f.asc(r.slice()),a=this._size;u.each([0,1],function(v){var c=e.handles[v],p=this._handleHeight;c.attr({scaleX:p/2,scaleY:p/2,x:r[v]+(v?-1:1),y:a[1]/2-p/2})},this),e.filler.setShape({x:s[0],y:0,width:s[1]-s[0],height:a[1]});var i={x:s[0],width:s[1]-s[0]};e.moveHandle&&(e.moveHandle.setShape(i),e.moveZone.setShape(i),e.moveZone.getBoundingRect(),e.moveHandleIcon&&e.moveHandleIcon.attr("x",i.x+i.width/2));for(var o=e.dataShadowSegs,l=[0,s[0],s[1],a[0]],h=0;h<o.length;h++){var d=o[h],g=d.getClipPath();g||(g=new P.default,d.setClipPath(g)),g.setShape({x:l[h],y:0,width:l[h+1]-l[h],height:a[1]})}this._updateDataInfo(t)},n.prototype._updateDataInfo=function(t){var e=this.dataZoomModel,r=this._displayables,s=r.handleLabels,a=this._orient,i=["",""];if(e.get("showDetail")){var o=e.findRepresentativeAxisProxy();if(o){var l=o.getAxisModel().axis,h=this._range,d=t?o.calculateDataWindow({start:h[0],end:h[1]}).valueWindow:o.getDataValueWindow();i=[this._formatLabel(d[0],l),this._formatLabel(d[1],l)]}}var g=f.asc(this._handleEnds.slice());v.call(this,0),v.call(this,1);function v(c){var p=B.getTransform(r.handles[c].parent,this.group),_=B.transformDirection(c===0?"right":"left",p),M=this._handleWidth/2+ot,y=B.applyTransform([g[c]+(c===0?-M:M),this._size[1]/2],p);s[c].setStyle({x:y[0],y:y[1],verticalAlign:a===L?"middle":_,align:a===L?_:"center",text:i[c]})}E(v,"setLabel")},n.prototype._formatLabel=function(t,e){var r=this.dataZoomModel,s=r.get("labelFormatter"),a=r.get("labelPrecision");(a==null||a==="auto")&&(a=e.getPixelPrecision());var i=t==null||isNaN(t)?"":e.type==="category"||e.type==="time"?e.scale.getLabel({value:Math.round(t)}):t.toFixed(Math.min(a,20));return u.isFunction(s)?s(t,i):u.isString(s)?s.replace("{value}",i):i},n.prototype._showDataInfo=function(t){t=this._dragging||t;var e=this._displayables,r=e.handleLabels;r[0].attr("invisible",!t),r[1].attr("invisible",!t),e.moveHandle&&this.api[t?"enterEmphasis":"leaveEmphasis"](e.moveHandle,1)},n.prototype._onDragMove=function(t,e,r,s){this._dragging=!0,C.stop(s.event);var a=this._displayables.sliderGroup.getLocalTransform(),i=B.applyTransform([e,r],a,!0),o=this._updateInterval(t,i[0]),l=this.dataZoomModel.get("realtime");this._updateView(!l),o&&l&&this._dispatchZoomAction(!0)},n.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var t=this.dataZoomModel.get("realtime");!t&&this._dispatchZoomAction(!1)},n.prototype._onClickPanel=function(t){var e=this._size,r=this._displayables.sliderGroup.transformCoordToLocal(t.offsetX,t.offsetY);if(!(r[0]<0||r[0]>e[0]||r[1]<0||r[1]>e[1])){var s=this._handleEnds,a=(s[0]+s[1])/2,i=this._updateInterval("all",r[0]-a);this._updateView(),i&&this._dispatchZoomAction(!1)}},n.prototype._onBrushStart=function(t){var e=t.offsetX,r=t.offsetY;this._brushStart=new et.default(e,r),this._brushing=!0,this._brushStartTime=+new Date},n.prototype._onBrushEnd=function(t){if(this._brushing){var e=this._displayables.brushRect;if(this._brushing=!1,!!e){e.attr("ignore",!0);var r=e.shape,s=+new Date;if(!(s-this._brushStartTime<200&&Math.abs(r.width)<5)){var a=this._getViewExtent(),i=[0,100];this._range=f.asc([f.linearMap(r.x,a,i,!0),f.linearMap(r.x+r.width,a,i,!0)]),this._handleEnds=[r.x,r.x+r.width],this._updateView(),this._dispatchZoomAction(!1)}}}},n.prototype._onBrush=function(t){this._brushing&&(C.stop(t.event),this._updateBrushRect(t.offsetX,t.offsetY))},n.prototype._updateBrushRect=function(t,e){var r=this._displayables,s=this.dataZoomModel,a=r.brushRect;a||(a=r.brushRect=new R({silent:!0,style:s.getModel("brushStyle").getItemStyle()}),r.sliderGroup.add(a)),a.attr("ignore",!1);var i=this._brushStart,o=this._displayables.sliderGroup,l=o.transformCoordToLocal(t,e),h=o.transformCoordToLocal(i.x,i.y),d=this._size;l[0]=Math.max(Math.min(d[0],l[0]),0),a.setShape({x:h[0],y:0,width:l[0]-h[0],height:d[1]})},n.prototype._dispatchZoomAction=function(t){var e=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:t?lt:null,start:e[0],end:e[1]})},n.prototype._findCoordRect=function(){var t,e=k.collectReferCoordSysModelInfo(this.dataZoomModel).infoList;if(!t&&e.length){var r=e[0].model.coordinateSystem;t=r.getRect&&r.getRect()}if(!t){var s=this.api.getWidth(),a=this.api.getHeight();t={x:s*.2,y:a*.2,width:s*.6,height:a*.6}}return t},n.type="dataZoom.slider",n}(j.default);function dt(m){var n={x:"y",y:"x",radius:"angle",angle:"radius"};return n[m]}E(dt,"getOtherDim");function W(m){return m==="vertical"?"ns-resize":"ew-resize"}E(W,"getCursor");exports.default=ht;
