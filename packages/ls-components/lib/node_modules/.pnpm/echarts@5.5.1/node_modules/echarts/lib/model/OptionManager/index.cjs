"use strict";var y=Object.defineProperty;var l=(i,e)=>y(i,"name",{value:e,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const h=require("../../util/model/index.cjs"),a=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),v=require("../../util/log/index.cjs");var g=/^(min|max)?(.+)$/,b=function(){function i(e){this._timelineOptions=[],this._mediaList=[],this._currentMediaIndices=[],this._api=e}return l(i,"OptionManager"),i.prototype.setOption=function(e,r,p){e&&(a.each(h.normalizeToArray(e.series),function(t){t&&t.data&&a.isTypedArray(t.data)&&a.setAsPrimitive(t.data)}),a.each(h.normalizeToArray(e.dataset),function(t){t&&t.source&&a.isTypedArray(t.source)&&a.setAsPrimitive(t.source)})),e=a.clone(e);var o=this._optionBackup,n=L(e,r,!o);this._newBaseOption=n.baseOption,o?(n.timelineOptions.length&&(o.timelineOptions=n.timelineOptions),n.mediaList.length&&(o.mediaList=n.mediaList),n.mediaDefault&&(o.mediaDefault=n.mediaDefault)):this._optionBackup=n},i.prototype.mountOption=function(e){var r=this._optionBackup;return this._timelineOptions=r.timelineOptions,this._mediaList=r.mediaList,this._mediaDefault=r.mediaDefault,this._currentMediaIndices=[],a.clone(e?r.baseOption:this._newBaseOption)},i.prototype.getTimelineOption=function(e){var r,p=this._timelineOptions;if(p.length){var o=e.getComponent("timeline");o&&(r=a.clone(p[o.getCurrentIndex()]))}return r},i.prototype.getMediaOption=function(e){var r=this._api.getWidth(),p=this._api.getHeight(),o=this._mediaList,n=this._mediaDefault,t=[],u=[];if(!o.length&&!n)return u;for(var c=0,m=o.length;c<m;c++)D(o[c].query,r,p)&&t.push(c);return!t.length&&n&&(t=[-1]),t.length&&!A(t,this._currentMediaIndices)&&(u=a.map(t,function(f){return a.clone(f===-1?n.option:o[f].option)})),this._currentMediaIndices=t,u},i}();function L(i,e,r){var p=[],o,n,t=i.baseOption,u=i.timeline,c=i.options,m=i.media,f=!!i.media,_=!!(c||u||t&&t.timeline);t?(n=t,n.timeline||(n.timeline=u)):((_||f)&&(i.options=i.media=null),n=i),f&&(a.isArray(m)?a.each(m,function(s){process.env.NODE_ENV!=="production"&&s&&!s.option&&a.isObject(s.query)&&a.isObject(s.query.option)&&v.error("Illegal media option. Must be like { media: [ { query: {}, option: {} } ] }"),s&&s.option&&(s.query?p.push(s):o||(o=s))}):process.env.NODE_ENV!=="production"&&v.error("Illegal media option. Must be an array. Like { media: [ {...}, {...} ] }")),d(n),a.each(c,function(s){return d(s)}),a.each(p,function(s){return d(s.option)});function d(s){a.each(e,function(O){O(s,r)})}return l(d,"doPreprocess"),{baseOption:n,timelineOptions:c||[],mediaDefault:o,mediaList:p}}l(L,"parseRawOption");function D(i,e,r){var p={width:e,height:r,aspectratio:e/r},o=!0;return a.each(i,function(n,t){var u=t.match(g);if(!(!u||!u[1]||!u[2])){var c=u[1],m=u[2].toLowerCase();q(p[m],n,c)||(o=!1)}}),o}l(D,"applyMediaQuery");function q(i,e,r){return r==="min"?i>=e:r==="max"?i<=e:i===e}l(q,"compare");function A(i,e){return i.join(",")===e.join(",")}l(A,"indicesEquals");exports.default=b;
