"use strict";var l=Object.defineProperty;var y=(r,t)=>l(r,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});function a(r){return r==null?0:r.length||1}y(a,"dataIndexMapValueLength");function d(r){return r}y(d,"defaultKeyGetter");var T=function(){function r(t,h,i,n,o,e){this._old=t,this._new=h,this._oldKeyGetter=i||d,this._newKeyGetter=n||d,this.context=o,this._diffModeMultiple=e==="multiple"}return y(r,"DataDiffer"),r.prototype.add=function(t){return this._add=t,this},r.prototype.update=function(t){return this._update=t,this},r.prototype.updateManyToOne=function(t){return this._updateManyToOne=t,this},r.prototype.updateOneToMany=function(t){return this._updateOneToMany=t,this},r.prototype.updateManyToMany=function(t){return this._updateManyToMany=t,this},r.prototype.remove=function(t){return this._remove=t,this},r.prototype.execute=function(){this[this._diffModeMultiple?"_executeMultiple":"_executeOneToOne"]()},r.prototype._executeOneToOne=function(){var t=this._old,h=this._new,i={},n=new Array(t.length),o=new Array(h.length);this._initIndexMap(t,null,n,"_oldKeyGetter"),this._initIndexMap(h,i,o,"_newKeyGetter");for(var e=0;e<t.length;e++){var u=n[e],s=i[u],_=a(s);if(_>1){var f=s.shift();s.length===1&&(i[u]=s[0]),this._update&&this._update(f,e)}else _===1?(i[u]=null,this._update&&this._update(s,e)):this._remove&&this._remove(e)}this._performRestAdd(o,i)},r.prototype._executeMultiple=function(){var t=this._old,h=this._new,i={},n={},o=[],e=[];this._initIndexMap(t,i,o,"_oldKeyGetter"),this._initIndexMap(h,n,e,"_newKeyGetter");for(var u=0;u<o.length;u++){var s=o[u],_=i[s],f=n[s],v=a(_),p=a(f);if(v>1&&p===1)this._updateManyToOne&&this._updateManyToOne(f,_),n[s]=null;else if(v===1&&p>1)this._updateOneToMany&&this._updateOneToMany(f,_),n[s]=null;else if(v===1&&p===1)this._update&&this._update(f,_),n[s]=null;else if(v>1&&p>1)this._updateManyToMany&&this._updateManyToMany(f,_),n[s]=null;else if(v>1)for(var c=0;c<v;c++)this._remove&&this._remove(_[c]);else this._remove&&this._remove(_)}this._performRestAdd(e,n)},r.prototype._performRestAdd=function(t,h){for(var i=0;i<t.length;i++){var n=t[i],o=h[n],e=a(o);if(e>1)for(var u=0;u<e;u++)this._add&&this._add(o[u]);else e===1&&this._add&&this._add(o);h[n]=null}},r.prototype._initIndexMap=function(t,h,i,n){for(var o=this._diffModeMultiple,e=0;e<t.length;e++){var u="_ec_"+this[n](t[e],e);if(o||(i[e]=u),!!h){var s=h[u],_=a(s);_===0?(h[u]=e,o&&i.push(u)):_===1?h[u]=[s,e]:s.push(e)}}},r}();exports.default=T;
