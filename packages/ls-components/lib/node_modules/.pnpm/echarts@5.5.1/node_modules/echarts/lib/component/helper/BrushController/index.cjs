"use strict";var ne=Object.defineProperty;var u=(e,r)=>ne(e,"name",{value:r,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const ae=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),o=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),ie=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/Eventful/index.cjs"),Z=require("../../../util/graphic/index.cjs"),G=require("../interactionMutex/index.cjs"),ue=require("../../../data/DataDiffer/index.cjs"),S=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),se=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Polyline/index.cjs"),oe=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Polygon/index.cjs"),U=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Rect/index.cjs");var _=!0,y=Math.min,m=Math.max,fe=Math.pow,he=1e4,ve=6,de=6,H="globalPan",ce={w:[0,0],e:[0,1],n:[1,0],s:[1,1]},ge={w:"ew",e:"ew",n:"ns",s:"ns",ne:"nesw",sw:"nesw",nw:"nwse",se:"nwse"},V={brushStyle:{lineWidth:2,stroke:"rgba(210,219,238,0.3)",fill:"#D2DBEE"},transformable:!0,brushMode:"single",removeOnClick:!1},pe=0,_e=function(e){ae.__extends(r,e);function r(t){var n=e.call(this)||this;return n._track=[],n._covers=[],n._handlers={},process.env.NODE_ENV!=="production"&&o.assert(t),n._zr=t,n.group=new S.default,n._uid="brushController_"+pe++,o.each(we,function(a,i){this._handlers[i]=o.bind(a,this)},n),n}return u(r,"BrushController"),r.prototype.enableBrush=function(t){return process.env.NODE_ENV!=="production"&&o.assert(this._mounted),this._brushType&&this._doDisableBrush(),t.brushType&&this._doEnableBrush(t),this},r.prototype._doEnableBrush=function(t){var n=this._zr;this._enableGlobalPan||G.take(n,H,this._uid),o.each(this._handlers,function(a,i){n.on(i,a)}),this._brushType=t.brushType,this._brushOption=o.merge(o.clone(V),t,!0)},r.prototype._doDisableBrush=function(){var t=this._zr;G.release(t,H,this._uid),o.each(this._handlers,function(n,a){t.off(a,n)}),this._brushType=this._brushOption=null},r.prototype.setPanels=function(t){if(t&&t.length){var n=this._panels={};o.each(t,function(a){n[a.panelId]=o.clone(a)})}else this._panels=null;return this},r.prototype.mount=function(t){t=t||{},process.env.NODE_ENV!=="production"&&(this._mounted=!0),this._enableGlobalPan=t.enableGlobalPan;var n=this.group;return this._zr.add(n),n.attr({x:t.x||0,y:t.y||0,rotation:t.rotation||0,scaleX:t.scaleX||1,scaleY:t.scaleY||1}),this._transform=n.getLocalTransform(),this},r.prototype.updateCovers=function(t){process.env.NODE_ENV!=="production"&&o.assert(this._mounted),t=o.map(t,function(v){return o.merge(o.clone(V),v,!0)});var n="\0-brush-index-",a=this._covers,i=this._covers=[],s=this,f=this._creatingCover;return new ue.default(a,t,c,h).add(g).update(g).remove(C).execute(),this;function h(v,d){return(v.id!=null?v.id:n+d)+"-"+v.brushType}u(h,"getKey");function c(v,d){return h(v.__brushOption,d)}u(c,"oldGetKey");function g(v,d){var b=t[v];if(d!=null&&a[d]===f)i[v]=a[d];else{var E=i[v]=d!=null?(a[d].__brushOption=b,a[d]):K(s,j(s,b));N(s,E)}}u(g,"addOrUpdate");function C(v){a[v]!==f&&s.group.remove(a[v])}u(C,"remove")},r.prototype.unmount=function(){if(!(process.env.NODE_ENV!=="production"&&!this._mounted))return this.enableBrush(!1),T(this),this._zr.remove(this.group),process.env.NODE_ENV!=="production"&&(this._mounted=!1),this},r.prototype.dispose=function(){this.unmount(),this.off()},r}(ie.default);function j(e,r){var t=w[r.brushType].createCover(e,r);return t.__brushOption=r,F(t,r),e.group.add(t),t}u(j,"createCover");function K(e,r){var t=P(r);return t.endCreating&&(t.endCreating(e,r),F(r,r.__brushOption)),r}u(K,"endCreating");function I(e,r){var t=r.__brushOption;P(r).updateCoverShape(e,r,t.range,t)}u(I,"updateCoverShape");function F(e,r){var t=r.z;t==null&&(t=he),e.traverse(function(n){n.z=t,n.z2=t})}u(F,"updateZ");function N(e,r){P(r).updateCommon(e,r),I(e,r)}u(N,"updateCoverAfterCreation");function P(e){return w[e.__brushOption.brushType]}u(P,"getCoverRenderer");function M(e,r,t){var n=e._panels;if(!n)return _;var a,i=e._transform;return o.each(n,function(s){s.isTargetByCursor(r,t,i)&&(a=s)}),a}u(M,"getPanelByPoint");function J(e,r){var t=e._panels;if(!t)return _;var n=r.__brushOption.panelId;return n!=null?t[n]:_}u(J,"getPanelByCover");function T(e){var r=e._covers,t=r.length;return o.each(r,function(n){e.group.remove(n)},e),r.length=0,!!t}u(T,"clearCovers");function l(e,r){var t=o.map(e._covers,function(n){var a=n.__brushOption,i=o.clone(a.range);return{brushType:a.brushType,panelId:a.panelId,range:i}});e.trigger("brush",{areas:t,isEnd:!!r.isEnd,removeOnClick:!!r.removeOnClick})}u(l,"trigger");function le(e){var r=e._track;if(!r.length)return!1;var t=r[r.length-1],n=r[0],a=t[0]-n[0],i=t[1]-n[1],s=fe(a*a+i*i,.5);return s>ve}u(le,"shouldShowCover");function Q(e){var r=e.length-1;return r<0&&(r=0),[e[0],e[r]]}u(Q,"getTrackEnds");function $(e,r,t,n){var a=new S.default;return a.add(new U.default({name:"main",style:z(t),silent:!0,draggable:!0,cursor:"move",drift:o.curry(X,e,r,a,["n","s","w","e"]),ondragend:o.curry(l,r,{isEnd:!0})})),o.each(n,function(i){a.add(new U.default({name:i.join(""),style:{opacity:0},draggable:!0,silent:!0,invisible:!0,drift:o.curry(X,e,r,a,i),ondragend:o.curry(l,r,{isEnd:!0})}))}),a}u($,"createBaseRectCover");function x(e,r,t,n){var a=n.brushStyle.lineWidth||0,i=m(a,de),s=t[0][0],f=t[1][0],h=s-a/2,c=f-a/2,g=t[0][1],C=t[1][1],v=g-i+a/2,d=C-i+a/2,b=g-s,E=C-f,L=b+a,A=E+a;p(e,r,"main",s,f,b,E),n.transformable&&(p(e,r,"w",h,c,i,A),p(e,r,"e",v,c,i,A),p(e,r,"n",h,c,L,i),p(e,r,"s",h,d,L,i),p(e,r,"nw",h,c,i,i),p(e,r,"ne",v,c,i,i),p(e,r,"sw",h,d,i,i),p(e,r,"se",v,d,i,i))}u(x,"updateBaseRect");function R(e,r){var t=r.__brushOption,n=t.transformable,a=r.childAt(0);a.useStyle(z(t)),a.attr({silent:!n,cursor:n?"move":"default"}),o.each([["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]],function(i){var s=r.childOfName(i.join("")),f=i.length===1?O(e,i[0]):be(e,i);s&&s.attr({silent:!n,invisible:!n,cursor:n?ge[f]+"-resize":null})})}u(R,"updateCommon");function p(e,r,t,n,a,i,s){var f=r.childOfName(t);f&&f.setShape(Ce(k(e,r,[[n,a],[n+i,a+s]])))}u(p,"updateRectShape");function z(e){return o.defaults({strokeNoScale:!0},e.brushStyle)}u(z,"makeStyle");function ee(e,r,t,n){var a=[y(e,t),y(r,n)],i=[m(e,t),m(r,n)];return[[a[0],i[0]],[a[1],i[1]]]}u(ee,"formatRectRange");function me(e){return Z.getTransform(e.group)}u(me,"getTransform");function O(e,r){var t={w:"left",e:"right",n:"top",s:"bottom"},n={left:"w",right:"e",top:"n",bottom:"s"},a=Z.transformDirection(t[r],me(e));return n[a]}u(O,"getGlobalDirection1");function be(e,r){var t=[O(e,r[0]),O(e,r[1])];return(t[0]==="e"||t[0]==="w")&&t.reverse(),t.join("")}u(be,"getGlobalDirection2");function X(e,r,t,n,a,i){var s=t.__brushOption,f=e.toRectRange(s.range),h=re(r,a,i);o.each(n,function(c){var g=ce[c];f[g[0]][g[1]]+=h[g[0]]}),s.range=e.fromRectRange(ee(f[0][0],f[1][0],f[0][1],f[1][1])),N(r,t),l(r,{isEnd:!1})}u(X,"driftRect");function ye(e,r,t,n){var a=r.__brushOption.range,i=re(e,t,n);o.each(a,function(s){s[0]+=i[0],s[1]+=i[1]}),N(e,r),l(e,{isEnd:!1})}u(ye,"driftPolygon");function re(e,r,t){var n=e.group,a=n.transformCoordToLocal(r,t),i=n.transformCoordToLocal(0,0);return[a[0]-i[0],a[1]-i[1]]}u(re,"toLocalDelta");function k(e,r,t){var n=J(e,r);return n&&n!==_?n.clipPath(t,e._transform):o.clone(t)}u(k,"clipByPanel");function Ce(e){var r=y(e[0][0],e[1][0]),t=y(e[0][1],e[1][1]),n=m(e[0][0],e[1][0]),a=m(e[0][1],e[1][1]);return{x:r,y:t,width:n-r,height:a-t}}u(Ce,"pointsToRect");function Ee(e,r,t){if(!(!e._brushType||Te(e,r.offsetX,r.offsetY))){var n=e._zr,a=e._covers,i=M(e,r,t);if(!e._dragging)for(var s=0;s<a.length;s++){var f=a[s].__brushOption;if(i&&(i===_||f.panelId===i.panelId)&&w[f.brushType].contain(a[s],t[0],t[1]))return}i&&n.setCursorStyle("crosshair")}}u(Ee,"resetCursor");function D(e){var r=e.event;r.preventDefault&&r.preventDefault()}u(D,"preventDefault");function B(e,r,t){return e.childOfName("main").contain(r,t)}u(B,"mainShapeContain");function te(e,r,t,n){var a=e._creatingCover,i=e._creatingPanel,s=e._brushOption,f;if(e._track.push(t.slice()),le(e)||a){if(i&&!a){s.brushMode==="single"&&T(e);var h=o.clone(s);h.brushType=Y(h.brushType,i),h.panelId=i===_?null:i.panelId,a=e._creatingCover=j(e,h),e._covers.push(a)}if(a){var c=w[Y(e._brushType,i)],g=a.__brushOption;g.range=c.getCreatingRange(k(e,a,e._track)),n&&(K(e,a),c.updateCommon(e,a)),I(e,a),f={isEnd:n}}}else n&&s.brushMode==="single"&&s.removeOnClick&&M(e,r,t)&&T(e)&&(f={isEnd:n,removeOnClick:!0});return f}u(te,"updateCoverByMouse");function Y(e,r){return e==="auto"?(process.env.NODE_ENV!=="production"&&o.assert(r&&r.defaultBrushType,'MUST have defaultBrushType when brushType is "atuo"'),r.defaultBrushType):e}u(Y,"determineBrushType");var we={mousedown:u(function(e){if(this._dragging)W(this,e);else if(!e.target||!e.target.draggable){D(e);var r=this.group.transformCoordToLocal(e.offsetX,e.offsetY);this._creatingCover=null;var t=this._creatingPanel=M(this,e,r);t&&(this._dragging=!0,this._track=[r.slice()])}},"mousedown"),mousemove:u(function(e){var r=e.offsetX,t=e.offsetY,n=this.group.transformCoordToLocal(r,t);if(Ee(this,e,n),this._dragging){D(e);var a=te(this,e,n,!1);a&&l(this,a)}},"mousemove"),mouseup:u(function(e){W(this,e)},"mouseup")};function W(e,r){if(e._dragging){D(r);var t=r.offsetX,n=r.offsetY,a=e.group.transformCoordToLocal(t,n),i=te(e,r,a,!0);e._dragging=!1,e._track=[],e._creatingCover=null,i&&l(e,i)}}u(W,"handleDragEnd");function Te(e,r,t){var n=e._zr;return r<0||r>n.getWidth()||t<0||t>n.getHeight()}u(Te,"isOutsideZrArea");var w={lineX:q(0),lineY:q(1),rect:{createCover:u(function(e,r){function t(n){return n}return u(t,"returnInput"),$({toRectRange:t,fromRectRange:t},e,r,[["w"],["e"],["n"],["s"],["s","e"],["s","w"],["n","e"],["n","w"]])},"createCover"),getCreatingRange:u(function(e){var r=Q(e);return ee(r[1][0],r[1][1],r[0][0],r[0][1])},"getCreatingRange"),updateCoverShape:u(function(e,r,t,n){x(e,r,t,n)},"updateCoverShape"),updateCommon:R,contain:B},polygon:{createCover:u(function(e,r){var t=new S.default;return t.add(new se.default({name:"main",style:z(r),silent:!0})),t},"createCover"),getCreatingRange:u(function(e){return e},"getCreatingRange"),endCreating:u(function(e,r){r.remove(r.childAt(0)),r.add(new oe.default({name:"main",draggable:!0,drift:o.curry(ye,e,r),ondragend:o.curry(l,e,{isEnd:!0})}))},"endCreating"),updateCoverShape:u(function(e,r,t,n){r.childAt(0).setShape({points:k(e,r,t)})},"updateCoverShape"),updateCommon:R,contain:B}};function q(e){return{createCover:u(function(r,t){return $({toRectRange:u(function(n){var a=[n,[0,100]];return e&&a.reverse(),a},"toRectRange"),fromRectRange:u(function(n){return n[e]},"fromRectRange")},r,t,[[["w"],["e"]],[["n"],["s"]]][e])},"createCover"),getCreatingRange:u(function(r){var t=Q(r),n=y(t[0][e],t[1][e]),a=m(t[0][e],t[1][e]);return[n,a]},"getCreatingRange"),updateCoverShape:u(function(r,t,n,a){var i,s=J(r,t);if(s!==_&&s.getLinearBrushOtherExtent)i=s.getLinearBrushOtherExtent(e);else{var f=r._zr;i=[0,[f.getWidth(),f.getHeight()][1-e]]}var h=[n,i];e&&h.reverse(),x(r,t,h,a)},"updateCoverShape"),updateCommon:R,contain:B}}u(q,"getLineRenderer");exports.default=_e;
