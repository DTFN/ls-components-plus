"use strict";var T=Object.defineProperty;var v=(s,e)=>T(s,"name",{value:e,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const h=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),b=require("../../../util/layout/index.cjs"),y=require("../../axisHelper/index.cjs"),A=require("../Cartesian2D/index.cjs"),I=require("../Axis2D/index.cjs"),L=require("../../../util/model/index.cjs"),m=require("../cartesianAxisHelper/index.cjs"),S=require("../../../scale/helper/index.cjs"),D=require("../../axisAlignTicks/index.cjs");var M=function(){function s(e,i,r){this.type="grid",this._coordsMap={},this._coordsList=[],this._axesMap={},this._axesList=[],this.axisPointerEnabled=!0,this.dimensions=A.cartesian2DDimensions,this._initCartesian(e,i,r),this.model=e}return v(s,"Grid"),s.prototype.getRect=function(){return this._rect},s.prototype.update=function(e,i){var r=this._axesMap;this._updateScale(e,this.model);function t(n){var c,l=h.keys(n),a=l.length;if(a){for(var f=[],u=a-1;u>=0;u--){var g=+l[u],x=n[g],d=x.model,p=x.scale;S.isIntervalOrLogScale(p)&&d.get("alignTicks")&&d.get("interval")==null?f.push(x):(y.niceScaleExtent(p,d),S.isIntervalOrLogScale(p)&&(c=x))}f.length&&(c||(c=f.pop(),y.niceScaleExtent(c.scale,c.model)),h.each(f,function(C){D.alignScaleTicks(C.scale,C.model,c.scale)}))}}v(t,"updateAxisTicks"),t(r.x),t(r.y);var o={};h.each(r.x,function(n){E(r,"y",n,o)}),h.each(r.y,function(n){E(r,"x",n,o)}),this.resize(this.model,i)},s.prototype.resize=function(e,i,r){var t=e.getBoxLayoutParams(),o=!r&&e.get("containLabel"),n=b.getLayoutRect(t,{width:i.getWidth(),height:i.getHeight()});this._rect=n;var c=this._axesList;l(),o&&(h.each(c,function(a){if(!a.model.get(["axisLabel","inside"])){var f=y.estimateLabelUnionRect(a);if(f){var u=a.isHorizontal()?"height":"width",g=a.model.get(["axisLabel","margin"]);n[u]-=f[u]+g,a.position==="top"?n.y+=f.height+g:a.position==="left"&&(n.x+=f.width+g)}}}),l()),h.each(this._coordsList,function(a){a.calcAffineTransform()});function l(){h.each(c,function(a){var f=a.isHorizontal(),u=f?[0,n.width]:[0,n.height],g=a.inverse?1:0;a.setExtent(u[g],u[1-g]),w(a,f?n.x:n.y)})}v(l,"adjustAxes")},s.prototype.getAxis=function(e,i){var r=this._axesMap[e];if(r!=null)return r[i||0]},s.prototype.getAxes=function(){return this._axesList.slice()},s.prototype.getCartesian=function(e,i){if(e!=null&&i!=null){var r="x"+e+"y"+i;return this._coordsMap[r]}h.isObject(e)&&(i=e.yAxisIndex,e=e.xAxisIndex);for(var t=0,o=this._coordsList;t<o.length;t++)if(o[t].getAxis("x").index===e||o[t].getAxis("y").index===i)return o[t]},s.prototype.getCartesians=function(){return this._coordsList.slice()},s.prototype.convertToPixel=function(e,i,r){var t=this._findConvertTarget(i);return t.cartesian?t.cartesian.dataToPoint(r):t.axis?t.axis.toGlobalCoord(t.axis.dataToCoord(r)):null},s.prototype.convertFromPixel=function(e,i,r){var t=this._findConvertTarget(i);return t.cartesian?t.cartesian.pointToData(r):t.axis?t.axis.coordToData(t.axis.toLocalCoord(r)):null},s.prototype._findConvertTarget=function(e){var i=e.seriesModel,r=e.xAxisModel||i&&i.getReferringComponents("xAxis",L.SINGLE_REFERRING).models[0],t=e.yAxisModel||i&&i.getReferringComponents("yAxis",L.SINGLE_REFERRING).models[0],o=e.gridModel,n=this._coordsList,c,l;if(i)c=i.coordinateSystem,h.indexOf(n,c)<0&&(c=null);else if(r&&t)c=this.getCartesian(r.componentIndex,t.componentIndex);else if(r)l=this.getAxis("x",r.componentIndex);else if(t)l=this.getAxis("y",t.componentIndex);else if(o){var a=o.coordinateSystem;a===this&&(c=this._coordsList[0])}return{cartesian:c,axis:l}},s.prototype.containPoint=function(e){var i=this._coordsList[0];if(i)return i.containPoint(e)},s.prototype._initCartesian=function(e,i,r){var t=this,o=this,n={left:!1,right:!1,top:!1,bottom:!1},c={x:{},y:{}},l={x:0,y:0};if(i.eachComponent("xAxis",a("x"),this),i.eachComponent("yAxis",a("y"),this),!l.x||!l.y){this._axesMap={},this._axesList=[];return}this._axesMap=c,h.each(c.x,function(f,u){h.each(c.y,function(g,x){var d="x"+u+"y"+x,p=new A.default(d);p.master=t,p.model=e,t._coordsMap[d]=p,t._coordsList.push(p),p.addAxis(f),p.addAxis(g)})});function a(f){return function(u,g){if(_(u,e)){var x=u.get("position");f==="x"?x!=="top"&&x!=="bottom"&&(x=n.bottom?"top":"bottom"):x!=="left"&&x!=="right"&&(x=n.left?"right":"left"),n[x]=!0;var d=new I.default(f,y.createScaleByModel(u),[0,0],u.get("type"),x),p=d.type==="category";d.onBand=p&&u.get("boundaryGap"),d.inverse=u.get("inverse"),u.axis=d,d.model=u,d.grid=o,d.index=g,o._axesList.push(d),c[f][g]=d,l[f]++}}}v(a,"createAxisCreator")},s.prototype._updateScale=function(e,i){h.each(this._axesList,function(t){if(t.scale.setExtent(1/0,-1/0),t.type==="category"){var o=t.model.get("categorySortInfo");t.scale.setSortInfo(o)}}),e.eachSeries(function(t){if(m.isCartesian2DSeries(t)){var o=m.findAxisModels(t),n=o.xAxisModel,c=o.yAxisModel;if(!_(n,i)||!_(c,i))return;var l=this.getCartesian(n.componentIndex,c.componentIndex),a=t.getData(),f=l.getAxis("x"),u=l.getAxis("y");r(a,f),r(a,u)}},this);function r(t,o){h.each(y.getDataDimensionsOnAxis(t,o.dim),function(n){o.scale.unionExtentFromData(t,n)})}v(r,"unionExtent")},s.prototype.getTooltipAxes=function(e){var i=[],r=[];return h.each(this.getCartesians(),function(t){var o=e!=null&&e!=="auto"?t.getAxis(e):t.getBaseAxis(),n=t.getOtherAxis(o);h.indexOf(i,o)<0&&i.push(o),h.indexOf(r,n)<0&&r.push(n)}),{baseAxes:i,otherAxes:r}},s.create=function(e,i){var r=[];return e.eachComponent("grid",function(t,o){var n=new s(t,e,i);n.name="grid_"+o,n.resize(t,i,!0),t.coordinateSystem=n,r.push(n)}),e.eachSeries(function(t){if(m.isCartesian2DSeries(t)){var o=m.findAxisModels(t),n=o.xAxisModel,c=o.yAxisModel,l=n.getCoordSysModel();if(process.env.NODE_ENV!=="production"){if(!l)throw new Error('Grid "'+h.retrieve3(n.get("gridIndex"),n.get("gridId"),0)+'" not found');if(n.getCoordSysModel()!==c.getCoordSysModel())throw new Error("xAxis and yAxis must use the same grid")}var a=l.coordinateSystem;t.coordinateSystem=a.getCartesian(n.componentIndex,c.componentIndex)}}),r},s.dimensions=A.cartesian2DDimensions,s}();function _(s,e){return s.getCoordSysModel()===e}v(_,"isAxisUsedInTheGrid");function E(s,e,i,r){i.getAxesOnZeroOf=function(){return o?[o]:[]};var t=s[e],o,n=i.model,c=n.get(["axisLine","onZero"]),l=n.get(["axisLine","onZeroAxisIndex"]);if(!c)return;if(l!=null)O(t[l])&&(o=t[l]);else for(var a in t)if(t.hasOwnProperty(a)&&O(t[a])&&!r[f(t[a])]){o=t[a];break}o&&(r[f(o)]=!0);function f(u){return u.dim+"_"+u.index}v(f,"getOnZeroRecordKey")}v(E,"fixAxisOnZero");function O(s){return s&&s.type!=="category"&&s.type!=="time"&&y.ifAxisCrossZero(s)}v(O,"canOnZeroToAxis");function w(s,e){var i=s.getExtent(),r=i[0]+i[1];s.toGlobalCoord=s.dim==="x"?function(t){return t+e}:function(t){return r-t+e},s.toLocalCoord=s.dim==="x"?function(t){return t-e}:function(t){return r-t+e}}v(w,"updateAxisTransform");exports.default=M;
