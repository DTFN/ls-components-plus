"use strict";var Y=Object.defineProperty;var b=(e,n)=>Y(e,"name",{value:n,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const R=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),o=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),P=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Displayable/index.cjs"),I=require("../../../util/model/index.cjs"),J=require("../../../util/graphic/index.cjs"),Q=require("../../../util/layout/index.cjs"),$=require("../../../util/number/index.cjs"),k=require("../../../view/Component/index.cjs"),F=require("../../../util/innerStore/index.cjs"),W=require("../../../util/styleCompat/index.cjs"),N=require("../../../animation/customGraphicTransition/index.cjs"),O=require("../../../animation/basicTransition/index.cjs"),K=require("../../../animation/customGraphicKeyframeAnimation/index.cjs"),H=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Text/index.cjs"),ee=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),te=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Image/index.cjs");var Z={path:null,compoundPath:null,group:ee.default,image:te.default,text:H.default},c=I.makeInner(),ne=function(e){R.__extends(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.type=n.type,t}return b(n,"GraphicComponentView"),n.prototype.init=function(){this._elMap=o.createHashMap()},n.prototype.render=function(t,i,r){t!==this._lastGraphicModel&&this._clear(),this._lastGraphicModel=t,this._updateElements(t),this._relocate(t,r)},n.prototype._updateElements=function(t){var i=t.useElOptionsToUpdate();if(i){var r=this._elMap,v=this.group,T=t.get("z"),A=t.get("zlevel");o.each(i,function(a){var x=I.convertOptionIdName(a.id,null),f=x!=null?r.get(x):null,d=I.convertOptionIdName(a.parentId,null),y=d!=null?r.get(d):v,s=a.type,p=a.style;s==="text"&&p&&a.hv&&a.hv[1]&&(p.textVerticalAlign=p.textBaseline=p.verticalAlign=p.align=null);var m=a.textContent,C=a.textConfig;if(p&&W.isEC4CompatibleStyle(p,s,!!C,!!m)){var h=W.convertFromEC4CompatibleStyle(p,s);!C&&h.textConfig&&(C=a.textConfig=h.textConfig),!m&&h.textContent&&(m=h.textContent)}var D=re(a);process.env.NODE_ENV!=="production"&&f&&o.assert(y===f.parent,"Changing parent is not supported.");var E=a.$action||"merge",G=E==="merge",q=E==="replace";if(G){var g=!f,l=f;g?l=j(x,y,a.type,r):(l&&(c(l).isNew=!1),K.stopPreviousKeyframeAnimationAndRestore(l)),l&&(N.applyUpdateTransition(l,D,t,{isInit:g}),B(l,a,T,A))}else if(q){V(f,a,r,t);var w=j(x,y,a.type,r);w&&(N.applyUpdateTransition(w,D,t,{isInit:!0}),B(w,a,T,A))}else E==="remove"&&(N.updateLeaveTo(f,a),V(f,a,r,t));var u=r.get(x);if(u&&m)if(G){var M=u.getTextContent();M?M.attr(m):u.setTextContent(new H.default(m))}else q&&u.setTextContent(new H.default(m));if(u){var S=a.clipPath;if(S){var z=S.type,_=void 0,g=!1;if(G){var U=u.getClipPath();g=!U||c(U).type!==z,_=g?L(z):U}else q&&(g=!0,_=L(z));u.setClipPath(_),N.applyUpdateTransition(_,S,t,{isInit:g}),K.applyKeyframeAnimation(_,S.keyframeAnimation,t)}var X=c(u);u.setTextConfig(C),X.option=a,ae(u,t,a),J.setTooltipConfig({el:u,componentModel:t,itemName:u.name,itemTooltipOption:a.tooltip}),K.applyKeyframeAnimation(u,a.keyframeAnimation,t)}})}},n.prototype._relocate=function(t,i){for(var r=t.option.elements,v=this.group,T=this._elMap,A=i.getWidth(),a=i.getHeight(),x=["x","y"],f=0;f<r.length;f++){var d=r[f],y=I.convertOptionIdName(d.id,null),s=y!=null?T.get(y):null;if(!(!s||!s.isGroup)){var p=s.parent,m=p===v,C=c(s),h=c(p);C.width=$.parsePercent(C.option.width,m?A:h.width)||0,C.height=$.parsePercent(C.option.height,m?a:h.height)||0}}for(var f=r.length-1;f>=0;f--){var d=r[f],y=I.convertOptionIdName(d.id,null),s=y!=null?T.get(y):null;if(s){var p=s.parent,h=c(p),D=p===v?{width:A,height:a}:{width:h.width,height:h.height},E={},G=Q.positionElement(s,d,D,null,{hv:d.hv,boundingMode:d.bounding},E);if(!c(s).isNew&&G){for(var q=d.transition,g={},l=0;l<x.length;l++){var w=x[l],u=E[w];q&&(N.isTransitionAll(q)||o.indexOf(q,w)>=0)?g[w]=u:s[w]=u}O.updateProps(s,g,t,0)}else s.attr(E)}}},n.prototype._clear=function(){var t=this,i=this._elMap;i.each(function(r){V(r,c(r).option,i,t._lastGraphicModel)}),this._elMap=o.createHashMap()},n.prototype.dispose=function(){this._clear()},n.type="graphic",n}(k.default);function L(e){process.env.NODE_ENV!=="production"&&o.assert(e,"graphic type MUST be set");var n=o.hasOwn(Z,e)?Z[e]:J.getShapeClass(e);process.env.NODE_ENV!=="production"&&o.assert(n,"graphic type "+e+" can not be found");var t=new n({});return c(t).type=e,t}b(L,"newEl");function j(e,n,t,i){var r=L(t);return n.add(r),i.set(e,r),c(r).id=e,c(r).isNew=!0,r}b(j,"createEl");function V(e,n,t,i){var r=e&&e.parent;r&&(e.type==="group"&&e.traverse(function(v){V(v,n,t,i)}),N.applyLeaveTransition(e,n,i),t.removeKey(c(e).id))}b(V,"removeEl");function B(e,n,t,i){e.isGroup||o.each([["cursor",P.default.prototype.cursor],["zlevel",i||0],["z",t||0],["z2",0]],function(r){var v=r[0];o.hasOwn(n,v)?e[v]=o.retrieve2(n[v],r[1]):e[v]==null&&(e[v]=r[1])}),o.each(o.keys(n),function(r){if(r.indexOf("on")===0){var v=n[r];e[r]=o.isFunction(v)?v:null}}),o.hasOwn(n,"draggable")&&(e.draggable=n.draggable),n.name!=null&&(e.name=n.name),n.id!=null&&(e.id=n.id)}b(B,"updateCommonAttrs");function re(e){return e=o.extend({},e),o.each(["id","parentId","$action","hv","bounding","textContent","clipPath"].concat(Q.LOCATION_PARAMS),function(n){delete e[n]}),e}b(re,"getCleanedElOption");function ae(e,n,t){var i=F.getECData(e).eventData;!e.silent&&!e.ignore&&!i&&(i=F.getECData(e).eventData={componentType:"graphic",componentIndex:n.componentIndex,name:e.name}),i&&(i.info=t.info)}b(ae,"setEventData");exports.GraphicComponentView=ne;exports.inner=c;
