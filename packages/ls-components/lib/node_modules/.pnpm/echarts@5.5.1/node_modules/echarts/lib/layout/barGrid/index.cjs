"use strict";var Z=Object.defineProperty;var y=(e,r)=>Z(e,"name",{value:r,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const W=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),M=require("../../util/number/index.cjs"),$=require("../../data/helper/dataStackHelper/index.cjs"),j=require("../../chart/helper/createRenderPlanner/index.cjs"),R=require("../../util/vendor/index.cjs");var N="__ec_stack_";function E(e){return e.get("stack")||N+e.seriesIndex}y(E,"getSeriesStackId");function F(e){return e.dim+e.index}y(F,"getAxisKey");function X(e,r){var t=[];return r.eachSeriesByType(e,function(a){Q(a)&&t.push(a)}),t}y(X,"prepareLayoutBarSeries");function aa(e){var r={};W.each(e,function(g){var v=g.coordinateSystem,o=v.getBaseAxis();if(!(o.type!=="time"&&o.type!=="value"))for(var d=g.getData(),u=o.dim+"_"+o.index,m=d.getDimensionIndex(d.mapDimension(o.dim)),p=d.getStore(),b=0,l=p.count();b<l;++b){var c=p.get(m,b);r[u]?r[u].push(c):r[u]=[c]}});var t={};for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];if(s){s.sort(function(g,v){return g-v});for(var i=null,h=1;h<s.length;++h){var n=s[h]-s[h-1];n>0&&(i=i===null?n:Math.min(i,n))}t[a]=i}}return t}y(aa,"getValueAxesMinGaps");function J(e){var r=aa(e),t=[];return W.each(e,function(a){var s=a.coordinateSystem,i=s.getBaseAxis(),h=i.getExtent(),n;if(i.type==="category")n=i.getBandWidth();else if(i.type==="value"||i.type==="time"){var g=i.dim+"_"+i.index,v=r[g],o=Math.abs(h[1]-h[0]),d=i.scale.getExtent(),u=Math.abs(d[1]-d[0]);n=v?o/u*v:o}else{var m=a.getData();n=Math.abs(h[1]-h[0])/m.count()}var p=M.parsePercent(a.get("barWidth"),n),b=M.parsePercent(a.get("barMaxWidth"),n),l=M.parsePercent(a.get("barMinWidth")||(U(a)?.5:1),n),c=a.get("barGap"),x=a.get("barCategoryGap");t.push({bandWidth:n,barWidth:p,barMaxWidth:b,barMinWidth:l,barGap:c,barCategoryGap:x,axisKey:F(i),stackId:E(a)})}),ta(t)}y(J,"makeColumnLayout");function ta(e){var r={};W.each(e,function(a,s){var i=a.axisKey,h=a.bandWidth,n=r[i]||{bandWidth:h,remainedWidth:h,autoWidthCount:0,categoryGap:null,gap:"20%",stacks:{}},g=n.stacks;r[i]=n;var v=a.stackId;g[v]||n.autoWidthCount++,g[v]=g[v]||{width:0,maxWidth:0};var o=a.barWidth;o&&!g[v].width&&(g[v].width=o,o=Math.min(n.remainedWidth,o),n.remainedWidth-=o);var d=a.barMaxWidth;d&&(g[v].maxWidth=d);var u=a.barMinWidth;u&&(g[v].minWidth=u);var m=a.barGap;m!=null&&(n.gap=m);var p=a.barCategoryGap;p!=null&&(n.categoryGap=p)});var t={};return W.each(r,function(a,s){t[s]={};var i=a.stacks,h=a.bandWidth,n=a.categoryGap;if(n==null){var g=W.keys(i).length;n=Math.max(35-g*4,15)+"%"}var v=M.parsePercent(n,h),o=M.parsePercent(a.gap,1),d=a.remainedWidth,u=a.autoWidthCount,m=(d-v)/(u+(u-1)*o);m=Math.max(m,0),W.each(i,function(c){var x=c.maxWidth,k=c.minWidth;if(c.width){var f=c.width;x&&(f=Math.min(f,x)),k&&(f=Math.max(f,k)),c.width=f,d-=f+o*f,u--}else{var f=m;x&&x<f&&(f=Math.min(x,d)),k&&k>f&&(f=k),f!==m&&(c.width=f,d-=f+o*f,u--)}}),m=(d-v)/(u+(u-1)*o),m=Math.max(m,0);var p=0,b;W.each(i,function(c,x){c.width||(c.width=m),b=c,p+=c.width*(1+o)}),b&&(p-=b.width*o);var l=-p/2;W.each(i,function(c,x){t[s][x]=t[s][x]||{bandWidth:h,offset:l,width:c.width},l+=c.width*(1+o)})}),t}y(ta,"doCalBarWidthAndOffset");function ra(e,r,t){if(e&&r){var a=e[F(r)];return a!=null&&t!=null?a[E(t)]:a}}y(ra,"retrieveColumnLayout");function ea(e,r){var t=X(e,r),a=J(t);W.each(t,function(s){var i=s.getData(),h=s.coordinateSystem,n=h.getBaseAxis(),g=E(s),v=a[F(n)][g],o=v.offset,d=v.width;i.setLayout({bandWidth:v.bandWidth,offset:o,size:d})})}y(ea,"layout");function ia(e){return{seriesType:e,plan:j.default(),reset:y(function(r){if(Q(r)){var t=r.getData(),a=r.coordinateSystem,s=a.getBaseAxis(),i=a.getOtherAxis(s),h=t.getDimensionIndex(t.mapDimension(i.dim)),n=t.getDimensionIndex(t.mapDimension(s.dim)),g=r.get("showBackground",!0),v=t.mapDimension(i.dim),o=t.getCalculationInfo("stackResultDimension"),d=$.isDimensionStacked(t,v)&&!!t.getCalculationInfo("stackedOnSeries"),u=i.isHorizontal(),m=na(s,i),p=U(r),b=r.get("barMinHeight")||0,l=o&&t.getDimensionIndex(o),c=t.getLayout("size"),x=t.getLayout("offset");return{progress:y(function(k,f){for(var H=k.count,A=p&&R.createFloat32Array(H*3),S=p&&g&&R.createFloat32Array(H*3),V=p&&R.createFloat32Array(H),T=a.master.getRect(),Y=u?T.width:T.height,D,q=f.getStore(),P=0;(D=k.next())!=null;){var z=q.get(d?l:h,D),_=q.get(n,D),L=m,K=void 0;d&&(K=+z-q.get(h,D));var w=void 0,B=void 0,C=void 0,G=void 0;if(u){var I=a.dataToPoint([z,_]);if(d){var O=a.dataToPoint([K,_]);L=O[0]}w=L,B=I[1]+x,C=I[0]-L,G=c,Math.abs(C)<b&&(C=(C<0?-1:1)*b)}else{var I=a.dataToPoint([_,z]);if(d){var O=a.dataToPoint([_,K]);L=O[1]}w=I[0]+x,B=L,C=c,G=I[1]-L,Math.abs(G)<b&&(G=(G<=0?-1:1)*b)}p?(A[P]=w,A[P+1]=B,A[P+2]=u?C:G,S&&(S[P]=u?T.x:w,S[P+1]=u?B:T.y,S[P+2]=Y),V[D]=D):f.setItemLayout(D,{x:w,y:B,width:C,height:G}),P+=3}p&&f.setLayout({largePoints:A,largeDataIndices:V,largeBackgroundPoints:S,valueAxisHorizontal:u})},"progress")}}},"reset")}}y(ia,"createProgressiveLayout");function Q(e){return e.coordinateSystem&&e.coordinateSystem.type==="cartesian2d"}y(Q,"isOnCartesian");function U(e){return e.pipelineContext&&e.pipelineContext.large}y(U,"isInLargeMode");function na(e,r){var t=r.model.get("startValue");return t||(t=0),r.toGlobalCoord(r.dataToCoord(r.type==="log"?t>0?t:1:t))}y(na,"getValueAxisStart");exports.createProgressiveLayout=ia;exports.layout=ea;exports.makeColumnLayout=J;exports.prepareLayoutBarSeries=X;exports.retrieveColumnLayout=ra;
