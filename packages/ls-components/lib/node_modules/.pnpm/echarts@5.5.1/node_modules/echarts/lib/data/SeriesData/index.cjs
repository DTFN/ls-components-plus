"use strict";var F=Object.defineProperty;var _=(n,t)=>F(n,"name",{value:t,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const s=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),C=require("../../model/Model/index.cjs"),P=require("../DataDiffer/index.cjs"),T=require("../helper/dataProvider/index.cjs"),q=require("../helper/dimensionHelper/index.cjs"),x=require("../SeriesDimensionDefine/index.cjs"),L=require("../../util/types/index.cjs"),y=require("../../util/model/index.cjs"),G=require("../../util/innerStore/index.cjs"),H=require("../Source/index.cjs"),R=require("../DataStore/index.cjs"),z=require("../helper/SeriesDataSchema/index.cjs");var I=s.isObject,d=s.map,B=typeof Int32Array>"u"?Array:Int32Array,U="e\0\0",N=-1,j=["hasItemOption","_nameList","_idList","_invertedIndicesMap","_dimSummary","userOutput","_rawData","_dimValueGetter","_nameDimIdx","_idDimIdx","_nameRepeatCount"],X=["_approximateExtent"],V,g,D,v,O,S,M,Y=function(){function n(t,e){this.type="list",this._dimOmitted=!1,this._nameList=[],this._idList=[],this._visual={},this._layout={},this._itemVisuals=[],this._itemLayouts=[],this._graphicEls=[],this._approximateExtent={},this._calculationInfo={},this.hasItemOption=!1,this.TRANSFERABLE_METHODS=["cloneShallow","downSample","lttbDownSample","map"],this.CHANGABLE_METHODS=["filterSelf","selectRange"],this.DOWNSAMPLE_METHODS=["downSample","lttbDownSample"];var i,r=!1;z.isSeriesDataSchema(t)?(i=t.dimensions,this._dimOmitted=t.isDimensionOmitted(),this._schema=t):(r=!0,i=t),i=i||["x","y"];for(var o={},h=[],a={},u=!1,f={},l=0;l<i.length;l++){var c=i[l],p=s.isString(c)?new x.default({name:c}):c instanceof x.default?c:new x.default(c),m=p.name;p.type=p.type||"float",p.coordDim||(p.coordDim=m,p.coordDimIndex=0);var w=p.otherDims=p.otherDims||{};h.push(m),o[m]=p,f[m]!=null&&(u=!0),p.createInvertedIndices&&(a[m]=[]),w.itemName===0&&(this._nameDimIdx=l),w.itemId===0&&(this._idDimIdx=l),process.env.NODE_ENV!=="production"&&s.assert(r||p.storeDimIndex>=0),r&&(p.storeDimIndex=l)}if(this.dimensions=h,this._dimInfos=o,this._initGetDimensionInfo(u),this.hostModel=e,this._invertedIndicesMap=a,this._dimOmitted){var A=this._dimIdxToName=s.createHashMap();s.each(h,function(E){A.set(o[E].storeDimIndex,E)})}}return _(n,"SeriesData"),n.prototype.getDimension=function(t){var e=this._recognizeDimIndex(t);if(e==null)return t;if(e=t,!this._dimOmitted)return this.dimensions[e];var i=this._dimIdxToName.get(e);if(i!=null)return i;var r=this._schema.getSourceDimension(e);if(r)return r.name},n.prototype.getDimensionIndex=function(t){var e=this._recognizeDimIndex(t);if(e!=null)return e;if(t==null)return-1;var i=this._getDimInfo(t);return i?i.storeDimIndex:this._dimOmitted?this._schema.getSourceDimensionIndex(t):-1},n.prototype._recognizeDimIndex=function(t){if(s.isNumber(t)||t!=null&&!isNaN(t)&&!this._getDimInfo(t)&&(!this._dimOmitted||this._schema.getSourceDimensionIndex(t)<0))return+t},n.prototype._getStoreDimIndex=function(t){var e=this.getDimensionIndex(t);if(process.env.NODE_ENV!=="production"&&e==null)throw new Error("Unknown dimension "+t);return e},n.prototype.getDimensionInfo=function(t){return this._getDimInfo(this.getDimension(t))},n.prototype._initGetDimensionInfo=function(t){var e=this._dimInfos;this._getDimInfo=t?function(i){return e.hasOwnProperty(i)?e[i]:void 0}:function(i){return e[i]}},n.prototype.getDimensionsOnCoord=function(){return this._dimSummary.dataDimsOnCoord.slice()},n.prototype.mapDimension=function(t,e){var i=this._dimSummary;if(e==null)return i.encodeFirstDimNotExtra[t];var r=i.encode[t];return r?r[e]:null},n.prototype.mapDimensionsAll=function(t){var e=this._dimSummary,i=e.encode[t];return(i||[]).slice()},n.prototype.getStore=function(){return this._store},n.prototype.initData=function(t,e,i){var r=this,o;if(t instanceof R.default&&(o=t),!o){var h=this.dimensions,a=H.isSourceInstance(t)||s.isArrayLike(t)?new T.DefaultDataProvider(t,h.length):t;o=new R.default;var u=d(h,function(f){return{type:r._dimInfos[f].type,property:f}});o.initData(a,u,i)}this._store=o,this._nameList=(e||[]).slice(),this._idList=[],this._nameRepeatCount={},this._doInit(0,o.count()),this._dimSummary=q.summarizeDimensions(this,this._schema),this.userOutput=this._dimSummary.userOutput},n.prototype.appendData=function(t){var e=this._store.appendData(t);this._doInit(e[0],e[1])},n.prototype.appendValues=function(t,e){var i=this._store.appendValues(t,e.length),r=i.start,o=i.end,h=this._shouldMakeIdFromName();if(this._updateOrdinalMeta(),e)for(var a=r;a<o;a++){var u=a-r;this._nameList[a]=e[u],h&&M(this,a)}},n.prototype._updateOrdinalMeta=function(){for(var t=this._store,e=this.dimensions,i=0;i<e.length;i++){var r=this._dimInfos[e[i]];r.ordinalMeta&&t.collectOrdinalMeta(r.storeDimIndex,r.ordinalMeta)}},n.prototype._shouldMakeIdFromName=function(){var t=this._store.getProvider();return this._idDimIdx==null&&t.getSource().sourceFormat!==L.SOURCE_FORMAT_TYPED_ARRAY&&!t.fillStorage},n.prototype._doInit=function(t,e){if(!(t>=e)){var i=this._store,r=i.getProvider();this._updateOrdinalMeta();var o=this._nameList,h=this._idList,a=r.getSource().sourceFormat,u=a===L.SOURCE_FORMAT_ORIGINAL;if(u&&!r.pure)for(var f=[],l=t;l<e;l++){var c=r.getItem(l,f);if(!this.hasItemOption&&y.isDataItemOption(c)&&(this.hasItemOption=!0),c){var p=c.name;o[l]==null&&p!=null&&(o[l]=y.convertOptionIdName(p,null));var m=c.id;h[l]==null&&m!=null&&(h[l]=y.convertOptionIdName(m,null))}}if(this._shouldMakeIdFromName())for(var l=t;l<e;l++)M(this,l);V(this)}},n.prototype.getApproximateExtent=function(t){return this._approximateExtent[t]||this._store.getDataExtent(this._getStoreDimIndex(t))},n.prototype.setApproximateExtent=function(t,e){e=this.getDimension(e),this._approximateExtent[e]=t.slice()},n.prototype.getCalculationInfo=function(t){return this._calculationInfo[t]},n.prototype.setCalculationInfo=function(t,e){I(t)?s.extend(this._calculationInfo,t):this._calculationInfo[t]=e},n.prototype.getName=function(t){var e=this.getRawIndex(t),i=this._nameList[e];return i==null&&this._nameDimIdx!=null&&(i=D(this,this._nameDimIdx,e)),i==null&&(i=""),i},n.prototype._getCategory=function(t,e){var i=this._store.get(t,e),r=this._store.getOrdinalMeta(t);return r?r.categories[i]:i},n.prototype.getId=function(t){return g(this,this.getRawIndex(t))},n.prototype.count=function(){return this._store.count()},n.prototype.get=function(t,e){var i=this._store,r=this._dimInfos[t];if(r)return i.get(r.storeDimIndex,e)},n.prototype.getByRawIndex=function(t,e){var i=this._store,r=this._dimInfos[t];if(r)return i.getByRawIndex(r.storeDimIndex,e)},n.prototype.getIndices=function(){return this._store.getIndices()},n.prototype.getDataExtent=function(t){return this._store.getDataExtent(this._getStoreDimIndex(t))},n.prototype.getSum=function(t){return this._store.getSum(this._getStoreDimIndex(t))},n.prototype.getMedian=function(t){return this._store.getMedian(this._getStoreDimIndex(t))},n.prototype.getValues=function(t,e){var i=this,r=this._store;return s.isArray(t)?r.getValues(d(t,function(o){return i._getStoreDimIndex(o)}),e):r.getValues(t)},n.prototype.hasValue=function(t){for(var e=this._dimSummary.dataDimIndicesOnCoord,i=0,r=e.length;i<r;i++)if(isNaN(this._store.get(e[i],t)))return!1;return!0},n.prototype.indexOfName=function(t){for(var e=0,i=this._store.count();e<i;e++)if(this.getName(e)===t)return e;return-1},n.prototype.getRawIndex=function(t){return this._store.getRawIndex(t)},n.prototype.indexOfRawIndex=function(t){return this._store.indexOfRawIndex(t)},n.prototype.rawIndexOf=function(t,e){var i=t&&this._invertedIndicesMap[t];if(process.env.NODE_ENV!=="production"&&!i)throw new Error("Do not supported yet");var r=i[e];return r==null||isNaN(r)?N:r},n.prototype.indicesOfNearest=function(t,e,i){return this._store.indicesOfNearest(this._getStoreDimIndex(t),e,i)},n.prototype.each=function(t,e,i){s.isFunction(t)&&(i=e,e=t,t=[]);var r=i||this,o=d(v(t),this._getStoreDimIndex,this);this._store.each(o,r?s.bind(e,r):e)},n.prototype.filterSelf=function(t,e,i){s.isFunction(t)&&(i=e,e=t,t=[]);var r=i||this,o=d(v(t),this._getStoreDimIndex,this);return this._store=this._store.filter(o,r?s.bind(e,r):e),this},n.prototype.selectRange=function(t){var e=this,i={},r=s.keys(t);return s.each(r,function(o){var h=e._getStoreDimIndex(o);i[h]=t[o]}),this._store=this._store.selectRange(i),this},n.prototype.mapArray=function(t,e,i){s.isFunction(t)&&(i=e,e=t,t=[]),i=i||this;var r=[];return this.each(t,function(){r.push(e&&e.apply(this,arguments))},i),r},n.prototype.map=function(t,e,i,r){var o=i||r||this,h=d(v(t),this._getStoreDimIndex,this),a=S(this);return a._store=this._store.map(h,o?s.bind(e,o):e),a},n.prototype.modify=function(t,e,i,r){var o=this,h=i||r||this;process.env.NODE_ENV!=="production"&&s.each(v(t),function(u){var f=o.getDimensionInfo(u);f.isCalculationCoord||console.error("Danger: only stack dimension can be modified")});var a=d(v(t),this._getStoreDimIndex,this);this._store.modify(a,h?s.bind(e,h):e)},n.prototype.downSample=function(t,e,i,r){var o=S(this);return o._store=this._store.downSample(this._getStoreDimIndex(t),e,i,r),o},n.prototype.lttbDownSample=function(t,e){var i=S(this);return i._store=this._store.lttbDownSample(this._getStoreDimIndex(t),e),i},n.prototype.getRawDataItem=function(t){return this._store.getRawDataItem(t)},n.prototype.getItemModel=function(t){var e=this.hostModel,i=this.getRawDataItem(t);return new C.default(i,e,e&&e.ecModel)},n.prototype.diff=function(t){var e=this;return new P.default(t?t.getStore().getIndices():[],this.getStore().getIndices(),function(i){return g(t,i)},function(i){return g(e,i)})},n.prototype.getVisual=function(t){var e=this._visual;return e&&e[t]},n.prototype.setVisual=function(t,e){this._visual=this._visual||{},I(t)?s.extend(this._visual,t):this._visual[t]=e},n.prototype.getItemVisual=function(t,e){var i=this._itemVisuals[t],r=i&&i[e];return r??this.getVisual(e)},n.prototype.hasItemVisual=function(){return this._itemVisuals.length>0},n.prototype.ensureUniqueItemVisual=function(t,e){var i=this._itemVisuals,r=i[t];r||(r=i[t]={});var o=r[e];return o==null&&(o=this.getVisual(e),s.isArray(o)?o=o.slice():I(o)&&(o=s.extend({},o)),r[e]=o),o},n.prototype.setItemVisual=function(t,e,i){var r=this._itemVisuals[t]||{};this._itemVisuals[t]=r,I(e)?s.extend(r,e):r[e]=i},n.prototype.clearAllVisual=function(){this._visual={},this._itemVisuals=[]},n.prototype.setLayout=function(t,e){I(t)?s.extend(this._layout,t):this._layout[t]=e},n.prototype.getLayout=function(t){return this._layout[t]},n.prototype.getItemLayout=function(t){return this._itemLayouts[t]},n.prototype.setItemLayout=function(t,e,i){this._itemLayouts[t]=i?s.extend(this._itemLayouts[t]||{},e):e},n.prototype.clearItemLayouts=function(){this._itemLayouts.length=0},n.prototype.setItemGraphicEl=function(t,e){var i=this.hostModel&&this.hostModel.seriesIndex;G.setCommonECData(i,this.dataType,t,e),this._graphicEls[t]=e},n.prototype.getItemGraphicEl=function(t){return this._graphicEls[t]},n.prototype.eachItemGraphicEl=function(t,e){s.each(this._graphicEls,function(i,r){i&&t&&t.call(e,i,r)})},n.prototype.cloneShallow=function(t){return t||(t=new n(this._schema?this._schema:d(this.dimensions,this._getDimInfo,this),this.hostModel)),O(t,this),t._store=this._store,t},n.prototype.wrapMethod=function(t,e){var i=this[t];s.isFunction(i)&&(this.__wrappedMethods=this.__wrappedMethods||[],this.__wrappedMethods.push(t),this[t]=function(){var r=i.apply(this,arguments);return e.apply(this,[r].concat(s.slice(arguments)))})},n.internalField=function(){V=_(function(t){var e=t._invertedIndicesMap;s.each(e,function(i,r){var o=t._dimInfos[r],h=o.ordinalMeta,a=t._store;if(h){i=e[r]=new B(h.categories.length);for(var u=0;u<i.length;u++)i[u]=N;for(var u=0;u<a.count();u++)i[a.get(o.storeDimIndex,u)]=u}})},"prepareInvertedIndex"),D=_(function(t,e,i){return y.convertOptionIdName(t._getCategory(e,i),null)},"getIdNameFromStore"),g=_(function(t,e){var i=t._idList[e];return i==null&&t._idDimIdx!=null&&(i=D(t,t._idDimIdx,e)),i==null&&(i=U+e),i},"getId"),v=_(function(t){return s.isArray(t)||(t=t!=null?[t]:[]),t},"normalizeDimensions"),S=_(function(t){var e=new n(t._schema?t._schema:d(t.dimensions,t._getDimInfo,t),t.hostModel);return O(e,t),e},"cloneListForMapAndSample"),O=_(function(t,e){s.each(j.concat(e.__wrappedMethods||[]),function(i){e.hasOwnProperty(i)&&(t[i]=e[i])}),t.__wrappedMethods=e.__wrappedMethods,s.each(X,function(i){t[i]=s.clone(e[i])}),t._calculationInfo=s.extend({},e._calculationInfo)},"transferProperties"),M=_(function(t,e){var i=t._nameList,r=t._idList,o=t._nameDimIdx,h=t._idDimIdx,a=i[e],u=r[e];if(a==null&&o!=null&&(i[e]=a=D(t,o,e)),u==null&&h!=null&&(r[e]=u=D(t,h,e)),u==null&&a!=null){var f=t._nameRepeatCount,l=f[a]=(f[a]||0)+1;u=a,l>1&&(u+="__ec__"+l),r[e]=u}},"makeIdFromName")}(),n}();exports.default=Y;
