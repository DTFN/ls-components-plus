"use strict";var H=Object.defineProperty;var h=(e,i)=>H(e,"name",{value:i,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const N=require("../../../util/model/index.cjs"),O=require("../modelHelper/index.cjs"),V=require("../findPointFromSeries/index.cjs"),c=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs");var B=N.makeInner();function q(e,i,a){var n=e.currTrigger,t=[e.x,e.y],d=e,r=e.dispatchAction||c.bind(a.dispatchAction,a),s=i.getComponent("axisPointer").coordSysAxesInfo;if(s){S(t)&&(t=V.default({seriesIndex:d.seriesIndex,dataIndex:d.dataIndex},i).point);var o=S(t),p=d.axesInfo,l=s.axesInfo,v=n==="leave"||S(t),u={},x={},y={list:[],map:{}},f={showPointer:c.curry(K,x),showTooltip:c.curry(L,y)};c.each(s.coordSysMap,function(m,A){var I=o||m.containPoint(t);c.each(s.coordSysAxesInfo[A],function(D,w){var P=D.axis,g=j(p,D);if(!v&&I&&(!p||g)){var M=g&&g.value;M==null&&!o&&(M=P.pointToData(t)),M!=null&&k(D,M,f,!1,u)}})});var T={};return c.each(l,function(m,A){var I=m.linkGroup;I&&!x[A]&&c.each(I.axesInfo,function(D,w){var P=x[w];if(D!==m&&P){var g=P.value;I.mapper&&(g=m.axis.scale.parse(I.mapper(g,b(D),b(m)))),T[m.key]=g}})}),c.each(T,function(m,A){k(l[A],m,f,!0,u)}),_(x,l,u),E(y,t,e,r),G(l,r,a),u}}h(q,"axisTrigger");function k(e,i,a,n,t){var d=e.axis;if(!(d.scale.isBlank()||!d.containData(i))){if(!e.involveSeries){a.showPointer(e,i);return}var r=C(i,e),s=r.payloadBatch,o=r.snapToValue;s[0]&&t.seriesIndex==null&&c.extend(t,s[0]),!n&&e.snap&&d.containData(o)&&o!=null&&(i=o),a.showPointer(e,i,s),a.showTooltip(e,r,o)}}h(k,"processOnAxis");function C(e,i){var a=i.axis,n=a.dim,t=e,d=[],r=Number.MAX_VALUE,s=-1;return c.each(i.seriesModels,function(o,p){var l=o.getData().mapDimensionsAll(n),v,u;if(o.getAxisTooltipData){var x=o.getAxisTooltipData(l,e,a);u=x.dataIndices,v=x.nestestValue}else{if(u=o.getData().indicesOfNearest(l[0],e,a.type==="category"?.5:null),!u.length)return;v=o.getData().get(l[0],u[0])}if(!(v==null||!isFinite(v))){var y=e-v,f=Math.abs(y);f<=r&&((f<r||y>=0&&s<0)&&(r=f,s=y,t=v,d.length=0),c.each(u,function(T){d.push({seriesIndex:o.seriesIndex,dataIndexInside:T,dataIndex:o.getData().getRawIndex(T)})}))}}),{payloadBatch:d,snapToValue:t}}h(C,"buildPayloadsBySeries");function K(e,i,a,n){e[i.key]={value:a,payloadBatch:n}}h(K,"showPointer");function L(e,i,a,n){var t=a.payloadBatch,d=i.axis,r=d.model,s=i.axisPointerModel;if(!(!i.triggerTooltip||!t.length)){var o=i.coordSys.model,p=O.makeKey(o),l=e.map[p];l||(l=e.map[p]={coordSysId:o.id,coordSysIndex:o.componentIndex,coordSysType:o.type,coordSysMainType:o.mainType,dataByAxis:[]},e.list.push(l)),l.dataByAxis.push({axisDim:d.dim,axisIndex:r.componentIndex,axisType:r.type,axisId:r.id,value:n,valueLabelOpt:{precision:s.get(["label","precision"]),formatter:s.get(["label","formatter"])},seriesDataIndices:t.slice()})}}h(L,"showTooltip");function _(e,i,a){var n=a.axesInfo=[];c.each(i,function(t,d){var r=t.axisPointerModel.option,s=e[d];s?(!t.useHandle&&(r.status="show"),r.value=s.value,r.seriesDataIndices=(s.payloadBatch||[]).slice()):!t.useHandle&&(r.status="hide"),r.status==="show"&&n.push({axisDim:t.axis.dim,axisIndex:t.axis.model.componentIndex,value:r.value})})}h(_,"updateModelActually");function E(e,i,a,n){if(S(i)||!e.list.length){n({type:"hideTip"});return}var t=((e.list[0].dataByAxis[0]||{}).seriesDataIndices||[])[0]||{};n({type:"showTip",escapeConnect:!0,x:i[0],y:i[1],tooltipOption:a.tooltipOption,position:a.position,dataIndexInside:t.dataIndexInside,dataIndex:t.dataIndex,seriesIndex:t.seriesIndex,dataByCoordSys:e.list})}h(E,"dispatchTooltipActually");function G(e,i,a){var n=a.getZr(),t="axisPointerLastHighlights",d=B(n)[t]||{},r=B(n)[t]={};c.each(e,function(p,l){var v=p.axisPointerModel.option;v.status==="show"&&p.triggerEmphasis&&c.each(v.seriesDataIndices,function(u){var x=u.seriesIndex+" | "+u.dataIndex;r[x]=u})});var s=[],o=[];c.each(d,function(p,l){!r[l]&&o.push(p)}),c.each(r,function(p,l){!d[l]&&s.push(p)}),o.length&&a.dispatchAction({type:"downplay",escapeConnect:!0,notBlur:!0,batch:o}),s.length&&a.dispatchAction({type:"highlight",escapeConnect:!0,notBlur:!0,batch:s})}h(G,"dispatchHighDownActually");function j(e,i){for(var a=0;a<(e||[]).length;a++){var n=e[a];if(i.axis.dim===n.axisDim&&i.axis.model.componentIndex===n.axisIndex)return n}}h(j,"findInputAxisInfo");function b(e){var i=e.axis.model,a={},n=a.axisDim=e.axis.dim;return a.axisIndex=a[n+"AxisIndex"]=i.componentIndex,a.axisName=a[n+"AxisName"]=i.name,a.axisId=a[n+"AxisId"]=i.id,a}h(b,"makeMapperParam");function S(e){return!e||e[0]==null||isNaN(e[0])||e[1]==null||isNaN(e[1])}h(S,"illegalPoint");exports.default=q;
