"use strict";var A=Object.defineProperty;var b=(I,y)=>A(I,"name",{value:y,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const N=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),C=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),O=require("../../../util/graphic/index.cjs"),B=require("../../../util/layout/index.cjs"),V=require("../LegendView/index.cjs"),z=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Text/index.cjs"),S=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Rect/index.cjs"),k=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),F=require("../../../animation/basicTransition/index.cjs");var q=k.default,R=["width","height"],T=["x","y"],L=function(I){N.__extends(y,I);function y(){var t=I!==null&&I.apply(this,arguments)||this;return t.type=y.type,t.newlineDisabled=!0,t._currentIndex=0,t}return b(y,"ScrollableLegendView"),y.prototype.init=function(){I.prototype.init.call(this),this.group.add(this._containerGroup=new q),this._containerGroup.add(this.getContentGroup()),this.group.add(this._controllerGroup=new q)},y.prototype.resetInner=function(){I.prototype.resetInner.call(this),this._controllerGroup.removeAll(),this._containerGroup.removeClipPath(),this._containerGroup.__rectSize=null},y.prototype.renderInner=function(t,u,i,a,e,x,g){var l=this;I.prototype.renderInner.call(this,t,u,i,a,e,x,g);var o=this._controllerGroup,d=u.get("pageIconSize",!0),c=C.isArray(d)?d:[d,d];r("pagePrev",0);var p=u.getModel("pageTextStyle");o.add(new z.default({name:"pageText",style:{text:"xx/xx",fill:p.getTextColor(),font:p.getFont(),verticalAlign:"middle",align:"center"},silent:!0})),r("pageNext",1);function r(s,h){var v=s+"DataIndex",n=O.createIcon(u.get("pageIcons",!0)[u.getOrient().name][h],{onclick:C.bind(l._pageGo,l,v,u,a)},{x:-c[0]/2,y:-c[1]/2,width:c[0],height:c[1]});n.name=s,o.add(n)}b(r,"createPageButton")},y.prototype.layoutInner=function(t,u,i,a,e,x){var g=this.getSelectorGroup(),l=t.getOrient().index,o=R[l],d=T[l],c=R[1-l],p=T[1-l];e&&B.box("horizontal",g,t.get("selectorItemGap",!0));var r=t.get("selectorButtonGap",!0),s=g.getBoundingRect(),h=[-s.x,-s.y],v=C.clone(i);e&&(v[o]=i[o]-s[o]-r);var n=this._layoutContentAndController(t,a,v,l,o,c,p,d);if(e){if(x==="end")h[l]+=n[o]+r;else{var f=s[o]+r;h[l]-=f,n[d]-=f}n[o]+=s[o]+r,h[1-l]+=n[p]+n[c]/2-s[c]/2,n[c]=Math.max(n[c],s[c]),n[p]=Math.min(n[p],s[p]+h[1-l]),g.x=h[0],g.y=h[1],g.markRedraw()}return n},y.prototype._layoutContentAndController=function(t,u,i,a,e,x,g,l){var o=this.getContentGroup(),d=this._containerGroup,c=this._controllerGroup;B.box(t.get("orient"),o,t.get("itemGap"),a?i.width:null,a?null:i.height),B.box("horizontal",c,t.get("pageButtonItemGap",!0));var p=o.getBoundingRect(),r=c.getBoundingRect(),s=this._showController=p[e]>i[e],h=[-p.x,-p.y];u||(h[a]=o[l]);var v=[0,0],n=[-r.x,-r.y],f=C.retrieve2(t.get("pageButtonGap",!0),t.get("itemGap",!0));if(s){var D=t.get("pageButtonPosition",!0);D==="end"?n[a]+=i[e]-r[e]:v[a]+=r[e]+f}n[1-a]+=p[x]/2-r[x]/2,o.setPosition(h),d.setPosition(v),c.setPosition(n);var P={x:0,y:0};if(P[e]=s?i[e]:p[e],P[x]=Math.max(p[x],r[x]),P[g]=Math.min(0,r[g]+n[1-a]),d.__rectSize=i[e],s){var _={x:0,y:0};_[e]=Math.max(i[e]-r[e]-f,0),_[x]=P[x],d.setClipPath(new S.default({shape:_})),d.__rectSize=_[e]}else c.eachChild(function(m){m.attr({invisible:!0,silent:!0})});var G=this._getPageInfo(t);return G.pageIndex!=null&&F.updateProps(o,{x:G.contentPosition[0],y:G.contentPosition[1]},s?t:null),this._updatePageInfoView(t,G),P},y.prototype._pageGo=function(t,u,i){var a=this._getPageInfo(u)[t];a!=null&&i.dispatchAction({type:"legendScroll",scrollDataIndex:a,legendId:u.id})},y.prototype._updatePageInfoView=function(t,u){var i=this._controllerGroup;C.each(["pagePrev","pageNext"],function(o){var d=o+"DataIndex",c=u[d]!=null,p=i.childOfName(o);p&&(p.setStyle("fill",c?t.get("pageIconColor",!0):t.get("pageIconInactiveColor",!0)),p.cursor=c?"pointer":"default")});var a=i.childOfName("pageText"),e=t.get("pageFormatter"),x=u.pageIndex,g=x!=null?x+1:0,l=u.pageCount;a&&e&&a.setStyle("text",C.isString(e)?e.replace("{current}",g==null?"":g+"").replace("{total}",l==null?"":l+""):e({current:g,total:l}))},y.prototype._getPageInfo=function(t){var u=t.get("scrollDataIndex",!0),i=this.getContentGroup(),a=this._containerGroup.__rectSize,e=t.getOrient().index,x=R[e],g=T[e],l=this._findTargetItemIndex(u),o=i.children(),d=o[l],c=o.length,p=c?1:0,r={contentPosition:[i.x,i.y],pageCount:p,pageIndex:p-1,pagePrevDataIndex:null,pageNextDataIndex:null};if(!d)return r;var s=D(d);r.contentPosition[e]=-s.s;for(var h=l+1,v=s,n=s,f=null;h<=c;++h)f=D(o[h]),(!f&&n.e>v.s+a||f&&!P(f,v.s))&&(n.i>v.i?v=n:v=f,v&&(r.pageNextDataIndex==null&&(r.pageNextDataIndex=v.i),++r.pageCount)),n=f;for(var h=l-1,v=s,n=s,f=null;h>=-1;--h)f=D(o[h]),(!f||!P(n,f.s))&&v.i<n.i&&(n=v,r.pagePrevDataIndex==null&&(r.pagePrevDataIndex=v.i),++r.pageCount,++r.pageIndex),v=f;return r;function D(_){if(_){var G=_.getBoundingRect(),m=G[g]+_[g];return{s:m,e:m+G[x],i:_.__legendDataIndex}}}function P(_,G){return _.e>=G&&_.s<=G+a}},y.prototype._findTargetItemIndex=function(t){if(!this._showController)return 0;var u,i=this.getContentGroup(),a;return i.eachChild(function(e,x){var g=e.__legendDataIndex;a==null&&g!=null&&(a=x),g===t&&(u=x)}),u??a},y.type="legend.scroll",y}(V.default);exports.default=L;
