"use strict";var ft=Object.defineProperty;var _=(u,n)=>ft(u,"name",{value:n,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const gt=require("../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),A=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),pt=require("../../helper/SymbolDraw/index.cjs"),lt=require("../../helper/Symbol/index.cjs"),ct=require("../lineAnimationDiff/index.cjs"),V=require("../../../util/model/index.cjs"),Y=require("../poly/index.cjs"),H=require("../../../view/Chart/index.cjs"),st=require("../helper/index.cjs"),M=require("../../helper/createClipPathFromCoordSys/index.cjs"),yt=require("../../../coord/CoordinateSystem/index.cjs"),k=require("../../../util/states/index.cjs"),z=require("../../../label/labelStyle/index.cjs"),tt=require("../../helper/labelHelper/index.cjs"),B=require("../../../util/innerStore/index.cjs"),mt=require("../../../util/vendor/index.cjs"),et=require("../../../util/format/index.cjs"),dt=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/tool/color/index.cjs"),_t=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Group/index.cjs"),St=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Text/index.cjs"),bt=require("../../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/LinearGradient/index.cjs"),X=require("../../../animation/basicTransition/index.cjs");function at(u,n){if(u.length===n.length){for(var t=0;t<u.length;t++)if(u[t]!==n[t])return;return!0}}_(at,"isPointsSame");function rt(u){for(var n=1/0,t=1/0,i=-1/0,r=-1/0,a=0;a<u.length;){var e=u[a++],l=u[a++];isNaN(e)||(n=Math.min(e,n),i=Math.max(e,i)),isNaN(l)||(t=Math.min(l,t),r=Math.max(l,r))}return[[n,t],[i,r]]}_(rt,"bboxFromPoints");function nt(u,n){var t=rt(u),i=t[0],r=t[1],a=rt(n),e=a[0],l=a[1];return Math.max(Math.abs(i[0]-e[0]),Math.abs(i[1]-e[1]),Math.abs(r[0]-l[0]),Math.abs(r[1]-l[1]))}_(nt,"getBoundingDiff");function it(u){return A.isNumber(u)?u:u?.5:0}_(it,"getSmooth");function xt(u,n,t){if(!t.valueDim)return[];for(var i=n.count(),r=mt.createFloat32Array(i*2),a=0;a<i;a++){var e=st.getStackedOnPoint(t,u,n,a);r[a*2]=e[0],r[a*2+1]=e[1]}return r}_(xt,"getStackedOnPoints");function O(u,n,t,i){var r=n.getBaseAxis(),a=r.dim==="x"||r.dim==="radius"?0:1,e=[],l=0,s=[],o=[],h=[],v=[];if(i){for(l=0;l<u.length;l+=2)!isNaN(u[l])&&!isNaN(u[l+1])&&v.push(u[l],u[l+1]);u=v}for(l=0;l<u.length-2;l+=2)switch(h[0]=u[l+2],h[1]=u[l+3],o[0]=u[l],o[1]=u[l+1],e.push(o[0],o[1]),t){case"end":s[a]=h[a],s[1-a]=o[1-a],e.push(s[0],s[1]);break;case"middle":var f=(o[a]+h[a])/2,g=[];s[a]=g[a]=f,s[1-a]=o[1-a],g[1-a]=h[1-a],e.push(s[0],s[1]),e.push(g[0],g[1]);break;default:s[a]=o[a],s[1-a]=h[1-a],e.push(s[0],s[1])}return e.push(u[l++],u[l++]),e}_(O,"turnPointsIntoStep");function It(u,n){var t=[],i=u.length,r,a;function e(h,v,f){var g=h.coord,S=(f-g)/(v.coord-g),p=dt.lerp(S,[h.color,v.color]);return{coord:f,color:p}}_(e,"lerpStop");for(var l=0;l<i;l++){var s=u[l],o=s.coord;if(o<0)r=s;else if(o>n){a?t.push(e(a,s,n)):r&&t.push(e(r,s,0),e(r,s,n));break}else r&&(t.push(e(r,s,0)),r=null),t.push(s),a=s}return t}_(It,"clipColorStops");function wt(u,n,t){var i=u.getVisual("visualMeta");if(!(!i||!i.length||!u.count())){if(n.type!=="cartesian2d"){process.env.NODE_ENV!=="production"&&console.warn("Visual map on line style is only supported on cartesian2d.");return}for(var r,a,e=i.length-1;e>=0;e--){var l=u.getDimensionInfo(i[e].dimension);if(r=l&&l.coordDim,r==="x"||r==="y"){a=i[e];break}}if(!a){process.env.NODE_ENV!=="production"&&console.warn("Visual map on line style only support x or y dimension.");return}var s=n.getAxis(r),o=A.map(a.stops,function(y){return{coord:s.toGlobalCoord(s.dataToCoord(y.value)),color:y.color}}),h=o.length,v=a.outerColors.slice();h&&o[0].coord>o[h-1].coord&&(o.reverse(),v.reverse());var f=It(o,r==="x"?t.getWidth():t.getHeight()),g=f.length;if(!g&&h)return o[0].coord<0?v[1]?v[1]:o[h-1].color:v[0]?v[0]:o[0].color;var S=10,p=f[0].coord-S,c=f[g-1].coord+S,m=c-p;if(m<.001)return"transparent";A.each(f,function(y){y.offset=(y.coord-p)/m}),f.push({offset:g?f[g-1].offset:.5,color:v[1]||"transparent"}),f.unshift({offset:g?f[0].offset:.5,color:v[0]||"transparent"});var x=new bt.default(0,0,0,0,f,!0);return x[r]=p,x[r+"2"]=c,x}}_(wt,"getVisualGradient");function Dt(u,n,t){var i=u.get("showAllSymbol"),r=i==="auto";if(!(i&&!r)){var a=t.getAxesByScale("ordinal")[0];if(a&&!(r&&Pt(a,n))){var e=n.mapDimension(a.dim),l={};return A.each(a.getViewLabels(),function(s){var o=a.scale.getRawOrdinalNumber(s.tickValue);l[o]=1}),function(s){return!l.hasOwnProperty(n.get(e,s))}}}}_(Dt,"getIsIgnoreFunc");function Pt(u,n){var t=u.getExtent(),i=Math.abs(t[1]-t[0])/u.scale.count();isNaN(i)&&(i=0);for(var r=n.count(),a=Math.max(1,Math.round(r/5)),e=0;e<r;e+=a)if(lt.default.getSymbolSize(n,e)[u.isHorizontal()?1:0]*1.5>i)return!1;return!0}_(Pt,"canShowAllSymbolForCategory");function Lt(u,n){return isNaN(u)||isNaN(n)}_(Lt,"isPointNull");function Ct(u){for(var n=u.length/2;n>0&&Lt(u[n*2-2],u[n*2-1]);n--);return n-1}_(Ct,"getLastIndexNotNull");function ot(u,n){return[u[n*2],u[n*2+1]]}_(ot,"getPointAtIndex");function Et(u,n,t){for(var i=u.length/2,r=t==="x"?0:1,a,e,l=0,s=-1,o=0;o<i;o++)if(e=u[o*2+r],!(isNaN(e)||isNaN(u[o*2+1-r]))){if(o===0){a=e;continue}if(a<=n&&e>=n||a>=n&&e<=n){s=o;break}l=o,a=e}return{range:[l,s],t:(n-a)/(e-a)}}_(Et,"getIndexRange");function ut(u){if(u.get(["endLabel","show"]))return!0;for(var n=0;n<k.SPECIAL_STATES.length;n++)if(u.get([k.SPECIAL_STATES[n],"endLabel","show"]))return!0;return!1}_(ut,"anyStateShowEndLabel");function R(u,n,t,i){if(yt.isCoordinateSystemType(n,"cartesian2d")){var r=i.getModel("endLabel"),a=r.get("valueAnimation"),e=i.getData(),l={lastFrameIndex:0},s=ut(i)?function(g,S){u._endLabelOnDuring(g,S,e,l,a,r,n)}:null,o=n.getBaseAxis().isHorizontal(),h=M.createGridClipPath(n,t,i,function(){var g=u._endLabel;g&&t&&l.originalX!=null&&g.attr({x:l.originalX,y:l.originalY})},s);if(!i.get("clip",!0)){var v=h.shape,f=Math.max(v.width,v.height);o?(v.y-=f,v.height+=f*2):(v.x-=f,v.width+=f*2)}return s&&s(1,h),h}else return process.env.NODE_ENV!=="production"&&i.get(["endLabel","show"])&&console.warn("endLabel is not supported for lines in polar systems."),M.createPolarClipPath(n,t,i)}_(R,"createLineClipPath");function Nt(u,n){var t=n.getBaseAxis(),i=t.isHorizontal(),r=t.inverse,a=i?r?"right":"left":"center",e=i?"middle":r?"top":"bottom";return{normal:{align:u.get("align")||a,verticalAlign:u.get("verticalAlign")||e}}}_(Nt,"getEndLabelStateSpecified");var At=function(u){gt.__extends(n,u);function n(){return u!==null&&u.apply(this,arguments)||this}return _(n,"LineView"),n.prototype.init=function(){var t=new _t.default,i=new pt.default;this.group.add(i.group),this._symbolDraw=i,this._lineGroup=t},n.prototype.render=function(t,i,r){var a=this,e=t.coordinateSystem,l=this.group,s=t.getData(),o=t.getModel("lineStyle"),h=t.getModel("areaStyle"),v=s.getLayout("points")||[],f=e.type==="polar",g=this._coordSys,S=this._symbolDraw,p=this._polyline,c=this._polygon,m=this._lineGroup,x=!i.ssr&&t.get("animation"),y=!h.isEmpty(),D=h.get("origin"),N=st.prepareDataCoordInfo(e,s,D),d=y&&xt(e,s,N),P=t.get("showSymbol"),I=t.get("connectNulls"),w=P&&!f&&Dt(t,s,e),E=this._data;E&&E.eachItemGraphicEl(function(C,ht){C.__temp&&(l.remove(C),E.setItemGraphicEl(ht,null))}),P||S.remove(),l.add(m);var L=f?!1:t.get("step"),b;e&&e.getArea&&t.get("clip",!0)&&(b=e.getArea(),b.width!=null?(b.x-=.1,b.y-=.1,b.width+=.2,b.height+=.2):b.r0&&(b.r0-=.5,b.r+=.5)),this._clipShapeForSymbol=b;var T=wt(s,e,r)||s.getVisual("style")[s.getVisual("drawType")];if(!(p&&g.type===e.type&&L===this._step))P&&S.updateData(s,{isIgnore:w,clipShape:b,disableAnimation:!0,getSymbolPoint:_(function(C){return[v[C*2],v[C*2+1]]},"getSymbolPoint")}),x&&this._initSymbolLabelAnimation(s,e,b),L&&(v=O(v,e,L,I),d&&(d=O(d,e,L,I))),p=this._newPolyline(v),y?c=this._newPolygon(v,d):c&&(m.remove(c),c=this._polygon=null),f||this._initOrUpdateEndLabel(t,e,et.convertToColorString(T)),m.setClipPath(R(this,e,!0,t));else{y&&!c?c=this._newPolygon(v,d):c&&!y&&(m.remove(c),c=this._polygon=null),f||this._initOrUpdateEndLabel(t,e,et.convertToColorString(T));var q=m.getClipPath();if(q){var F=R(this,e,!1,t);X.initProps(q,{shape:F.shape},t)}else m.setClipPath(R(this,e,!0,t));P&&S.updateData(s,{isIgnore:w,clipShape:b,disableAnimation:!0,getSymbolPoint:_(function(C){return[v[C*2],v[C*2+1]]},"getSymbolPoint")}),(!at(this._stackedOnPoints,d)||!at(this._points,v))&&(x?this._doUpdateAnimation(s,d,e,r,L,D,I):(L&&(v=O(v,e,L,I),d&&(d=O(d,e,L,I))),p.setShape({points:v}),c&&c.setShape({points:v,stackedOnPoints:d})))}var G=t.getModel("emphasis"),U=G.get("focus"),W=G.get("blurScope"),J=G.get("disabled");if(p.useStyle(A.defaults(o.getLineStyle(),{fill:"none",stroke:T,lineJoin:"bevel"})),k.setStatesStylesFromModel(p,t,"lineStyle"),p.style.lineWidth>0&&t.get(["emphasis","lineStyle","width"])==="bolder"){var vt=p.getState("emphasis").style;vt.lineWidth=+p.style.lineWidth+1}B.getECData(p).seriesIndex=t.seriesIndex,k.toggleHoverEmphasis(p,U,W,J);var $=it(t.get("smooth")),j=t.get("smoothMonotone");if(p.setShape({smooth:$,smoothMonotone:j,connectNulls:I}),c){var Z=s.getCalculationInfo("stackedOnSeries"),K=0;c.useStyle(A.defaults(h.getAreaStyle(),{fill:T,opacity:.7,lineJoin:"bevel",decal:s.getVisual("style").decal})),Z&&(K=it(Z.get("smooth"))),c.setShape({smooth:$,stackedOnSmooth:K,smoothMonotone:j,connectNulls:I}),k.setStatesStylesFromModel(c,t,"areaStyle"),B.getECData(c).seriesIndex=t.seriesIndex,k.toggleHoverEmphasis(c,U,W,J)}var Q=_(function(C){a._changePolyState(C)},"changePolyState");s.eachItemGraphicEl(function(C){C&&(C.onHoverStateChange=Q)}),this._polyline.onHoverStateChange=Q,this._data=s,this._coordSys=e,this._stackedOnPoints=d,this._points=v,this._step=L,this._valueOrigin=D,t.get("triggerLineEvent")&&(this.packEventData(t,p),c&&this.packEventData(t,c))},n.prototype.packEventData=function(t,i){B.getECData(i).eventData={componentType:"series",componentSubType:"line",componentIndex:t.componentIndex,seriesIndex:t.seriesIndex,seriesName:t.name,seriesType:"line"}},n.prototype.highlight=function(t,i,r,a){var e=t.getData(),l=V.queryDataIndex(e,a);if(this._changePolyState("emphasis"),!(l instanceof Array)&&l!=null&&l>=0){var s=e.getLayout("points"),o=e.getItemGraphicEl(l);if(!o){var h=s[l*2],v=s[l*2+1];if(isNaN(h)||isNaN(v)||this._clipShapeForSymbol&&!this._clipShapeForSymbol.contain(h,v))return;var f=t.get("zlevel")||0,g=t.get("z")||0;o=new lt.default(e,l),o.x=h,o.y=v,o.setZ(f,g);var S=o.getSymbolPath().getTextContent();S&&(S.zlevel=f,S.z=g,S.z2=this._polyline.z2+1),o.__temp=!0,e.setItemGraphicEl(l,o),o.stopSymbolAnimation(!0),this.group.add(o)}o.highlight()}else H.default.prototype.highlight.call(this,t,i,r,a)},n.prototype.downplay=function(t,i,r,a){var e=t.getData(),l=V.queryDataIndex(e,a);if(this._changePolyState("normal"),l!=null&&l>=0){var s=e.getItemGraphicEl(l);s&&(s.__temp?(e.setItemGraphicEl(l,null),this.group.remove(s)):s.downplay())}else H.default.prototype.downplay.call(this,t,i,r,a)},n.prototype._changePolyState=function(t){var i=this._polygon;k.setStatesFlag(this._polyline,t),i&&k.setStatesFlag(i,t)},n.prototype._newPolyline=function(t){var i=this._polyline;return i&&this._lineGroup.remove(i),i=new Y.ECPolyline({shape:{points:t},segmentIgnoreThreshold:2,z2:10}),this._lineGroup.add(i),this._polyline=i,i},n.prototype._newPolygon=function(t,i){var r=this._polygon;return r&&this._lineGroup.remove(r),r=new Y.ECPolygon({shape:{points:t,stackedOnPoints:i},segmentIgnoreThreshold:2}),this._lineGroup.add(r),this._polygon=r,r},n.prototype._initSymbolLabelAnimation=function(t,i,r){var a,e,l=i.getBaseAxis(),s=l.inverse;i.type==="cartesian2d"?(a=l.isHorizontal(),e=!1):i.type==="polar"&&(a=l.dim==="angle",e=!0);var o=t.hostModel,h=o.get("animationDuration");A.isFunction(h)&&(h=h(null));var v=o.get("animationDelay")||0,f=A.isFunction(v)?v(null):v;t.eachItemGraphicEl(function(g,S){var p=g;if(p){var c=[g.x,g.y],m=void 0,x=void 0,y=void 0;if(r)if(e){var D=r,N=i.pointToCoord(c);a?(m=D.startAngle,x=D.endAngle,y=-N[1]/180*Math.PI):(m=D.r0,x=D.r,y=N[0])}else{var d=r;a?(m=d.x,x=d.x+d.width,y=g.x):(m=d.y+d.height,x=d.y,y=g.y)}var P=x===m?0:(y-m)/(x-m);s&&(P=1-P);var I=A.isFunction(v)?v(S):h*P+f,w=p.getSymbolPath(),E=w.getTextContent();p.attr({scaleX:0,scaleY:0}),p.animateTo({scaleX:1,scaleY:1},{duration:200,setToFinal:!0,delay:I}),E&&E.animateFrom({style:{opacity:0}},{duration:300,delay:I}),w.disableLabelAnimation=!0}})},n.prototype._initOrUpdateEndLabel=function(t,i,r){var a=t.getModel("endLabel");if(ut(t)){var e=t.getData(),l=this._polyline,s=e.getLayout("points");if(!s){l.removeTextContent(),this._endLabel=null;return}var o=this._endLabel;o||(o=this._endLabel=new St.default({z2:200}),o.ignoreClip=!0,l.setTextContent(this._endLabel),l.disableLabelAnimation=!0);var h=Ct(s);h>=0&&(z.setLabelStyle(l,z.getLabelStatesModels(t,"endLabel"),{inheritColor:r,labelFetcher:t,labelDataIndex:h,defaultText:_(function(v,f,g){return g!=null?tt.getDefaultInterpolatedLabel(e,g):tt.getDefaultLabel(e,v)},"defaultText"),enableTextSetter:!0},Nt(a,i)),l.textConfig.position=null)}else this._endLabel&&(this._polyline.removeTextContent(),this._endLabel=null)},n.prototype._endLabelOnDuring=function(t,i,r,a,e,l,s){var o=this._endLabel,h=this._polyline;if(o){t<1&&a.originalX==null&&(a.originalX=o.x,a.originalY=o.y);var v=r.getLayout("points"),f=r.hostModel,g=f.get("connectNulls"),S=l.get("precision"),p=l.get("distance")||0,c=s.getBaseAxis(),m=c.isHorizontal(),x=c.inverse,y=i.shape,D=x?m?y.x:y.y+y.height:m?y.x+y.width:y.y,N=(m?p:0)*(x?-1:1),d=(m?0:-p)*(x?-1:1),P=m?"x":"y",I=Et(v,D,P),w=I.range,E=w[1]-w[0],L=void 0;if(E>=1){if(E>1&&!g){var b=ot(v,w[0]);o.attr({x:b[0]+N,y:b[1]+d}),e&&(L=f.getRawValue(w[0]))}else{var b=h.getPointOn(D,P);b&&o.attr({x:b[0]+N,y:b[1]+d});var T=f.getRawValue(w[0]),q=f.getRawValue(w[1]);e&&(L=V.interpolateRawValues(r,S,T,q,I.t))}a.lastFrameIndex=w[0]}else{var F=t===1||a.lastFrameIndex>0?w[0]:0,b=ot(v,F);e&&(L=f.getRawValue(F)),o.attr({x:b[0]+N,y:b[1]+d})}if(e){var G=z.labelInner(o);typeof G.setLabelText=="function"&&G.setLabelText(L)}}},n.prototype._doUpdateAnimation=function(t,i,r,a,e,l,s){var o=this._polyline,h=this._polygon,v=t.hostModel,f=ct.default(this._data,t,this._stackedOnPoints,i,this._coordSys,r,this._valueOrigin),g=f.current,S=f.stackedOnCurrent,p=f.next,c=f.stackedOnNext;if(e&&(g=O(f.current,r,e,s),S=O(f.stackedOnCurrent,r,e,s),p=O(f.next,r,e,s),c=O(f.stackedOnNext,r,e,s)),nt(g,p)>3e3||h&&nt(S,c)>3e3){o.stopAnimation(),o.setShape({points:p}),h&&(h.stopAnimation(),h.setShape({points:p,stackedOnPoints:c}));return}o.shape.__points=f.current,o.shape.points=g;var m={shape:{points:p}};f.current!==g&&(m.shape.__points=f.next),o.stopAnimation(),X.updateProps(o,m,v),h&&(h.setShape({points:g,stackedOnPoints:S}),h.stopAnimation(),X.updateProps(h,{shape:{stackedOnPoints:c}},v),o.shape.points!==h.shape.points&&(h.shape.points=o.shape.points));for(var x=[],y=f.status,D=0;D<y.length;D++){var N=y[D].cmd;if(N==="="){var d=t.getItemGraphicEl(y[D].idx1);d&&x.push({el:d,ptIdx:D})}}o.animators&&o.animators.length&&o.animators[0].during(function(){h&&h.dirtyShape();for(var P=o.shape.__points,I=0;I<x.length;I++){var w=x[I].el,E=x[I].ptIdx*2;w.x=P[E],w.y=P[E+1],w.markRedraw()}})},n.prototype.remove=function(t){var i=this.group,r=this._data;this._lineGroup.removeAll(),this._symbolDraw.remove(!0),r&&r.eachItemGraphicEl(function(a,e){a.__temp&&(i.remove(a),r.setItemGraphicEl(e,null))}),this._polyline=this._polygon=this._coordSys=this._points=this._stackedOnPoints=this._endLabel=this._data=null},n.type="line",n}(H.default);exports.default=At;
