"use strict";var B=Object.defineProperty;var v=(i,n)=>B(i,"name",{value:n,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const H=require("../../../../../../../../tslib@2.3.0/node_modules/tslib/tslib.es6/index.cjs"),R=require("../../../../core/echarts/index.cjs"),u=require("../../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),I=require("../../featureManager/index.cjs"),A=require("../../../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/event/index.cjs"),q=require("../../../../util/log/index.cjs");var L=new Array(60).join("-"),x="	";function N(i){var n={},e=[],t=[];return i.eachRawSeries(function(r){var o=r.coordinateSystem;if(o&&(o.type==="cartesian2d"||o.type==="polar")){var a=o.getBaseAxis();if(a.type==="category"){var s=a.dim+"_"+a.index;n[s]||(n[s]={categoryAxis:a,valueAxis:o.getOtherAxis(a),series:[]},t.push({axisDim:a.dim,axisIndex:a.index})),n[s].series.push(r)}else e.push(r)}else e.push(r)}),{seriesGroupByCategoryAxis:n,other:e,meta:t}}v(N,"groupSeries");function j(i){var n=[];return u.each(i,function(e,t){var r=e.categoryAxis,o=e.valueAxis,a=o.dim,s=[" "].concat(u.map(e.series,function(g){return g.name})),l=[r.model.getCategories()];u.each(e.series,function(g){var h=g.getRawData();l.push(g.getRawData().mapArray(h.mapDimension(a),function(m){return m}))});for(var c=[s.join(x)],d=0;d<l[0].length;d++){for(var f=[],p=0;p<l.length;p++)f.push(l[p][d]);c.push(f.join(x))}n.push(c.join(`
`))}),n.join(`

`+L+`

`)}v(j,"assembleSeriesWithCategoryAxis");function k(i){return u.map(i,function(n){var e=n.getRawData(),t=[n.name],r=[];return e.each(e.dimensions,function(){for(var o=arguments.length,a=arguments[o-1],s=e.getName(a),l=0;l<o-1;l++)r[l]=arguments[l];t.push((s?s+x:"")+r.join(x))}),t.join(`
`)}).join(`

`+L+`

`)}v(k,"assembleOtherSeries");function z(i){var n=N(i);return{value:u.filter([j(n.seriesGroupByCategoryAxis),k(n.other)],function(e){return!!e.replace(/[\n\t\s]/g,"")}).join(`

`+L+`

`),meta:n.meta}}v(z,"getContentFromModel");function w(i){return i.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}v(w,"trim");function F(i){var n=i.slice(0,i.indexOf(`
`));if(n.indexOf(x)>=0)return!0}v(F,"isTSVFormat");var E=new RegExp("["+x+"]+","g");function G(i){for(var n=i.split(/\n+/g),e=w(n.shift()).split(E),t=[],r=u.map(e,function(l){return{name:l,data:[]}}),o=0;o<n.length;o++){var a=w(n[o]).split(E);t.push(a.shift());for(var s=0;s<a.length;s++)r[s]&&(r[s].data[o]=a[s])}return{series:r,categories:t}}v(G,"parseTSVContents");function P(i){for(var n=i.split(/\n+/g),e=w(n.shift()),t=[],r=0;r<n.length;r++){var o=w(n[r]);if(o){var a=o.split(E),s="",l=void 0,c=!1;isNaN(a[0])?(c=!0,s=a[0],a=a.slice(1),t[r]={name:s,value:[]},l=t[r].value):l=t[r]=[];for(var d=0;d<a.length;d++)l.push(+a[d]);l.length===1&&(c?t[r].value=l[0]:t[r]=l[0])}}return{name:e,data:t}}v(P,"parseListContents");function V(i,n){var e=i.split(new RegExp(`
*`+L+`
*`,"g")),t={series:[]};return u.each(e,function(r,o){if(F(r)){var a=G(r),s=n[o],l=s.axisDim+"Axis";s&&(t[l]=t[l]||[],t[l][s.axisIndex]={data:a.categories},t.series=t.series.concat(a.series))}else{var a=P(r);t.series.push(a)}}),t}v(V,"parseContents");var U=function(i){H.__extends(n,i);function n(){return i!==null&&i.apply(this,arguments)||this}return v(n,"DataView"),n.prototype.onclick=function(e,t){setTimeout(function(){t.dispatchAction({type:"hideTip"})});var r=t.getDom(),o=this.model;this._dom&&r.removeChild(this._dom);var a=document.createElement("div");a.style.cssText="position:absolute;top:0;bottom:0;left:0;right:0;padding:5px",a.style.backgroundColor=o.get("backgroundColor")||"#fff";var s=document.createElement("h4"),l=o.get("lang")||[];s.innerHTML=l[0]||o.get("title"),s.style.cssText="margin:10px 20px",s.style.color=o.get("textColor");var c=document.createElement("div"),d=document.createElement("textarea");c.style.cssText="overflow:auto";var f=o.get("optionToContent"),p=o.get("contentToOption"),g=z(e);if(u.isFunction(f)){var h=f(t.getOption());u.isString(h)?c.innerHTML=h:u.isDom(h)&&c.appendChild(h)}else{d.readOnly=o.get("readOnly");var m=d.style;m.cssText="display:block;width:100%;height:100%;font-family:monospace;font-size:14px;line-height:1.6rem;resize:none;box-sizing:border-box;outline:none",m.color=o.get("textColor"),m.borderColor=o.get("textareaBorderColor"),m.backgroundColor=o.get("textareaColor"),d.value=g.value,c.appendChild(d)}var D=g.meta,y=document.createElement("div");y.style.cssText="position:absolute;bottom:5px;left:0;right:0";var S="float:right;margin-right:20px;border:none;cursor:pointer;padding:2px 5px;font-size:12px;border-radius:3px",C=document.createElement("div"),T=document.createElement("div");S+=";background-color:"+o.get("buttonColor"),S+=";color:"+o.get("buttonTextColor");var M=this;function b(){r.removeChild(a),M._dom=null}v(b,"close"),A.addEventListener(C,"click",b),A.addEventListener(T,"click",function(){if(p==null&&f!=null||p!=null&&f==null){process.env.NODE_ENV!=="production"&&q.warn("It seems you have just provided one of `contentToOption` and `optionToContent` functions but missed the other one. Data change is ignored."),b();return}var O;try{u.isFunction(p)?O=p(c,t.getOption()):O=V(d.value,D)}catch(_){throw b(),new Error("Data view format error "+_)}O&&t.dispatchAction({type:"changeDataView",newOption:O}),b()}),C.innerHTML=l[1],T.innerHTML=l[2],T.style.cssText=C.style.cssText=S,!o.get("readOnly")&&y.appendChild(T),y.appendChild(C),a.appendChild(s),a.appendChild(c),a.appendChild(y),c.style.height=r.clientHeight-80+"px",r.appendChild(a),this._dom=a},n.prototype.remove=function(e,t){this._dom&&t.getDom().removeChild(this._dom)},n.prototype.dispose=function(e,t){this.remove(e,t)},n.getDefaultOption=function(e){var t={show:!0,readOnly:!1,optionToContent:null,contentToOption:null,icon:"M17.5,17.3H33 M17.5,17.3H33 M45.4,29.5h-28 M11.5,2v56H51V14.8L38.4,2H11.5z M38.4,2.2v12.7H51 M45.4,41.7h-28",title:e.getLocaleModel().get(["toolbox","dataView","title"]),lang:e.getLocaleModel().get(["toolbox","dataView","lang"]),backgroundColor:"#fff",textColor:"#000",textareaColor:"#fff",textareaBorderColor:"#333",buttonColor:"#c23531",buttonTextColor:"#fff"};return t},n}(I.ToolboxFeature);function W(i,n){return u.map(i,function(e,t){var r=n&&n[t];if(u.isObject(r)&&!u.isArray(r)){var o=u.isObject(e)&&!u.isArray(e);o||(e={value:e});var a=r.name!=null&&e.name==null;return e=u.defaults(e,r),a&&delete e.name,e}else return e})}v(W,"tryMergeDataOption");R.registerAction({type:"changeDataView",event:"dataViewChanged",update:"prepareAndUpdate"},function(i,n){var e=[];u.each(i.newOption.series,function(t){var r=n.getSeriesByName(t.name)[0];if(!r)e.push(u.extend({type:"scatter"},t));else{var o=r.get("data");e.push({name:t.name,data:W(t.data,o)})}}),n.mergeOption(u.defaults({series:e},i.newOption))});exports.default=U;
