"use strict";var H=Object.defineProperty;var T=(a,n)=>H(a,"name",{value:n,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("../../util/graphic/index.cjs");const J=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/PathProxy/index.cjs"),j=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/contain/util/index.cjs"),E=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/curve/index.cjs"),O=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/util/index.cjs"),K=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/matrix/index.cjs"),R=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/vector/index.cjs"),G=require("../../util/states/index.cjs"),L=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/core/Point/index.cjs"),V=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/shape/Polyline/index.cjs"),W=require("../../../../../../zrender@5.6.0/node_modules/zrender/lib/graphic/Path/index.cjs");var g=Math.PI*2,w=J.default.CMD,X=["top","right","bottom","left"];function N(a,n,o,r,t){var s=o.width,f=o.height;switch(a){case"top":r.set(o.x+s/2,o.y-n),t.set(0,-1);break;case"bottom":r.set(o.x+s/2,o.y+f+n),t.set(0,1);break;case"left":r.set(o.x-n,o.y+f/2),t.set(-1,0);break;case"right":r.set(o.x+s+n,o.y+f/2),t.set(1,0);break}}T(N,"getCandidateAnchor");function rr(a,n,o,r,t,s,f,i,l){f-=a,i-=n;var u=Math.sqrt(f*f+i*i);f/=u,i/=u;var e=f*o+a,h=i*o+n;if(Math.abs(r-t)%g<1e-4)return l[0]=e,l[1]=h,u-o;if(s){var b=r;r=j.normalizeRadian(t),t=j.normalizeRadian(b)}else r=j.normalizeRadian(r),t=j.normalizeRadian(t);r>t&&(t+=g);var v=Math.atan2(i,f);if(v<0&&(v+=g),v>=r&&v<=t||v+g>=r&&v+g<=t)return l[0]=e,l[1]=h,u-o;var p=o*Math.cos(r)+a,d=o*Math.sin(r)+n,M=o*Math.cos(t)+a,q=o*Math.sin(t)+n,A=(p-f)*(p-f)+(d-i)*(d-i),I=(M-f)*(M-f)+(q-i)*(q-i);return A<I?(l[0]=p,l[1]=d,Math.sqrt(A)):(l[0]=M,l[1]=q,Math.sqrt(I))}T(rr,"projectPointToArc");function z(a,n,o,r,t,s,f,i){var l=t-a,u=s-n,e=o-a,h=r-n,b=Math.sqrt(e*e+h*h);e/=b,h/=b;var v=l*e+u*h,p=v/b;i&&(p=Math.min(Math.max(p,0),1)),p*=b;var d=f[0]=a+p*e,M=f[1]=n+p*h;return Math.sqrt((d-t)*(d-t)+(M-s)*(M-s))}T(z,"projectPointToLine");function Y(a,n,o,r,t,s,f){o<0&&(a=a+o,o=-o),r<0&&(n=n+r,r=-r);var i=a+o,l=n+r,u=f[0]=Math.min(Math.max(t,a),i),e=f[1]=Math.min(Math.max(s,n),l);return Math.sqrt((u-t)*(u-t)+(e-s)*(e-s))}T(Y,"projectPointToRect");var S=[];function ar(a,n,o){var r=Y(n.x,n.y,n.width,n.height,a.x,a.y,S);return o.set(S[0],S[1]),r}T(ar,"nearestPointOnRect");function er(a,n,o){for(var r=0,t=0,s=0,f=0,i,l,u=1/0,e=n.data,h=a.x,b=a.y,v=0;v<e.length;){var p=e[v++];v===1&&(r=e[v],t=e[v+1],s=r,f=t);var d=u;switch(p){case w.M:s=e[v++],f=e[v++],r=s,t=f;break;case w.L:d=z(r,t,e[v],e[v+1],h,b,S,!0),r=e[v++],t=e[v++];break;case w.C:d=E.cubicProjectPoint(r,t,e[v++],e[v++],e[v++],e[v++],e[v],e[v+1],h,b,S),r=e[v++],t=e[v++];break;case w.Q:d=E.quadraticProjectPoint(r,t,e[v++],e[v++],e[v],e[v+1],h,b,S),r=e[v++],t=e[v++];break;case w.A:var M=e[v++],q=e[v++],A=e[v++],I=e[v++],k=e[v++],D=e[v++];v+=1;var U=!!(1-e[v++]);i=Math.cos(k)*A+M,l=Math.sin(k)*I+q,v<=1&&(s=i,f=l);var Z=(h-M)*I/A+M;d=rr(M,q,I,k,k+D,U,Z,b,S),r=Math.cos(k+D)*A+M,t=Math.sin(k+D)*I+q;break;case w.R:s=r=e[v++],f=t=e[v++];var $=e[v++],F=e[v++];d=Y(s,f,$,F,h,b,S);break;case w.Z:d=z(r,t,s,f,h,b,S,!0),r=s,t=f;break}d<u&&(u=d,o.set(S[0],S[1]))}return u}T(er,"nearestPointOnPath");var x=new L.default,c=new L.default,y=new L.default,P=new L.default,C=new L.default;function tr(a,n){if(a){var o=a.getTextGuideLine(),r=a.getTextContent();if(r&&o){var t=a.textGuideLineConfig||{},s=[[0,0],[0,0],[0,0]],f=t.candidates||X,i=r.getBoundingRect().clone();i.applyTransform(r.getComputedTransform());var l=1/0,u=t.anchor,e=a.getComputedTransform(),h=e&&K.invert([],e),b=n.get("length2")||0;u&&y.copy(u);for(var v=0;v<f.length;v++){var p=f[v];N(p,0,i,x,P),L.default.scaleAndAdd(c,x,P,b),c.transform(h);var d=a.getBoundingRect(),M=u?u.distance(c):a instanceof W.default?er(c,a.path,y):ar(c,d,y);M<l&&(l=M,c.transform(e),y.transform(e),y.toArray(s[0]),c.toArray(s[1]),x.toArray(s[2]))}Q(s,n.get("minTurnAngle")),o.setShape({points:s})}}}T(tr,"updateLabelLinePoints");var _=[],m=new L.default;function Q(a,n){if(n<=180&&n>0){n=n/180*Math.PI,x.fromArray(a[0]),c.fromArray(a[1]),y.fromArray(a[2]),L.default.sub(P,x,c),L.default.sub(C,y,c);var o=P.len(),r=C.len();if(!(o<.001||r<.001)){P.scale(1/o),C.scale(1/r);var t=P.dot(C),s=Math.cos(n);if(s<t){var f=z(c.x,c.y,y.x,y.y,x.x,x.y,_,!1);m.fromArray(_),m.scaleAndAdd(C,f/Math.tan(Math.PI-n));var i=y.x!==c.x?(m.x-c.x)/(y.x-c.x):(m.y-c.y)/(y.y-c.y);if(isNaN(i))return;i<0?L.default.copy(m,c):i>1&&L.default.copy(m,y),m.toArray(a[1])}}}}T(Q,"limitTurnAngle");function or(a,n,o){if(o<=180&&o>0){o=o/180*Math.PI,x.fromArray(a[0]),c.fromArray(a[1]),y.fromArray(a[2]),L.default.sub(P,c,x),L.default.sub(C,y,c);var r=P.len(),t=C.len();if(!(r<.001||t<.001)){P.scale(1/r),C.scale(1/t);var s=P.dot(n),f=Math.cos(o);if(s<f){var i=z(c.x,c.y,y.x,y.y,x.x,x.y,_,!1);m.fromArray(_);var l=Math.PI/2,u=Math.acos(C.dot(n)),e=l+u-o;if(e>=l)L.default.copy(m,y);else{m.scaleAndAdd(C,i/Math.tan(Math.PI/2-e));var h=y.x!==c.x?(m.x-c.x)/(y.x-c.x):(m.y-c.y)/(y.y-c.y);if(isNaN(h))return;h<0?L.default.copy(m,c):h>1&&L.default.copy(m,y)}m.toArray(a[1])}}}}T(or,"limitSurfaceAngle");function B(a,n,o,r){var t=o==="normal",s=t?a:a.ensureState(o);s.ignore=n;var f=r.get("smooth");f&&f===!0&&(f=.3),s.shape=s.shape||{},f>0&&(s.shape.smooth=f);var i=r.getModel("lineStyle").getLineStyle();t?a.useStyle(i):s.style=i}T(B,"setLabelLineState");function nr(a,n){var o=n.smooth,r=n.points;if(r)if(a.moveTo(r[0][0],r[0][1]),o>0&&r.length>=3){var t=R.dist(r[0],r[1]),s=R.dist(r[1],r[2]);if(!t||!s){a.lineTo(r[1][0],r[1][1]),a.lineTo(r[2][0],r[2][1]);return}var f=Math.min(t,s)*o,i=R.lerp([],r[1],r[0],f/t),l=R.lerp([],r[1],r[2],f/s),u=R.lerp([],i,l,.5);a.bezierCurveTo(i[0],i[1],i[0],i[1],u[0],u[1]),a.bezierCurveTo(l[0],l[1],l[0],l[1],r[2][0],r[2][1])}else for(var e=1;e<r.length;e++)a.lineTo(r[e][0],r[e][1])}T(nr,"buildLabelLinePath");function vr(a,n,o){var r=a.getTextGuideLine(),t=a.getTextContent();if(!t){r&&a.removeTextGuideLine();return}for(var s=n.normal,f=s.get("show"),i=t.ignore,l=0;l<G.DISPLAY_STATES.length;l++){var u=G.DISPLAY_STATES[l],e=n[u],h=u==="normal";if(e){var b=e.get("show"),v=h?i:O.retrieve2(t.states[u]&&t.states[u].ignore,i);if(v||!O.retrieve2(b,f)){var p=h?r:r&&r.states[u];p&&(p.ignore=!0),r&&B(r,!0,u,e);continue}r||(r=new V.default,a.setTextGuideLine(r),!h&&(i||!f)&&B(r,!0,"normal",n.normal),a.stateProxy&&(r.stateProxy=a.stateProxy)),B(r,!1,u,e)}}if(r){O.defaults(r.style,o),r.style.fill=null;var d=s.get("showAbove"),M=a.textGuideLineConfig=a.textGuideLineConfig||{};M.showAbove=d||!1,r.buildPath=nr}}T(vr,"setLabelLineStyle");function fr(a,n){n=n||"labelLine";for(var o={normal:a.getModel(n)},r=0;r<G.SPECIAL_STATES.length;r++){var t=G.SPECIAL_STATES[r];o[t]=a.getModel([t,n])}return o}T(fr,"getLabelLineStatesModels");exports.getLabelLineStatesModels=fr;exports.limitSurfaceAngle=or;exports.limitTurnAngle=Q;exports.setLabelLineStyle=vr;exports.updateLabelLinePoints=tr;
