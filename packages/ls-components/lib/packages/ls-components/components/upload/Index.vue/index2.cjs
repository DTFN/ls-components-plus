"use strict";var ve=Object.defineProperty;var r=(P,q)=>ve(P,"name",{value:q,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});;/* empty css                                                                                                                                            */;/* empty css                                                                                                                                              */;/* empty css                                                                                                                                                */;/* empty css                                                                                                                                              */const e=require("vue"),E=,/* empty css               */pe=,/* empty css                          */ge=,/* empty css                                */F=,/* empty css                              */j=;/* empty css                           */;/* empty css                                                                                                                                             */;/* empty css                                                                                                                                               */const S=,/* empty css                                                                                                                                              */ke=,/* empty css                                                                                                                                             */Fe=,/* empty css                                                                                                                                             */ye={class:"ls-drag"},he={class:"drag-txt ls-color-brand6"},be={key:0,class:"btn-picture-card"},Ce={key:0,class:"ls-tip"},Be=e.defineComponent({name:"LSUpload",inheritAttrs:!1,__name:"Index",props:E.lsUploadProps,emits:["uploadErrorFunc","onChangeFunc","httpResponseFunc"],setup(P,{expose:q,emit:G}){const x=e.useSlots(),m=e.useAttrs(),H=ge.useNamespace("upload").b(),c=e.ref(),s=e.ref(!1),v=e.reactive({isCover:!0,accept:"",disabled:!1}),a=e.reactive({uploadFileList:[],initUploadStatus:!0,showPreview:!1,typePreview:"",sourcePreview:"",iconColor:pe.getVariable("colorText1")}),o=P,w=G;e.watch(()=>m["file-list"],t=>{a.uploadFileList=t||[]},{immediate:!0,deep:!0});const y=e.computed(()=>{var t,n;return(((t=o==null?void 0:o.item)==null?void 0:t.isToast)||typeof((n=o==null?void 0:o.item)==null?void 0:n.isToast))==="undefined"}),d=e.computed(()=>{var n;const t=(n=o==null?void 0:o.item)==null?void 0:n.isCover;return typeof t>"u"?!0:t}),p=e.computed(()=>m.multiple),g=e.computed(()=>{const t=m["auto-upload"];return typeof t>"u"?!0:t}),K=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.emptyFileMsg)||""}),M=e.computed(()=>m["list-type"]),L=e.computed(()=>M.value===E.UPLOAD_TYPE_MAP.picCard),W=e.computed(()=>!M.value||M.value=="text"),h=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitFile)||[]}),X=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitFileMsg)||""}),b=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitSize)||2}),Y=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitSizeMsg)||""}),$=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitUnit)||"MB"}),J=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.limitNumMsg)||""}),R=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.profile)||!1}),C=e.computed(()=>m.drag),Q=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.hideCoverBtn)&&d.value&&a.uploadFileList.length>0}),k=e.computed(()=>m.disabled),A=e.computed(()=>{const t=L.value?"图片":"文件";let n=`选择${t}`;return s.value?n="正在上传...":d.value&&!p.value?g.value?a.initUploadStatus?n="点击上传":n="重新上传":a.initUploadStatus?n=`选择${t}`:n="重新上传":g.value&&(n="点击上传"),n}),Z=e.computed(()=>{let t="不限制上传格式，";return L.value&&(t="文件须为图片格式，"),`${t}文件大小不超过${b.value}${$.value}`}),ee=e.computed(()=>{var t;return((t=o==null?void 0:o.item)==null?void 0:t.tipContent)||""}),N=e.computed(()=>{var t;return(t=o==null?void 0:o.item)==null?void 0:t.httpRequestFunc});e.watch([d,N],([t,n])=>{v.isCover=t,n&&n instanceof Function&&(v["http-request"]=ue)},{immediate:!0,deep:!0}),e.watch(()=>h.value,t=>{t&&t.length>0&&te(t)},{immediate:!0,deep:!0});function te(t){v.accept="",t.forEach(n=>{const l=E.fileTypeMap[n]||"";l&&(v.accept&&(v.accept+=","),v.accept+=l)})}r(te,"updateFileAccept");function B(t){const{formRuleFunc:n,formValidateFunc:l}=e.toRefs(o==null?void 0:o.item);if(n&&n.value instanceof Function&&l&&l.value instanceof Function){const i=n.value(),{message:u}=i;i.message=t,l.value(),i.message=u}w("uploadErrorFunc",t)}r(B,"validateForm");function ne(t,n){if(s.value=!1,o.onExceed)return o.onExceed(t,n);const l=`当前限制选择 ${m.limit} 个文件，本次选择了 ${t.length} 个文件，共选择了 ${t.length+n.length} 个文件`||J.value;y.value?setTimeout(()=>{S.ElMessage.warning(l)},200):B(l)}r(ne,"onExceedAction");function oe(t){if(o.beforeUpload){const l=o.beforeUpload(t);return l&&d.value&&!p.value&&T(),l}const n=V(t,!0);return n&&g.value&&d.value&&!p.value&&T(),n}r(oe,"beforeUploadAction");function V(t,n){let l=!0;const{size:i,name:u}=t,_=h.value.length>0&&!z(u);let U=!1;switch($.value){case"KB":U=i/1024>b.value;break;case"MB":U=i/1024/1024>b.value;break;default:U=i/1024/1024/1024>b.value;break}if(_){const f=X.value||`上传文件 ${t.name} 只能是 ${h.value.filter(me=>me).join("，").toLocaleLowerCase()} 格式！`;y.value&&n?setTimeout(()=>{S.ElMessage.error(f)},200):B(f),l=!1}if(U){const f=Y.value||`上传文件 ${t.name} 大小不能超过 ${b.value}${$.value}！`;y.value&&n?setTimeout(()=>{S.ElMessage.error(f)},200):B(f),l=!1}if(L.value&&!z(u,E.IMG_SUFFIX_LIST)){const f=`上传文件 ${t.name} 不是图片格式的文件！`;y.value&&n?setTimeout(()=>{S.ElMessage.error(f)},200):B(f),l=!1}return l}r(V,"validateUploadFile");function z(t,n){let l=[];if(h.value.length>0?l=h.value:n&&(l=n),l.length<=0)return!0;for(let i=0;i<l.length;i++){const u=(l[i]||"").toLowerCase();if(t.toLowerCase().endsWith(u))return!0}return!1}r(z,"fileTypeMatch");function T(t,n){a.uploadFileList.splice(t||0,n||a.uploadFileList.length-1)}r(T,"updateCoverFileList");function le(t,n){a.uploadFileList=n;const l=t.raw&&V(t.raw,!g.value);if(l&&d.value&&!p.value&&T(),o.onChange)return o.onChange(t,n);const{size:i}=t;if(i<=0){D();const u=K.value||"禁止上传空文件，请检查后重新上传！";y.value?S.ElMessage.error(u):B(u);return}t.raw&&(!g.value&&!l?D():(t.blob=URL.createObjectURL(t.raw)||"",w("onChangeFunc",t)))}r(le,"onChangeAction");function D(){let t=0;a.uploadFileList.length>1&&(t=a.uploadFileList.length-1),T(t,1),w("onChangeFunc",{})}r(D,"setChangeRes");function ie(t,n,l){s.value=!1,a.initUploadStatus=!1;const{formRuleFunc:i,formValidateFunc:u}=e.toRefs(o==null?void 0:o.item);if(i&&i.value instanceof Function&&u&&u.value instanceof Function&&u.value(),o.onSuccess)return o.onSuccess(t,n,l)}r(ie,"onSuccessAction");function re(t,n,l){if(s.value=!1,o.onError)return o.onError(t,n,l)}r(re,"onErrorAction");function ae(t,n){if(a.initUploadStatus=!n.length,a.uploadFileList=a.uploadFileList.filter(l=>l.uid===t.uid||l.name===t.name?null:l),o.onRemove)return o.onRemove(t,n)}r(ae,"onRemoveAction");async function ue(t){const{file:n}=t;if(!n)return;const{size:l}=n;if(l<=0||!V(n,!1))return;if(o.httpRequest)return o.httpRequest(t);const i=new FormData;if(i.append("file",n),N.value instanceof Function){s.value=!0;let u={};try{u=await N.value(i)}catch(_){u=_}finally{s.value=!1,w("httpResponseFunc",u)}}}r(ue,"httpRequestAction");function I(){let t=!1;for(let n=0;n<a.uploadFileList.length;n++)if(a.uploadFileList[n].status===E.UPLOAD_STATUS_MAP.ready){t=!0;break}return t}r(I,"hasReadyFile");function O(){var t;(t=c==null?void 0:c.value)==null||t.submit()}r(O,"comfirmUpload");function se(t){c==null||c.value.handleRemove(t)}r(se,"removeFile");function ce(){a.uploadFileList.forEach(t=>{var n;if(t)try{(n=c==null?void 0:c.value)==null||n.abort(t),se(t)}catch{}})}r(ce,"cancelUpload");function de(t,n,l){if(s.value=!0,o.onProgress)return o.onProgress(t,n,l)}r(de,"onProgressAction");function fe(t){if(o.onPreview)return o.onPreview(t)}return r(fe,"onPreviewAction"),q({uploadRef:c}),(t,n)=>{const l=ke.ElAvatar,i=Fe.ElUpload;return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass([e.unref(H),e.unref(C)?"ls-upload-drag":"",e.unref(R)?"ls-profile":"",e.unref(Q)?"hide-cover-btn":""])},[e.createVNode(i,e.mergeProps({ref_key:"uploadRef",ref:c},Object.assign(e.unref(v),t.$attrs),{"on-exceed":ne,"before-upload":oe,"on-change":le,"on-success":ie,"on-error":re,"on-remove":ae,"on-progress":de,"on-preview":fe}),e.createSlots({trigger:e.withCtx(()=>[e.unref(R)?t.item.defProfile&&e.unref(a).uploadFileList.length<1?(e.openBlock(),e.createBlock(l,{key:1,size:60,src:t.item.defProfile,fit:"contain"},null,8,["src"])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(x).trigger?e.renderSlot(t.$slots,"trigger",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(C)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(s)?(e.openBlock(),e.createBlock(F.default,{key:0,text:"",loading:e.unref(s),disabled:e.unref(k)},null,8,["loading","disabled"])):(e.openBlock(),e.createBlock(j.default,{key:1,class:"upload-icon",name:"UploadFilled",size:"56",color:"#E7E7E7"})),e.createElementVNode("div",ye,[e.createElementVNode("div",he,e.toDisplayString(e.unref(A)),1),e.unref(s)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[n[0]||(n[0]=e.createTextVNode("   /   ")),n[1]||(n[1]=e.createElementVNode("div",{class:"drag-txt ls-color-text2"},"拖拽到此区域",-1))],64))])],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(L)?(e.openBlock(),e.createElementBlock("div",be,[e.unref(s)?(e.openBlock(),e.createBlock(F.default,{key:0,text:"",loading:e.unref(s),disabled:e.unref(k)},null,8,["loading","disabled"])):(e.openBlock(),e.createBlock(j.default,{key:1,class:"upload-btn-plus",name:"Plus",size:28,color:e.unref(a).iconColor},null,8,["color"])),e.createElementVNode("div",null,e.toDisplayString(e.unref(A)),1)])):(e.openBlock(),e.createBlock(F.default,{key:1,plain:"",icon:"upload",loading:e.unref(s),disabled:e.unref(k)},{default:e.withCtx(()=>[e.createTextVNode(e.toDisplayString(e.unref(A)),1)]),_:1},8,["loading","disabled"]))],64))],64))],64))]),default:e.withCtx(()=>[e.unref(x).default?e.renderSlot(t.$slots,"default",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[!e.unref(g)&&(e.unref(W)||e.unref(C))?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["upload-btn-handle",[e.unref(C)?"drag-css":"nor-css",!e.unref(d)||e.unref(p)?"multi-css":""]])},[e.unref(C)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[!e.unref(d)||e.unref(p)?(e.openBlock(),e.createBlock(F.default,{key:0,type:"primary",loading:e.unref(s),disabled:e.unref(k),onClick:ce,class:"ls-upload-btn-com ls-upload-btn-cancel"},{default:e.withCtx(()=>n[3]||(n[3]=[e.createTextVNode("取消上传")])),_:1},8,["loading","disabled"])):e.createCommentVNode("",!0),e.createVNode(F.default,{class:e.normalizeClass(["start-upload ls-upload-btn-com ls-upload-btn-comfirm",{"is-ready":I()}]),type:"primary",loading:e.unref(s),disabled:e.unref(k),onClick:O},{default:e.withCtx(()=>n[4]||(n[4]=[e.createTextVNode("开始上传")])),_:1},8,["class","loading","disabled"])],64)):(e.openBlock(),e.createBlock(F.default,{key:0,type:"primary",class:e.normalizeClass(["ls-upload-btn-com ls-upload-btn-comfirm",{"is-ready":I()}]),loading:e.unref(s),disabled:e.unref(k),onClick:O},{default:e.withCtx(()=>n[2]||(n[2]=[e.createTextVNode("开始上传 ")])),_:1},8,["class","loading","disabled"]))],2)):e.createCommentVNode("",!0)],64))]),tip:e.withCtx(()=>[e.unref(x).tip?e.renderSlot(t.$slots,"tip",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock("div",Ce,e.toDisplayString(e.unref(ee)||e.unref(Z)),1))]),_:2},[e.unref(x).file?{name:"file",fn:e.withCtx(()=>[e.renderSlot(t.$slots,"file",{},void 0,!0)]),key:"0"}:void 0]),1040)],2)}}});exports.default=Be;
