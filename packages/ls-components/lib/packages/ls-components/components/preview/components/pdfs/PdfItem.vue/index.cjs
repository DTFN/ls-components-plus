"use strict";var D=Object.defineProperty;var r=(s,f)=>D(s,"name",{value:f,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const n=require("vue"),j=require("pdfjs-dist"),z=;/* empty css                        */;/* empty css                         */const H=,/* empty css                  */J=;/* empty css                 */;/* empty css                  */const X=;/* empty css                                                                                             */function I(s){const f=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const p in s)if(p!=="default"){const o=Object.getOwnPropertyDescriptor(s,p);Object.defineProperty(f,p,o.get?o:{enumerable:!0,get:r(()=>s[p],"get")})}}return f.default=s,Object.freeze(f)}r(I,"_interopNamespaceDefault");const C=I(j),G=n.defineComponent({name:"LSPdf"}),K=n.defineComponent({...G,props:{pdf:{},page:{default:1},scale:{default:1},rotation:{},fitParent:{type:Boolean},width:{},height:{},textLayer:{type:Boolean},imageResourcesPath:{},hideForms:{type:Boolean},intent:{default:"display"},annotationLayer:{type:Boolean},annotationsFilter:{},annotationsMap:{},watermarkText:{},watermarkOptions:{},highlightText:{},highlightOptions:{}},emits:["annotation","highlight","loaded","textLoaded","annotationLoaded","xfaLoaded","loadComplete","loadError","update:source"],setup(s,{expose:f,emit:p}){const o=s,u=p;n.watch(()=>o.pdf,()=>{W()},{immediate:!0,deep:!0});const v=n.ref(),y=n.ref(),_=n.ref(!1);let x;const c=n.computed(()=>({viewport:void 0,document:void 0,page:void 0})),A=n.computed(()=>({annotationsMap:o.annotationsMap,annotationsFilter:o.annotationsFilter,imageResourcesPath:o.imageResourcesPath,hideForms:o.hideForms,intent:o.intent})),O=n.computed(()=>({highlightText:o.highlightText,highlightOptions:o.highlightOptions}));function T(){return X.default({},{columns:4,rows:4,rotation:45,fontSize:18,color:"rgba(211, 210, 211, 0.4)"},o.watermarkOptions)}r(T,"getWatermarkOptionsWithDefaults");function b(a){if(!(typeof a=="number"&&a%90===0))return 0;const e=a/90;return e>4?b(a-360):e<0?b(a+360):a}r(b,"getRotation");function B(a){let e=o.scale;if(o.fitParent){const t=v.value.parentNode.clientWidth,i=a.getViewport({scale:1}).width;e=t/i}else if(o.width){const t=a.getViewport({scale:1}).width;e=o.width/t}else if(o.height){const t=a.getViewport({scale:1}).height;e=o.height/t}return e}r(B,"getScale");function F(a=1){if(!o.watermarkText)return;const e=M();if(!e)return;const t=e.getContext("2d");if(!t)return;const i=T(),h=o.watermarkText,l=i.columns,g=i.rows,d=l*g,w=i.rotation,P=i.fontSize*a;t.font=`${P}px Trebuchet MS`,t.fillStyle=i.color;for(let m=0;m<d;m++){const k=m%l*(e.width/l)+e.width/(l*2),q=Math.floor(m/l)*(e.height/g)+e.height/(g*2),$=t.measureText(h).width;t.save(),t.translate(k,q),t.rotate(-w*(Math.PI/180)),t.fillText(h,-$/2,P/2),t.restore()}}r(F,"paintWatermark");function M(){var e;let a=null;return(e=v.value)==null||e.childNodes.forEach(t=>{t.tagName==="CANVAS"&&(a=t)}),a}r(M,"getCurrentCanvas");function N(a){var h;let e;const t=M();t&&(t==null?void 0:t.getAttribute("role"))==="main"?e=t:(e=document.createElement("canvas"),e.style.display="block",e.setAttribute("dir","ltr"));const i=window.devicePixelRatio||1;return e.width=Math.floor(a.width*i),e.height=Math.floor(a.height*i),e.style.width=`${Math.floor(a.width)}px`,e.style.height=`${Math.floor(a.height)}px`,e.setAttribute("class","pdf-canvas"),(h=v.value)==null||h.style.setProperty("--scale-factor",`${a.scale}`),y.value.style.width=`${Math.floor(a.width)}px`,y.value.style.height=`${Math.floor(a.height)}px`,y.value.style.top="0",y.value.style.left="0",_.value=!0,e}r(N,"setupCanvas");function S(){x&&x.cancel()}r(S,"cancelRender");function L(a){var e;(e=n.toRaw(c.value.document))==null||e.getPage(a).then(t=>{var k;S();const i=t.getViewport(),h={scale:B(t),rotation:b((o.rotation||0)+i.rotation)},l=t.getViewport(h),g=M(),d=N(l),w=window.devicePixelRatio||1,P=w!==1?[w,0,0,w,0,0]:void 0,m={canvasContext:d.getContext("2d"),viewport:l,annotationMode:o.hideForms?C.AnnotationMode.ENABLE:C.AnnotationMode.ENABLE_FORMS,transform:P,intent:o.intent};(d==null?void 0:d.getAttribute("role"))!=="main"?g&&((k=v.value)==null||k.replaceChild(d,g)):d.removeAttribute("role"),c.value.page=t,c.value.viewport=l,x=t.render(m),x.promise.then(()=>{_.value=!1,F(l.scale),u("loaded",c.value.viewport),u("loadComplete")}).catch(()=>{u("loadError")})})}r(L,"renderPage");function V(a){a.promise&&a.promise.then(async e=>{c.value.document=e,L(o.page)})}r(V,"initDoc"),n.watch(()=>[o.page,o.scale,o.width,o.height,o.rotation,o.hideForms,o.intent],()=>{L(o.page)});function E(){L(o.page)}r(E,"reload");function R(){S()}r(R,"cancel");async function W(){if(o.pdf)try{V(o.pdf)}finally{}}return r(W,"initPdf"),f({reload:E,cancel:R}),(a,e)=>(n.openBlock(),n.createElementBlock("div",{ref_key:"container",ref:v,style:{position:"relative",display:"block"}},[e[5]||(e[5]=n.createElementVNode("canvas",{dir:"ltr",style:{display:"block"},role:"main"},null,-1)),a.annotationLayer?(n.openBlock(),n.createBlock(z.default,n.mergeProps({key:0},{...n.unref(c),...n.unref(A)},{onAnnotation:e[0]||(e[0]=t=>u("annotation",t)),onAnnotationLoaded:e[1]||(e[1]=t=>u("annotationLoaded",t))}),null,16)):n.createCommentVNode("",!0),a.textLayer?(n.openBlock(),n.createBlock(H.default,n.mergeProps({key:1},{...n.unref(c),...n.unref(O)},{onHighlight:e[2]||(e[2]=t=>u("highlight",t)),onTextLoaded:e[3]||(e[3]=t=>u("textLoaded",t))}),null,16)):n.createCommentVNode("",!0),n.createVNode(J.default,n.mergeProps({...n.unref(c)},{onXfaLoaded:e[4]||(e[4]=t=>u("xfaLoaded"))}),null,16),n.withDirectives(n.createElementVNode("div",{ref_key:"loadingLayer",ref:y,style:{position:"absolute"}},[n.renderSlot(a.$slots,"default")],512),[[n.vShow,n.unref(_)]])],512))}});exports.default=K;
