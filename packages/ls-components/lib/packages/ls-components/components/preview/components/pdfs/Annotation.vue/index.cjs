"use strict";var F=Object.defineProperty;var c=(s,l)=>F(s,"name",{value:l,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const i=require("vue"),j=require("pdfjs-dist"),y=require("../annotations/index.cjs"),k=require("../linkService/index.cjs");function P(s){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const e in s)if(e!=="default"){const d=Object.getOwnPropertyDescriptor(s,e);Object.defineProperty(l,e,d.get?d:{enumerable:!0,get:c(()=>s[e],"get")})}}return l.default=s,Object.freeze(l)}c(P,"_interopNamespaceDefault");const T=P(j),L=i.defineComponent({__name:"Annotation",props:{page:{},viewport:{},document:{},annotationsFilter:{},annotationsMap:{},imageResourcesPath:{},hideForms:{type:Boolean},enableScripting:{type:Boolean},intent:{}},emits:["annotation","annotationLoaded"],setup(s,{emit:l}){const e=s,d=l,r=i.ref(),v=i.ref();function w(o){const t=y.annotationEventsHandler(o,e.document,v.value);Promise.resolve(t).then(n=>{n&&d("annotation",n)})}c(w,"annotationsEvents");async function M(){var t;return await((t=i.toRaw(e.document))==null?void 0:t.getFieldObjects())}c(M,"getFieldObjects");async function O(){var t;return await((t=i.toRaw(e.document))==null?void 0:t.hasJSActions())}c(O,"getHasJSActions");async function b(){const o=e.page;let t=await(o==null?void 0:o.getAnnotations({intent:e.intent}));if(e.annotationsFilter){const n=e.annotationsFilter;t=t.filter(u=>{const p=u.subtype,f=u.fieldType?`${p}.${u.fieldType}`:null;return(n==null?void 0:n.includes(p))||f!==null&&(n==null?void 0:n.includes(f))})}return t}c(b,"getAnnotations");async function S(){var h,_;(_=(h=r.value).replaceChildren)==null||_.call(h);for(const a of y.EVENTS_TO_HANDLER)r.value.removeEventListener(a,w);const o=i.toRaw(e.document),t=e.page,n=e.viewport;v.value=await b();const u=new Map([]);for(const a of v.value)if(a.subtype==="Widget"&&a.fieldType==="Btn"&&a.pushButton){const g=a.rect[2]-a.rect[0],E=a.rect[3]-a.rect[1],m=document.createElement("canvas");m.setAttribute("width",(g*n.scale).toString()),m.setAttribute("height",(E*n.scale).toString()),u.set(a.id,m)}const p=o.annotationStorage;if(e.annotationsMap)for(const[a,g]of Object.entries(e.annotationsMap))p.setValue(a,g);const f={accessibilityManager:void 0,annotationCanvasMap:u,div:r.value,page:t,viewport:n.clone({dontFlip:!0}),annotationEditorUIManager:null,l10n:null},A={annotations:v.value,viewport:n.clone({dontFlip:!0}),linkService:new k.SimpleLinkService,annotationCanvasMap:u,div:r.value,annotationStorage:p,renderForms:!e.hideForms,page:t,enableScripting:!1,hasJSActions:await O(),fieldObjects:await M(),downloadManager:null,imageResourcesPath:e.imageResourcesPath};new T.AnnotationLayer(f).render(A).then(async()=>{d("annotationLoaded",await b())});for(const a of y.EVENTS_TO_HANDLER)r.value.addEventListener(a,w)}return c(S,"render"),i.watch(()=>e.viewport,()=>{e.page&&e.viewport&&r.value&&S()}),i.onMounted(()=>{e.page&&e.viewport&&r.value&&S()}),(o,t)=>(i.openBlock(),i.createElementBlock("div",{ref_key:"layer",ref:r,class:"annotationLayer",style:{display:"block"}},null,512))}});exports.default=L;
