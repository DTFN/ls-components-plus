"use strict";var _=Object.defineProperty;var o=(t,s)=>_(t,"name",{value:s,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const r=require("vue"),b=require("pdfjs-dist"),p=require("../highlight/index.cjs"),M=require("../../../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/merge/index.cjs");function D(t){const s=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const e in t)if(e!=="default"){const l=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(s,e,l.get?l:{enumerable:!0,get:o(()=>t[e],"get")})}}return s.default=t,Object.freeze(s)}o(D,"_interopNamespaceDefault");const S=D(b),L=r.defineComponent({__name:"Text",props:{page:{},viewport:{},highlightText:{},highlightOptions:{}},emits:["highlight","textLoaded"],setup(t,{emit:s}){const e=t,l=s,c=r.ref(),u=r.ref();let h=[];function w(){return M.default({},{ignoreCase:!0,completeWords:!1},e.highlightOptions)}o(w,"getHighlightOptionsWithDefaults");async function v(n=!1){const i=e.page,a=await(i==null?void 0:i.getTextContent());if(a&&(n&&p.resetDivs(a,h),e.highlightText)){const d=typeof e.highlightText=="string"?[e.highlightText]:e.highlightText,g=p.findMatches(d,a,w());p.highlightMatches(g,a,h),l("highlight",{matches:g,textContent:a,textDivs:h,page:(i==null?void 0:i.pageNumber)||1})}}o(v,"findAndHighlight");function m(){var g,x;(x=(g=c.value).replaceChildren)==null||x.call(g);const n=e.page,i=e.viewport,a=n==null?void 0:n.streamTextContent({includeMarkedContent:!0,disableNormalization:!0}),d=new S.TextLayer({container:c.value,textContentSource:a,viewport:i});d.render().then(async()=>{var y;h=d.textDivs;const O=await(n==null?void 0:n.getTextContent());l("textLoaded",{textDivs:h,textContent:O});const f=document.createElement("div");f.className="endOfContent",(y=c.value)==null||y.appendChild(f),u.value=f,v()})}o(m,"render");function C(){u.value&&u.value.classList.add("active")}o(C,"onMouseDown");function T(){u.value&&u.value.classList.remove("active")}return o(T,"onMouseUp"),r.watch(()=>e.viewport,()=>{e.page&&e.viewport&&c.value&&m()}),r.watch(()=>[e.highlightText,e.highlightOptions],()=>{v(!0)},{deep:!0}),r.onMounted(()=>{e.page&&e.viewport&&c.value&&m()}),(n,i)=>(r.openBlock(),r.createElementBlock("div",{ref_key:"layer",ref:c,class:"textLayer",style:{display:"block"},onMousedown:C,onMouseup:T},null,544))}});exports.default=L;
