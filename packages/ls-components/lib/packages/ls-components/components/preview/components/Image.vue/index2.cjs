"use strict";var ne=Object.defineProperty;var r=(w,z)=>ne(w,"name",{value:z,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),F=require("../../../../../../node_modules/.pnpm/@vueuse_core@12.0.0_typescript@5.5.4/node_modules/@vueuse/core/index/index.cjs"),oe=require("../../../_hooks/useNamespace/index.cjs"),se=require("../../../_hooks/useZIndex/index.cjs"),k=require("../../../_constants/aria/index.cjs"),_=require("../../../_utils/check/index.cjs"),ae=require("../../../_utils/types/index.cjs"),X=require("../../types/index.cjs"),f=require("../../../icon/Index.vue/index.cjs"),O=require("../../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/throttle/index.cjs"),Y=require("../../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/merge/index.cjs"),re=["src"],le=e.defineComponent({name:"LSImage"}),ie=e.defineComponent({...le,props:X.imageViewerProps,emits:X.previewEmits,setup(w,{expose:z,emit:$}){const v={CONTAIN:{name:"FullScreen"},ORIGINAL:{name:"ScaleToOriginal"}},A=_.isFirefox()?"DOMMouseScroll":"mousewheel",l=w,h=$,s=oe.useNamespace("image"),{nextZIndex:B}=se.useZIndex(),I=e.ref(),y=e.ref([]),L=e.effectScope(),g=e.ref(!0),u=e.ref(l.initialIndex),N=e.shallowRef(v.CONTAIN),a=e.reactive({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"auto",height:"auto",objectFit:"none"}),j=e.computed(()=>{const{source:t}=l;return t.length<=1}),D=e.computed(()=>u.value===0),S=e.computed(()=>u.value===l.source.length-1),Z=e.computed(()=>l.source[u.value]),H=e.computed(()=>{const{scale:t,deg:n,offsetX:o,offsetY:i,enableTransition:c,width:E,height:T,objectFit:C}=a;let m=o/t,p=i/t;switch(n%360){case 90:case-270:[m,p]=[p,-m];break;case 180:case-180:[m,p]=[-m,-p];break;case 270:case-90:[m,p]=[-p,m];break}const b={transform:`scale(${t}) rotate(${n}deg) translate(${m}px, ${p}px)`,transition:c?"transform .3s":""};return N.value.name===v.CONTAIN.name&&(b.maxWidth=b.maxHeight="100%"),b.width=E,b.height=T,b.objectFit=C,b}),P=e.computed(()=>_.isNumber(l.zIndex)?l.zIndex:B()),G=r(()=>{l.onClose&&l.onClose(),h("update:source",[])},"closeFunc");function V(){J(),G()}r(V,"hide");function W(){const t=O.default(o=>{switch(o.code){case k.EVENT_CODE.esc:l.closeOnPressEscape&&V();break;case k.EVENT_CODE.space:M();break;case k.EVENT_CODE.left:q();break;case k.EVENT_CODE.up:d("zoomIn");break;case k.EVENT_CODE.right:R();break;case k.EVENT_CODE.down:d("zoomOut");break}}),n=O.default(o=>{(o.wheelDelta?o.wheelDelta:-o.detail)>0?d("zoomIn",{zoomRate:1.2,enableTransition:!1}):d("zoomOut",{zoomRate:1.2,enableTransition:!1})});L.run(()=>{F.useEventListener(document,"keydown",t),F.useEventListener(document,A,n)})}r(W,"registerEventListener");function J(){L.stop()}r(J,"unregisterEventListener");function K(){g.value=!1,h("loadComplete")}r(K,"handleImgLoad");function Q(t){g.value=!1,t.target.alt="ls.image.error",h("loadError")}r(Q,"handleImgError");function U(t){if(g.value||t.button!==0||!I.value)return;a.enableTransition=!1;const{offsetX:n,offsetY:o}=a,i=t.pageX,c=t.pageY,E=O.default(C=>{a.offsetX=n+C.pageX-i,a.offsetY=o+C.pageY-c}),T=F.useEventListener(document,"mousemove",E);F.useEventListener(document,"mouseup",()=>{T()}),t.preventDefault()}r(U,"handleMouseDown");function ee(){Y.default(a,{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"auto",height:"auto",objectFit:"none"})}r(ee,"reset");function te(){Y.default(a,{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"100%",height:"100%",objectFit:"cover"})}r(te,"fullScreen");function M(){if(g.value)return;const t=ae.keysOf(v),n=Object.values(v),o=N.value.name,c=(n.findIndex(E=>E.name===o)+1)%t.length;N.value=v[t[c]],o===v.CONTAIN.name?te():ee()}r(M,"toggleMode");function x(t){const n=l.source.length;u.value=(t+n)%n}r(x,"setActiveItem");function q(){D.value&&!l.infinite||x(u.value-1)}r(q,"prev");function R(){S.value&&!l.infinite||x(u.value+1)}r(R,"next");function d(t,n={}){if(g.value)return;const{zoomRate:o,rotateDeg:i,enableTransition:c}={zoomRate:1.4,rotateDeg:90,enableTransition:!0,...n};switch(t){case"zoomOut":a.scale>.2&&(a.scale=Number.parseFloat((a.scale/o).toFixed(3)));break;case"zoomIn":a.scale<7&&(a.scale=Number.parseFloat((a.scale*o).toFixed(3)));break;case"clockwise":a.deg+=i;break;case"anticlockwise":a.deg-=i;break}a.enableTransition=c}return r(d,"handleActions"),e.watch(Z,()=>{e.nextTick(()=>{const t=y.value[0];t!=null&&t.complete||(g.value=!0)})}),e.watch(u,t=>{h("switch",t)}),e.onMounted(()=>{var t,n;W(),(n=(t=I.value)==null?void 0:t.focus)==null||n.call(t)}),z({setActiveItem:x}),(t,n)=>(e.openBlock(),e.createBlock(e.Teleport,{to:"body",disabled:!t.teleported},[e.createVNode(e.Transition,{name:"viewer-fade",appear:""},{default:e.withCtx(()=>[e.createElementVNode("div",{ref_key:"wrapper",ref:I,tabindex:-1,class:e.normalizeClass(e.unref(s).e("wrapper")),style:e.normalizeStyle({zIndex:e.unref(P)})},[e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("mask")),onClick:n[0]||(n[0]=e.withModifiers(o=>t.hideOnClickModal&&V(),["self"]))},null,2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("close")]),onClick:V},[e.createVNode(f.default,{name:"Close",size:24,color:"#FFF"})],2),e.unref(j)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("prev"),e.unref(s).is("disabled",!t.infinite&&e.unref(D))]),onClick:q},[e.createVNode(f.default,{name:"ArrowLeft",size:24,color:"#FFF"})],2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("next"),e.unref(s).is("disabled",!t.infinite&&e.unref(S))]),onClick:R},[e.createVNode(f.default,{name:"ArrowRight",size:24,color:"#FFF"})],2)],64)),e.createElementVNode("div",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("actions")])},[e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("actions__inner"))},[e.createVNode(f.default,{name:"ZoomOut",size:24,color:"#FFF",onClick:n[1]||(n[1]=o=>d("zoomOut"))}),e.createVNode(f.default,{name:"ZoomIn",size:24,color:"#FFF",onClick:n[2]||(n[2]=o=>d("zoomIn"))}),e.createElementVNode("i",{class:e.normalizeClass(e.unref(s).e("actions__divider"))},null,2),e.createVNode(f.default,{name:e.unref(N).name,size:24,color:"#FFF",onClick:M},null,8,["name"]),e.createElementVNode("i",{class:e.normalizeClass(e.unref(s).e("actions__divider"))},null,2),e.createVNode(f.default,{name:"RefreshLeft",size:24,color:"#FFF",onClick:n[3]||(n[3]=o=>d("anticlockwise"))}),e.createVNode(f.default,{name:"RefreshRight",size:24,color:"#FFF",onClick:n[4]||(n[4]=o=>d("clockwise"))})],2)],2),e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("canvas"))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.source,(o,i)=>e.withDirectives((e.openBlock(),e.createElementBlock("img",{ref_for:!0,ref:r(c=>e.unref(y)[i]=c,"ref"),key:o,src:o,style:e.normalizeStyle(e.unref(H)),class:e.normalizeClass(e.unref(s).e("img")),onLoad:K,onError:Q,onMousedown:U},null,46,re)),[[e.vShow,i===e.unref(u)]])),128))],2),e.renderSlot(t.$slots,"default",{},void 0,!0)],6)]),_:3})],8,["disabled"]))}});exports.default=ie;
