"use strict";var x=Object.defineProperty;var l=(t,o)=>x(t,"name",{value:o,configurable:!0});Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const E=require("pdfjs-dist"),N=require("../../../../../node_modules/.pnpm/pdfjs-dist@4.8.69/node_modules/pdfjs-dist/build/pdf.worker.min/index.cjs"),m=require("vue"),b=require("../components/pdfs/destination/index.cjs"),T=require("../components/pdfs/miscellaneous/index.cjs");function U(t){const o=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const u in t)if(u!=="default"){const i=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(o,u,i.get?i:{enumerable:!0,get:l(()=>t[u],"get")})}}return o.default=t,Object.freeze(o)}l(U,"_interopNamespaceDefault");const P=U(E);function _(t){P.GlobalWorkerOptions.workerSrc=t}l(_,"configWorker");function q(t,o={onProgress:void 0,onPassword:void 0,onError:void 0,password:""}){var S;(S=P.GlobalWorkerOptions)!=null&&S.workerSrc||_(N.default);const u=m.shallowRef(),i=m.shallowRef(),D=m.shallowRef(0),k=m.shallowRef({});function v(d){i.value&&i.value.destroy();const a=P.getDocument(d);if(o.onProgress&&(a.onProgress=o.onProgress),o.onPassword)a.onPassword=o.onPassword;else if(o.password){const e=l(c=>{c(o.password??"")},"onPassword");a.onPassword=e}return a.promise.then(async e=>{i.value=e,u.value=e.loadingTask,D.value=e.numPages;const c=await e.getMetadata(),s=await e.getAttachments(),r=await e.getJSActions(),f=await e.getOutline();k.value={metadata:c,attachments:s,javascript:r,outline:f}},e=>{typeof o.onError=="function"&&o.onError(e)})}l(v,"processLoadingTask");async function L(d){var n;const a=await((n=u.value)==null?void 0:n.promise);if(!a)return null;const e=await b.getDestinationArray(a,d),c=await b.getDestinationRef(a,e);if(!c||!e)return null;const s=await a.getPageIndex(c),r=e[1].name,f=e.slice(2),p=b.isSpecLike(f)?b.getLocation(r,f):null;return{pageIndex:s,location:p??{type:"Fit",spec:[]}}}l(L,"getPDFDestination");async function j(d="filename"){var r;if(!i.value)throw new Error("Current PDFDocumentProxy have not loaded yet");const a=await((r=i.value)==null?void 0:r.saveDocument()),e=new Blob([a],{type:"application/pdf"}),c=URL.createObjectURL(e),s=document.createElement("a");document.body.appendChild(s),s.href=c,s.download=d,s.style.display="none",s.click(),setTimeout(()=>{URL.revokeObjectURL(c),document.body.removeChild(s)},10)}l(j,"download");async function F(d=150,a="filename"){var R,C;if(!i.value)throw new Error("Current PDFDocumentProxy have not loaded yet");const e=await((R=i.value)==null?void 0:R.saveDocument()),s=await P.getDocument(e.buffer).promise,r=d/72,f=96/72,p=await T.createIframe(),n=p.contentWindow;n.document.title=a;const I=[...Array(s.numPages).keys()].map(y=>y+1);for(const y of I){const h=await s.getPage(y),g=h.getViewport({scale:1});y===1&&T.addStylesToIframe(n,g.width*r/f,g.height*r/f);const w=document.createElement("canvas");w.width=g.width*r,w.height=g.height*r;const O=w.cloneNode();n==null||n.document.body.appendChild(O),await(h==null?void 0:h.render({canvasContext:w.getContext("2d"),intent:"print",transform:[r,0,0,r,0,0],viewport:g}).promise),(C=O.getContext("2d"))==null||C.drawImage(w,0,0)}n==null||n.focus(),n==null||n.print(),document.body.removeChild(p)}return l(F,"print"),m.isRef(t)?(t.value&&v(t.value),m.watch(t,()=>{t.value&&v(t.value)})):t&&v(t),{pdf:u,pages:D,info:k,print:F,download:j,getPDFDestination:L,processLoadingTask:v}}l(q,"usePDF");exports.usePDF=q;
