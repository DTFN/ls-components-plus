"use strict";var k=Object.defineProperty;var c=(p,v)=>k(p,"name",{value:v,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const i=require("vue"),T=require("pdfjs-dist"),m=require("../annotations/index.cjs"),L=require("../linkService/index.cjs"),O=i.defineComponent({__name:"Annotation",props:{page:{},viewport:{},document:{},annotationsFilter:{},annotationsMap:{},imageResourcesPath:{},hideForms:{type:Boolean},enableScripting:{type:Boolean},intent:{}},emits:["annotation","annotationLoaded"],setup(p,{emit:v}){const t=p,y=v,s=i.ref(),u=i.ref();function w(o){const e=m.annotationEventsHandler(o,t.document,u.value);Promise.resolve(e).then(n=>{n&&y("annotation",n)})}c(w,"annotationsEvents");async function E(){var e;return await((e=i.toRaw(t.document))==null?void 0:e.getFieldObjects())}c(E,"getFieldObjects");async function M(){var e;return await((e=i.toRaw(t.document))==null?void 0:e.hasJSActions())}c(M,"getHasJSActions");async function h(){const o=t.page;let e=await(o==null?void 0:o.getAnnotations({intent:t.intent}));if(t.annotationsFilter){const n=t.annotationsFilter;e=e.filter(r=>{const l=r.subtype,d=r.fieldType?`${l}.${r.fieldType}`:null;return(n==null?void 0:n.includes(l))||d!==null&&(n==null?void 0:n.includes(d))})}return e}c(h,"getAnnotations");async function S(){var b,A;(A=(b=s.value).replaceChildren)==null||A.call(b);for(const a of m.EVENTS_TO_HANDLER)s.value.removeEventListener(a,w);const o=i.toRaw(t.document),e=t.page,n=t.viewport;u.value=await h();const r=new Map([]);for(const a of u.value)if(a.subtype==="Widget"&&a.fieldType==="Btn"&&a.pushButton){const f=a.rect[2]-a.rect[0],F=a.rect[3]-a.rect[1],g=document.createElement("canvas");g.setAttribute("width",(f*n.scale).toString()),g.setAttribute("height",(F*n.scale).toString()),r.set(a.id,g)}const l=o.annotationStorage;if(t.annotationsMap)for(const[a,f]of Object.entries(t.annotationsMap))l.setValue(a,f);const d={accessibilityManager:void 0,annotationCanvasMap:r,div:s.value,page:e,viewport:n.clone({dontFlip:!0}),annotationEditorUIManager:null,l10n:null},_={annotations:u.value,viewport:n.clone({dontFlip:!0}),linkService:new L.SimpleLinkService,annotationCanvasMap:r,div:s.value,annotationStorage:l,renderForms:!t.hideForms,page:e,enableScripting:!1,hasJSActions:await M(),fieldObjects:await E(),downloadManager:null,imageResourcesPath:t.imageResourcesPath};new T.AnnotationLayer(d).render(_).then(async()=>{y("annotationLoaded",await h())});for(const a of m.EVENTS_TO_HANDLER)s.value.addEventListener(a,w)}return c(S,"render"),i.watch(()=>t.viewport,()=>{t.page&&t.viewport&&s.value&&S()}),i.onMounted(()=>{t.page&&t.viewport&&s.value&&S()}),(o,e)=>(i.openBlock(),i.createElementBlock("div",{ref_key:"layer",ref:s,class:"annotationLayer",style:{display:"block"}},null,512))}});exports.default=O;
