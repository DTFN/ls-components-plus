"use strict";var _=Object.defineProperty;var s=(u,g)=>_(u,"name",{value:g,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const i=require("vue"),L=require("pdfjs-dist"),f=require("../highlight/index.cjs"),O=require("../../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/merge/index.cjs"),D=i.defineComponent({__name:"Text",props:{page:{},viewport:{},highlightText:{},highlightOptions:{}},emits:["highlight","textLoaded"],setup(u,{emit:g}){const e=u,p=g,r=i.ref(),a=i.ref();let l=[];function w(){return O.default({},{ignoreCase:!0,completeWords:!1},e.highlightOptions)}s(w,"getHighlightOptionsWithDefaults");async function v(t=!1){const n=e.page,o=await(n==null?void 0:n.getTextContent());if(o&&(t&&f.resetDivs(o,l),e.highlightText)){const h=typeof e.highlightText=="string"?[e.highlightText]:e.highlightText,c=f.findMatches(h,o,w());f.highlightMatches(c,o,l),p("highlight",{matches:c,textContent:o,textDivs:l,page:(n==null?void 0:n.pageNumber)||1})}}s(v,"findAndHighlight");function x(){var c,m;(m=(c=r.value).replaceChildren)==null||m.call(c);const t=e.page,n=e.viewport,o=t==null?void 0:t.streamTextContent({includeMarkedContent:!0,disableNormalization:!0}),h=new L.TextLayer({container:r.value,textContentSource:o,viewport:n});h.render().then(async()=>{var C;l=h.textDivs;const M=await(t==null?void 0:t.getTextContent());p("textLoaded",{textDivs:l,textContent:M});const d=document.createElement("div");d.className="endOfContent",(C=r.value)==null||C.appendChild(d),a.value=d,v()})}s(x,"render");function y(){a.value&&a.value.classList.add("active")}s(y,"onMouseDown");function T(){a.value&&a.value.classList.remove("active")}return s(T,"onMouseUp"),i.watch(()=>e.viewport,()=>{e.page&&e.viewport&&r.value&&x()}),i.watch(()=>[e.highlightText,e.highlightOptions],()=>{v(!0)},{deep:!0}),i.onMounted(()=>{e.page&&e.viewport&&r.value&&x()}),(t,n)=>(i.openBlock(),i.createElementBlock("div",{ref_key:"layer",ref:r,class:"textLayer",style:{display:"block"},onMousedown:y,onMouseup:T},null,544))}});exports.default=D;
