"use strict";var D=Object.defineProperty;var i=(x,k)=>D(x,"name",{value:k,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const o=require("vue"),A=require("pdfjs-dist"),z=;/* empty css                        */;/* empty css                         */const H=,/* empty css                  */X=;/* empty css                 */;/* empty css                  */const j=,/* empty css                                                                                          */I=o.defineComponent({name:"LSPdf"}),J=o.defineComponent({...I,props:{pdf:{},page:{default:1},scale:{default:1},rotation:{},fitParent:{type:Boolean},width:{},height:{},textLayer:{type:Boolean},imageResourcesPath:{},hideForms:{type:Boolean},intent:{default:"display"},annotationLayer:{type:Boolean},annotationsFilter:{},annotationsMap:{},watermarkText:{},watermarkOptions:{},highlightText:{},highlightOptions:{}},emits:["annotation","highlight","loaded","textLoaded","annotationLoaded","xfaLoaded","loadComplete","loadError","update:source"],setup(x,{expose:k,emit:S}){const n=x,s=S;o.watch(()=>n.pdf,()=>{W()},{immediate:!0,deep:!0});const p=o.ref(),g=o.ref(),P=o.ref(!1);let v;const u=o.computed(()=>({viewport:void 0,document:void 0,page:void 0})),b=o.computed(()=>({annotationsMap:n.annotationsMap,annotationsFilter:n.annotationsFilter,imageResourcesPath:n.imageResourcesPath,hideForms:n.hideForms,intent:n.intent})),T=o.computed(()=>({highlightText:n.highlightText,highlightOptions:n.highlightOptions}));function B(){return j.default({},{columns:4,rows:4,rotation:45,fontSize:18,color:"rgba(211, 210, 211, 0.4)"},n.watermarkOptions)}i(B,"getWatermarkOptionsWithDefaults");function _(a){if(!(typeof a=="number"&&a%90===0))return 0;const e=a/90;return e>4?_(a-360):e<0?_(a+360):a}i(_,"getRotation");function V(a){let e=n.scale;if(n.fitParent){const t=p.value.parentNode.clientWidth,r=a.getViewport({scale:1}).width;e=t/r}else if(n.width){const t=a.getViewport({scale:1}).width;e=n.width/t}else if(n.height){const t=a.getViewport({scale:1}).height;e=n.height/t}return e}i(V,"getScale");function E(a=1){if(!n.watermarkText)return;const e=L();if(!e)return;const t=e.getContext("2d");if(!t)return;const r=B(),c=n.watermarkText,l=r.columns,f=r.rows,d=l*f,m=r.rotation,y=r.fontSize*a;t.font=`${y}px Trebuchet MS`,t.fillStyle=r.color;for(let h=0;h<d;h++){const w=h%l*(e.width/l)+e.width/(l*2),q=Math.floor(h/l)*(e.height/f)+e.height/(f*2),$=t.measureText(c).width;t.save(),t.translate(w,q),t.rotate(-m*(Math.PI/180)),t.fillText(c,-$/2,y/2),t.restore()}}i(E,"paintWatermark");function L(){var e;let a=null;return(e=p.value)==null||e.childNodes.forEach(t=>{t.tagName==="CANVAS"&&(a=t)}),a}i(L,"getCurrentCanvas");function F(a){var c;let e;const t=L();t&&(t==null?void 0:t.getAttribute("role"))==="main"?e=t:(e=document.createElement("canvas"),e.style.display="block",e.setAttribute("dir","ltr"));const r=window.devicePixelRatio||1;return e.width=Math.floor(a.width*r),e.height=Math.floor(a.height*r),e.style.width=`${Math.floor(a.width)}px`,e.style.height=`${Math.floor(a.height)}px`,e.setAttribute("class","pdf-canvas"),(c=p.value)==null||c.style.setProperty("--scale-factor",`${a.scale}`),g.value.style.width=`${Math.floor(a.width)}px`,g.value.style.height=`${Math.floor(a.height)}px`,g.value.style.top="0",g.value.style.left="0",P.value=!0,e}i(F,"setupCanvas");function C(){v&&v.cancel()}i(C,"cancelRender");function M(a){var e;(e=o.toRaw(u.value.document))==null||e.getPage(a).then(t=>{var w;C();const r=t.getViewport(),c={scale:V(t),rotation:_((n.rotation||0)+r.rotation)},l=t.getViewport(c),f=L(),d=F(l),m=window.devicePixelRatio||1,y=m!==1?[m,0,0,m,0,0]:void 0,h={canvasContext:d.getContext("2d"),viewport:l,annotationMode:n.hideForms?A.AnnotationMode.ENABLE:A.AnnotationMode.ENABLE_FORMS,transform:y,intent:n.intent};(d==null?void 0:d.getAttribute("role"))!=="main"?f&&((w=p.value)==null||w.replaceChild(d,f)):d.removeAttribute("role"),u.value.page=t,u.value.viewport=l,v=t.render(h),v.promise.then(()=>{P.value=!1,E(l.scale),s("loaded",u.value.viewport),s("loadComplete")}).catch(()=>{s("loadError")})})}i(M,"renderPage");function N(a){a.promise&&a.promise.then(async e=>{u.value.document=e,M(n.page)})}i(N,"initDoc"),o.watch(()=>[n.page,n.scale,n.width,n.height,n.rotation,n.hideForms,n.intent],()=>{M(n.page)});function O(){M(n.page)}i(O,"reload");function R(){C()}i(R,"cancel");async function W(){if(n.pdf)try{N(n.pdf)}finally{}}return i(W,"initPdf"),k({reload:O,cancel:R}),(a,e)=>(o.openBlock(),o.createElementBlock("div",{ref_key:"container",ref:p,style:{position:"relative",display:"block"}},[e[5]||(e[5]=o.createElementVNode("canvas",{dir:"ltr",style:{display:"block"},role:"main"},null,-1)),a.annotationLayer?(o.openBlock(),o.createBlock(z.default,o.mergeProps({key:0},{...o.unref(u),...o.unref(b)},{onAnnotation:e[0]||(e[0]=t=>s("annotation",t)),onAnnotationLoaded:e[1]||(e[1]=t=>s("annotationLoaded",t))}),null,16)):o.createCommentVNode("",!0),a.textLayer?(o.openBlock(),o.createBlock(H.default,o.mergeProps({key:1},{...o.unref(u),...o.unref(T)},{onHighlight:e[2]||(e[2]=t=>s("highlight",t)),onTextLoaded:e[3]||(e[3]=t=>s("textLoaded",t))}),null,16)):o.createCommentVNode("",!0),o.createVNode(X.default,o.mergeProps({...o.unref(u)},{onXfaLoaded:e[4]||(e[4]=t=>s("xfaLoaded"))}),null,16),o.withDirectives(o.createElementVNode("div",{ref_key:"loadingLayer",ref:g,style:{position:"absolute"}},[o.renderSlot(a.$slots,"default")],512),[[o.vShow,o.unref(P)]])],512))}});exports.default=J;
