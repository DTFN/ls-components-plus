"use strict";var te=Object.defineProperty;var a=(z,V)=>te(z,"name",{value:V,configurable:!0});Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),F=require("../../../../../node_modules/.pnpm/@vueuse_core@12.0.0_typescript@5.5.4/node_modules/@vueuse/core/index/index.cjs"),oe=require("../../_hooks/useNamespace/index.cjs"),se=require("../../_hooks/useZIndex/index.cjs"),E=require("../../_constants/aria/index.cjs"),h=require("../../_utils/check/index.cjs"),ae=require("../../_utils/types/index.cjs"),re=require("../types/index.cjs"),le=require("../../_constants/prviewType/index.cjs"),d=require("../../icon/Index.vue/index.cjs"),D=require("../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/throttle/index.cjs"),j=require("../../../../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/merge/index.cjs"),ie=["src"],ce=["src"],ue=e.defineComponent({name:"LSImage"}),de=e.defineComponent({...ue,props:re.imageViewerProps,emits:le.previewEmits,setup(z,{expose:V,emit:Z}){const v={CONTAIN:{name:"FullScreen"},ORIGINAL:{name:"ScaleToOriginal"}},H=h.isFirefox()?"DOMMouseScroll":"mousewheel",l=z,b=Z,B=e.useAttrs(),s=oe.useNamespace("image"),{nextZIndex:P}=se.useZIndex(),I=e.ref(),T=e.ref([]),L=e.effectScope(),k=e.ref(!0),f=e.ref(l.initialIndex),N=e.shallowRef(v.CONTAIN),r=e.reactive({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"auto",height:"auto",objectFit:"none"}),G=e.computed(()=>{const{source:n}=l||{};return h.isString(n)||n.length<=1}),S=e.computed(()=>f.value===0),M=e.computed(()=>{const n=l.source;return f.value===n.length-1}),W=e.computed(()=>(l.source||{})[f.value]),q=e.computed(()=>{const{scale:n,deg:o,offsetX:t,offsetY:i,enableTransition:u,width:w,height:x,objectFit:C}=r;let m=t/n,p=i/n;switch(o%360){case 90:case-270:[m,p]=[p,-m];break;case 180:case-180:[m,p]=[-m,-p];break;case 270:case-90:[m,p]=[-p,m];break}const g={transform:`scale(${n}) rotate(${o}deg) translate(${m}px, ${p}px)`,transition:u?"transform .3s":""};return N.value.name===v.CONTAIN.name&&(g.maxWidth=g.maxHeight="100%"),g.width=w,g.height=x,g.objectFit=C,g}),J=e.computed(()=>h.isNumber(l.zIndex)?l.zIndex:P()),K=a(()=>{l.onClose&&l.onClose(),b("update:source",[])},"closeFunc");function y(){U(),K()}a(y,"hide");function Q(){const n=D.default(t=>{switch(t.code){case E.EVENT_CODE.esc:l.closeOnPressEscape&&y();break;case E.EVENT_CODE.space:X();break;case E.EVENT_CODE.left:Y();break;case E.EVENT_CODE.up:c("zoomIn");break;case E.EVENT_CODE.right:_();break;case E.EVENT_CODE.down:c("zoomOut");break}}),o=D.default(t=>{(t.wheelDelta?t.wheelDelta:-t.detail)>0?c("zoomIn",{zoomRate:1.2,enableTransition:!1}):c("zoomOut",{zoomRate:1.2,enableTransition:!1})});L.run(()=>{F.useEventListener(document,"keydown",n),F.useEventListener(document,H,o)})}a(Q,"registerEventListener");function U(){L.stop()}a(U,"unregisterEventListener");function A(){k.value=!1,b("loadComplete")}a(A,"handleImgLoad");function R(n){k.value=!1,n.target.alt="ls.image.error",b("loadError")}a(R,"handleImgError");function $(n){if(k.value||n.button!==0||!I.value)return;r.enableTransition=!1;const{offsetX:o,offsetY:t}=r,i=n.pageX,u=n.pageY,w=D.default(C=>{r.offsetX=o+C.pageX-i,r.offsetY=t+C.pageY-u}),x=F.useEventListener(document,"mousemove",w);F.useEventListener(document,"mouseup",()=>{x()}),n.preventDefault()}a($,"handleMouseDown");function ee(){j.default(r,{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"auto",height:"auto",objectFit:"none"})}a(ee,"reset");function ne(){j.default(r,{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1,width:"100%",height:"100%",objectFit:"cover"})}a(ne,"fullScreen");function X(){if(k.value)return;const n=ae.keysOf(v),o=Object.values(v),t=N.value.name,u=(o.findIndex(w=>w.name===t)+1)%n.length;N.value=v[n[u]],t===v.CONTAIN.name?ne():ee()}a(X,"toggleMode");function O(n){const t=l.source.length;f.value=(n+t)%t}a(O,"setActiveItem");function Y(){S.value&&!l.infinite||O(f.value-1)}a(Y,"prev");function _(){M.value&&!l.infinite||O(f.value+1)}a(_,"next");function c(n,o={}){if(k.value)return;const{zoomRate:t,rotateDeg:i,enableTransition:u}={zoomRate:1.4,rotateDeg:90,enableTransition:!0,...o};switch(n){case"zoomOut":r.scale>.2&&(r.scale=Number.parseFloat((r.scale/t).toFixed(3)));break;case"zoomIn":r.scale<7&&(r.scale=Number.parseFloat((r.scale*t).toFixed(3)));break;case"clockwise":r.deg+=i;break;case"anticlockwise":r.deg-=i;break;case"download":b("download",B.downloadData);break}r.enableTransition=u}return a(c,"handleActions"),e.watch(W,()=>{e.nextTick(()=>{const n=T.value[0];n!=null&&n.complete||(k.value=!0)})}),e.watch(f,n=>{b("switch",n)}),e.onMounted(()=>{var n,o;Q(),(o=(n=I.value)==null?void 0:n.focus)==null||o.call(n)}),V({setActiveItem:O}),(n,o)=>(e.openBlock(),e.createElementBlock("div",null,[(e.openBlock(),e.createBlock(e.Teleport,{to:"body",disabled:!n.teleported},[e.createVNode(e.Transition,{name:"viewer-fade",appear:""},{default:e.withCtx(()=>[e.createElementVNode("div",{ref_key:"wrapper",ref:I,tabindex:-1,class:e.normalizeClass(e.unref(s).e("wrapper")),style:e.normalizeStyle({zIndex:e.unref(J)})},[e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("mask")),onClick:o[0]||(o[0]=e.withModifiers(t=>n.hideOnClickModal&&y(),["self"]))},null,2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("close")]),onClick:y},[e.createVNode(d.default,{name:"Close",size:24,color:"#FFF"})],2),e.unref(G)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("prev"),e.unref(s).is("disabled",!n.infinite&&e.unref(S))]),onClick:Y},[e.createVNode(d.default,{name:"ArrowLeft",size:24,color:"#FFF"})],2),e.createElementVNode("span",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("next"),e.unref(s).is("disabled",!n.infinite&&e.unref(M))]),onClick:_},[e.createVNode(d.default,{name:"ArrowRight",size:24,color:"#FFF"})],2)],64)),e.createElementVNode("div",{class:e.normalizeClass([e.unref(s).e("btn"),e.unref(s).e("actions")])},[e.createElementVNode("div",{class:e.normalizeClass(e.unref(s).e("actions__inner"))},[e.createVNode(d.default,{name:"ZoomOut",size:24,color:"#FFF",onClick:o[1]||(o[1]=t=>c("zoomOut"))}),e.createVNode(d.default,{name:"ZoomIn",size:24,color:"#FFF",onClick:o[2]||(o[2]=t=>c("zoomIn"))}),e.createElementVNode("i",{class:e.normalizeClass(e.unref(s).e("actions__divider"))},null,2),e.createVNode(d.default,{name:e.unref(N).name,size:24,color:"#FFF",onClick:X},null,8,["name"]),e.createElementVNode("i",{class:e.normalizeClass(e.unref(s).e("actions__divider"))},null,2),e.createVNode(d.default,{name:"RefreshLeft",size:24,color:"#FFF",onClick:o[3]||(o[3]=t=>c("anticlockwise"))}),e.createVNode(d.default,{name:"RefreshRight",size:24,color:"#FFF",onClick:o[4]||(o[4]=t=>c("clockwise"))}),e.unref(B).hasDownload?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("i",{class:e.normalizeClass(e.unref(s).e("actions__divider"))},null,2),e.createVNode(d.default,{name:"Download",size:24,color:"#FFF",onClick:o[5]||(o[5]=t=>c("download"))})],64)):e.createCommentVNode("",!0)],2)],2),n.source?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(e.unref(s).e("canvas"))},[e.unref(h.isArray)(n.source)?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(n.source,(t,i)=>e.withDirectives((e.openBlock(),e.createElementBlock("img",{ref_for:!0,ref:a(u=>e.unref(T)[i]=u,"ref"),key:t,src:t,style:e.normalizeStyle(e.unref(q)),class:e.normalizeClass(e.unref(s).e("img")),onLoad:A,onError:R,onMousedown:$},null,46,ie)),[[e.vShow,i===e.unref(f)]])),128)):(e.openBlock(),e.createElementBlock("img",{ref:a(t=>e.unref(T)[0]=t,"ref"),key:n.source,src:n.source,style:e.normalizeStyle(e.unref(q)),class:e.normalizeClass(e.unref(s).e("img")),onLoad:A,onError:R,onMousedown:$},null,46,ce))],2)):e.createCommentVNode("",!0),e.renderSlot(n.$slots,"default",{},void 0,!0)],6)]),_:3})],8,["disabled"]))]))}});exports.default=de;
